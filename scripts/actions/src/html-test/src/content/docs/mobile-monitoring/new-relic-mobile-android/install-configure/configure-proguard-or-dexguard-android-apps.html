
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJ0aXAifV0=">
  <p><strong>Admins or Owner</strong></p>
</div>
<p>Follow these instructions to support ProGuard or DexGuard with New Relic Mobile for Android. Check <a href="/docs/mobile-monitoring/new-relic-mobile-android/get-started/new-relic-android-compatibility-requirements">our Android compatibility and requirements</a>, and if you have previously installed the Android agent SDK for New Relic Mobile, follow the <a href="/docs/mobile-apps/android-1-upgrade">steps before upgrading</a> to the latest version with ProGuard or DexGuard.</p>
<h2>Configure ProGuard [#proguard]</h2>
<p>To add support for <a href="http://proguard.sourceforge.net/manual/usage.html">ProGuard</a>:</p>
<ol>
  <li>
    <p>Add a New Relic Mobile exclusion to your app; for example:</p>
    <ul>
      <li>To support New Relic instrumentation, add <code>keep class</code>.</li>
      <li>To disable warnings related to unresolved problems, add <code>dont warn</code>.</li>
      <li>To preserve line numbers for crash reporting, add <code>LineNumberTable</code>.</li>
      <li>To preserve stack information for handled exceptions, add <code>SourceFile</code> and <code>EnclosingMethod.</code></li>
    </ul>
  </li>
  <li>
    <p>Add the following to your <a href="#proguard-library">ProGuard config file</a> (<code>proguard.cfg</code>, <code>proguard-android.txt</code>, <code>proguard-rules.pro</code>, etc.):</p>
    <pre><code>-keep class com.newrelic.** { *; }
-dontwarn com.newrelic.**
-keepattributes Exceptions, Signature, InnerClasses, LineNumberTable, SourceFile, EnclosingMethod
</code></pre>
  </li>
  <li>
    <p>Clean and rebuild your project.</p>
  </li>
  <li>
    <p>Run your app in an emulator or device to start seeing data on your mobile app's <a href="/docs/mobile-apps/mobile-apps-dashboard"><strong>Overview</strong> page</a>.</p>
  </li>
  <li>
    <p>Optional: Use the New Relic Mobile <strong>Settings</strong> page to <a href="/docs/mobile-apps/customizing-your-mobile-app-settings">customize your mobile app</a>.</p>
  </li>
</ol>
<p>If no data appears, review your <code>logcat</code> output for errors.</p>
<h2>Network library support [#proguard-library]</h2>
<p>New Relic instrumentation happens before ProGuard obfuscates your code. In order for these libraries to be properly instrumented, their classes must not be obfuscated by ProGuard.</p>
<p>Here are examples of rules to be applied to preserve these classes. This is not a complete list. Different rules will be needed depending on your library or version.</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p><strong>Library</strong></p>
      </div>
      <div>
        <p><strong>Rules</strong></p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p>Apache Http</p>
      </div>
      <div>
        <pre><code>-keep class org.apache.http.** { *; }
-dontwarn org.apache.http.**

</code></pre>
      </div>
    </div>
    <div>
      <div>
        <p>OkHttp 2</p>
      </div>
      <div>
        <pre><code>-keep class com.squareup.okhttp.* { *; }
-dontwarn com.squareup.okhttp.**
-dontwarn okio.**

</code></pre>
      </div>
    </div>
    <div>
      <div>
        <p>OkHttp 3</p>
      </div>
      <div>
        <pre><code>-keep class okhttp3.** { *; }
-dontwarn okhttp3.**
-dontwarn okio.**

</code></pre>
      </div>
    </div>
    <div>
      <div>
        <p>Retrofit 2</p>
      </div>
      <div>
        <pre><code>-keep class retrofit2.** { *; }
-dontwarn retrofit2.**

</code></pre>
      </div>
    </div>
  </div>
</div>
<h2>Configure DexGuard [#dexguard]</h2>
<p>DexGuard uses the same configuration options as ProGuard, and it can read any pre-existing ProGuard configuration files. DexGuard also has its own set of additional configuration options and provides sample configurations for many common app frameworks.</p>
<p>To add support for <strong>DexGuard</strong>:</p>
<ol>
  <li>
    <p>Add DexGuard to your app and set up the Gradle plugin according to the directions from DexGuard.</p>
  </li>
  <li>
    <p>Create a <code>dexguard-project.txt</code> file to hold specific DexGuard configuration options, and add:</p>
    <pre><code>-dontnote com.newrelic.agent.android.NewRelic
-dontnote com.newrelic.agent.android.harvest.crash.Crash
</code></pre>
  </li>
  <li>
    <p>After the DexGuard plugin has been configured, verify that your app's <code>buildTypes</code> configuration is similar to this:</p>
    <pre><code>buildTypes {
   release {
      minifyEnabled true
      proguardFile getDefaultDexGuardFile('dexguard-release.pro')
      proguardFile 'proguard-rules.pro'
      proguardFile 'dexguard-project.txt'
   } ...
</code></pre>
  </li>
  <li>
    <p>Clean and rebuild your project.</p>
  </li>
  <li>
    <p>Run your app in an emulator or device to start seeing data on your mobile app's <a href="/docs/mobile-apps/mobile-apps-dashboard"><strong>Overview</strong> page</a>.</p>
  </li>
  <li>
    <p>Optional: Use the New Relic Mobile <strong>Settings</strong> page to <a href="/docs/mobile-apps/customizing-your-mobile-app-settings">customize your mobile app</a>.</p>
  </li>
</ol>
<p>If no data appears, review your <code>logcat</code> output for errors.</p>
