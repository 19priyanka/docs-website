
<p><a href="https://developer.android.com/topic/instant-apps/index.html">Android Instant Apps</a> allow users to quickly use your applications without installation. With the Mobile Android agent <a href="/docs/release-notes/mobile-release-notes/android-release-notes/android-5170">version 5.17.0</a> and higher, you can use New Relic to detect and instrument all feature modules for an instant app.</p>
<p>Use this documentation along with the standard New Relic procedures to <a href="/docs/mobile-monitoring/new-relic-mobile-android/install-configure/install-android-apps-gradle-android-studio">install Android apps with Gradle and Android Studio</a>. After following the standard installation procedures, follow these additional steps for Android instant apps.</p>
<h2>Terminology</h2>
<p>This procedure uses the following terms that are specific to the Android Instant Apps plugin:</p>
<ul>
  <li><strong>Module</strong>: Any packaged class and/or resource collection</li>
  <li><strong>APK</strong>: A module that packages the apps resources and DEX’ed classes</li>
  <li><strong>Feature module</strong>: A slimmed down module that contains only a subset of the total APK</li>
</ul>
<h2>Install the plugin [#install]</h2>
<p>To install the New Relic plugin for Android Instant Apps:</p>
<ol>
  <li>
    <p>First follow the steps in the <a href="/docs/mobile-monitoring/new-relic-mobile-android/install-configure/install-android-apps-gradle-android-studio">Install Android apps with Gradle and Android Studio</a> documentation.</p>
  </li>
  <li>
    <p>Apply the agent plugin in every project Gradle build file.</p>
  </li>
  <li>
    <p>List the Android agent as a dependency.</p>
  </li>
  <li>
    <p>Start the agent from each <a href="https://developer.android.com/reference/android/app/Activity.html">Activity class</a> in the feature that could be side-loaded through a Digital Asset Link intent, (for example, mobile.example.com/signin).</p>
    <div data-component="CollapserGroup" data-prop="W10=">
      <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiYnVpbGQuZ3JhZGxlIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJNaW5pbWFsIGJ1aWxkLmdyYWRsZSBleGFtcGxlIn1d">
        <div data-prop-text="title">Minimal build.gradle example</div>
        <pre><code>apply plugin: ‘com.android.[application|library|feature|instantapp]'

apply plugin: ‘newrelic’

dependencies {

    implementation "com.newrelic.agent.android:android-agent:${project.agentVersion}"

}

</code></pre>
      </div>
    </div>
  </li>
  <li>
    <p>Review the considerations for <a href="#instrument">instrumentation</a>.</p>
  </li>
</ol>
<h2>Instrumentation [#instrument]</h2>
<p>When instrumenting an instant app, be aware of the following considerations with APKs:</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p><strong>Instant apps and APKs</strong></p>
      </div>
      <div>
        <p><strong>Comments</strong></p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p>Instrumentation</p>
      </div>
      <div>
        <ul>
          <li>Instrumentation of instant apps behaves the same as instrumentation with a normal APK. The agent will detect when an APK is an instant app. For feature APKs, the agent will inject a unique build ID that instant apps will use when reporting crashes.</li>
          <li>The side-loaded (main) activity of every feature must call <code>NewRelic.start()</code> when the activity is created (as per normal instructions).</li>
        </ul>
      </div>
    </div>
    <div>
      <div>
        <p>ProGuard and Dexguard support for feature and application APKs</p>
      </div>
      <div>
        <p>Place the <code>newrelic.properties</code> file in the root (main) directory of the project.</p>
      </div>
    </div>
  </div>
</div>
<h2>ProGuard and Dexguard support [#proguard]</h2>
<p>The Android Studio Gradle plugin will obfuscate any build configuration where <code>minifyEnabled</code> is set to <code>true</code>. In these conditions, the New Relic agent will forward the ProGuard map generated for the build to crash collectors, tagged with a unique build ID generated by the agent.</p>
<p>Obfuscation is best configured in the application or instant app project that includes other modules as dependencies. Modules may configure ProGuard as needed.</p>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
  <p>When using ProGuard or DexGuard with Android apps, follow the procedures to complete the additional, required configuration steps. For more information, see the <a href="https://docs.newrelic.com/docs/mobile-monitoring/new-relic-mobile-android/install-configure/configure-proguard-or-dexguard-android-apps">ProGuard and DexGuard configuration</a> documentation.</p>
</div>
<h2>Troubleshoot auto-instrumentation [#troubleshooting]</h2>
<p>If you are not whether the agent is auto-instrumenting an instant app project, try running these steps:</p>
<ol>
  <li>
    <p>Build app with <code>debug</code> (<code>-d</code>, <code>--debug</code>) option, and capture the build log.</p>
  </li>
  <li>
    <p>Search the log for evidence of instant apps by looking for either of these terms:</p>
    <ul>
      <li>
        <pre><code>This appears to be an Instant App
</code></pre>
      </li>
      <li>
        <pre><code>BuildId[1a2b34c5-def6-7890-g123-h4567890a]
</code></pre>
      </li>
    </ul>
  </li>
  <li>
    <p>The agent will add an attribute named <code>'instantApp'</code> to the app's Insights session attributes if the app appears to be an instant app.</p>
  </li>
</ol>
