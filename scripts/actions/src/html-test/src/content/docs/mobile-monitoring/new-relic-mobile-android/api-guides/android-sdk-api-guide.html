
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
  <p>Starting with version 5.9.0 of the New Relic Android agent, you can set a custom user identifier value to associate user sessions with analytics events and attributes. For more information, see the <a href="/docs/mobile-monitoring/new-relic-mobile-android/android-sdk-api/set-user-id"><code>NewRelic.setUserId</code> method</a>.</p>
</div>
<p>New Relic Mobile's Android agent provides an SDK API to set up <a href="/docs/mobile-monitoring/new-relic-mobile/maintenance/add-custom-data-new-relic-mobile">custom instrumentation</a> for monitoring your application. The API gives you the ability to:</p>
<ul>
  <li><a href="#instrumenting">Instrument your own code</a>.</li>
  <li><a href="#creating">Create</a>, <a href="#naming">name</a>, and <a href="#ending">end</a> interaction traces from events in your mobile app.</li>
  <li><a href="#create-custom">Record custom metrics</a>.</li>
  <li><a href="#attributes-events-insights">Send custom attributes and events to New Relic Insights</a>.</li>
  <li><a href="#track-custom">Track networking from libraries not supported automatically</a>.</li>
</ul>
<h2>Install the SDK [#installing]</h2>
<p>Before using the Android SDK API:</p>
<ol>
  <li>Review the <a href="/docs/release-notes/mobile-release-notes/android-release-notes">Android SDK API release notes</a> to ensure you have your app instrumented with a current SDK for New Relic Mobile.</li>
  <li>Follow the <strong>Add a new app</strong> instructions in <a href="https://rpm.newrelic.com/mobile">rpm.newrelic.com/mobile</a>.</li>
</ol>
<p>For more information, see the detailed <a href="/docs/mobile-monitoring/new-relic-mobile-android/install-configure">Android installation and configuration procedures</a>. If you need to support Android 2.2, see the <a href="/docs/mobile-monitoring/mobile-monitoring-installation/android/installing-android-apps-android-22-support">legacy Android agent SDK procedures</a>.</p>
<h2>Instrument your code [#instrumenting]</h2>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJjYXV0aW9uIn1d">
  <p>Tracing is heavily optimized, but it does impose a performance overhead. Avoid instrumenting methods that are expected to be called hundreds of times.</p>
</div>
<p>If you have custom libraries or application code that you want to include in interaction traces:</p>
<ol>
  <li>
    <p>Use the following Java annotation:</p>
    <pre><code>import com.newrelic.agent.android.instrumentation.Trace;
</code></pre>
  </li>
  <li>
    <p>Add the <code>@Trace</code> annotation to the <a href="#methods-instrumented">methods</a> you want to instrument:</p>
    <pre><code>@Trace
  public void myHeavyweightMethod() {
  …
</code></pre>
  </li>
  <li>
    <p>To tell New Relic Mobile what kind of method is being traced, use the optional <a href="#cat-example"><code>category</code> attribute</a>.</p>
  </li>
</ol>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoibWV0aG9kcy1pbnN0cnVtZW50ZWQifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IkF1dG9tYXRpY2FsbHkgaW5zdHJ1bWVudGVkIG1ldGhvZHMifV0=">
    <div data-prop-text="title">Automatically instrumented methods</div>
    <p>Automatic instrumentation is one of the agent's more convenient features. However, if it interferes with the method being traced, add <code>@SkipTrace</code> to the method, and the agent will skip it during compile time instrumentation.</p>
    <div data-component="Table" data-prop="W10=">
      <div>
        <div>
          <div>
            <p><strong>Classes</strong></p>
          </div>
          <div>
            <p><strong>Methods</strong></p>
          </div>
        </div>
      </div>
      <div></div>
      <div>
        <div>
          <div>
            <p><code>Activity</code></p>
          </div>
          <div>
            <ul>
              <li><code>onCreate</code></li>
              <li><code>onCreateView</code></li>
            </ul>
          </div>
        </div>
        <div>
          <div>
            <p><code>AsyncTask</code></p>
          </div>
          <div>
            <ul>
              <li><code>execute</code></li>
              <li><code>executeOnExecutor</code></li>
            </ul>
          </div>
        </div>
        <div>
          <div>
            <p><code>BitmapFactory</code></p>
          </div>
          <div>
            <ul>
              <li><code>decodeFile</code></li>
              <li><code>decodeResourceStream</code></li>
              <li><code>decodeResource</code></li>
              <li><code>decodeByteArray</code></li>
              <li><code>decodeStream</code></li>
              <li><code>decodeFileDescriptor</code></li>
              <li><code>decodeResourceStream</code></li>
            </ul>
          </div>
        </div>
        <div>
          <div>
            <p><code>SQLiteDatabase</code></p>
          </div>
          <div>
            <ul>
              <li><code>query</code></li>
              <li><code>queryWithFactory</code></li>
              <li><code>rawQuery</code></li>
              <li><code>rawQueryWithFactory</code></li>
              <li><code>insert</code></li>
              <li><code>insertOrThrow</code></li>
              <li><code>insertWithOnConflict</code></li>
              <li><code>replace</code></li>
              <li><code>replaceOrThrow</code></li>
              <li><code>delete</code></li>
              <li><code>update</code></li>
              <li><code>updateWithOnConflict</code></li>
              <li><code>execSql</code></li>
            </ul>
          </div>
        </div>
        <div>
          <div>
            <p><code>GSON</code></p>
          </div>
          <div>
            <ul>
              <li><code>toJson</code></li>
              <li><code>fromJson</code></li>
            </ul>
          </div>
        </div>
        <div>
          <div>
            <p><code>JSONObject</code></p>
          </div>
          <div>
            <ul>
              <li><code>&#x3C;init></code></li>
              <li><code>toString</code></li>
            </ul>
          </div>
        </div>
        <div>
          <div>
            <p><code>JSONArray</code></p>
          </div>
          <div>
            <ul>
              <li><code>&#x3C;init></code></li>
              <li><code>toString</code></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiY2F0LWV4YW1wbGUifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IkNhdGVnb3J5IGF0dHJpYnV0ZSBleGFtcGxlIn1d">
    <div data-prop-text="title">Category attribute example</div>
    <p>The category can be a custom name, or it can be one of the predefined <code>MetricCategory</code> enums (listed below). Here is an example of instrumenting an image processing method using the predefined <code>IMAGE</code> category:</p>
    <pre><code>@Trace(category = MetricCategory.IMAGE)
public void processImageData() {
…

</code></pre>Available `MetricCategory` enums include:
    &#x3C;Table>
    &#x3C;thead>
    &#x3C;tr>
    &#x3C;th width={200}>
    **MetricCategory**
    &#x3C;/th>
    &#x3C;th>
    **Description**
    &#x3C;/th>
    &#x3C;/tr>
    &#x3C;/thead>
    &#x3C;tbody>
    &#x3C;tr>
    &#x3C;td>
    `VIEW_LOADING`
    &#x3C;/td>
    &#x3C;td>
    Creating sub views, controls, and other related tasks
    &#x3C;/td>
    &#x3C;/tr>
    &#x3C;tr>
    &#x3C;td>
    `VIEW_LAYOUT`
    &#x3C;/td>
    &#x3C;td>
    Inflation of layouts, resolving components
    &#x3C;/td>
    &#x3C;/tr>
    &#x3C;tr>
    &#x3C;td>
    `DATABASE`
    &#x3C;/td>
    &#x3C;td>
    SQLite and other file I/O
    &#x3C;/td>
    &#x3C;/tr>
    &#x3C;tr>
    &#x3C;td>
    `IMAGE`
    &#x3C;/td>
    &#x3C;td>
    Image loading and processing
    &#x3C;/td>
    &#x3C;/tr>
    &#x3C;tr>
    &#x3C;td>
    `JSON`
    &#x3C;/td>
    &#x3C;td>
    JSON parsing or creation
    &#x3C;/td>
    &#x3C;/tr>
    &#x3C;tr>
    &#x3C;td>
    `NETWORK`
    &#x3C;/td>
    &#x3C;td>
    Web service integration methods, remote resource loading
    &#x3C;/td>
    &#x3C;/tr>
    &#x3C;/tbody>
    &#x3C;/Table>
  </div>
</div>
<h2>Use the API methods [#using-api]</h2>
<p>The following table lists <a href="/docs/mobile-monitoring/new-relic-mobile-android/android-sdk-api">all the New Relic Android SDK API calls</a>, ordered by common use cases.</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>If you want to...</p>
      </div>
      <div>
        <p>Do this</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p>Track app activity that may be helpful for troubleshooting crashes</p>
      </div>
      <div>
        <p>See <a href="/docs/mobile-monitoring/new-relic-mobile-android/android-sdk-api/recordbreadcrumb"><code>recordBreadcrumb</code></a>.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Track a method as an interaction</p>
      </div>
      <div>
        <p>See <a href="/docs/mobile-monitoring/new-relic-mobile-android/android-sdk-api/startinteraction-android-agent-api"><code>startInteraction</code></a>.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Name or rename an interaction</p>
      </div>
      <div>
        <p>See <a href="/docs/mobile-monitoring/new-relic-mobile-android/android-sdk-api/setinteractionname-android-agent-api"><code>setInteractionName</code></a>.</p>
      </div>
    </div>
    <div>
      <div>
        <p>End an interaction</p>
      </div>
      <div>
        <p>See <a href="/docs/mobile-monitoring/new-relic-mobile-android/android-sdk-api/endinteraction-android-agent-api"><code>endInteraction</code></a>.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Disable or enable all interactions</p>
      </div>
      <div>
        <p>See <a href="/docs/mobile-monitoring/new-relic-mobile-android/android-sdk-api/withinteractiontracing-android-agent-api"><code>withInteractionTracing</code></a>.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Set an app version associated with an interaction</p>
      </div>
      <div>
        <p>See <a href="/docs/mobile-monitoring/new-relic-mobile-android/android-sdk-api/withapplicationversion-android-agent-api"><code>withApplicationVersion</code></a>.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Set custom build ID</p>
      </div>
      <div>
        <p>See <a href="/docs/mobile-monitoring/new-relic-mobile-android/android-sdk-api/withapplicationbuild-android-agent-api"><code>withApplicationBuild</code></a>.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Create custom metrics</p>
      </div>
      <div>
        <p>See <a href="/docs/mobile-monitoring/new-relic-mobile-android/android-sdk-api/recordmetric-android-agent-api"><code>recordMetric</code></a>.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Send custom attributes and events to Insights</p>
      </div>
      <div>
        <p>There are several ways to add custom attributes and events. For more about which would be the best method to use and why, see <a href="/docs/mobile-monitoring/new-relic-mobile/maintenance/add-custom-data-new-relic-mobile">Add custom data</a>.</p>
        <ul>
          <li>Create an attribute: <a href="/docs/mobile-monitoring/new-relic-mobile-android/android-sdk-api/setattribute-android-agent-api"><code>setAttribute</code></a></li>
          <li>Increment an attribute count: <a href="/docs/mobile-monitoring/new-relic-mobile-android/android-sdk-api/incrementattribute-android-agent-api"><code>incrementAttribute</code></a></li>
          <li>Remove an attribute: <a href="/docs/mobile-monitoring/new-relic-mobile-android/android-sdk-api/removeattribute-android-agent-api"><code>removeAttribute</code></a></li>
          <li>Remove all attributes: <a href="/docs/mobile-monitoring/new-relic-mobile-android/android-sdk-api/removeallattributes-android-agent-api"><code>removeAllAttributes</code></a></li>
          <li>Record custom Insights event: <a href="/docs/mobile-monitoring/new-relic-mobile-android/android-sdk-api/recordevent-android-agent-api"><code>recordCustomEvent</code></a></li>
          <li>Record a breadcrumb event: <a href="/docs/mobile-monitoring/new-relic-mobile-android/android-sdk-api/recordbreadcrumb"><code>recordBreadcrumb</code></a></li>
          <li>Set the maximum size of an event pool: <a href="/docs/mobile-monitoring/new-relic-mobile-android/android-sdk-api/setmaxeventpoolsize-android-agent-api"><code>setMaxEventPoolSize</code></a></li>
          <li>Set maximum time agent stores events in memory: <a href="/docs/mobile-monitoring/new-relic-mobile-android/android-sdk-api/setmaxeventbuffertime-android-agent-api"><code>setMaxEventBufferTime</code></a></li>
          <li>Return the current session's ID: <a href="/docs/mobile-monitoring/new-relic-mobile-android/android-sdk-api/currentsessionid-android-agent-api"><code>currentSessionId</code></a></li>
          <li>Set custom user ID for associating sessions with events and attributes: <a href="/docs/mobile-monitoring/new-relic-mobile-android/android-sdk-api/setuserid-android-agent-api"><code>setUserId</code></a></li>
        </ul>
      </div>
    </div>
    <div>
      <div>
        <p>Track custom network requests and failures</p>
      </div>
      <div>
        <p>Use these methods:</p>
        <ul>
          <li>Record HTTP transactions at varying levels of detail: See <a href="/docs/mobile-monitoring/new-relic-mobile-android/android-sdk-api/noticehttptransaction-android-agent-api"><code>noticeHttpTransaction</code></a>.</li>
          <li>Record network failures: See <a href="/docs/mobile-monitoring/new-relic-mobile-android/android-sdk-api/noticenetworkfailure-android-agent-api"><code>noticeNetworkFailure</code></a>.</li>
        </ul>
      </div>
    </div>
    <div>
      <div>
        <p>Record a handled exception as an event, including context</p>
      </div>
      <div>
        <p>See <code>recordHandledException()</code>.</p>
      </div>
    </div>
  </div>
</div>
<h2>Manual cross application tracing [#manual-cat]</h2>
<p>The <code>noticeHttpTransaction</code> code does not automatically append the appropriate header ID value needed to get <a href="/docs/apm/traces/cross-application-traces/cross-application-tracing">cross application tracing</a> to work. This is why you will not see the application link in your Android app on New Relic's <a href="/docs/mobile-monitoring/mobile-monitoring-ui/network-dashboards/map-dashboard-mobile-apps"><strong>Map</strong> page</a> for mobile apps or on the <a href="/docs/mobile-monitoring/mobile-monitoring-ui/network-dashboards/http-requests-dashboard"><strong>HTTP requests</strong> page</a>.</p>
<p>You can use a public method in the New Relic Android SDK to get the appropriate ID to pass along with your HTTP request to your back-end application, as long as it is already instrumented by New Relic. The appropriate header ID will be passed from the back-end application in the response, providing everything needed for cross application tracing to function.</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZXhhbXBsZS10aXRsZSJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiQ3Jvc3MgYXBwbGljYXRpb24gdHJhY2luZyBleGFtcGxlIn1d">
    <div data-prop-text="title">Cross application tracing example</div>
    <p>This example adds the <code>NewRelic-ID</code> to the back-end HTTP request, with <code>conn</code> as the external HTTP connection. (Notice the additional import.)</p>
    <pre><code>import com.newrelic.agent.android.NewRelic;
import com.newrelic.agent.android.Agent; //required for getCrossProcessId()
...
...

//new method for appending the crossProcessID necessary for CAT in New Relic
public static void setCrossProcessHeader(HttpURLConnection conn) {
    String crossProcessId = Agent.getCrossProcessId(); // API call into the agent for the X-NewRelic-ID
    if (crossProcessId != null) {
        conn.setRequestProperty("X-NewRelic-ID", crossProcessId);
    }
}

</code></pre>
    <pre><code>
//NewRelic.noticeHttpTransaction(url, httpMethod, statusCode, startTimeMs, endTimeMs, bytesSent, bytesReceived, responseBody, params, response);
//Where xNewRelicAppDataHeader is the value of the X-NewRelic-App-Data header
NewRelic.noticeHttpTransaction("http://api.newrelic.com", "GET", 200, System.nanoTime(), System.nanoTime(),100 ,100, "Test", new HashMap&#x3C;String, String>(), xNewRelicAppDataHeader);

</code></pre>After adding the appropriate header to the request to the back-end app, the response from the app needs to be parsed for the `X-Newrelic-App-Data` header, and then added to the `noticeHttpTransaction` call as a string. For example:
  </div>
</div>
