
<p>In order to report <a href="/docs/apm/other-features/request-queueing/request-queuing-tracking-front-end-time">request queuing</a>, New Relic agents depend on an HTTP header set by the front-end web server (such as Apache or Nginx) or load balancer (such as HAProxy or F5). These examples use the <code>X-Request-Start</code> header, since it is has broader support across platforms.</p>
<p>If this does not work with your <a href="/docs/apm/applications-menu/features/configure-request-queue-reporting">server configuration for request queuing</a>, try using the <code>X-Queue-Start</code> header. The syntax should otherwise be the same.</p>
<h2>Apache</h2>
<p>Apache's <strong>mod_headers</strong> module includes a <code>%t</code> variable that is formatted correctly. To enable request queue reporting, add this code to your Apache config:</p>
<pre><code>RequestHeader set X-Request-Start "%t"
</code></pre>
<h2>Nginx</h2>
<p>If you are using Nginx version 1.2.6 or higher and the latest version of the Ruby, Python, or PHP agent, Nginx can easily be configured to report queue time. (For Nginx versions 1.2.6 or lower, you must recompile Nginx with a module or patch.)</p>
<p>Configuring with Nginx 1.2.6 or higher uses the <code>${msec}</code> variable, which is a number in seconds with milliseconds resolution. For more information, see <a href="http://nginx.org/en/docs/http/ngx_http_core_module.html#variables" title="Link opens in a new window">http://nginx.org/en/docs/http/ngx_http_core_module.html#variables</a>.</p>
<p>Add the appropriate information to your Nginx config:</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p><strong>Nginx configuration</strong></p>
      </div>
      <div>
        <p><strong>Values</strong></p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p>General Nginx use</p>
      </div>
      <div>
        <pre><code>proxy_set_header X-Request-Start "t=${msec}";

</code></pre>
      </div>
    </div>
    <div>
      <div>
        <p>Passenger</p>
      </div>
      <div>
        <p>Version 5 or higher:</p>
        <pre><code>>passenger_set_header X-REQUEST-START "t=${msec}";

</code></pre>
        <pre><code>
passenger_set_cgi_param X_REQUEST_START "t=${msec}";

</code></pre>Older versions:
      </div>
    </div>
    <div>
      <div>
        <p>fastcgi</p>
      </div>
      <div>
        <pre><code>fastcgi_param HTTP_X_REQUEST_START "t=${msec}";

</code></pre>
      </div>
    </div>
    <div>
      <div>
        <p>uWSGI</p>
      </div>
      <div>
        <pre><code>uwsgi_param HTTP_X_REQUEST_START "t=${msec}";

</code></pre>
      </div>
    </div>
  </div>
</div>
<h2>F5 load balancers [#f5]</h2>
<p>For F5 load balancers, use this configuration snippet:</p>
<pre><code>when HTTP_REQUEST_SEND {
    # TCL 8.4 so we have to calculate the time in millisecond resolution
    # Calculation from: https://groups.google.com/forum/?  fromgroups=#!topic/comp.lang.tcl/tV9H6TDv0t8
    set secs [clock seconds]
    set ms [clock clicks -milliseconds]
    set base [expr { $secs * 1000 }]
    set fract [expr { $ms - $base }]
    if { $fract >= 1000 } {
      set diff [expr { $fract / 1000 }]
      incr secs $diff
      incr fract [expr { -1000 * $diff }]
    }
    set micros [format "%d%03d000" $secs $fract]

  # Want this header inserted as if coming from the client
    clientside {
      HTTP::header insert X-Request-Start "t=${micros}"
    }
  }
</code></pre>
<h2>Network timing</h2>
<p>Even with request queuing configured, the front-end server's setup can still affect network time in <a href="/docs/browser/new-relic-browser/page-load-timing-resources/page-load-timing-process">your Browser data</a>. This is because the front-end server does not add the queuing time header until after it actually accepts and processes the request.</p>
<p>The queuing time headers can never account for backlog in the listener socket used to accept requests. For example, if the front-end server's configuration results in a backlog of requests that queue in the listener socket, page load timing will show an increase in network time.</p>
