
<p>In <a href="/docs/apm/new-relic-apm/getting-started/welcome-new-relic-apm">APM</a>, transaction traces can contain database query data. Use the <strong>Database queries</strong> page to analyze a slow transaction or change database query collection settings.</p>
<h2>Find Database queries [#view-sql]</h2>
<p>If database query data is associated with your <a href="/docs/apm/transactions/transaction-traces/transaction-traces#find-view">selected transaction trace</a>, the <strong>Database queries</strong> page will be visible from the <strong>Transaction trace</strong> details page.</p>
<p>If you expect to see database data for a transaction trace but don't see it, you may need to change the <a href="#settings">Database query settings</a>.</p>
<p>
  <img src="./images/APM-transaction-trace-database-queries.png" alt="APM - Transaction trace - Database queries tab" title="APM-transaction-trace-database-queries.png">
</p>
<p>Go to <strong><a href="https://one.newrelic.com">one.newrelic.com</a> > APM > (select an app) > Monitor > Transactions > (select a transaction trace) > Database queries</strong>.</p>
<h2>Use Database queries [#use]</h2>
<p>Use the <strong>Database queries</strong> page to analyze and troubleshoot a slow transaction. For example:</p>
<ol>
  <li>You notice on the <a href="/docs/apm/applications-menu/monitoring/apm-overview-page">APM <strong>Overview</strong> page</a> that a transaction is abnormally slow.</li>
  <li>You select a <a href="/docs/apm/transactions/transaction-traces/transaction-traces">transaction trace</a> to get more details about that transaction.</li>
  <li>If the trace has associated database data, you select the <strong>Database queries</strong> page to examine the slow queries in the trace, and use them as the basis to <a href="#troubleshooting">troubleshoot and improve your app's performance</a>.</li>
</ol>
<p>Other functions include:</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>If you want to...</p>
      </div>
      <div>
        <p>Do this...</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p>View hidden queries</p>
      </div>
      <div>
        <p>By default, New Relic hides queries that take less than five milliseconds. To view these hidden queries, select the <strong>Show fast queries</strong> checkbox.</p>
      </div>
    </div>
    <div>
      <div>
        <p>View stack traces</p>
      </div>
      <div>
        <p>To view stack traces associated with a database query, click the database
          <div data-component="Icon" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJuYW1lIiwidmFsdWUiOiJmZS1kYXRhYmFzZSJ9XQ=="></div>icon (in the table's <strong>Total duration</strong> column).
        </p>
      </div>
    </div>
  </div>
</div>
<h2>Configure database query settings [#settings]</h2>
<p>You can change database query settings in the same way you change other <a href="/docs/apm/transactions/transaction-traces/configure-transaction-traces">transaction trace settings</a>; for example, via configuring the New Relic agent or, for some agents, via the UI.</p>
<p>Common database query setting changes include:</p>
<ul>
  <li><a href="/docs/apm/transactions/transaction-traces/configure-transaction-traces#record-sql">Collecting raw query data instead of obfuscated or turning off query collection</a></li>
  <li>Changing the stack trace threshold</li>
  <li>Turning on query explain plan collection</li>
</ul>
<h2>Use database queries to improve performance [#troubleshooting]</h2>
<p>Here are some tips to improve your app's database performance:</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p><strong>Use database queries</strong></p>
      </div>
      <div>
        <p><strong>Comments</strong></p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p>Time</p>
      </div>
      <div>
        <p>Look for queries where the <code>TOTAL DURATION</code> contributes large amounts of time to the overall transaction time. This indicates a good place to try to enhance your database query with an index or some other optimization.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Duplicate queries</p>
      </div>
      <div>
        <p>Look for queries that repeatedly query the same kind of information; for example, multiple queries to look up individual account IDs. Try rewriting the query to <code>INCLUDE</code> the specific values (account IDs 1, 2, 10, 14, 17, etc.) so that a single query can get all the relevant items.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Database overhead</p>
      </div>
      <div>
        <p>Look at the structure of your queries to see if there are opportunities to combine different types of information into a single call; for example, querying for the account ID, name, etc. This is useful, for example, if your database center is in a different geographical location, because this will reduce overhead.</p>
        <p>The amount of time for your database request and response may be very fast. However, by combining requests into fewer calls, you can reduce that time even more.</p>
      </div>
    </div>
    <div>
      <div>
        <p>MySQL</p>
      </div>
      <div>
        <p>From your app's main <a href="/docs/apm/applications-menu/monitoring/apm-overview-page">APM <strong>Summary</strong></a> page, compare the database time on the main chart to other processing time. Sudden spikes or larger amounts of database time compared to other processing times may indicate problems.</p>
      </div>
    </div>
  </div>
</div>
<h2>Find other slow queries [#slow-queries]</h2>
<p>The <strong>Trace details</strong> page is useful for examining a specific transaction's details. To see all of your application's slowest queries in one place, use the <a href="/docs/apm/applications-menu/monitoring/viewing-slow-query-details">Slow queries feature</a>.</p>
