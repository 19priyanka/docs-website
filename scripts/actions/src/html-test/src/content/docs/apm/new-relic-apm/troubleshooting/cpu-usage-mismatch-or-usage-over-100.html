
<h2>Problem</h2>
<p>CPU percent usage data between APM and Infrastructure seems contradictory, or your CPU usage exceeds 100%.</p>
<h2>Cause</h2>
<p>CPU usage data for APM is different than CPU usage data for Infrastructure.</p>
<ul>
  <li>In APM, CPU percent usage measures aggregate usage of all <strong>instances</strong> of an application or service on a given server.</li>
  <li>In Infrastructure, CPU percent usage is measured differently depending on if you are viewing CPU usage in relation to <a href="/docs/infrastructure/new-relic-infrastructure/infrastructure-ui-pages/infrastructure-compute-page-measure-resource-usage">hosts</a>, or to <a href="/docs/infrastructure/new-relic-infrastructure/infrastructure-ui-pages/infrastructure-processes-page-inspect-process-performance">processes</a>.</li>
</ul>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiaDItYXBwcyJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiTmV3IFJlbGljIEFQTSJ9XQ==">
    <div data-prop-text="title">New Relic APM</div>
    <p>To view your app's CPU usage: Go to <strong><a href="https://one.newrelic.com">one.newrelic.com</a> > (select an app)</strong> and see the <strong>CPU usage</strong> in the hosts list. The number of instances is listed under each host name (for example, <strong>55 instances)</strong>.</p>
    <p>APM CPU percent usage measures aggregate CPU usage of all instances of your app or service on a given server. This percentage is affected by the number of instances running across cores on the server. Multiple instances of a service running on one server or in a multi-core environment can produce CPU usage percentages well above 100%.</p>
    <p>APM calculates the percentage by aggregating CPU time and dividing by clock time:</p>
    <pre><code>CPU usage = (instance CPU time + instance CPU time + [...]) / (clock time)

</code></pre>**Example: Upgrading to a quad core processor**
    If you upgrade from a dual processor to a quad processor under the same architecture, you should see roughly the same CPU numbers for the same loads and applications. If New Relic normalized the calculation, the upgrade would appear to produce an abrupt decrease in your CPU usage, even if the number of cycles you are using would be the same. Adding more instances does not make your code more efficient.
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiaDItc2VydmVycyJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiTmV3IFJlbGljIEluZnJhc3RydWN0dXJlIn1d">
    <div data-prop-text="title">New Relic Infrastructure</div>
    <p>To view your individual host CPU usage:</p>
    <ol>
      <li>
        <p>Go to <strong><a href="https://one.newrelic.com">one.newrelic.com</a> > Infrastructure</strong> and see <strong>CPU %</strong>.</p>
      </li>
      <li>
        <p>See individual CPU usage in the hosts list.</p>
        <p>The exact calculation for CPU usage is measured differently depending on if you are viewing CPU usage in relation to <a href="/docs/infrastructure/new-relic-infrastructure/infrastructure-ui-pages/infrastructure-compute-page-measure-resource-usage">hosts</a>, or to <a href="/docs/infrastructure/new-relic-infrastructure/infrastructure-ui-pages/infrastructure-processes-page-inspect-process-performance">processes</a>:</p>
        <div data-component="Table" data-prop="W10=">
          <div>
            <div>
              <div>
                <p>Page</p>
              </div>
              <div>
                <p>Calculation details</p>
              </div>
            </div>
          </div>
          <div>
            <div>
              <div>
                <p><a href="/docs/infrastructure/new-relic-infrastructure/infrastructure-ui-pages/infrastructure-compute-page-measure-resource-usage">Hosts</a></p>
              </div>
              <div>
                <p>On the <strong>Hosts</strong> page, CPU Percent is a derived metric that is part of the <code>SystemSample</code> event. The CPU percentage is not collected by New Relic, but derived from several other metrics. Specifically, the <a href="/docs/infrastructure/new-relic-infrastructure/data-instrumentation/default-infrastructure-attributes-events#systemsample-cpu-percent"><code>cpuPercent</code></a> attribute is an aggregation of <code>cpuUserPercent</code>, <code>cpuSystemPercent</code>, <code>cpuIoWaitPercent</code> and <code>cpuStealPercent</code>.</p>
                <p>The <strong>Hosts</strong> page shows metrics from a perspective of your whole system. For example, if a server has 32 cores installed and is showing <code>cpuPercent</code> of 50%, 16 of the 32 cores are being used.</p>
              </div>
            </div>
            <div>
              <div>
                <p><a href="/docs/infrastructure/new-relic-infrastructure/infrastructure-ui-pages/infrastructure-processes-page-inspect-process-performance">Processes</a></p>
              </div>
              <div>
                <p>On the <strong>Processes</strong> page, CPU percent is scoped to individual processes, rather than hosts. Because of this, the CPU percent metric does not take into account the resources of the entire system. Instead, it shows how much of a single CPU core each process is taking.</p>
                <p>For example, with a 32-core server, a process showing <code>cpuPercent</code> of 50% is only taking half of a single core, or about 1.5625% of the CPU cycles available on the whole server. This can result in cpuPercent exceeding 100% on the <strong>Processes</strong> page. When this occurs, the process is demanding more than a single coreâ€™s worth of CPU cycles.</p>
              </div>
            </div>
          </div>
        </div>
      </li>
    </ol>
  </div>
</div>
