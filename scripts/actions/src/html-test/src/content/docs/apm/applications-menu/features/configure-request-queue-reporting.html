
<p><a href="/docs/apm/applications-menu/features/request-queuing-tracking-front-end-time">Request queuing</a> occurs before the request reaches your application (where the agent resides). This is why you need to do some straightforward configuration of the agent and your production hosts to take advantage of this feature.</p>
<h2>HTTP header</h2>
<p>In order to report request queuing, most New Relic agents depend on an HTTP header set by the front-end web <a href="/docs/features/request-queue-server-configuration-examples">server</a> (such as Apache or Nginx) or load balancer (such as HAProxy or F5). You can configure these front-end servers to set the timestamp in the HTTP header that represents when the request first entered your production infrastructure.</p>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJ0aXAifV0=">
  <p>Set this header as soon after the request enters your infrastructure as possible so that you are less likely to miss performance problems in your infrastructure that occur before the header is set.</p>
</div>
<p>Most New Relic agents will interpret an <code>X-Queue-Start</code> or <code>X-Request-Start</code> header and use it to calculate Request Queuing. The agents treat these headers identically. Include a value in the format <code>t=MICROSECONDS_SINCE_EPOCH</code> where <code>MICROSECONDS_SINCE_EPOCH</code> is an integer value of the number of microseconds that have elapsed since the beginning of the Unix epoch (for example, January 1, 1970).</p>
<p>Nearly any front-end HTTP server or load balancer can be configured to add this header. Additional details depend on your specific agent and server configuration. For more information, see the <a href="/docs/apm/applications-menu/features/request-queue-server-configuration-examples">request queue configuration examples</a>.</p>
<h2>C SDK</h2>
<p>The C SDK does not support request queuing.</p>
<h2>Go agent [#go]</h2>
<p>With the Go agent, set either header to record a metric for it.</p>
<h2>Java, Node.js, Python, Ruby agents [#most-agents]</h2>
<p>The most recent versions of the Java, Node.js, Python, and Ruby agents provide more flexibility in the format of the <code>X-Request-Start</code> or <code>X-Queue-Start</code> header. These agents allow the timestamp to be submitted in seconds, milliseconds, or microseconds as an integer or floating point value. These agents also allow the leading <code>t=</code> in the header value to be omitted.</p>
<p>Based on the order of magnitude, these agents automatically interpret the time unit as seconds, milliseconds, or microseconds. New Relic can do this reliably since a millisecond timestamp, interpreted as microseconds, would result in a queue time over 40 years.</p>
<p><strong>Python agent only:</strong> When using Apache/mod_wsgi 3.4 or higher, mod_wsgi will automatically insert an equivalent to the <code>X-Queue-Start</code> header into the WSGI environ dictionary for each request. This will mark the specific point in time where Apache first accepted the request. The value set by mod_wsgi will be picked up and used by the Python agent if no separate <code>X-Request-Start</code> or <code>X-Queue-Start</code> header has been manually configured into a web server's front end or in Apache itself.</p>
<h2>.NET agent [#net]</h2>
<p>The .NET agent does not require (and will ignore) any configuration of HTTP headers to calculate queue time. It works by instrumenting the IIS-queuing mechanism directly and reports queue time as the difference between when the <code>HttpContext</code> constructor executes and when the <code>HttpApplication.BeginRequest</code> event fires.</p>
<p>Request queue time is only reported for .NET Framework applications hosted on IIS (for example: ASP.NET applications). It is <strong>not</strong> reported for ASP .NET Core applications (targeting .NET Core or Framework), nor for self-hosted OWIN applications.</p>
<h2>PHP agent [#php]</h2>
<p>The PHP agent only supports the <code>X-Request-Start</code> header. This identifies the timestamp in microseconds as an integer, with an optional <code>t=</code> in the header value. To ensure that the header is read properly, check your <code>phpinfo()</code> under the <strong>PHP Variables</strong> section, and verify that <code>_SERVER["HTTP_X_REQUEST_START"]</code> exists and is in the expected format.</p>
<p>If you are using Nginx, see <a href="/docs/apm/other-features/request-queueing/request-queue-server-configuration-examples#nginx">Request queue server configuration examples</a> for additional information on setting the header.</p>
