
<p>After <a href="/docs/install-containerized-private-minions-cpms">installing your containerized private minion (CPM)</a>, you can keep track of its maintenance and monitoring in several ways:</p>
<ul>
  <li>Check if the CPM is healthy and working with the <a href="#cpm-status">CPM status endpoint</a>.</li>
  <li>See if a private location is under-provisioned and <a href="#more-minions">needs more minions</a>.</li>
  <li>Review your <a href="#">Docker logs</a> or <a href="#">Kubernetes logs</a>.</li>
</ul>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJ0aXAifV0=">
  <p>You can also get notified of monitor failures with <a href="/docs/synthetics/new-relic-synthetics/using-monitors/alerting-synthetics">New Relic's alerts</a>.</p>
</div>
<h2>Check CPM status using HTTP [#cpm-status]</h2>
<p>Connecting to a running CPM using HTTP is the easiest way to check if it's healthy and working. The container exposes two ports: <code>8080</code> and <code>8180</code>. You can check the CPM with the following endpoints:</p>
<ul>
  <li><code>:8080/status/check</code>: provides details about internal health checks that the minion performs. <code>HTTP 200</code> means the status is healthy.</li>
  <li><code>:8080/status</code>: provides details about a minion's status, which is the same data published in Insights as <code>SyntheticsPrivateMinion</code> event.</li>
  <li><code>:8180/</code>: provides JVM application admin endpoints. This is an advanced view of a minion's Java Development Kit (JDK) internal state.</li>
</ul>
<h2>Check if your private location requires more minions [#more-minions]</h2>
<p>If your private location has multiple monitor checks queued up and you experience delays, you may need more minions available to execute the monitor checks.</p>
<p>To learn how to verify this, see <a href="/docs/synthetics/new-relic-synthetics/private-locations/monitor-private-locations#more-minions">Does my private location need more minions?</a></p>
<h2>Review logs [#monitor-docker-logs]</h2>
<p>You can monitor your minion's health by looking at CPM container logs.</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoicmV2aWV3LWRvY2tlci1sb2dzIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJSZXZpZXcgRG9ja2VyIGxvZ3MifV0=">
    <div data-prop-text="title">Review Docker logs</div>
    <p>This is an example of a CPM log indicating that the minion is working properly in a Docker container system environment:</p>
    <pre><code>$docker logs [YOUR_CONTAINER_NAME]
  2018-10-10 11:33:29,856 - Minion ID: a21f6d7f-4f65-4dec-92fb-88cb975d2a19
  2018-10-10 11:33:29,869 - Publishing resources for Private Minion API: /status/check, /build-info, /status
  2018-10-10 11:33:40,527 - Minion is configured, checking if it is healthy...
  2018-10-10 11:33:43,471 - Launching in PRIVATE Location: 123456-example_private_loc-480
  2018-10-10 11:33:43,723 - Configured 2 heavy worker threads, and 50 light worker threads
  2018-10-10 11:33:43,796 -
  2018-10-10 11:33:43,796 - **************************************************************************
  2018-10-10 11:33:43,796 - * Synthetics Minion is ready and servicing location 'example_private_location'
  2018-10-10 11:33:43,796 - **************************************************************************
  ... logging continues ...

</code></pre>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoicmV2aWV3LWt1YmVybmV0ZXMtbG9ncyJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiUmV2aWV3IEt1YmVybmV0ZXMgbG9ncyJ9XQ==">
    <div data-prop-text="title">Review Kubernetes logs</div>
    <p>This is an example of a CPM log indicating that the minion is working properly in a Kubernetes container orchestration system environment:</p>
    <p>First, get the name of the CPM pod you want to review logs for:</p>
    <pre><code>kubectl get pods -n YOUR_NAMESPACE

</code></pre>
    <pre><code>
$ kubectl logs -n YOUR_NAMESPACE YOUR_CPM_NAME
2020-05-11 22:57:24,084 - Minion will use 2 heavy workers
2020-05-11 22:57:24,149 - Minion will use 50 lightweight workers
2020-05-11 22:57:27,973 - Minion Container System: KUBERNETES
2020-05-11 22:57:30,158 - Minion deployment mode: PRIVATE_MINION_POD_KUBERNETES
2020-05-11 22:57:30,178 - No volume mounted at '/var/lib/newrelic/synthetics' in ':rw' mode: Private Minion's ID will change with each boot
2020-05-11 22:57:30,284 - Minion ID: a21f6d7f-4f65-4dec-92fb-88cb975d2a19
2020-05-11 22:57:30,654 - Publishing resources for Private Minion API: /status/check, /build-info, /status
2020-05-11 22:57:31,595 - Minion is configured, checking if it is healthy...
2020-05-11 22:57:35,457 - Launching in PRIVATE Location: 123456-example_private_loc-480
2020-05-11 22:57:36,060 - Executor for async-worker-* threads configured with a max pool size of 16
2020-05-11 22:57:36,072 - Configured 2 heavy worker threads, and 50 lightweight worker threads
2020-05-11 22:57:36,087 -
2020-05-11 22:57:36,087 - **************************************************************************
2020-05-11 22:57:36,087 - * Synthetics Minion 3.0.1 is ready and servicing location 'example_private_location'
2020-05-11 22:57:36,087 - **************************************************************************
2020-05-11 22:57:36,087 -
... logging continues ...

</code></pre>Then, interact with that CPM pod:
  </div>
</div>
<h2>Enable debug logs [#monitor-docker-debug-logs]</h2>
<p>If you experience issues with your CPM, you can enable debug logs to help troubleshoot issues.</p>
<p>The default level of logging is set to only inform the user of key information and actionable errors. If this is insufficient, you can enable a more verbose logging by using the <code>MINION_LOG_LEVEL</code> environment variable.</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZG9ja2VyLWRlYnVnLWxvZ3MifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IkVuYWJsZSBEb2NrZXIgZGVidWcgbG9ncyJ9XQ==">
    <div data-prop-text="title">Enable Docker debug logs</div>
    <div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJ0aXAifV0=">
      <p>Adding <code>-f</code> to the <code>Docker logs</code> makes the command follow logs.</p>
    </div>
    <pre><code>docker run ... -e MINION_LOG_LEVEL=DEBUG ...
  docker logs -f YOUR_CONTAINER_NAME
  ... verbose logging continues ...

</code></pre>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoia3ViZXJuZXRlcy1kZWJ1Zy1sb2dzIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJFbmFibGUgS3ViZXJuZXRlcyBkZWJ1ZyBsb2dzIn1d">
    <div data-prop-text="title">Enable Kubernetes debug logs</div>
    <div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJ0aXAifV0=">
      <p>Adding <code>-f</code> to the <code>Kubernetes logs</code> makes the command follow logs.</p>
    </div>
    <p>To enable DEBUG logs add the <code>--set synthetics.minionLogLevel=DEBUG</code> option when running your <code>helm install</code>:</p>
    <pre><code>helm install YOUR_CPM_NAME YOUR_REPO_NAME/synthetics-minion -n YOUR_NAMESPACE --set synthetics.privateLocationKey=YOUR_PRIVATE_LOCATION_KEY --set synthetics.minionLogLevel=DEBUG

</code></pre>
    <pre><code>
kubectl logs -f -n YOUR_NAMESPACE YOUR_CPM_POD_NAME

... verbose logging continues ...

</code></pre>Then, interact with that CPM pod:
    <pre><code>
kubectl get pods -n YOUR_NAMESPACE

</code></pre>Get the name of the CPM pod you want to review logs for:
  </div>
</div>
<h2>Retrieve Kubernetes debugging information [#retrieve-kubernetes-debugging]</h2>
<p>If you experience issues with your CPM in a Kubernetes container orchestration system environment, you can retrieve information about the CPM pod and the node it is running on to help troubleshoot.</p>
<p>To retrieve information for the CPM pod:</p>
<pre><code>kubectl describe pod -n YOUR_NAMESPACE YOUR_CPM_POD_NAME
</code></pre>
<p>To retrieve information for the node the CPM pod is running on, identify the node, and then:</p>
<pre><code>kubectl describe node NODE_ASSOCIATED_WITH_YOUR_CPM_POD_NAME
</code></pre>
<h2>Monitor CPMs with New Relic Infrastructure [#monitor-via-infrastructure]</h2>
<p><a href="/docs/infrastructure">New Relic's infrastructure monitoring</a> supports <a href="https://docs.newrelic.com/docs/infrastructure/new-relic-infrastructure/data-instrumentation/docker-instrumentation-infrastructure">advanced Docker monitoring</a> and <a href="https://docs.newrelic.com/docs/integrations/kubernetes-integration/get-started/introduction-kubernetes-integration">advanced Kubernetes monitoring</a>. To add support for this, synthetic monitoring labels the containers spawned by CPM with a series of informative labels, all prefixed with <code>synthetics-minion-</code>. You can use these labels to identify CPM-spawned containers that are running your monitors. Example labels include:</p>
<ul>
  <li><code>synthetics-minion-runner-role</code></li>
  <li><code>synthetics-minion-runner-version</code></li>
  <li><code>synthetics-minion-container-id</code></li>
  <li><code>synthetics-minion-id</code></li>
  <li><code>synthetics-minion-build-number</code></li>
  <li><code>synthetics-minion-job</code></li>
  <li><code>synthetics-minion-account</code></li>
  <li><code>synthetics-minion-monitor</code></li>
  <li><code>synthetics-minion-monitor-version</code></li>
  <li><code>synthetics-minion-monitor-type</code></li>
  <li><code>synthetics-minion-monitor-type-label</code></li>
</ul>
