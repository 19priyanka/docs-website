
<h2>Problem</h2>
<p>The infrastructure agent's HTTP/HTTPS proxy configuration is not working.</p>
<p>For best proxy results, we recommend using the <a href="/docs/infrastructure/install-configure-manage-infrastructure/update-or-uninstall/update-infrastructure-agent">most recent infrastructure agent</a>.</p>
<h2>Solution</h2>
<p>If the proxy configuration for your infrastructure agent isn't working, the problem may be due to proxy precedence.</p>
<p>Review the section below for your infrastructure agent version:</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJjbGFzc05hbWUiLCJ2YWx1ZSI6ImZyZXEtbGluayJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiMTMxIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJWZXJzaW9uIDEuMy4xIG9yIGhpZ2hlciJ9XQ==">
    <div data-prop-text="title">Version 1.3.1 or higher</div>
    <p>Infrastructure agent versions 1.3.1 or higher uses the following proxy precedence:</p>
    <div data-component="Table" data-prop="W10=">
      <div>
        <div>
          <div>
            <p>Configuration</p>
          </div>
          <div>
            <p>Precedence</p>
          </div>
          <div>
            <p>Windows</p>
          </div>
          <div>
            <p>Linux</p>
          </div>
        </div>
      </div>
      <div>
        <div>
          <div>
            <p><code>NRIA_PROXY</code></p>
          </div>
          <div>
            <p>1</p>
          </div>
          <div>
            <p>HTTP/HTTPS</p>
          </div>
          <div>
            <p>HTTP/HTTPS</p>
          </div>
        </div>
        <div>
          <div>
            <p><code>proxy</code> (in <code>newrelic-infra.yml</code>)</p>
          </div>
          <div>
            <p>2</p>
          </div>
          <div>
            <p>HTTP/HTTPS</p>
          </div>
          <div>
            <p>HTTP/HTTPS</p>
          </div>
        </div>
        <div>
          <div>
            <p><code>HTTPS_PROXY</code></p>
          </div>
          <div>
            <p>3</p>
          </div>
          <div>
            <p>HTTPS</p>
          </div>
          <div>
            <p>HTTPS</p>
          </div>
        </div>
        <div>
          <div>
            <p><code>HTTP_PROXY</code></p>
          </div>
          <div>
            <p>4</p>
          </div>
          <div>
            <p>HTTP</p>
          </div>
          <div>
            <p>HTTP</p>
          </div>
        </div>
      </div>
    </div>
    <p>The following options affect TLS certificate configuration:</p>
    <ul>
      <li>
        <p>If you use an HTTPS proxy, you probably need to set one of these:</p>
        <ul>
          <li>The configuration option <code>proxy_validate_certificates: true</code></li>
          <li>The environment variable <code>NRIA_PROXY_VALIDATE_CERTIFICATES=true</code></li>
        </ul>
      </li>
      <li>
        <p>If you use your own self-signed certificates for the HTTPS proxy, keep the default value <code>proxy_validate_certificates: false</code></p>
        <p>Here are some additional factors that affect proxy configuration:</p>
      </li>
      <li>
        <p>The <code>NRIA_PROXY</code> and <code>proxy</code> configuration options enable HTTP or HTTPS depending on the URL scheme.</p>
      </li>
      <li>
        <p>The <code>HTTP_PROXY</code> and <code>HTTPS_PROXY</code> environment variables are ignored if either of the these configuration options is set:</p>
        <ul>
          <li>NRIA_IGNORE_SYSTEM_PROXY=true</li>
          <li>ignore_system_proxy: true</li>
        </ul>
      </li>
      <li>
        <p>The certificate validation won't work in Centos 5 systems.</p>
      </li>
    </ul>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJjbGFzc05hbWUiLCJ2YWx1ZSI6ImZyZXEtbGluayJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiMTAxMDAyXzEyMjUifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IlZlcnNpb24gMS4wLjEwMDIgdG8gMS4yLjI1In1d">
    <div data-prop-text="title">Version 1.0.1002 to 1.2.25</div>
    <p>For infrastructure agent versions 1.0.1002 to 1.2.25, review the section below based on your configuration:</p>
    <ul>
      <li>
        <p><a href="#false">Ignore proxy is false</a></p>
      </li>
      <li>
        <p><a href="#true">Ignore proxy is true</a></p>
        <p><strong>Ignore proxy is false</strong></p>
        <p>If <code>NRIA_IGNORE_SYSTEM_PROXY=FALSE</code> or <code>ignore_system_proxy=FALSE</code>:</p>
        <div data-component="Table" data-prop="W10=">
          <div>
            <div>
              <div>
                <p>Configuration</p>
              </div>
              <div>
                <p>Precedence</p>
              </div>
              <div>
                <p>Windows</p>
              </div>
              <div>
                <p>Linux</p>
              </div>
            </div>
          </div>
          <div>
            <div>
              <div>
                <p><code>HTTPS_PROXY</code></p>
              </div>
              <div>
                <p>1</p>
              </div>
              <div>
                <p>HTTP 1</p>
              </div>
              <div>
                <p>HTTP 1</p>
              </div>
            </div>
            <div>
              <div>
                <p><code>NRIA_PROXY</code></p>
              </div>
              <div>
                <p>2</p>
              </div>
              <div>
                <p>HTTP 1</p>
              </div>
              <div>
                <p>HTTP 1</p>
              </div>
            </div>
            <div>
              <div>
                <p><code>proxy</code> (in <code>newrelic-infra.yml</code>)</p>
              </div>
              <div>
                <p>3</p>
              </div>
              <div>
                <p>HTTP 1</p>
              </div>
              <div>
                <p>HTTP 1</p>
              </div>
            </div>
            <div>
              <div>
                <p><code>HTTP_PROXY</code></p>
              </div>
              <div>
                <p>4</p>
              </div>
              <div>
                <p>HTTP</p>
              </div>
              <div>
                <p>HTTP</p>
              </div>
            </div>
          </div>
        </div>
        <p>1 HTTPS proxy not supported (redirected to HTTP)</p>
        <p><strong>Ignore proxy is true</strong></p>
        <p>If <code>NRIA_IGNORE_SYSTEM_PROXY=TRUE</code> or <code>ignore_system_proxy=TRUE</code>:</p>
        <div data-component="Table" data-prop="W10=">
          <div>
            <div>
              <div>
                <p>Configuration</p>
              </div>
              <div>
                <p>Precedence</p>
              </div>
              <div>
                <p>Windows</p>
              </div>
              <div>
                <p>Linux</p>
              </div>
            </div>
          </div>
          <div>
            <div>
              <div>
                <p><code>NRIA_PROXY</code></p>
              </div>
              <div>
                <p>1</p>
              </div>
              <div>
                <p>HTTP 1</p>
              </div>
              <div>
                <p>HTTP 1</p>
              </div>
            </div>
            <div>
              <div>
                <p><code>proxy</code> (in <code>newrelic-infra.yml</code>)</p>
              </div>
              <div>
                <p>2</p>
              </div>
              <div>
                <p>HTTP 1</p>
              </div>
              <div>
                <p>HTTP 1</p>
              </div>
            </div>
          </div>
        </div>
        <p>1 HTTPS proxy not supported (redirected to HTTP)</p>
      </li>
    </ul>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJjbGFzc05hbWUiLCJ2YWx1ZSI6ImZyZXEtbGluayJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiMTA5NTZfdG9fMTA5ODkifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IlZlcnNpb24gMS4wLjk1NiB0byAxLjAuOTg5In1d">
    <div data-prop-text="title">Version 1.0.956 to 1.0.989</div>
    <p>Infrastructure agent versions 1.0.956 to 1.0.989 uses the following proxy precedence:</p>
    <div data-component="Table" data-prop="W10=">
      <div>
        <div>
          <div>
            <p>Configuration</p>
          </div>
          <div>
            <p>Precedence</p>
          </div>
          <div>
            <p>Windows</p>
          </div>
          <div>
            <p>Linux</p>
          </div>
        </div>
      </div>
      <div>
        <div>
          <div>
            <p><code>HTTPS_PROXY</code></p>
          </div>
          <div>
            <p>1</p>
          </div>
          <div>
            <p>HTTPS</p>
          </div>
          <div>
            <p>HTTP 1</p>
          </div>
        </div>
        <div>
          <div>
            <p><code>NRIA_PROXY</code></p>
          </div>
          <div>
            <p>2</p>
          </div>
          <div>
            <p>HTTP/HTTPS 2</p>
          </div>
          <div>
            <p>HTTP 1</p>
          </div>
        </div>
        <div>
          <div>
            <p><code>proxy</code> (in <code>newrelic-infra.yml</code>)</p>
          </div>
          <div>
            <p>3</p>
          </div>
          <div>
            <p>HTTP/HTTPS</p>
          </div>
          <div>
            <p>HTTP 1</p>
          </div>
        </div>
        <div>
          <div>
            <p><code>HTTP_PROXY</code></p>
          </div>
          <div>
            <p>4</p>
          </div>
          <div>
            <p>HTTP/HTTPS</p>
          </div>
          <div>
            <p>TTP</p>
          </div>
        </div>
      </div>
    </div>
    <p>1 HTTPS proxy not supported (redirected to HTTP)</p>
    <p>2 When using a HTTPS proxy with a custom TLS/SSL or self-signed certificate, provide either:</p>
    <ul>
      <li>The certificate file location in <code>ca_bundle_file</code></li>
      <li>The certificates directory path in <code>ca_bundle_dir</code></li>
    </ul>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJjbGFzc05hbWUiLCJ2YWx1ZSI6ImZyZXEtbGluayJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiMTA5NTYifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IlZlcnNpb24gMS4wLjk0NCBvciBsb3dlciJ9XQ==">
    <div data-prop-text="title">Version 1.0.944 or lower</div>
    <p>Infrastructure agent versions 1.0.944 or lower uses the following proxy precedence:</p>
    <div data-component="Table" data-prop="W10=">
      <div>
        <div>
          <div>
            <p>Configuration</p>
          </div>
          <div>
            <p>Precedence</p>
          </div>
          <div>
            <p>Windows</p>
          </div>
          <div>
            <p>Linux</p>
          </div>
        </div>
      </div>
      <div>
        <div>
          <div>
            <p><code>HTTPS_PROXY</code></p>
          </div>
          <div>
            <p>1</p>
          </div>
          <div>
            <p>HTTP 1</p>
          </div>
          <div>
            <p>HTTP 1</p>
          </div>
        </div>
        <div>
          <div>
            <p><code>NRIA_PROXY</code></p>
          </div>
          <div>
            <p>2</p>
          </div>
          <div>
            <p>HTTP 1</p>
          </div>
          <div>
            <p>HTTP 1</p>
          </div>
        </div>
        <div>
          <div>
            <p><code>proxy</code> (in <code>newrelic-infra.yml</code>)</p>
          </div>
          <div>
            <p>3</p>
          </div>
          <div>
            <p>HTTP 1</p>
          </div>
          <div>
            <p>HTTP 1</p>
          </div>
        </div>
        <div>
          <div>
            <p><code>HTTP_PROXY</code></p>
          </div>
          <div>
            <p>4</p>
          </div>
          <div>
            <p>HTTP</p>
          </div>
          <div>
            <p>HTTP</p>
          </div>
        </div>
      </div>
    </div>
    <p>1 HTTPS proxy not supported (redirected to HTTP)</p>
    <p>2 When using a HTTPS proxy with a custom TLS/SSL or self-signed certificate, provide either:</p>
    <ul>
      <li>The certificate file location in <code>ca_bundle_file</code></li>
      <li>The certificates directory path in <code>ca_bundle_dir</code></li>
    </ul>
  </div>
</div>
