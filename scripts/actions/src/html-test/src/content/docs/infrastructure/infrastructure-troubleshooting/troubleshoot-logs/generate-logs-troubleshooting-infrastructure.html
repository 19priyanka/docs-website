
<h2>Problem</h2>
<p>When troubleshooting your infrastructure agent, generate <code>verbose</code> logs for a few minutes to find and investigate errors. This can be useful for your own troubleshooting or when working with New Relic Support.</p>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
  <p>Verbose logging generates a lot of data very quickly. When finished generating logs, be sure to set <code>verbose: 0</code> to reduce disk space consumption.</p>
</div>
<p>If you have <a href="/docs/release-notes/infrastructure-release-notes/infrastructure-agent-release-notes/new-relic-infrastructure-agent-140">New Relic infrastructure agent 1.4.0</a> or higher, you can automate this process by using the <code>newrelic-infra-ctl</code> command. For more information, see the <a href="/docs/infrastructure/install-configure-manage-infrastructure/manage-your-agent/troubleshoot-running-agent">troubleshooting binary documentation</a>.</p>
<h2>Solution</h2>
<p>Generating <code>verbose</code> log files requires editing your configuration file. For a sample config file that includes all applicable settings, see the <a href="/docs/infrastructure/new-relic-infrastructure/configuration/infrastructure-config-file-template-newrelic-infrayml">example template</a>. To generate detailed logs:</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>Step</p>
      </div>
      <div>
        <p>Procedures</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <ol>
          <li></li>
        </ol>
      </div>
      <div>
        <p>Edit your <code>newrelic-infra.yml</code> file:</p>
        <ol>
          <li>Enable verbose logging: <a href="/docs/infrastructure/new-relic-infrastructure/configuration/configure-infrastructure-agent#verbose"><code>verbose: 1</code></a>. (If you use a containerized infrastructure agent on CoreOS, see <a href="#system-notes">system-specific notes</a>.)</li>
          <li>Set <a href="/docs/infrastructure/install-configure-infrastructure/configuration/infrastructure-configuration-settings#log-file"><code>log_file</code></a> to a convenient log file location.</li>
          <li><a href="/docs/infrastructure/new-relic-infrastructure/configuration/start-stop-restart-check-infrastructure-agent-status">Restart the agent</a> so the agent notices the new settings.</li>
        </ol>
      </div>
    </div>
    <div>
      <div>
        <ol start="2">
          <li></li>
        </ol>
      </div>
      <div>
        <p>Let your host run at normal load for about three minutes to generate sufficient logging data.</p>
      </div>
    </div>
    <div>
      <div>
        <ol start="3">
          <li></li>
        </ol>
      </div>
      <div>
        <p>Return your settings to default:</p>
        <ol>
          <li>Disable verbose logging by setting <a href="/docs/infrastructure/new-relic-infrastructure/configuration/configure-infrastructure-agent#verbose"><code>verbose: 0</code></a> in <code>newrelic-infra.yml</code>.</li>
          <li>Optional: Disable logging to a custom file by removing the <a href="/docs/infrastructure/new-relic-infrastructure/configuration/configure-infrastructure-agent#log_file"><code>log_file</code></a> line from <code>newrelic-infra.yml</code>.</li>
          <li><a href="/docs/infrastructure/new-relic-infrastructure/configuration/start-stop-restart-check-infrastructure-agent-status">Restart the agent</a> so the agent notices the new settings.</li>
        </ol>
      </div>
    </div>
    <div>
      <div>
        <ol start="4">
          <li></li>
        </ol>
      </div>
      <div>
        <p>Examine the log file for errors.</p>
        <p>If you need to send your log file to New Relic Support:</p>
        <ol>
          <li>
            <p>Include the line in your log file that contains the agent version:</p>
            <pre><code>New Relic infrastructure agent version X.YY.ZZZ
</code></pre>
          </li>
          <li>
            <p>Attach the log file to your support ticket, along with your <code>newrelic-infra.yml</code>.</p>
          </li>
        </ol>
      </div>
    </div>
  </div>
</div>
<h3>Smart verbose mode</h3>
<p>Sometimes errors don't occur until after quite some time has passed. This makes debugging difficult, because typically verbose logs are only enabled for a short period time; otherwise there will be many debug logs. For example, if an error occurs one hour after the infrastructure agent has started, getting debug logs around the time of the error can be tricky or impractical.</p>
<p>As of infrastructure agent v1.9.0 or higher, you can use smart verbose mode for logs. Smart verbose mode only logs the most recent debug messages after an error has been logged. This allows you to leave smart verbose mode running until an error occurs, without logging lots of irrelevant debug messages, and only logging the most recent debug messages. (The number of messages is determined by your configuration.)</p>
<p>For more information on smart verbose mode, see the <a href="https://docs.newrelic.com/docs/infrastructure/infrastructure-troubleshooting/troubleshoot-logs/infrastructure-agent-logging-behavior#smart-verbose-mode">Infrastructure agent logging behavior</a> docs, and use the <a href="https://docs.newrelic.com/docs/infrastructure/install-configure-manage-infrastructure/configuration/infrastructure-configuration-settings#verbose">Infrastructure configuration settings</a> documentation for details on how to enable smart verbose mode.</p>
<h3>Forward the agent logs to New Relic Logs [#forward-logs-to-nr-logs]</h3>
<p>The Infrastructure agent can be configured to send its own logs to <a href="https://docs.newrelic.com/docs/logs/new-relic-logs/get-started/introduction-new-relic-logs">New Relic Logs</a>. This can be useful for troubleshooting issues with log forwarding, the Infrastructure agent, or when contacting <a href="https://support.newrelic.com/" title="Link opens in a new window.">support</a>.</p>
<p>For details on how to enable log forwarding for the Infrastructure agent, see <a href="/docs/logs/enable-new-relic-logs/1-enable-logs/forward-your-logs-using-new-relic-infrastructure#troubleshoot">Troubleshoot log forwarding</a>.</p>
<h3>Notes for specific systems [#system-notes]</h3>
<p>These are some additional notes and requirements for specific systems, used to supplement the <a href="#verbose">general logging instructions</a>:</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiY29yZW9zIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJDb250YWluZXJpemVkIGFnZW50IG9uIENvcmVPUyJ9XQ==">
    <div data-prop-text="title">Containerized agent on CoreOS</div>
    <p>If you are using a containerized infrastructure agent on CoreOS:</p>
    <ol>
      <li>
        <p>Choose one of these options to change the log level to verbose:</p>
        <ul>
          <li>
            <p><strong>Recommended:</strong> Set the environment variable <code>NRIA_VERBOSE</code> to <code>1</code>. Running this on the command line would look like:</p>
            <pre><code>-e NRIA_VERBOSE=1
</code></pre>
            <p>OR</p>
          </li>
          <li>
            <p>Edit the config file to set <code>verbose: 1</code>. (Editing the config file in a container is not recommended, because it requires rebuilding the image twice: once to add verbose logging and once to remove it.)</p>
          </li>
        </ul>
      </li>
      <li>
        <p>Use <code>journalctl</code> to collect the logs:</p>
        <pre><code>journalctl -u newrelic-infra > newrelic-infra.log
</code></pre>
      </li>
      <li>
        <p>Set the verbose logging level back to <code>0</code> after collecting logs for a few minutes.</p>
      </li>
    </ol>
  </div>
</div>
