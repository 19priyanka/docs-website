
<p>The infrastructure agent can be configured in a variety of ways. The default method is to edit the <a href="/docs/infrastructure/install-configure-infrastructure/configuration/infrastructure-configuration-settings">configuration variables</a> in the <code>newrelic-infra.yml</code> file.</p>
<p>A configuration file template is available in <a href="https://github.com/newrelic/infrastructure-agent/blob/master/assets/examples/infrastructure/newrelic-infra-template.yml.example">Infrastructure config file template</a>. You can also override the config file by setting <a href="#Environment_Variables">environment variables</a>, or use <a href="#config-mgmt">config management tools</a>, such as Ansible or Puppet.</p>
<p>To configure infrastructure integrations, see the <a href="/docs/infrastructure/integrations/types-integrations">specific integration's documentation</a>.</p>
<h2>Configuration methods and precedence [#precedence]</h2>
<p>The default method to configure the infrastructure agent is the <code>newrelic-infra.yml</code> config file. You can override the config file by setting environment variables, which is ideal for containerized environments.</p>
<p>
  <img src="./images/infrastructure-config-cascade-%28orders-of-precedence%29.png" alt="infrastructure config cascade (orders of precedence).png" title="infrastructure config cascade (orders of precedence).png">
</p>
<p>Environment variables override the config file. The config file overrides the agent defaults.</p>
<p>Here are detailed descriptions of each configuration method:</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiY29uZmlnLWZpbGUifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6eyJ0eXBlIjoibWR4VmFsdWVFeHByZXNzaW9uIiwidmFsdWUiOiI8PkNvbmZpZ3VyYXRpb24gZmlsZSAoPElubGluZUNvZGU+bmV3cmVsaWMtaW5mcmEueW1sPC9JbmxpbmVDb2RlPikgbG9jYXRpb24gYW5kIGRlc2NyaXB0aW9uPC8+IiwicG9zaXRpb24iOnsic3RhcnQiOnsibGluZSI6NTQsImNvbHVtbiI6MTEsIm9mZnNldCI6MzYwOX0sImVuZCI6eyJsaW5lIjo1NCwiY29sdW1uIjoxMDcsIm9mZnNldCI6MzcwNX19fX1d">
    <div data-prop-text="title">[object Object]</div>
    <p>To configure the infrastructure agent, use the <code>newrelic-infra.yml</code> file. Its default location is:</p>
    <ul>
      <li>
        <p>Linux: <code>/etc/newrelic-infra.yml</code></p>
      </li>
      <li>
        <p>Windows: <code>C:\Program Files\New Relic\newrelic-infra\newrelic-infra.yml</code></p>
        <p>For a sample config file, see our <a href="https://github.com/newrelic/infrastructure-agent/blob/master/assets/examples/infrastructure/newrelic-infra-template.yml.example">infrastructure config file template</a>.</p>
      </li>
    </ul>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiRW52aXJvbm1lbnRfVmFyaWFibGVzIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJFbnZpcm9ubWVudCB2YXJpYWJsZSBzeW50YXggYW5kIGRlc2NyaXB0aW9uIn1d">
    <div data-prop-text="title">Environment variable syntax and description</div>
    <p>To set an environment variable, use the variable name from the config file in all caps and prefix with <code>NRIA_</code>; for example, <code>NRIA_LICENSE_KEY</code>. Only use environment variables with containerized environments.</p>
    <p>The options described in the <a href="https://github.com/newrelic/infrastructure-agent/blob/master/assets/examples/infrastructure/newrelic-infra-template.yml.example">infrastructure config file template</a> include their corresponding environment variables, labeled as <code>Env var</code>. Environment variables are also listed in <a href="https://docs.newrelic.com/docs/infrastructure/install-configure-manage-infrastructure/configuration/infrastructure-configuration-settings">Infrastructure configuration settings</a>.</p>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoicGFzc3Rocm91Z2gifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IlVzaW5nIGVudmlyb25tZW50IHZhcmlhYmxlIHBhc3N0aHJvdWdocyB3aXRoIG9uLWhvc3QgaW50ZWdyYXRpb25zIn1d">
    <div data-prop-text="title">Using environment variable passthroughs with on-host integrations</div>
    <p>You can use environment variables to control config settings for <a href="/docs/integrations/host-integrations/host-integrations-list">on-host integrations</a>, which can then be passed through to the infrastructure agent. Variables that can be used with each on-host integration are listed in the documentation for each integration, and can be set through one of the following methods.</p>
    <ul>
      <li>
        <p><strong>From inside the config file:</strong> add an entry to the <a href="https://github.com/newrelic/infrastructure-agent/blob/master/assets/examples/infrastructure/newrelic-infra-template.yml.example">infrastructure config file</a> to allow the agent to get the environment variables you've set.</p>
        <pre><code>passthrough_environment:
  - HTTPS_PROXY
  - HTTP_PROXY
</code></pre>
      </li>
      <li>
        <p><strong>From the command line:</strong> use another environment variable to pass through these settings.</p>
        <pre><code>NRIA_PASSTHROUGH_ENVIRONMENT="HTTPS_PROXY,HTTP_PROXY"
</code></pre>
      </li>
    </ul>
  </div>
</div>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
  <p>For a better understanding of configuration settings, see <a href="/docs/infrastructure/install-configure-infrastructure/configuration/infrastructure-configuration-settings">Infrastructure configuration settings</a>, which contains a detailed explanation of each variable.</p>
</div>
<h2>Configuration file structure [#config_structure]</h2>
<p>When editing <code>newrelic-infra.yml</code>, you must conform to the <a href="https://en.wikipedia.org/wiki/YAML">YAML format</a> and adhere to the following rules:</p>
<ul>
  <li>Do not modify the casing of the configuration options: YAML keys are case sensitive.</li>
  <li>Respect the indentation levels. All indentations are in similar increments, typically of two space characters. Data in the same stanza of the file must use the same level of indentation. Indent any sub-stanzas by an additional two spaces (see examples in <a href="https://docs.newrelic.com/docs/infrastructure/install-configure-infrastructure/configuration/infrastructure-configuration-settings#custom-attributes">Custom attributes</a> and <a href="https://docs.newrelic.com/docs/infrastructure/install-configure-infrastructure/configuration/infrastructure-configuration-settings#network-interface-filters">Network interface filters</a>).</li>
</ul>
<p>A template of <code>newrelic-infra.yml</code> is available in the <a href="https://github.com/newrelic/infrastructure-agent/blob/master/assets/examples/infrastructure/newrelic-infra-template.yml.example">infrastructure agent repository</a>. Use a <a href="http://www.yamllint.com/">validator</a> to ensure the syntax is accurate before using the file with the infrastructure agent.</p>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
  <p>Always <a href="/docs/infrastructure-start-stop-restart-check-agent-status">restart the agent</a> or your web server after changing settings.</p>
</div>
<h2>Configuration management tools [#config-mgmt]</h2>
<p>To dynamically create your configuration file and manage the infrastructure agent with configuration management tools, see the documentation for:</p>
<ul>
  <li><a href="/docs/infrastructure/new-relic-infrastructure/config-management-tools/configure-new-relic-infrastructure-using-ansible">Ansible</a></li>
  <li><a href="/docs/infrastructure/new-relic-infrastructure/config-management-tools/configure-new-relic-infrastructure-using-chef">Chef</a></li>
  <li><a href="/docs/infrastructure/new-relic-infrastructure/config-management-tools/configure-new-relic-infrastructure-puppet">Puppet</a></li>
</ul>
