
<p>The infrastructure agent for Linux environments can run as root, privileged, or unprivileged user, which are described below:</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>Mode</p>
      </div>
      <div>
        <p>Overview</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p>Root</p>
      </div>
      <div>
        <p>Installed by default. Runs as <code>root</code> and has total access to all the system metrics and inventory.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Privileged</p>
      </div>
      <div>
        <p>Runs as a non-privileged user named <code>nri-agent</code> that is created automatically during the installation process.</p>
        <p>Normal users do not have <code>READ</code> access to all the system metrics, so the agent will not be able to report all the metrics of the root mode. However, privileged mode can collect more metrics than unprivileged mode, including most of the inventory. This is because at installation time, the <code>/usr/bin/newrelic-infra</code> executable is granted with <a href="http://man7.org/linux/man-pages/man7/capabilities.7.html"><code>CAP_SYS_PTRACE</code> and <code>CAP_DAC_READ_SEARCH</code> kernel capabilities</a>.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Unprivileged</p>
      </div>
      <div>
        <p>Runs as a non-privileged user named <code>nri-agent</code> that is created automatically during the installation process.</p>
        <p>This mode is the most restricted. Normal users do not have <code>READ</code> access to all the system metrics, so the agent will not be able to report all the metrics of the root or privileged modes.</p>
      </div>
    </div>
  </div>
</div>
<h2>Metrics and inventory provided [#mode-metrics]</h2>
<p>The agent provides different metrics and inventory depending on the running mode:</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>Mode</p>
      </div>
      <div>
        <p>Metrics and inventory</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p>Root</p>
      </div>
      <div>
        <p>All of the documented <a href="https://docs.newrelic.com/docs/infrastructure/new-relic-infrastructure/data-instrumentation">data and instrumentation values</a>.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Privileged</p>
      </div>
      <div>
        <p>All of the values from root mode, except:</p>
        <ul>
          <li>SELinux inventory: This depends on the <code>semodule</code> command, which requires root access.</li>
          <li>Docker process metrics: These are not enabled by default. However, you can manually enable them by giving access rights to the <code>nri-agent</code> user.</li>
        </ul>
      </div>
    </div>
    <div>
      <div>
        <p>Unprivileged</p>
      </div>
      <div>
        <p>All of the values from privileged mode, except:</p>
        <p><strong>Process samples</strong> do not report these metrics:</p>
        <ul>
          <li>
            <p>File descriptor count</p>
          </li>
          <li>
            <p>I/O read bytes per second</p>
          </li>
          <li>
            <p>I/O read count per second</p>
          </li>
          <li>
            <p>I/O total read bytes</p>
          </li>
          <li>
            <p>I/O total read count</p>
          </li>
          <li>
            <p>I/O total write bytes</p>
          </li>
          <li>
            <p>I/O total write count</p>
          </li>
          <li>
            <p>I/O write bytes per second</p>
          </li>
          <li>
            <p>I/O write count per second</p>
            <p>The following <strong>inventory sources</strong> are not reported:</p>
          </li>
          <li>
            <p><code>config/sshd</code></p>
          </li>
          <li>
            <p><code>kernel/sysctl</code></p>
          </li>
          <li>
            <p><code>packages/rpm</code></p>
          </li>
          <li>
            <p><code>packages/dpkg</code></p>
          </li>
          <li>
            <p><code>services/pidfile</code> on SysV-based distributions</p>
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>
<h2>Run integrations [#mode-integrations]</h2>
<p>As root, integrations will run as usual. When running as privileged or unprivileged user, integrations will execute properly, although some custom integrations (for example, built by customers or technical sales staff) that depend on access to root may need additional configuration.</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJPbi1ob3N0IGludGVncmF0aW9ucyJ9XQ==">
    <div data-prop-text="title">On-host integrations</div>
    <p>In general, on-host integrations will run with the non-root agent as long as the <code>nri-agent</code> has permissions on the integration cache files.</p>
    <p>The default path where the integration cache files are stored is <code>/tmp</code>. To change the path, set the environment variable <code>NRIA_CACHE_PATH</code>. In this situation, use the following instructions to target the provided cache path folder instead of <code>/tmp</code>.</p>
    <div data-component="Table" data-prop="W10=">
      <div>
        <div>
          <div>
            <p>On-host integrations</p>
          </div>
          <div>
            <p>Cache path folder</p>
          </div>
        </div>
      </div>
      <div>
        <div>
          <div>
            <p>Apache</p>
          </div>
          <div>
            <pre><code>sudo chown nri-agent:nri-agent -R /tmp/nr-apache.json

</code></pre>
          </div>
        </div>
        <div>
          <div>
            <p>Cassandra</p>
          </div>
          <div>
            <pre><code>sudo chown nri-agent:nri-agent -R /tmp/nr-integrations

</code></pre>
          </div>
        </div>
        <div>
          <div>
            <p>MySQL</p>
          </div>
          <div>
            <pre><code>sudo chown nri-agent:nri-agent -R /tmp/nr-mysql.json

</code></pre>
          </div>
        </div>
        <div>
          <div>
            <p>Nginx</p>
          </div>
          <div>
            <pre><code>sudo chown nri-agent:nri-agent -R /tmp/nr-nginx.json

</code></pre>
          </div>
        </div>
        <div>
          <div>
            <p>Redis</p>
          </div>
          <div>
            <pre><code>sudo chown nri-agent:nri-agent -R /tmp/nr-redis.json

</code></pre>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJDdXN0b20gaW50ZWdyYXRpb25zIn1d">
    <div data-prop-text="title">Custom integrations</div>
    <p>If your custom integration doesn't require root privileges, then itâ€™s compatible with the rootless mode. To run it, you just need to change the <code>owner:group</code> of the cache file as explained above.</p>
    <p>If your integration requires to be executed with a privileged user, you can use the <code>integration_user</code> argument in the configuration integration.</p>
  </div>
</div>
<h2>Set the running mode for your agent [#set-mode]</h2>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJ0aXAifV0=">
  <p>When deciding which run mode to use, consider how much data you want to be able to collect and analyze, or how much data you want to restrict.</p>
</div>
<p>For default and <a href="/docs/infrastructure/install-configure-infrastructure/linux-installation/assisted-install-infrastructure-linux">assisted installations</a>, you can set the running mode by including the <code>NRIA_MODE</code> environment variable set to either <code>ROOT</code>, <code>PRIVILEGED</code>, or <code>UNPRIVILEGED</code>.</p>
<p>For <a href="https://docs.newrelic.com/docs/infrastructure/install-configure-infrastructure/linux-installation/manual-install-infrastructure-linux">manual installations</a>, follow the instructions described in our docs.</p>
<h2>Switch running modes [#install-agent]</h2>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoicm9vdC1yb290bGVzcyJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiRnJvbSByb290IHRvIHByaXZpbGVnZWQvdW5wcml2aWxlZ2VkIn1d">
    <div data-prop-text="title">From root to privileged/unprivileged</div>
    <p>To switch the running mode <strong>from root to privileged or unprivileged</strong>, follow the installation/update instructions in this doc.</p>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoicm9vdGxlc3Mtcm9vdCJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiRnJvbSBwcml2aWxlZ2VkL3VucHJpdmlsZWdlZCB0byBhbnkgb3RoZXIgbW9kZSJ9XQ==">
    <div data-prop-text="title">From privileged/unprivileged to any other mode</div>
    <p>To change the running mode <strong>from privileged or unprivileged to any other mode:</strong></p>
    <ol>
      <li>
        <p>Follow these steps:</p>
        <div data-component="Table" data-prop="W10=">
          <div>
            <div>
              <div>
                <p><strong>Debian/Ubuntu</strong></p>
              </div>
              <div>
                <pre><code>dpkg --purge newrelic-infra

</code></pre>
                <pre><code>
sudo apt-get remove --purge newrelic-infra

</code></pre>OR
              </div>
            </div>
            <div>
              <div>
                <p><strong>Centos/Suse/RedHat/Amazon</strong></p>
              </div>
              <div>
                <pre><code>rpm -e newrelic-infra

</code></pre>
                <pre><code>
sudo zypper rm newrelic-infra

</code></pre>OR
                <pre><code>
sudo yum remove newrelic-infra

</code></pre>OR
              </div>
            </div>
          </div>
        </div>
      </li>
      <li>
        <p>After making sure the agent is completely removed, reinstall the agent with the selected mode.</p>
      </li>
    </ol>
  </div>
</div>
<h2>Update the agent [#update]</h2>
<p>Follow standard procedures to <a href="/docs/update-infrastructure-agent">update the infrastructure agent</a>.</p>
