
<p>Our custom installation process for the infrastructure agent for Windows allows you to tailor all aspects of the installation, and place files and folders wherever you want on your filesystem.</p>
<p>This method gives you <strong>full control</strong> of the installation: <strong>you are responsible</strong> for placing the files in the correct folders, providing the correct configuration values, and ensuring the agent has all the right permissions.</p>
<p>Before installation, check the <a href="/docs/Infrastructure-compatibility-requirements">compatibility and requirements</a>.</p>
<h2>Install the agent [#windows-manual-install]</h2>
<p>To install the agent:</p>
<ol>
  <li>
    <p>Download the <a href="https://download.newrelic.com/infrastructure_agent/binaries/windows/">packaged agent file</a>.</p>
  </li>
  <li>
    <p>Unpack the file.</p>
  </li>
  <li>
    <p>Make sure the file unpacks with the following structure:</p>
    <p>
      <img src="./images/Infra-windows-files.png" alt="Infra-windows-files.png" title="Infra-windows-files.png">
    </p>
  </li>
  <li>
    <p><a href="#install-service-script">Install the service script</a>.</p>
  </li>
</ol>
<p><strong>Optionally</strong>, you can:</p>
<ul>
  <li><a href="#change-config-file">Change the location of the configuration file</a>.</li>
  <li><a href="#configure-plugin">Configure the plugin directory</a>.</li>
  <li><a href="#agent-directory">Configure the agent directory</a>.</li>
  <li><a href="#log-file">Configure the log file</a>.</li>
</ul>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
  <p>As of <a href="/docs/release-notes/infrastructure-release-notes/infrastructure-agent-release-notes/new-relic-infrastructure-agent-140">version 1.4.0</a>, the infrastructure agent package includes the additional <code>newrelic-infra-ctl</code> binary, which is used to help troubleshoot a running agent. Although this binary is not required to execute the agent, we recommend to add it in your path. <a href="/docs/infrastructure/install-configure-manage-infrastructure/manage-your-agent/troubleshoot-running-agent">See our docs</a> for more information.</p>
</div>
<h2>Install the service script [#install-service-script]</h2>
<p>To proceed with the installation, you need to create the service. Check the file provided in the zip file for reference:</p>
<pre><code>C:\Program Files\New Relic\newrelic-infra\installer.ps1
</code></pre>
<h2>Configuration file [#change-config-file]</h2>
<p>The Infrastructure agent depends on a configuration file, usually named <code>newrelic-infra.yml</code>, placed in the same folder with the agent, to configure the agent's behavior. You can create a new config file based on <a href="/docs/infrastructure/new-relic-infrastructure/configuration/infrastructure-config-file-template-newrelic-infrayml">config file template</a>. For more information, see how to <a href="/docs/infrastructure/new-relic-infrastructure/configuration/configure-infrastructure-agent">configure the agent</a>.</p>
<h3>Changing the config file's location</h3>
<p>By default, the configuration file is located in <code>C:\Program Files\New Relic\newrelic-infra\newrelic-infra.yml</code>.</p>
<p>To change the location of the configuration file:</p>
<ol>
  <li>
    <p>Execute the command <code>regedit.exe</code>.</p>
  </li>
  <li>
    <p>Browse to the folder <code>Computer\HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\newrelic-infra\ImagePath</code>.</p>
  </li>
  <li>
    <p>Retrieve the <code>ImagePath</code> key. If the agent binary is on the default path, look for the key at <code>C:\Program Files\New Relic\newrelic-infra\newrelic-infra.exe</code>.</p>
  </li>
  <li>
    <p>Use the <code>-config</code> flag to add the new location of the configuration file to the key:</p>
    <pre><code>C:\Program Files\New Relic\newrelic-infra\newrelic-infra.exe -config c:\config.yaml
</code></pre>
  </li>
</ol>
<h2>Configure the plugin directory [#configure-plugin]</h2>
<p>The Infrastructure agent allows you to install <a href="/docs/integrations">integrations</a> that monitor and report data from popular services such as Kubernetes, AWS, MySQL, Redis, Kafka, etc. Each integration has its own configuration file, named by default <code>integration-name-config.yml</code>, placed in the predefined location <code>C:\Program Files\New Relic\newrelic-infra\integrations.d</code>. On initialization, the agent loads the config file.</p>
<p>To overwrite the predefined location of the integration configuration file, use one of the following methods:</p>
<ul>
  <li>Set the location in the <code>NRIA_PLUGIN_DIR</code> environment variable.</li>
  <li>Set the custom path in the <code>newrelic-infra.yml</code> configuration file using the <code>plugin_dir</code> field.</li>
  <li>Pass it as a command line argument using <code>-plugin_dir</code> when you run the <code>newrelic-infra</code> binary.</li>
</ul>
<h2>Configure the agent directory [#agent-directory]</h2>
<p>The agent requires its own defined directory to run the installed <a href="/docs/integrations">integrations</a>, caching data (inventory), etc. The default location is <code>C:\Program Files\New Relic\newrelic-infra\</code>.</p>
<p>The agent directory has the following structure and content:</p>
<ul>
  <li><code>LICENSE</code>: Text file containing the New Relic Infrastructure agent license.</li>
  <li><code>custom-integrations</code>: Directory that stores the installed the <a href="/docs/integrations/integrations-sdk/getting-started/introduction-infrastructure-integrations-sdk">custom integrations</a>.</li>
  <li><code>newrelic-integrations</code>: Directory that stores the <a href="/docs/infrastructure/integrations/types-integrations">New Relic official integrations</a>.</li>
</ul>
<p>Additionally, the agent uses a different folder, <code>app_data_dir</code>, to store data. By default it points to <code>C:\ProgramData\New Relic\newrelic-infra\</code>.</p>
<p>To overwrite the predefined location of the agent directory, use one of the following methods:</p>
<ul>
  <li>Set the location in the <code>NRIA_AGENT_DIR</code> environment variable.</li>
  <li>Set the custom path in the <code>newrelic-infra.yml</code> configuration file using the <code>agent_dir</code> field.</li>
  <li>Pass it as a command line argument using <code>-agent_dir</code> when you run the <code>newrelic-infra</code> binary.</li>
</ul>
<h2>Configure the log file [#log-file]</h2>
<p>By default the agent stores the log files in <code>C:\Program Files\New Relic\newrelic-infra\newrelic-infra.log</code>.</p>
<p>To overwrite the predefined location of the log file, use one of the following methods:</p>
<ul>
  <li>Set the location in the <code>NRIA_LOG_FILE</code> environment variable.</li>
  <li>Set the custom path in the <code>newrelic-infra.yml</code> configuration file using the <code>log_file</code> field.</li>
  <li>Pass it as a command line argument using <code>-log_file</code> when you run the <code>newrelic-infra</code> binary.</li>
</ul>
<h2>What's next? [#what-next]</h2>
<p>You may also want to:</p>
<ul>
  <li><a href="/docs/Infrastructure-configure-your-agent#conf-custom_attributes">Add custom attributes</a> to annotate your Infrastructure data.</li>
  <li><a href="/docs/infrastructure-amazon-aws-ec2-integration#connect">Connect your AWS account</a> if your servers are hosted on Amazon EC2.</li>
  <li>Add other <a href="/docs/infrastructure/integrations-getting-started/getting-started/introduction-infrastructure-integrations">New Relic Infrastructure integrations</a> to collect data from external services.</li>
  <li>Manually <a href="/docs/infrastructure-start-stop-restart-check-agent-status#linux">start, stop, restart, or check the agent status</a>.</li>
</ul>
