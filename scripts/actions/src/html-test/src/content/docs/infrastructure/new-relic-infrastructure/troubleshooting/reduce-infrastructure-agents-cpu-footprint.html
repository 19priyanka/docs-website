
<h2>Problem</h2>
<p>The New Relic infrastructure agent is consuming too much CPU.</p>
<h2>Solution</h2>
<p>The New Relic infrastructure agent is designed to report a broad range of system data with minimal CPU and memory consumption. However, if you have a need to reduce your CPU consumption, you can disable or decrease the sampling frequency of various samplers and plugins.</p>
<p>This topic highlights some <code>newrelic-infra.yml</code> configurations that may reduce your CPU usage:</p>
<ul>
  <li><a href="#samplers">Reduce event sampling</a></li>
  <li><a href="#reduce_disable">Reduce agent plugin reporting</a></li>
  <li><a href="on_host_integrations">Review on-host integrations</a></li>
</ul>
<h3>Reduce event sampling [#samplers]</h3>
<p>The infrastructure agent reports several <a href="/docs/infrastructure/manage-your-data/data-instrumentation/default-infrastructure-events">default events</a> at specific frequencies. To lower the overhead, you can reduce the sampling frequency in seconds, or you can completely disable the samplers by setting the corresponding property value to <code>-1</code>.</p>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
  <p>We don't recommend a sample rate larger than 60 seconds because you may see gaps in the New Relic user interface charts.</p>
</div>
<p>The table below lists some samplers to configure:</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>Event</p>
      </div>
      <div>
        <p>Sampling frequency</p>
      </div>
      <div>
        <p>Allow/deny list</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p>Network</p>
      </div>
      <div>
        <p><a href="/docs/infrastructure/install-configure-manage-infrastructure/configuration/infrastructure-configuration-settings#metrics-network-sample-rate">Network sampling rate</a></p>
      </div>
      <div>
        <p>Not available</p>
      </div>
    </div>
    <div>
      <div>
        <p>Process</p>
      </div>
      <div>
        <p><a href="/docs/infrastructure/install-configure-manage-infrastructure/configuration/infrastructure-configuration-settings#metrics-process-sample-rate">Process sampling rate</a></p>
      </div>
      <div>
        <p><a href="/docs/infrastructure/install-configure-manage-infrastructure/configuration/infrastructure-configuration-settings#allowed-list-process-sample">Allow list (Windows only)</a></p>
      </div>
    </div>
    <div>
      <div>
        <p>Storage</p>
      </div>
      <div>
        <p><a href="/docs/infrastructure/install-configure-manage-infrastructure/configuration/infrastructure-configuration-settings#metrics_storage_sample_rate">Storage sampling rate</a></p>
      </div>
      <div>
        <p><a href="/docs/infrastructure/install-configure-manage-infrastructure/configuration/infrastructure-configuration-settings#file-devices-ignored">Deny list</a></p>
      </div>
    </div>
    <div>
      <div>
        <p>System</p>
      </div>
      <div>
        <p><a href="/docs/infrastructure/install-configure-manage-infrastructure/configuration/infrastructure-configuration-settings#metrics-system-sample-rate">System sampling rate</a></p>
      </div>
      <div>
        <p>Not available</p>
      </div>
    </div>
  </div>
</div>
<h3>Reduce agent plugin reporting [#reduce_plugins]</h3>
<p>The infrastructure agent has built-in plugins that collect inventory data (specific system configuration and state information). For some systems, the CPU consumption may be relatively high if the plugins are gathering a lot of data. To reduce the footprint, you can disable or decrease the sampling frequency for specific plugins that report data you donâ€™t want.</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZW5hYmxlX2Rpc2FibGUifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IkhvdyB0byBlbmFibGUgYW5kIGRpc2FibGUgcGx1Z2lucyJ9XQ==">
    <div data-prop-text="title">How to enable and disable plugins</div>
    <ul>
      <li>
        <p><strong>Disable a single plugin:</strong> To disable a plugin, set the corresponding property value to <code>-1</code>.</p>
      </li>
      <li>
        <p><strong>Disable all plugins:</strong> <code>disable_all_plugins: true</code></p>
      </li>
      <li>
        <p><strong>Enable selected plugins:</strong> To enable certain plugins, insert an exception in <code>disable_all_plugins</code>. For example, the following configuration disables all plugins, but the Network Interfaces plugin reports every 120 seconds:</p>
        <pre><code>disable_all_plugins: true network_interface_interval_sec: 120
</code></pre>
      </li>
    </ul>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoic2VsaW51eCJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjp7InR5cGUiOiJtZHhWYWx1ZUV4cHJlc3Npb24iLCJ2YWx1ZSI6Ijw+RGlzYWJsZSBTRUxpbnV4IDxJbmxpbmVDb2RlPnNlbW9kdWxlIC1sPC9JbmxpbmVDb2RlPiAoTGludXggb25seSk8Lz4iLCJwb3NpdGlvbiI6eyJzdGFydCI6eyJsaW5lIjoxMzQsImNvbHVtbiI6MTEsIm9mZnNldCI6NDM4N30sImVuZCI6eyJsaW5lIjoxMzQsImNvbHVtbiI6ODMsIm9mZnNldCI6NDQ1OX19fX1d">
    <div data-prop-text="title">[object Object]</div>
    <p>The SELinux plugin periodically invokes the <code>semodule -l</code> system command to get information about the existing SELinux modules. In most CentOS/RedHat distributions, this command will generate CPU consumption peaks.</p>
    <p>To disable this functionality, insert the following configuration option in your <code>/etc/newrelic-infra.yml</code> file:</p>
    <p><code>selinux_enable_semodule: false</code></p>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoic3lzY3RsIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJSZWR1Y2Ugb3IgZGlzYWJsZSBTeXNjdGwgKExpbnV4IG9ubHkpIn1d">
    <div data-prop-text="title">Reduce or disable Sysctl (Linux only)</div>
    <p>The Sysctl plugin walks the whole <code>/sys</code> directory structure and reads values from all the files there. Disabling it or reducing the interval may decrease some CPU System time in the Infrastructure agent.</p>
    <p>You can disable inventory frequency by setting it to a negative number or reduce the frequeny by setting the <code>sysctl_interval_sec</code> configuration value to the number of seconds between consecutive executions of the plugin.</p>
    <p>For example, to execute the plugin once every 10 minutes:</p>
    <pre><code>sysctl_interval_sec: 600

</code></pre>The current default value for the `sysctl_interval_sec` property is `60`.
    <pre><code>
sysctl_interval_sec: -1

</code></pre>To disable the Sysctl plugin:
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiYWRkaXRpb25hbF9wbHVnaW5zIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJBZGRpdGlvbmFsIHBsdWdpbnMgdG8gcmVkdWNlIG9yIGRpc2FibGUifV0=">
    <div data-prop-text="title">Additional plugins to reduce or disable</div>
    <p>The following inventory plugins are not especially CPU consuming, but you can still reduce their frequency or disable them by setting the corresponding configuration options.</p>
    <p><strong>Linux plugins</strong></p>
    <p>For configuration of these Linux plugins, see <a href="/docs/infrastructure/install-configure-manage-infrastructure/configuration/infrastructure-configuration-settings#plugins-variables">Plugin variables</a>:</p>
    <ul>
      <li>
        <p>Cloud Security Groups</p>
      </li>
      <li>
        <p>Daemon Tools</p>
      </li>
      <li>
        <p>DPKG</p>
      </li>
      <li>
        <p>Facter</p>
      </li>
      <li>
        <p>Kernel Modules</p>
      </li>
      <li>
        <p>Network interfaces</p>
      </li>
      <li>
        <p>RPM</p>
      </li>
      <li>
        <p>SELinux</p>
      </li>
      <li>
        <p>Supervisord</p>
      </li>
      <li>
        <p>Sysctl</p>
      </li>
      <li>
        <p>Systemd</p>
      </li>
      <li>
        <p>SysV</p>
      </li>
      <li>
        <p>Upstart</p>
      </li>
      <li>
        <p>Users</p>
      </li>
      <li>
        <p>SSHD configuration</p>
        <p><strong>Windows plugins</strong></p>
        <p>For configuration of these Windows plugins, see <a href="/docs/infrastructure/install-configure-manage-infrastructure/configuration/infrastructure-configuration-settings#plugins-variables">Plugin variables</a>:</p>
      </li>
      <li>
        <p>Network interfaces</p>
      </li>
      <li>
        <p>Windows services</p>
      </li>
      <li>
        <p>Windows updates</p>
      </li>
    </ul>
  </div>
</div>
<h3>Review on-host integrations [#on_host_integrations]</h3>
<p>If you use infrastructure on-host integrations, this may have additional impacts on CPU usage. The nature of the impact and the methods to adjust the impact depend on the integration you're using.</p>
<p>Here are some ways to adjust on-host integration CPU usage:</p>
<ul>
  <li>See if your <a href="/docs/integrations/host-integrations/host-integrations-list">integration</a> has configuration options you can adjust.</li>
  <li>If possible, spread out the monitoring load by adding additional infrastructure agents. For example, the Kafka integration allows a <a href="/docs/integrations/host-integrations/host-integrations-list/kafka-monitoring-integration#multiple-agents">multi-agent deployment</a>.</li>
</ul>
