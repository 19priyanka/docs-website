
<h2>Summary</h2>
<p>A security update for New Relic's Ruby agent fixes a vulnerability where the agent could unintentionally capture raw aggregate queries with MongoDB. New Relic recommends updating to the latest remediated version.</p>
<p><strong>Release date:</strong> February 9, 2017</p>
<p><strong>Vulnerability identifier:</strong> NR17-03</p>
<p><strong>Priority:</strong> Low</p>
<h2>Affected software [#affected]</h2>
<p>The following New Relic agent versions are affected:</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p><strong>Name</strong></p>
      </div>
      <div>
        <p><strong>Affected version</strong></p>
      </div>
      <div>
        <p><strong>Notes</strong></p>
      </div>
      <div>
        <p><strong>Remediated version</strong></p>
      </div>
    </div>
    <div>
      <div>
        <p>Ruby agent</p>
      </div>
      <div>
        <p>3.13.1 (and greater)</p>
      </div>
      <div>
        <p>With MongoDB driver 2.1 (and greater)</p>
      </div>
      <div>
        <p><a href="https://docs.newrelic.com/docs/release-notes/agent-release-notes/ruby-release-notes/ruby-agent-3181330">3.18.1</a></p>
      </div>
    </div>
  </div>
</div>
<h2>Vulnerability information [#vuln-info]</h2>
<p>New Relicâ€™s Ruby Agent version 3.13.1 added visibility to MongoDB queries with version 2.1 and greater of the MongoDB driver for Ruby. The agent's default setting for <strong>mongo.obfuscate_queries</strong> is true. This should cause the agent to obfuscate the values in Mongo queries before sending this information to New Relic. However, when using the aggregate pipeline with this version of the driver, the aggregate queries were not properly obfuscated.</p>
<h3>Mitigating factors [#factors]</h3>
<ul>
  <li>Only customers who use version 2.1 and greater of the Ruby Driver for MongoDB are affected</li>
  <li>Aggregate queries generally do not contain sensitive information</li>
</ul>
<h2>Workarounds</h2>
<p>Users who are affected and are unable to upgrade may choose to configure the Ruby agent to not capture mongoDB queries. Users can set <strong>mongo.capture_queries</strong> to false to prevent the agent from sending any information about the query.</p>
<h2>Report security vulnerabilities to New Relic [#report]</h2>
<p>New Relic is committed to the security of our customers and their data. If you believe you have found a security vulnerability in one of our products or websites, we welcome and greatly appreciate you reporting it to New Relic's coordinated disclosure program. For more information, see <a href="/docs/security/new-relic-security/data-privacy/reporting-security-vulnerabilities">Reporting security vulnerabilities</a>.</p>
<h2>For more help [#more_help]</h2>
<p>Additional documentation resources include:.</p>
<ul>
  <li><a href="https://docs.mongodb.com/manual/core/aggregation-pipeline/">MongoDB Aggregate Pipeline</a></li>
  <li><a href="https://docs.newrelic.com/docs/agents/ruby-agent/configuration/ruby-agent-configuration#mongo">Ruby Agent Mongo Configuration</a></li>
  <li><a href="https://docs.newrelic.com/docs/agents/ruby-agent/installation/ruby-agent-installation">Ruby agent installation</a></li>
  <li><a href="https://newrelic.com/why-new-relic/security" title="Link opens in a new window.">NR Security</a></li>
</ul>
