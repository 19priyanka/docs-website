
<p><a href="https://www.salesforce.com/campaign/lightning/">Salesforce</a> has strict requirements about <a href="https://www.w3.org/TR/CSP2/">Content Security Policy (CSP) v2</a>. In this situation, you must copy and paste the New Relic Browser agent's JavaScript code and self-host it as a <code>.js</code> file. This allows the page to reference the <code>.js</code> file during page load.</p>
<h2>Contents [#in-page-toc]</h2>
<h2>Requirements</h2>
<p>In order to use New Relic Browser to monitor Salesforce Lightning pages, make sure you follow these requirements:</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p><strong>CSP and Salesforce Lightning</strong></p>
      </div>
      <div>
        <p><strong>Browser agent requirements</strong></p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p>Application or platform</p>
      </div>
      <div>
        <p>Your app or platform where your site is hosted must meet New Relic Browser's standard <a href="/docs/browser/new-relic-browser/getting-started/compatibility-requirements-new-relic-browser">compatibility requirements</a>. <strong>Exception:</strong> CSP restrictions prevent you from linking an APM app for Browser monitoring.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Subscription</p>
      </div>
      <div>
        <p>You must have a <a href="https://newrelic.com/browser-monitoring/pricing"><strong>Pro+SPA</strong> Browser subscription</a> for your app.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Host location for domains</p>
      </div>
      <div>
        <p>The <code>.js</code> file for New Relic Browser must be hosted on a highly available or replicated location, such as a CDN or distributed network. This helps ensure performance is not affected. Follow the <a href="https://help.salesforce.com/articleView?id=csp_trusted_sites.htm&#x26;type=5">Salesforce procedures</a> to add New Relic Browser URLs to your CSP whitelist.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Browser agent version</p>
      </div>
      <div>
        <ul>
          <li>Your selected app must use the <a href="/docs/release-notes/new-relic-browser-release-notes/browser-agent-release-notes">latest Browser agent version</a>.</li>
          <li>You must <strong>manually update</strong> the <code>.js</code> file whenever the New Relic Browser agent version is updated. New Relic Browser cannot make this change automatically for Salesforce Lightning apps.</li>
        </ul>
      </div>
    </div>
  </div>
</div>
<h2>1. Whitelist New Relic Browser domains [#csp-exception]</h2>
<p>Follow the <a href="https://help.salesforce.com/articleView?id=csp_trusted_sites.htm&#x26;type=5">Salesforce procedures</a> to add New Relic Browser URLs to your CSP whitelist. Add <strong>both</strong> of these New Relic Browser domains to your CSP whitelist:</p>
<ul>
  <li><code>https://js-agent.newrelic.com</code>: This is where the New Relic Browser agent is hosted. The Browser agent download requires three files to run. Two are downloaded after the initial agent is run to continue capturing performance data.</li>
  <li><code>https://bam.nr-data.net</code>: This is the endpoint where the New Relic Browser agent receives data from your site.</li>
</ul>
<h2>2. Copy Browser app's JS snippet [#js-snippet]</h2>
<p>To create and host a <code>.js</code> file, you must first copy the Browser agent's JavaScript snippet from the hosting app.</p>
<ol>
  <li>Go to <strong><a href="https://rpm.newrelic.com/browser">rpm.newrelic.com/browser</a></strong>.</li>
  <li>From the list of Browser apps, select the app for which you want to self-host the Browser agent.</li>
  <li>Select <strong>Settings > Application settings > Copy/paste JavaScript code</strong>.</li>
  <li>Copy the Browser agent's JavaScript snippet.</li>
  <li>Save and exit the Browser app's <strong>Application settings</strong> page.</li>
</ol>
<p>Continue with the procedures to create a <code>.js</code> file for your page.</p>
<h2>3. Create .js file for page [#js-file]</h2>
<p>After you copy the Browser agent's JavaScript snippet from the selected Browser app:</p>
<ol>
  <li>Open a text editor and paste the Browser agent's JavaScript snippet.</li>
  <li>Delete the first line (<code>&#x3C;script type="text/javascript"></code>) and the last line of the JavaScript snippet (<code>&#x3C;/script></code>).</li>
  <li>Save the text file as <code>nr-spa-AGENT_VERSION.min.js</code>, where AGENT_VERSION is the <a href="/docs/release-notes/new-relic-browser-release-notes/browser-agent-release-notes">latest Browser agent version</a>.</li>
  <li>Upload the <code>.js</code> file to your <a href="https://developer.salesforce.com/docs/atlas.en-us.lightning.meta/lightning/js_libs_platform.htm">Salesforce external JavaScript libs directory</a>, and reference the <code>.js</code> file in the <code>&#x3C;head></code> of your webpage.</li>
</ol>
<p>After you install the Browser agent's JavaScript snippet, you can use the <a href="/docs/browser/new-relic-browser/getting-started/browser-overview-page-website-performance-summary">New Relic Browser UI</a> to monitor website performance.</p>
<h2>4. Keep Browser agent up to date [#agent-update]</h2>
<p>You must <a href="#js-file">manually update the <code>.js</code> file</a> whenever New Relic updates the <a href="/docs/release-notes/new-relic-browser-release-notes/browser-agent-release-notes">Browser agent version</a>. New Relic Browser cannot make this change automatically for Salesforce Lightning apps.</p>
