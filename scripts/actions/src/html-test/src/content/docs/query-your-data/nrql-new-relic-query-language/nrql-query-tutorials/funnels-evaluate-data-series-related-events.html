
<p>With <a href="/docs/query-data/nrql-new-relic-query-language/getting-started/introduction-nrql">NRQL</a>, you can use funnels to evaluate sets of related actions. The actions generally share a relationship via an identifier such as a user ID or session ID.</p>
<h2>Why it matters [#why-matters]</h2>
<p>NRQL <code>funnel</code> functions can answer questions like, "Of the people that completed step A, how many also completed step B, and of the people that completed steps A and B, how many also completed step C?"</p>
<p>For example, at New Relic, we could use <code>funnel</code> to track the number of users who completed these steps:</p>
<ol>
  <li>Visited the <a href="https://newrelic.com/platform">New Relic One marketing page</a>.</li>
  <li>Signed up for an account.</li>
  <li>Created a dashboard.</li>
</ol>
<h2>Funnel query structure [#requirements]</h2>
<p>Here's the structure of a simple NRQL funnel query:</p>
<pre><code>FROM DATA_TYPE 
  SELECT funnel(AN_ATTRIBUTE, ACTION_A, ACTION_B) 
  SINCE TIMEFRAME
</code></pre>
<p>See also a more complex <a href="#example">funnel query example</a>.</p>
<p>Funnel queries require the <a href="/docs/query-data/nrql-new-relic-query-language/getting-started/nrql-syntax-components-functions#func-funnel"><code>funnel</code> function</a>, an <a href="https://docs.newrelic.com/docs/using-new-relic/welcome-new-relic/get-started/glossary#attribute">attribute</a> to funnel, and at least two steps:</p>
<ol>
  <li>The first step is the anchor step, which will always represent 100% of the results.</li>
  <li>The second and later steps describe the number of users who have also completed additional actions. This number typically will be less than 100%. However, it could be 100% if every user who completes action (A) also completes the additional actions being queried.</li>
</ol>
<h2>Funnel query technical details</h2>
<p>One way to use funnel queries is to calculate the rate at which multi-step, ordered sequences were completed over a given timeframe, like in the New Relic One signup <a href="#why-matters">example</a>. But you can also use funnels to calculate overlap between several distinct actions that don't have a sequential relationship to one another. In other words, the order of steps doesn't impact the calculations performed.</p>
<p>The way funnel queries compute results varies depending on the size of the data set:</p>
<ul>
  <li>If the funnel is dealing with 256 funnel attribute values or fewer, it will calculate the value exactly.</li>
  <li>If it's dealing with more than 256 funnel attribute values, it applies an algorithm called MinHash to calculate approximate results for optimized performance.</li>
</ul>
<p>This means that for large data sets, there may be occasional "false positives" at the level of individual data points. These do not interfere greatly with the accuracy of the numerical estimates provided in query results.</p>
<p>Here's a detailed breakdown of technical details and constraints for funnel queries.</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p><strong>Technical details</strong></p>
      </div>
      <div>
        <p><strong>Comments</strong></p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p>Order of steps</p>
      </div>
      <div>
        <p>The order of steps completed is not enforced and does not impact results.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Attributes</p>
      </div>
      <div>
        <p>You can only run funnel queries on one attribute at a time.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Unique values</p>
      </div>
      <div>
        <p>For funnel queries that involve more than 256 unique funnel attribute values, the results are approximate.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Maximum steps</p>
      </div>
      <div>
        <p>You can have a maximum of 10 steps within a single funnel query.</p>
      </div>
    </div>
  </div>
</div>
<h2>Funnel query example [#example]</h2>
<p>This example queries the New Relic Browser <a href="/attribute-dictionary?attribute_name=&#x26;events_tids%5B%5D=8302"><code>PageView</code></a> event and its attributes. It queries unique browser sessions that have progressed from registration to account upgrades. Labels are included for each step, indicated by the keyword <code>AS</code>.</p>
<pre><code>FROM PageView SELECT funnel(session, 
    WHERE pageUrl='http://www.storefront.com/signup' AS 'Email Sign Up', 
    WHERE pageUrl='http://www.appproduction.com/basic_feature' AS 'Feature Compare', 
    WHERE pageUrl='http://www.appproduction.com/advanced_feature/upgrade' AS 'Upgraded Account') 
    SINCE 12 hours ago
</code></pre>
<p>This query returns the following:</p>
<p>
  <img src="./images/crop-insights-funnels.png" alt="Screenshot of funnel function" title="crop-insights-funnels.png">
</p>
<p>An example NRQL funnel query that displays a count of the users who registered for an account, visited a feature-compare page, and upgraded.</p>
<p>Include additional actions inside the parentheses of the funnel function in a comma separated list:</p>
<pre><code>SELECT funnel(session, 
    WHERE name='Controller/about/main' AS 'Action A', 
    WHERE name = 'Controller/about/careers' AS 'Action B', 
    WHERE name = 'Controller/about/insights' AS 'Action C', 
    WHERE name = 'Controller/about/apply' AS 'Action D') 
    FROM PageView 
    SINCE 1 week ago
</code></pre>
