
<p>Using <a href="/docs/query-data/nrql-new-relic-query-language/getting-started/introduction-nrql">NRQL</a>, you can split your query results into buckets that cover certain ranges using the <a href="/docs/insights/nrql-new-relic-query-language/nrql-reference/nrql-syntax-components-functions#func-buckets"><code>buckets</code> function</a> .</p>
<h2>Create bucketed NRQL query [#segmentation]</h2>
<p>To return bucketed results, use the <code>FACET buckets()</code> clause in a NRQL query. A bucketing query has the structure:</p>
<pre><code>SELECT FUNCTION(ATTRIBUTE) 
    FROM DATA_TYPE 
    FACET buckets(ATTRIBUTE, CEILING_VALUE, NUMBER_OF_BUCKETS)
</code></pre>
<p>Bucketing can be used with any attribute that is stored as a numerical value in the New Relic database.</p>
<h2>Bucket query example [#example]</h2>
<p>To create a chart that shows the average duration of ranges of database calls:</p>
<ol>
  <li>Create a NRQL statement with a <code>SELECT</code> statement for an attribute; for example, <code>SELECT average(duration)</code>.</li>
  <li>Add a <code>FACET</code> clause that facets on buckets for another attribute; for example, <code>buckets(databaseCallCount,400,10)</code>.</li>
</ol>
<p>This query computes the average duration for each of the 10 buckets, with an upper limit of 400. All values above our upper limit of 400 are grouped in the last bucket, “>=360.0”.</p>
<pre><code>SELECT average(duration) FROM Transaction 
    SINCE 12 hours ago 
    FACET buckets(databaseCallCount, 400, 10)
</code></pre>
<p>This query returns the following results:</p>
<p>
  <img src="./images/facet-buckets_0.png" alt="facet-buckets.png" title="facet-buckets.png">
</p>
<p>Here' an example of a NRQL query with segments broken out into ten buckets. The bottom bucket will include outliers, so you may want to adjust accordingly.</p>
