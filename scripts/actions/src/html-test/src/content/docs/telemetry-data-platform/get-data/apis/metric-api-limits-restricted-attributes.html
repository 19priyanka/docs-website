
<p>This document describes data requirements for the <a href="/docs/new-relic-metric-api">Metric API</a>, including:</p>
<ul>
  <li>Maximum limits</li>
  <li>Restricted attributes</li>
</ul>
<h2>Maximum limits [#requirements]</h2>
<p>The following default limits apply for all Metric data:</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>Condition</p>
      </div>
      <div>
        <p>Limit</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p>Age range for timestamp values</p>
      </div>
      <div>
        <p>Metrics reported with a timestamp older than 48 hours ago or newer than 24 hours from the time they are reported are dropped.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Max data points per minute (DPM)</p>
        <p>See <a href="#accounts-asterisk">Additional account conditions</a>.</p>
      </div>
      <div>
        <p>1 million DPM</p>
      </div>
    </div>
    <div>
      <div>
        <p>Max unique timeseries (cardinality) per account per day</p>
        <p>See <a href="#accounts-asterisk">Additional account conditions</a>.</p>
      </div>
      <div>
        <p>1 million</p>
        <p>A timeseries is a single, unique combination of a metric name and any attributes.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Max unique timeseries (cardinality) per metric name per day</p>
      </div>
      <div>
        <p>100k</p>
      </div>
    </div>
    <div>
      <div>
        <p>Max payloads per minute</p>
      </div>
      <div>
        <p>100k</p>
      </div>
    </div>
    <div>
      <div>
        <p>Max attributes per metric</p>
      </div>
      <div>
        <p>100</p>
      </div>
    </div>
    <div>
      <div>
        <p>Max metric attribute name length</p>
      </div>
      <div>
        <p>255 characters</p>
      </div>
    </div>
    <div>
      <div>
        <p>Max characters for an attribute key</p>
      </div>
      <div>
        <p>255 characters</p>
      </div>
    </div>
    <div>
      <div>
        <p>Max metric attribute value length</p>
      </div>
      <div>
        <p>4096 characters</p>
      </div>
    </div>
    <div>
      <div>
        <p>Allowed HTTP protocols</p>
      </div>
      <div>
        <p>HTTPS only</p>
      </div>
    </div>
    <div>
      <div>
        <p>Numerical long values falling outside minimum or maximum Java long values</p>
      </div>
      <div>
        <p>Numerical long values that fall outside of the minimum or maximum Java long value will be rejected.</p>
        <ul>
          <li>If the number is in the common block, then the entire block will be dropped.</li>
          <li>If the number is in a metric data point, then the metric data point it resides in will be dropped.</li>
        </ul>
      </div>
    </div>
    <div>
      <div>
        <p>Numerical double values falling outside minimum or maximum Java double values</p>
      </div>
      <div>
        <p>Numeric double values that fall outside of a the minimum or maximum Java double value will be rejected.</p>
        <ul>
          <li>If the number is in the common block, then the entire block will be dropped.</li>
          <li>If the number is in a metric data point, then the metric data point it resides in will be dropped.</li>
        </ul>
      </div>
    </div>
    <div>
      <div>
        <p>Payload size</p>
      </div>
      <div>
        <p>Total maximum size or length: <strong>1MB (10^6 bytes) maximum per POST</strong>. We highly recommend using compression.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Payload format</p>
      </div>
      <div>
        <p>The payload must encoded as <strong>UTF-8</strong>.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Attribute naming syntax</p>
      </div>
      <div>
        <p>Attribute names can be a combination of alphanumeric characters, colons (<code>:</code>), periods (<code>.</code>), and underscores (<code>_</code>).</p>
      </div>
    </div>
  </div>
</div>
<p>The following default limits apply only to data collected via the Prometheus Remote Write integration:</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>Condition</p>
      </div>
      <div>
        <p>Limit</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p>Max unique Count and Summary timeseries (cardinality) per account per 5 minute interval</p>
        <p>See <a href="#accounts-asterisk">Additional account conditions</a>.</p>
      </div>
      <div>
        <p>1 million</p>
        <p>A timeseries is a single, unique combination of a metric name and any attributes. Timeseries received above this limit are dropped. This limit is enforced prior to and in addition to standard Metric limits.</p>
      </div>
    </div>
  </div>
</div>
<h3>Additional account conditions [#additional-considerations]</h3>
<p>Metric API limits apply at the individual account level. Trial and paid accounts receive a 1M DPM and 1M cardinality limit for trial purposes, but you can request up to 15M DPM and 15M cardinality for your account. To request changes to your metric rate limits, contact your New Relic account representative, or visit our <a href="http://support.newrelic.com/">Support portal</a>.</p>
<h2>Rate limit violations</h2>
<p>This section describes how the Metric API behaves when you exceed the rate limits, and how to respond if limits are exceeded.</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoidmlvbGF0aW9uLWRwbS1leGNlZWRlZCJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiTWF4IGRhdGEgcG9pbnRzIHBlciBtaW51dGUgKERQTSkifV0=">
    <div data-prop-text="title">Max data points per minute (DPM)</div>
    <p>Data points per minute refers to the per minute rate at which individual metric values are sent to the Metric API.</p>
    <p>When the maximum DPM limit is exceeded for an account, the New Relic Metric API returns a <code>429</code> response for the remainder of the minute. The response will include a <code>Retry-After</code> header indicating how long to wait in seconds before resubmitting or sending new data.</p>
    <p>To resolve this issue, either reduce the number of data points you are sending, or request a rate limit change. Subsequent subscription changes do not impact modified rate limits. If an account change impacts your rate limit, you must notify us to adjust your rate limit.</p>
    <p>To request rate limit changes, contact your New Relic account representative, or visit our <a href="http://support.newrelic.com">Support portal</a>.</p>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoidmlvbGF0aW9uLXVuaXF1ZS10aW1lc2VyaWVzIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJNYXggdW5pcXVlIHRpbWVzZXJpZXMgcGVyIGFjY291bnQgcGVyIGRheSJ9XQ==">
    <div data-prop-text="title">Max unique timeseries per account per day</div>
    <p>A timeseries is a single, unique combination of a metric name and any attributes assigned to that metric. For example, if a <code>CPU utilization</code> metric with a single attribute <code>hostname</code> is sent from ten different hosts, this equals ten distinct values for the <code>hostname</code> attribute and ten unique metric timeseries.</p>
    <p>If the per-account, per-day unique metric timeseries (cardinality) limit is exceeded during a 24 hour period, the endpoint will continue to receive and store raw metric data. However, New Relic will stop creating additional aggregate rollups (1 minute, 5 minutes, etc.) for the remainder of the 24 hour period. (These rollups are used used by default to query time windows longer than 60 minutes.)</p>
    <p>You can continue to query your data when such a violation occurs by specifying a 60 minute or shorter time window or specifying the RAW keyword as described in <a href="/docs/introduction-new-relic-metric-api#example-view-raw-datapoints">view and query your metrics</a>. This can be helpful in identifying potential causes for the violation.</p>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoidmlvbGF0aW9uLXVuaXF1ZS10aW1lc2VyaWVzIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJNYXggdW5pcXVlIHRpbWVzZXJpZXMgcGVyIG1ldHJpYyBuYW1lIHBlciBkYXkifV0=">
    <div data-prop-text="title">Max unique timeseries per metric name per day</div>
    <p>A timeseries is a single, unique combination of a metric name and any attributes assigned to that metric. For example, if a <code>CPU utilization</code> metric with a single attribute <code>hostname</code> is sent from ten different hosts, this equals ten distinct values for the <code>hostname</code> attribute and ten unique metric timeseries.</p>
    <p>If the per-metric name, per-day unique metric timeseries (cardinality) limit is exceeded during a 24 hour period, the endpoint will continue to receive and store raw metric data. However, New Relic will stop creating additional aggregate rollups (1 minute, 5 minutes, etc.) for the remainder of the 24 hour period. (These rollups are used used by default to query time windows longer than 60 minutes.)</p>
    <p>You can continue to query your data when such a violation occurs by specifying a 60 minute or shorter time window or specifying the RAW keyword as described in <a href="/docs/introduction-new-relic-metric-api#example-view-raw-datapoints">view and query your metrics</a>. This can be helpful in identifying potential causes for the violation.</p>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoidmlvbGF0aW9uLXBheWxvYWRzIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJNYXggcGF5bG9hZHMgcGVyIG1pbnV0ZSJ9XQ==">
    <div data-prop-text="title">Max payloads per minute</div>
    <p>If you make more than 100k POST requests to the Metric API endpoint within a minute, the endpoint will return a <code>429</code> response for the remainder of the minute. The response will include a <code>Retry-After</code> header indicating how long to wait in seconds before resubmitting or sending new data.</p>
    <p>In general, if you reach this limit, consider creating larger payloads. To do this, combine more data points into each request to reduce the number of POSTs that are necessary.</p>
    <p>If this is not an option, you can request a rate limit increase by contacting your New Relic account representative or visiting our <a href="http://support.newrelic.com/">Support portal</a>.</p>
  </div>
</div>
<h2>Restricted attributes [#send-metric-data]</h2>
<p>These attributes are restricted by the New Relic platform. Any values submitted with these keys in the attributes section of a metric data point will cause the data point to be dropped, or the value to be omitted or overwritten:</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>Attribute</p>
      </div>
      <div>
        <p>Description</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p><code>newrelic.source</code></p>
      </div>
      <div>
        <p>This resets to the value <code>metricAPI</code>.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>metricName</code></p>
      </div>
      <div>
        <p>This resets to the <code>name</code> value passed into each data point. This allows <code>name</code> to be an attribute key.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>endTimestamp</code></p>
      </div>
      <div>
        <p><code>timestamp</code> and <code>interval.ms</code> will be converted to an <code>endTimestamp</code> for the data point.</p>
      </div>
    </div>
  </div>
</div>
<p>Additional restrictions include:</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>Restriction</p>
      </div>
      <div>
        <p>Comments</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p>Metric and attribute names</p>
      </div>
      <div>
        <p>You cannot pass the same value for metric name and attribute name.</p>
        <p>In the following example, the metric is invalid because the metric is named <code>service.errors.all</code> and there is an attribute <code>service.errors.all</code>.</p>
        <p><strong>Example: Metric value used as an attribute (invalid)</strong></p>
        <pre><code>[
  {
    "metrics": [
      {
        "name": "service.errors.all",
        "type": "count",
        "value": 15,
        "timestamp": 1531414060739,
        "interval.ms": 10000,
        "attributes": {
          "service.response.statuscode": "400",
          "service.errors.all": "test",
          "service.name": "foo"
        }
      }
    ]
  }
]

</code></pre>
      </div>
    </div>
    <div>
      <div>
        <p>Reserved words</p>
      </div>
      <div>
        <p>The Metric API inherits some <a href="/docs/insights/insights-data-sources/custom-data/insights-custom-data-requirements-limits#reserved-words">reserved words from New Relic Insights</a>, including <code>accountID</code>, <code>appId</code>, and <code>eventType</code>. Additionally, the syntax terms for NRQL are restricted unless you backtick (<code>``</code>) them. For a full list, see <a href="/docs/insights/insights-data-sources/custom-data/insights-custom-data-requirements-limits#reserved-syntax">Reserved words: NRQL syntax terms</a>.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Keys within metric JSON</p>
      </div>
      <div>
        <p>All keys used within the metric JSON cannot be attribute keys. This includes <code>interval.ms</code>, <code>timestamp</code>, <code>value</code>, <code>common</code>, <code>min</code>, <code>max</code>, <code>count</code>, <code>sum</code>, and <code>metrics</code>.</p>
        <p><strong>Exception:</strong> You can use <code>name</code> as an attribute key.</p>
      </div>
    </div>
  </div>
</div>
