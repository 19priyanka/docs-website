
<p>Use the <a href="/docs/introduction-new-relic-metric-api">Metric API</a> to send custom metrics to the New Relic platform. This document includes a quick start to send your first custom metric, plus detailed information on how to format and send your metric data.</p>
<h2>Quick start: Send metric data [#send-metric-data]</h2>
<p>We report the metric types <code>count</code>, <code>gauge</code>, and <code>summary</code>. For more information on metrics see <a href="/docs/telemetry-data-platform/ingest-manage-data/understand-data/metric-data-type">our documentation</a>.</p>
<p>Metric data is submitted to New Relic through an HTTP POST request. Each request is composed of one or more metric data points, which consist of a metric name, a timestamp, and a value.</p>
<p>Follow this example to send your first metric data points to New Relic:</p>
<ol>
  <li>
    <p>Find or register an <a href="/docs/insights/insights-data-sources/custom-data/send-custom-events-event-api#register">Insert API key</a> for your account: Go to: <strong><a href="https://one.newrelic.com">one.newrelic.com</a> > <a href="/docs/using-new-relic/welcome-new-relic/get-started/glossary#account-dropdown">account dropdown</a> > Account settings > API keys</strong>, and select <strong>Insights API keys</strong>.</p>
  </li>
  <li>
    <p>Insert your API key into the following JSON, and then send the JSON to our <a href="#api-endpoint">endpoint</a>.</p>
    <p>This example creates a single metric data point for a metric named <code>memory.heap</code>, but you can create additional attributes or data points by specifying <a href="#supported-metric-types">metric types</a> or adding <a href="#optional-map-attributes">optional <code>common</code> blocks</a>.</p>
    <pre><code>curl -vvv -k -H "Content-Type: application/json" \
-H "Api-Key: YOUR_API_KEY_HERE" \
-X POST https://metric-api.newrelic.com/metric/v1 \
--data '[{ 
        "metrics":[{ 
           "name":"memory.heap", 
           "type":"gauge", 
           "value":2.3, 
           "timestamp":CURRENT_TIME_IN_MILLISECONDS_HERE, 
           "attributes":{"host.name":"dev.server.com"} 
           }] 
    }]'
</code></pre>
  </li>
</ol>
<p>The metric should be available in New Relic in a few seconds. You can query the data from any <a href="/docs/query-data/nrql-new-relic-query-language/getting-started/introduction-nrql#where">NRQL interface</a> using this query:</p>
<pre><code>FROM Metric SELECT max(memory.heap) TIMESERIES
</code></pre>
<p>For more on where data shows up, see <a href="/docs/data-ingest-apis/get-data-new-relic/metric-api/introduction-metric-api#find-data">Find Metric API data</a>.</p>
<h2>Endpoint URL [#api-endpoint]</h2>
<p>Use an HTTP POST when sending metric data to the metric API endpoint:</p>
<pre><code>https://metric-api.newrelic.com/metric/v1
</code></pre>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJ0aXAifV0=">
  <p>If your account hosts data in the EU data center, ensure you're using the proper <a href="/docs/using-new-relic/welcome-new-relic/getting-started/introduction-eu-region-data-center#endpoints">API endpoints for EU region accounts</a>.</p>
</div>
<h2>HTTP request headers [#headers-query-parameters]</h2>
<p>Include the following HTTP request headers with the POST request. You can send some parameters as query parameters instead of request headers.</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>Header</p>
      </div>
      <div>
        <p>Send as a query parameter?</p>
      </div>
      <div>
        <p>Details</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p><code>Content-Type</code></p>
      </div>
      <div>
        <p>No</p>
      </div>
      <div>
        <p><strong>Required</strong>. Must be <code>application/json</code>.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>Content-Length</code></p>
      </div>
      <div>
        <p>No</p>
      </div>
      <div>
        <p><strong>Required (usually set automatically by the HTTP client)</strong>. The length of the request body in octets (8-bit bytes) unless sent with chunked encoding. This header is generally set by default by the underlying HTTP client sending the data and in most cases should not require any additional effort by the end user.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>Api-Key</code></p>
      </div>
      <div>
        <p>Yes</p>
      </div>
      <div>
        <p><strong>Required.</strong> The <a href="/docs/insights/insights-data-sources/custom-data/send-custom-events-event-api#register">Insert API key</a> authenticates you to use the Metric API. If this is provided as both a header and a query parameter, the values must match.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>Content-Encoding</code></p>
      </div>
      <div>
        <p>No</p>
      </div>
      <div>
        <p><strong>Required if GZIP.</strong> The value must be <code>GZIP</code> or <code>Identity.</code> If no value is present, then <code>Identity</code> is assumed.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>x-request-id</code></p>
      </div>
      <div>
        <p>No</p>
      </div>
      <div>
        <p><strong>Optional - Reserved for future use.</strong> The value must be a valid <code>UUID4</code>. The value is expected to be unique for each request.</p>
      </div>
    </div>
  </div>
</div>
<h2>HTTP request body [#body-format]</h2>
<p>The body of the HTTP POST request must be in JSON format. The following describes the requirements and recommendations for the JSON payload.</p>
<p>The payload must be encoded as <strong>UTF-8</strong>.</p>
<h3>Structure [#new-relic-guidelines]</h3>
<p>The JSON payload uses this structure:</p>
<ul>
  <li>The JSON payload is an array of maps.</li>
  <li>Each map must contain a <code>metrics</code> key whose value is an array containing one or more metric data points.</li>
  <li>A metric data point is identified by a <code>name</code>, <code>type</code>, and <code>value</code> along with an optional set of attributes.</li>
</ul>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoianNvbi1mb3JtYXQtZXhhbXBsZSJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiSlNPTiBwYXlsb2FkIGNyZWF0aW5nIHR3byBtZXRyaWNzIn1d">
    <div data-prop-text="title">JSON payload creating two metrics</div>
    <p>This example payload creates two metrics. <code>service.errors.all</code> is a count metric with three attributes and <code>service.memory</code> is a gauge metric with two attributes.</p>
    <pre><code>[
  {
    "metrics": [
      {
        "name": "service.errors.all",
        "type": "count",
        "value": 15,
        "timestamp": CURRENT_TIME_IN_MILLISECONDS_HERE,
        "interval.ms": 10000,
        "attributes": {
          "service.response.statuscode": "400",
          "host.name": "dev.server.com",
          "service.name": "foo"
        }
      },
      {
        "name": "service.memory",
        "type": "gauge",
        "value": 2.7,
        "timestamp": CURRENT_TIME_IN_MILLISECONDS_HERE,
        "attributes": {
          "host.name": "dev.server.com",
          "app.name": "foo"
        }
      }
    ]
  }
]

</code></pre>
  </div>
</div>
<h3>Required key-value pairs [#json-payload-keys]</h3>
<p>Each metric data point map in the <code>metrics</code> array uses the following key-value structure:</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>Key</p>
      </div>
      <div>
        <p>Description</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p><code>name</code></p>
        <p><em>string</em></p>
      </div>
      <div>
        <p><strong>Required</strong>. The name of the metric. The value must be less than 255 characters.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>value</code></p>
        <p><em>number</em> or <em>map</em></p>
      </div>
      <div>
        <p><strong>Required</strong>. The value varies depending on the <a href="/docs/telemetry-data-platform/ingest-manage-data/understand-data/metric-data-type">metric type</a>. For <code>gauge</code> and <code>count</code> the value should be a single number. For <code>summary</code>, the value should be a map with key-value pairs specifying the count, sum, min, and max.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>timestamp</code></p>
        <p><em>long</em></p>
      </div>
      <div>
        <p><strong>Required</strong>. The metric's start time in <a href="https://currentmillis.com/">Unix time</a>. Defaults to the current time in UTC timezone. This field also support seconds, microseconds, and nanoseconds. However, the data will be converted to milliseconds for storage and query. Metrics reported with a timestamp older than 48 hours ago or newer than 24 hours from the time they are reported are dropped.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>interval.ms</code></p>
        <p><em>positive long</em></p>
      </div>
      <div>
        <p><strong>Required for <code>count</code> and <code>summary</code> <a href="/docs/telemetry-data-platform/ingest-manage-data/understand-data/metric-data-type">metric types</a></strong>. The length of the time window.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>type</code></p>
      </div>
      <div>
        <p><strong>Recommended</strong>. This should be one of the <a href="/docs/telemetry-data-platform/ingest-manage-data/understand-data/metric-data-type">supported metric types</a>. If you do not specify a type, then this will default to a <code>gauge</code>.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>attributes</code></p>
        <p><em>strings</em>, <em>JSON numbers</em>, or <em>booleans</em></p>
      </div>
      <div>
        <p><strong>Recommended</strong>. A map of key value pairs associated with this specific metric. Values can be strings, JSON numbers, or booleans. Keys are case-sensitive and must be less than 255 characters.</p>
      </div>
    </div>
  </div>
</div>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoibWV0cmljLXR5cGVzLWV4YW1wbGUifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IkpTT04gcGF5bG9hZCB3aXRoIHRocmVlIG1ldHJpYyB0eXBlcyJ9XQ==">
    <div data-prop-text="title">JSON payload with three metric types</div>
    <p>Here's an example payload containing one metric data point for each metric type:</p>
    <pre><code>[
  {
    "metrics": [
      {
        "name": "cache.misses",
        "type": "count",
        "value": 15,
        "timestamp": CURRENT_TIME_IN_MILLISECONDS_HERE,
        "interval.ms": 10000,
        "attributes": {
          "cache.name": "myCache",
          "host.name": "dev.server.com"
        }
      },
      { 
        "name": "temperature", 
        "type": "gauge", 
        "value": 15, 
        "timestamp": CURRENT_TIME_IN_MILLISECONDS_HERE, 
        "attributes": { 
          "city": "Portland", 
          "state": "Oregon" 
        } 
      },
      {
        "name": "service.response.duration",
        "type": "summary",
        "value": {
          "count": 5, 
          "sum": 0.004382655, 
          "min": 0.0005093, 
          "max": 0.001708826
        },
        "interval.ms": 10000, 
        "timestamp": CURRENT_TIME_IN_MILLISECONDS_HERE,
        "attributes": {
          "host.name": "dev.server.com",
          "app.name": "foo"
        }
      }
    ]
  }
]

</code></pre>
  </div>
</div>
<h3>Share attributes across metrics with <code>common</code> [#optional-map-attributes]</h3>
<p>If you want to include a set of attributes on multiple metrics (and not add the same attributes for each metric), you can use the <code>common</code> block. This is an optional map that specifies information that applies to all associated metric data points. Values in the common section will be overridden if the same key exists on a metric data point.</p>
<p>The block can include:</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>Attribute</p>
      </div>
      <div>
        <p>Description</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p><code>timestamp</code></p>
        <p><em>long</em></p>
      </div>
      <div>
        <p>The metric's start time in <a href="https://currentmillis.com/">Unix time</a>. This defaults to the current time in the UTC timezone. This field also supports seconds, microseconds, and nanoseconds. However, the data will be converted to milliseconds for storage and later querying.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>interval.ms</code></p>
        <p><em>positive long</em></p>
      </div>
      <div>
        <p><strong>Required for <code>count</code> and <code>summary</code>.</strong>The length of the time window.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>attributes</code></p>
        <p><em>strings, JSON numbers, or booleans</em></p>
      </div>
      <div>
        <p>A map of key-value pairs associated with this specific metric. Values can be strings, JSON numbers, or booleans.</p>
      </div>
    </div>
  </div>
</div>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZXhhbXBsZS1jb21tb24tYXR0cmlidXRlcyJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjp7InR5cGUiOiJtZHhWYWx1ZUV4cHJlc3Npb24iLCJ2YWx1ZSI6Ijw+RXhhbXBsZSBvZiA8SW5saW5lQ29kZT5jb21tb248L0lubGluZUNvZGU+IGF0dHJpYnV0ZXM8Lz4iLCJwb3NpdGlvbiI6eyJzdGFydCI6eyJsaW5lIjo0MjEsImNvbHVtbiI6MTEsIm9mZnNldCI6MTIxOTB9LCJlbmQiOnsibGluZSI6NDIxLCJjb2x1bW4iOjcxLCJvZmZzZXQiOjEyMjUwfX19fV0=">
    <div data-prop-text="title">[object Object]</div>
    <p>In the following example payload, three metrics are sent. All three metrics share <code>app.name</code> and <code>host.name</code> attributes, specified in the <code>common</code> block. Each metric also has a unique value for another attribute, <code>server.response.statuscode</code>.</p>
    <pre><code>[
  {
    "common" : {
      "timestamp": 1531414060739,
      "interval.ms": 10000,
      "attributes": {
        "app.name": "foo",
        "host.name": "dev.server.com"
      }
    },
    "metrics": [
      {
        "name": "service.errors.all",
        "type": "count",
        "value": 9,
        "attributes": {
          "service.response.statuscode": "400"
        }
      },
      {
        "name": "service.errors.all",
        "type": "count",
        "value": 4,
        "attributes": {
          "service.response.statuscode": "500"
        }
      },
      {
        "name": "service.response.duration",
        "type": "summary",
        "value": {
          "count": 5,
          "sum": 0.004382655,
          "min": 0.0005093,
          "max": 0.001708826
        },
        "attributes": {
          "service.response.statuscode": "200"
        }
      }
    ]
  }
]

</code></pre>
  </div>
</div>
<h2>Response validation and status codes [#response-validation]</h2>
<p>The Metric API returns a <code>202</code> response code for successful requests. When your data is accepted, an HTTP <code>202</code> response code is returned with a response structure like this:</p>
<pre><code>HTTP/1.1 202 Accepted
Content-Type: application/json; charset=UTF-8
Content-Length: 52
Access-Control-Allow-Methods: GET, POST, PUT, HEAD, OPTIONS
Access-Control-Allow-Credentials: true
Access-Control-Allow-Origin: *
Connection: keep-alive

{"requestId":"f0e7bfff-001a-b000-0000-01682bcf4565"}
</code></pre>
<h3>Missing data with <code>202</code> response [#async-errors]</h3>
<p>A <code>202</code> code indicates the API did receive your data, and that the data passed basic validation checks. Normally, your data will be available for querying within a few seconds. However, New Relic runs additional validation asynchronously after receiving your data. If you receive a <code>202</code> response but can't find your metric, this indicates that New Relic found an error during this asynchronous validation.</p>
<p>You can find these errors in the <code>NrIntegrationError</code> event in the account associated with the Insert API key you used. The <code>requestId</code> for each request will be tagged on the <code>NrIntegrationError</code> event. See <a href="/docs/troubleshoot-nrintegrationerror-event">Troubleshoot a <code>NRIntegrationError</code> event</a> for more information.</p>
<h3>Status codes [#response-status-codes]</h3>
<p>The Metric API can return the following HTTP status codes:</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>Status code</p>
      </div>
      <div>
        <p>Definition</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p><code>202</code></p>
      </div>
      <div>
        <p>Data accepted.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>400</code></p>
      </div>
      <div>
        <p>Structure of the request is invalid.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>403</code></p>
      </div>
      <div>
        <p>Authentication failure.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>404</code></p>
      </div>
      <div>
        <p>The request path is incorrect.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>405</code></p>
      </div>
      <div>
        <p>Used a request method other than POST.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>408</code></p>
      </div>
      <div>
        <p>The request took too long to reach the endpoint.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>411</code></p>
      </div>
      <div>
        <p>The <code>Content-Length</code> header wasn’t included.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>413</code></p>
      </div>
      <div>
        <p>The payload was too big. Payloads must be under 1MB (10^6 bytes).</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>414</code></p>
      </div>
      <div>
        <p>The request URI was too long.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>415</code></p>
      </div>
      <div>
        <p>The <code>Content-Type</code> or <code>Content-Encoding</code> was invalid.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>429</code></p>
      </div>
      <div>
        <p>The request rate quota has been exceeded.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>431</code></p>
      </div>
      <div>
        <p>The request headers are too long.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>5xx</code></p>
      </div>
      <div>
        <p>There was a server error (please retry).</p>
      </div>
    </div>
  </div>
</div>
