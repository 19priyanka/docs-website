
<h2>Problem</h2>
<p>You sent metric data points to the <a href="/docs/introduction-new-relic-metric-api">Metric API</a>, and are not seeing what you expect when querying the data. Use the following checklist to determine the root cause:</p>
<ul>
  <li>Make sure you are <a href="/docs/introduction-new-relic-metric-api#view-and-query">querying the data correctly</a>.</li>
  <li>Check the <a href="/docs/report-metrics-metric-api#response-validation">HTTP status codes returned by the API</a>. Issues like authorization failures can be diagnosed with HTTP status codes.</li>
  <li>If you are sending data from a Prometheus server via <a href="https://docs.newrelic.com/docs/integrations/prometheus-integrations/get-started/monitor-prometheus-new-relic#remote-write">New Relic's remote_write endpoint</a>, check your Prometheus server logs for errors or non-2xx HTTP responsesÂ from the New Relic endpoint.</li>
  <li>Query your account for <code>NrIntegrationError</code> events. New Relic's ingestion endpoints are asynchronous, meaning the endpoint verifies the payload <em>after</em> it returns the HTTP response. If any issues occur while verifying your payload, then an <code>NrIntegrationError</code> event will be created in your account. New Relic also uses <code>NrIntegrationError</code> events to notify customers when various rate limits have been reached.</li>
</ul>
<h2>Solution</h2>
<h3>View error details [#error-details]</h3>
<p>To view details about the errors, run this NRQL query:</p>
<pre><code>SELECT count(*) FROM NrIntegrationError WHERE newRelicFeature ='Metrics' facet category, message limit 100 since 24 hours ago
</code></pre>
<p>The <code>category</code> indicates the type of error and the <code>message</code> provides more detailed information about the error. If the <code>category</code> is <code>rateLimit</code>, then you should also examine the <code>rateLimitType</code> field for more information on the type of rate limiting.</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>Category</p>
      </div>
      <div>
        <p>rateLimitType</p>
      </div>
      <div>
        <p>Description and solution</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p><code>BadRequest</code></p>
      </div>
      <div>
        <p>(not set)</p>
      </div>
      <div>
        <p>There is an issue with the JSON payload. These include JSON syntax errors, attribute names, or values that are too long.</p>
        <p>Check the <code>message</code> field to determine the exact issue. Then review the JSON payload, and update it to ensure it meets the proper semantic guidelines.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>RateLimit</code></p>
      </div>
      <div>
        <p><code>DatapointsPerMinute</code></p>
      </div>
      <div>
        <p>You are sending too many datapoints per minute. If you get this error, you can either send data less frequently, or request changes to your metric rate limits by contacting your New Relic account representative, or visiting our <a href="https://support.newrelic.com/">Support portal</a>.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>RateLimit</code></p>
      </div>
      <div>
        <p><code>UniqueTimeseriesPerDay</code></p>
      </div>
      <div>
        <p>You have an attribute with a high number of unique values, like <code>containerId</code> or <code>URI</code>. To resolve this error, review any attributes that may be causing the issue and remove them. If desired, you can use a <a href="https://docs.newrelic.com/docs/accounts/accounts/data-management/drop-data-using-nerdgraph">data dropping rule</a> to remove attributes at ingest time.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>RateLimit</code></p>
      </div>
      <div>
        <p><code>UniquePrometheusTimeseries</code></p>
      </div>
      <div>
        <p>You have Prometheus servers reporting too many unique timeseries via <a href="https://docs.newrelic.com/docs/integrations/prometheus-integrations/get-started/monitor-prometheus-new-relic#remote-write">New Relic's remote_write endpoint</a>.</p>
        <p>Reduce the number of unique timeseries reported by modifying your <a href="https://prometheus.io/docs/prometheus/latest/configuration/configuration/">Prometheus server configuration</a> to reduce the number of targets being scraped, or by using <a href="https://prometheus.io/docs/prometheus/latest/configuration/configuration/#relabel_config">relabel rules</a> in the <a href="https://prometheus.io/docs/prometheus/latest/configuration/configuration/#remote_write">remote_write section</a> of your server configuration to drop timeseries or highly unique labels.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>RateLimit</code></p>
      </div>
      <div>
        <p><code>RequestsPerMinute</code></p>
      </div>
      <div>
        <p>Too many requests per minute are being sent. To resolve this, put more datapoints in each request, and send them less frequently.</p>
      </div>
    </div>
  </div>
</div>
<h3>Match errors to ingested payloads [#errors-payloads]</h3>
<p>When a <code>NrIntegrationError</code> event is created as a result of a syntax issue with the HTTP request payload, then the event contains the attributes <code>apiKeyPrefix</code> and <code>requestId</code>.</p>
<ul>
  <li>The <code>apiKeyPrefix</code> matches the first 6 characters of the API key used to send the data.</li>
  <li>The <code>requestId</code> matches the <code>requestId</code> sent in the HTTP response.</li>
</ul>
<p>To view these fields, run this NRQL query:</p>
<pre><code>SELECT message, apiKeyPrefix, requestId FROM NrIntegrationError limit 100
</code></pre>
<p>To verify a specific <code>requestId</code>, run this NRQL query:</p>
<pre><code>SELECT * FROM NrIntegrationError where requestId ='REQUEST_ID'
</code></pre>
<h3>Programmatically retrieve NrIntegrationError events</h3>
<p>To programmatically retrieve these errors:</p>
<ol>
  <li>
    <p>Ensure you have an <a href="/docs/insights/insights-api/get-data/query-insights-event-data-api">Insights query API key</a> (go to <strong><a href="https://insights.newrelic.com">insights.newrelic.com</a> > Manage data > API keys</strong>).</p>
  </li>
  <li>
    <p>Create an HTTP request as shown below:</p>
    <div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJ0aXAifV0=">
      <p>If your account hosts data in the EU data center, ensure you're using the proper <a href="/docs/using-new-relic/welcome-new-relic/getting-started/introduction-eu-region-data-center#endpoints">API endpoints for EU region accounts</a>.</p>
    </div>
    <pre><code>curl -H "Accept: application/json" -H "X-Query-Key:YOUR_API_KEY_HERE" "https://insights-api.newrelic.com/v1/accounts/YOUR_ACCONT_HERE/query?nrql=SELECT%20*%20FROM%20NrIntegrationError%20where%20newRelicFeature='Metrics'"
</code></pre>
  </li>
</ol>
