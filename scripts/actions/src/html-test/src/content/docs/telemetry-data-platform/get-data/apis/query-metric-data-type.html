
<p>When metrics are reported to New Relic via the <a href="/docs/data-ingest-apis/get-data-new-relic/metric-api/introduction-metric-api">Metric API</a> (including from integrations that use that API), the data is reported as the <a href="/docs/using-new-relic/data/understand-data/new-relic-data-types#dimensional-metrics"><code>Metric</code> data type</a> and is available for querying.</p>
<p>This document contains:</p>
<ul>
  <li>How to <a href="#view-and-query">view and query your metrics</a></li>
  <li><a href="#example-metric-queries">Example metric queries</a></li>
  <li>How to <a href="#query-multiple-metrics-wildcards">query multiple metrics with wildcards</a></li>
  <li>How to <a href="#explore-metric-data">explore metric data</a></li>
</ul>
<h2>Query APM metric timeslice data [#metric-timeslice]</h2>
<p>New Relic APM reports a specific type of data that we call metric timeslice data. For how to query that, see <a href="/docs/query-data/nrql-new-relic-query-language/nrql-query-tutorials/query-metric-timeslice-data-nrql">Query metric timeslice data</a>.</p>
<p>For information about other types of metrics, see <a href="/docs/using-new-relic/data/understand-data/new-relic-data-types#metrics-new-relic">Metric data types</a>.</p>
<h2>View and query your metrics [#view-and-query]</h2>
<p>You can use <a href="/docs/query-data/nrql-new-relic-query-language/getting-started/introduction-nrql">NRQL</a> to query your metric data in the <a href="/docs/chart-builder/use-chart-builder/get-started/introduction-chart-builder">New Relic One query builder</a> or using our <a href="/docs/apis/nerdgraph/get-started/introduction-new-relic-nerdgraph">NerdGraph API</a>.</p>
<p>To query a metric, use the following query format:</p>
<pre><code>FROM Metric SELECT function(metric_name) WHERE attribute=value FACET attribute TIMESERIES
</code></pre>
<p>Below are the functions supported for each <a href="https://docs.newrelic.com/docs/report-metrics-metric-api#payload-metrics">metric type</a>:</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>Metric type</p>
      </div>
      <div>
        <p>Supported functions</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p><code>Summary</code></p>
      </div>
      <div>
        <p>count, sum, min, max, and average</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>Count</code></p>
      </div>
      <div>
        <p>sum</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>Gauge</code></p>
      </div>
      <div>
        <p>count, sum, min, max, average, and latest</p>
      </div>
    </div>
  </div>
</div>
<p>Add the names of the metrics you want to chart with the appropriate value functions in the <code>SELECT</code> clause. The <code>WHERE</code> and <code>FACET</code> clauses can be used with attribute values. Remember to include the keyword <code>TIMESERIES</code> if you want to chart the data.</p>
<p>This example demonstrates how you could chart the CPU usage in seconds for cluster <code>foo</code> . This query breaks down CPU usage by container, given a <code>count</code> metric named <code>container_cpu_usage_seconds_total</code> with the attributes <code>containerName</code> and <code>clusterName</code>:</p>
<pre><code>FROM Metric select sum(container_cpu_usage_seconds_total) 
  WHERE clusterName = 'foo' 
  FACET containerName 
  TIMESERIES
</code></pre>
<p>If you want the CPU usage per minute (the rate of change), then you can add the rate function to the query above.</p>
<pre><code>FROM Metric select rate(sum(container_cpu_usage_seconds_total), 1 minute) 
  WHERE clusterName = 'foo' 
  FACET containerName 
  TIMESERIES
</code></pre>
<h2>View example metric queries [#example-metric-queries]</h2>
<p>The previous examples demonstrate basic forms of metric queries, but NRQL can also be used to chart, explore, and analyze metric data.</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZXhhbXBsZS1tdWx0aXBsZS1tZXRyaWNzIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJDaGFydCBtdWx0aXBsZSBtZXRyaWNzIn1d">
    <div data-prop-text="title">Chart multiple metrics</div>
    <p>Chart multiple metrics using a single query by providing a comma-separated list of metrics in the <code>SELECT</code> clause. For example, to chart the memory usage for a container along with the memory limit metric, use the following query:</p>
    <pre><code>FROM Metric 
  SELECT latest(container_memory_usage_bytes), latest(container_spec_memory_limit_bytes) 
  WHERE containerName = 'inventory' 
  TIMESERIES

</code></pre>You can also do this using [wildcards](#query-multiple-metrics-wildcards), as explained below.
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZXhhbXBsZS1tYXRoIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJQZXJmb3JtIG1hdGhlbWF0aWNhbCBvcGVyYXRpb25zIG9uIG1ldHJpYyBkYXRhIn1d">
    <div data-prop-text="title">Perform mathematical operations on metric data</div>
    <p>Perform math operations on one or more metrics to compute a new, derived metric. To monitor available memory, you can calculate the percentage of available memory from the two metrics used in the previous example:</p>
    <pre><code>FROM Metric 
  SELECT (latest(container_spec_memory_limit_bytes) - latest(container_memory_usage_bytes)) 
    / latest(container_spec_memory_limit_bytes) 
    * 100 
    AS '% Memory Available' 
  WHERE containerName = 'inventory' 
  TIMESERIES

</code></pre>You can also do this using [wildcards](#query-multiple-metrics-wildcards), as explained below.
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZXhhbXBsZS1maWx0ZXJzLXRpbWVzZXJpZXMifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IlVzZSBmaWx0ZXJzIHRvIHNlbGVjdCBzcGVjaWZpYyB0aW1lIHNlcmllcyJ9XQ==">
    <div data-prop-text="title">Use filters to select specific time series</div>
    <p>In addition to using a <code>WHERE</code> clause which applies to everything in <code>SELECT</code>, NRQL provides another aggregation function called <code>filter</code> which can be used to select a specific time series to be charted or operated on.</p>
    <p>The following example charts a memory usage metric labeled <code>"Total (k8s)"</code> which is computed by adding together the memory usage of two specific containers within a pod:</p>
    <pre><code>FROM Metric 
  SELECT filter(
    latest(
      container_memory_usage_bytes), 
    WHERE containerName = 'discovery') 
  + filter(
    latest(
      container_memory_usage_bytes), 
    WHERE containerName = 'istio-proxy') 
  AS 'Total (k8s)' 
  WHERE clusterName = 'my-cluster' AND podName LIKE 'istio-pilot-%' 
  TIMESERIES

</code></pre>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZXhhbXBsZS12aWV3LXJhdy1kYXRhcG9pbnRzIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJWaWV3IHRoZSByYXcgbWV0cmljIGRhdGEgcG9pbnRzIn1d">
    <div data-prop-text="title">View the raw metric data points</div>
    <p>When querying metric data using <code>FROM Metric</code>, New Relic automatically selects the specific aggregate to use in the query, depending on the length of the query window and any bucket size specified as an argument to the <code>TIMESERIES</code> keyword. This ensures efficient querying and chart resolution. If you want to override this behavior to view or operate on the raw metric data points, use the optional <code>RAW</code> keyword in your query.</p>
    <p>When querying these raw metric data points, there is a query time window limit of 48 hours. Any query attempting to access more than 48 hours of raw metric data will result in a query error.</p>
    <p>This example shows how to list the last 20 data points received for a particular metric:</p>
    <pre><code>FROM Metric SELECT * WHERE metricName = 'container_fs_usage_bytes' LIMIT 20 RAW

</code></pre>
  </div>
</div>
<h2>Query multiple metrics with wildcards [#query-multiple-metrics-wildcards]</h2>
<p>Wildcards are represented in NRQL by the <code>%</code> character. If you want to query multiple metrics that use a standard naming convention, you can use the wildcard feature to return results for all of them without having to specify each metric name individually.</p>
<p>Wildcards can help you:</p>
<ul>
  <li>Aggregate metrics together and chart the results</li>
  <li><code>FACET</code> results by metric name in a chart</li>
  <li>Find and chart all metrics matching a given naming convention</li>
</ul>
<p>Wildcards are particularly helpful if you later add new metrics matching an existing naming convention. By using <code>%</code> instead of writing out each metric name in your query, you won't have to rewrite the query when you add new metrics.</p>
<p>Let's say you have multiple algorithms that perform a similar task. You can define the following metrics, which show the duration of the different algorithms:</p>
<ul>
  <li><code>myNeatProcess.algorithm1.duration</code></li>
  <li><code>myNeatProcess.algorithm2.duration</code></li>
  <li><code>myNeatProcess.algorithm3.duration</code></li>
</ul>
<p>If used in a query, <code>myNeatProcess.%.duration</code> will return results for all three of the algorithms above. If you later create new algorithms named <code>algorithm4</code>, <code>algorithm5</code>, and <code>algorithm6</code>, the same query will return results for all six algorithms.</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZXhhbXBsZS1tdWx0aXBsZS1tZXRyaWNzLXdpbGRjYXJkIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJDaGFydCBtdWx0aXBsZSBtZXRyaWNzIHdpdGggd2lsZGNhcmRzIn1d">
    <div data-prop-text="title">Chart multiple metrics with wildcards</div>
    <p>You can chart multiple metrics using a single query by using wildcards (<code>%</code>) in the <code>SELECT</code> clause. For example, to query all the algorithms in the example above and plot a line on the chart for each algorithm's average duration, use the following query:</p>
    <pre><code>FROM Metric 
	SELECT average(myNeatProcess.%.duration) 
	FACET metricName TIMESERIES

</code></pre>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZXhhbXBsZS1tYXRoIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJQZXJmb3JtIG1hdGhlbWF0aWNhbCBvcGVyYXRpb25zIG9uIG1ldHJpYyBkYXRhIHdpdGggd2lsZGNhcmRzIn1d">
    <div data-prop-text="title">Perform mathematical operations on metric data with wildcards</div>
    <p>You can also use wildcards to perform math operations on multiple metrics and compute a new metric. You can calculate the mean duration for all algorithms listed in the example above:</p>
    <pre><code>FROM Metric 
	SELECT average(myNeatProcess.%.duration) TIMESERIES

</code></pre>
    <pre><code>
FROM Metric 
	SELECT myNeatProcess.algorithm1.duration / sum(myNeatProcess.%.duration) TIMESERIES

</code></pre>You can calculate what percentage of overall runtime a single algorithm takes:
  </div>
</div>
<h2>Explore metric data</h2>
<p>The NRQL <code>keyset</code> and <code>uniques</code> functions can be used together with the <code>metricName</code> attribute (available on all metrics) to perform tasks like listing all the available metrics in your account or discovering the attributes available on a particular metric.</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZXhhbXBsZS1saXN0LW5hbWVzLWFjY291bnQifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6Ikxpc3QgYWxsIG1ldHJpYyBuYW1lcyBpbiBhbiBhY2NvdW50In1d">
    <div data-prop-text="title">List all metric names in an account</div>
    <pre><code>FROM Metric SELECT uniques(metricName)

</code></pre>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZXhhbXBsZS1saXN0LW5hbWVzLWhvc3QifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6Ikxpc3QgYWxsIG1ldHJpYyBuYW1lcyBmb3IgYSBwYXJ0aWN1bGFyIGhvc3QifV0=">
    <div data-prop-text="title">List all metric names for a particular host</div>
    <pre><code>FROM Metric SELECT uniques(metricName) WHERE hostname = 'host1.mycompany.com'

</code></pre>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZXhhbXBsZS1zaG93LWtleXMtbWV0cmljIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJTaG93IHRoZSBhdHRyaWJ1dGUga2V5cyBmb3IgYSBzcGVjaWZpYyBtZXRyaWMifV0=">
    <div data-prop-text="title">Show the attribute keys for a specific metric</div>
    <pre><code>FROM Metric SELECT keyset() WHERE metricName = METRIC_NAME

</code></pre>
  </div>
</div>
