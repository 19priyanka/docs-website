
<p>You can use New Relic's <a href="https://api.newrelic.com/graphiql">NerdGraph GraphiQL explorer</a> to query your <a href="/docs/understand-dependencies/distributed-tracing/get-started/introduction-distributed-tracing">distributed tracing</a> data. This document explains:</p>
<ul>
  <li>Trace metadata that's only available with NerdGraph</li>
  <li>Example queries of trace data</li>
</ul>
<h2>Trace metadata</h2>
<p>In addition to <a href="/docs/understand-dependencies/distributed-tracing/get-started/how-new-relic-distributed-tracing-works#trace-structure">span event and transaction event data</a>, we calculate additional metadata about the trace and its span relationships. To query this metadata, go to the NerdGraph GraphiQL explorer at <a href="https://api.newrelic.com/graphiql">https://api.newrelic.com/graphiql</a>.</p>
<p>Additional trace-level data:</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>Trace-level metadata</p>
      </div>
      <div>
        <p>Description</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p><code>durationMs</code></p>
      </div>
      <div>
        <p>The duration of this trace in milliseconds.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>entities</code></p>
      </div>
      <div>
        <p>All <a href="/docs/using-new-relic/welcome-new-relic/get-started/glossary#entity">entities</a> that are part of this trace.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>entityCount</code></p>
      </div>
      <div>
        <p>The number of entities that are part of this trace.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>spanConnections</code></p>
      </div>
      <div>
        <p>Parent/child IDs that represent all of the span relationships within this trace.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>timestamp</code></p>
      </div>
      <div>
        <p>Epoch milliseconds timestamp representing the trace's start time.</p>
      </div>
    </div>
  </div>
</div>
<p>Additional span-level data:</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>Span-level metadata</p>
      </div>
      <div>
        <p>Description</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p><code>clientType</code></p>
      </div>
      <div>
        <p>For a client span, this indicates the type of entity called: <code>DATASTORE</code> or <code>EXTERNAL</code>.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>entityGuid</code></p>
      </div>
      <div>
        <p>The New Relic identifier for the entity that sent the span.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>processBoundary</code></p>
      </div>
      <div>
        <p>The position of a span with respect to the boundaries between processes: <code>ENTRY</code>, <code>EXIT</code>, or <code>IN_PROCESS</code>.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>spanAnomalies</code></p>
      </div>
      <div>
        <p>Anomalies detected for a span, compared to similar spans that occurred over the previous hours before this span occurred. Anomalous spans appear in the <a href="/docs/apm/distributed-tracing/ui-data/understand-use-distributed-tracing-data">trace UI</a>.</p>
      </div>
    </div>
  </div>
</div>
<p>For more about trace structure and span relationships, see <a href="/docs/understand-dependencies/distributed-tracing/get-started/how-new-relic-distributed-tracing-works#trace-structure">Trace structure</a>.</p>
<h2>Trace data query examples [#trace-query-examples]</h2>
<p>Here are example NerdGraph queries of distributed tracing data:</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoidHJhY2VpZCJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiUXVlcnkgYnkgdHJhY2UgSUQifV0=">
    <div data-prop-text="title">Query by trace ID</div>
    <p>This NerdGraph query example shows how to return all data for a trace by using a trace's <a href="/attribute-dictionary/span/traceid"><code>traceId</code></a>. Note that <code>attributes</code> is used to return <a href="/docs/understand-dependencies/distributed-tracing/get-started/how-new-relic-distributed-tracing-works#trace-storage"><code>Span</code> event attributes</a>.</p>
    <pre><code>{
  actor {
    distributedTracing {
      trace(traceId: "YOUR_TRACE_ID") {
        spans {
          attributes
          clientType
          durationMs
          entityGuid
          id
          name
          parentId
          processBoundary
          timestamp
          traceId
                spanAnomalies {
                      anomalousValue
                      anomalyType
                      averageMeasure
                }
        }
      }
    }
  }
}

</code></pre>For more about trace structure and span relationships, see [Trace structure](/docs/understand-dependencies/distributed-tracing/get-started/how-new-relic-distributed-tracing-works#trace-structure).
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoidHJhY2UtZGF0YSJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiUXVlcnkgc3BhbiByZWxhdGlvbnNoaXAgZGF0YSJ9XQ==">
    <div data-prop-text="title">Query span relationship data</div>
    <p>This NerdGraph query example shows how to return trace-level metadata about the relationships between spans:</p>
    <pre><code>{
  actor {
    distributedTracing {
      trace(traceId: "YOUR_TRACE_ID") {
        id
	timestamp
        durationMs
        spanConnections {
          parent
          child
        }
      }
    }
  }
}

</code></pre>For more about trace structure and span relationships, see [Trace structure](/docs/understand-dependencies/distributed-tracing/get-started/how-new-relic-distributed-tracing-works#trace-structure).
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZW50aXR5LWRhdGEifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IlF1ZXJ5IGRhdGEgb2YgdGhlIGVudGl0aWVzIGluIGEgdHJhY2UifV0=">
    <div data-prop-text="title">Query data of the entities in a trace</div>
    <p>This NerdGraph query example returns the <a href="/docs/using-new-relic/welcome-new-relic/get-started/glossary#entity">entities</a> associated with a trace and some data about those entities.</p>
    <pre><code>{
  actor {
    distributedTracing {
      trace(traceId: "YOUR_TRACE_ID") {
        entities {
          name
          tags {
            key
          }
          account {
            name
          }
        }
      }
    }
  }
}

</code></pre>
  </div>
</div>
