
<p>The <a href="/docs/data-analysis/metrics/analyze-your-metrics/data-collection-metric-timeslice-event-data#timeslice-data">metric timeslice data</a> presented on the <strong>Web transaction time</strong> chart on your application's <a href="/docs/apm/applications-menu/monitoring/apm-overview-page"><strong>Summary</strong> page</a> will depend on your web app's configuration. Possible components may include:</p>
<ul>
  <li><a href="/docs/data-analysis/user-interface-functions/view-your-data/response-time">Response time</a></li>
  <li>Application total time for your agent language</li>
  <li>Datastore, Database or (Ruby) Database</li>
  <li><a href="/docs/accounts-partnerships/education/getting-started-new-relic/glossary#web-external">Web external</a></li>
  <li>Memcache</li>
  <li>Request queuing time</li>
</ul>
<p>This describes how to use the REST API (v2) to obtain the data shown on the <strong>Web transaction time</strong> chart.</p>
<h2>General API values [#general]</h2>
<p>When making your own calculations, be aware of the following:</p>
<ul>
  <li>You can change the <a href="/docs/apm/apis/requirements/specifying-time-range-api-v2#api-call">default time range (30 minutes)</a> used in these examples.</li>
  <li>The time range you specify must be consistent in <strong>all</strong> of these queries; otherwise the final calculations will be incorrect.</li>
  <li>The <code>HttpDispatcher:call_count</code> is used in almost every calculation, but you only need to acquire it once for your specified time range.</li>
  <li>You must replace the <code>${APPID}</code> and <code>${APIKEY}</code> variables in these examples with your specific <a href="/docs/apm/apis/requirements/identification-code">application ID</a> and <a href="/docs/apis/rest-api-v2/requirements/rest-api-key#viewing">API key</a>.</li>
</ul>
<h2>HttpDispatcher [#HttpDispatcher]</h2>
<p>The overlaid <code>response time</code> line on the <strong>Web transaction time</strong> chart represents the <code>Request queuing</code> time combined with the <code>HttpDispatcher</code> time. The <code>HttpDispatcher:average_response_time</code> is the total response time for your web application without the request queuing time and is obtained directly. It is not used to calculate the application total time.</p>
<p>Use the following command to obtain this metric:</p>
<pre><code>curl -X GET 'https://api.newrelic.com/v2/applications/${APPID}/metrics/data.json' \
     -H 'X-Api-Key:${APIKEY}' -i \
     -d 'names[]=HttpDispatcher&#x26;values[]=average_response_time'
</code></pre>
<h2>Application total time [#app-total-time]</h2>
<p>The <code>Application total time</code> refers to your New Relic agent language (Java/JVM time, PHP, Python, etc.). This includes all the processing time that is <strong>not</strong> attributed to other values on the chart <strong>except</strong> for the <code>Request queuing</code> time and the <code>HttpDispatcher</code> time. This is why you must calculate the other components first.</p>
<p>Use this equation to determine the <code>Application total time</code>:</p>
<pre><code>Application total time = WebTransactionTotalTime - Datastore time - Database time - (Ruby) Database - Web external - Memcache
</code></pre>
<p>Each of the values in this equation are described in detail later in this document.</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p><strong>Application total time calculation</strong></p>
      </div>
      <div>
        <p><strong>Comments</strong></p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p>Terms</p>
      </div>
      <div>
        <p>Not all the terms in the equation may apply. If the corresponding data does not appear for your application, the corresponding terms may be ignored.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Datastore and Database</p>
      </div>
      <div>
        <p>The <code>Datastore time</code>, <code>Database time</code>, and <code>(Ruby) Database</code> values <a href="#datastore-v-database">are not the same</a>. As of February 2015, <code>Datastore</code> is being phased in to replace Database. Also, the <a href="#ruby_database">Ruby agent</a> stores data in a slightly different form.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Memcache</p>
      </div>
      <div>
        <p>The <a href="#memcache"><code>Memcache</code></a> term may not exist for all applications.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Request queuing time</p>
      </div>
      <div>
        <p>The <code>Request queuing</code> time (if it exists) may appear in the chart in the UI, but it is not involved in the calculations. It is presented simply as a convenience.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Response time</p>
      </div>
      <div>
        <p>The <code>Response time</code> may appear in the chart in the UI as an overlaid line. This time is not involved in the calculation for application total time.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Web transaction total time vs. HttpDispatcher</p>
      </div>
      <div>
        <p>If your application does not report a <a href="#web-tx-total-time"><code>WebTransactionTotalTime</code> metric</a>, then use the <code>HttpDispatcher</code> metric. The <code>WebTransactionTotalTime</code> metric is only present in more recent agents which may exhibit asynchronous behavior.</p>
      </div>
    </div>
  </div>
</div>
<h2>Web transaction total time [#web-tx-total-time]</h2>
<p>The <code>WebTransactionTotalTime</code> is the total execution time for your web application and is obtained directly. Use the following command:</p>
<pre><code>curl -X GET 'https://api.newrelic.com/v2/applications/${APPID}/metrics/data.json' \ 
       -H 'X-Api-Key:${APIKEY}' -i \ 
       -d 'names[]=WebTransactionTotalTime&#x26;values[]=average_response_time'
</code></pre>
<h2>Datastore vs. database [#datastore-v-database]</h2>
<p>As of February 2015, the New Relic agents display the database time separated into specific database types. For specific agent version requirements, see <a href="/docs/apm/applications-menu/monitoring/databases-slow-queries-page#availablity">Databases and slow queries feature availability</a>.</p>
<p>These New Relic agents will replace the <code>Database</code> metric name with <code>Datastore/${DBTYPE}</code>, where <code>${DBTYPE}</code> identifies the appropriate database; for example, Postgres, MongoDB, Microsoft SQL Server, ODBC, Redis, SQLite, Memcached, Solr, Elasticsearch, etc.</p>
<h2>Datastore total time [#datastore]</h2>
<p>If your <strong>Web transaction time</strong> chart shows the generic <strong>Database</strong> category, do not use these calculations. Instead, use the <a href="#database">Database</a> calculations.</p>
<p>The <code>Datastore</code> total time is a derived value. To calculate it, use this equation:</p>
<pre><code>Datastore time = ( Datastore/${DBTYPE}/allWeb:average_response_time * Datastore/${DBTYPE}/allWeb:call_count ) / HttpDispatcher:call_count
</code></pre>
<p>The <code>${DBTYPE}</code> represents the type of database reported; for example, Postgres, ODBC, Redis, MongoDB, MySQL, Microsoft SQL Server, SQLite, Cassandra, Memcached, etc. Substitute the database name as appropriate.</p>
<p>To obtain the data for this calculation, use the following commands.</p>
<ul>
  <li>
    <p>HttpDispatcher:call_count</p>
    <pre><code>curl -X GET 'https://api.newrelic.com/v2/applications/${APPID}/metrics/data.json' \
         -H 'X-Api-Key:${API_KEY}' -i \
         -d 'names[]=HttpDispatcher&#x26;values[]=call_count'
</code></pre>
  </li>
  <li>
    <p>Datastore/${DBTYPE}/allWeb:call_count</p>
    <pre><code>curl -X GET 'https://api.newrelic.com/v2/applications/${APPID}/metrics/data.json' \
     -H 'X-Api-Key:${APIKEY}' -i \
     -d 'names[]=Datastore/${DBTYPE}/allWeb&#x26;values[]=call_count'
</code></pre>
  </li>
  <li>
    <p>Datastore/${DBTYPE}/allWeb:average_response_time</p>
    <pre><code>curl -X GET 'https://api.newrelic.com/v2/applications/${APPID}/metrics/data.json' \
     -H 'X-Api-Key:${APIKEY}' -i \
     -d 'names[]=Datastore/${DBTYPE}/allWeb&#x26;values[]=average_response_time'
</code></pre>
  </li>
</ul>
<p>You can also perform this operation in a single command:</p>
<pre><code>curl -X GET 'https://api.newrelic.com/v2/applications/${APPID}/metrics/data.json' \
     -H 'X-Api-Key:${APIKEY}' -i \
     -d 'names[]=Datastore/MongoDB/allWeb&#x26;names[]=HttpDispatcher&#x26;values[]=average_response_time&#x26;values[]=call_count'
</code></pre>
<h2>Database total time [#database]</h2>
<p>If you are using a Ruby agent older than 3.11.0, do not use these calculations. Instead, use the <a href="#ruby_database">(Ruby) Database</a> calculations.</p>
<p>The <code>Database</code> total time is a derived value. To calculate it, use this equation:</p>
<pre><code>Database time = ( Database/allWeb:average_response_time * Database/allWeb:call_count ) / HttpDispatcher:call_count
</code></pre>
<p>To obtain the data for this calculation, use the following commands.</p>
<ul>
  <li>
    <p>HttpDispatcher:call_count</p>
    <pre><code>curl -X GET 'https://api.newrelic.com/v2/applications/${APPID}/metrics/data.json' \
     -H 'X-Api-Key:${APIKEY}' -i \
     -d 'names[]=HttpDispatcher&#x26;values[]=call_count'
</code></pre>
  </li>
  <li>
    <p>Database/allWeb:call_count</p>
    <pre><code>curl -X GET 'https://api.newrelic.com/v2/applications/${APPID}/metrics/data.json' \
     -H 'X-Api-Key:${APIKEY}' -i \
     -d 'names[]=Database/allWeb&#x26;values[]=call_count'
</code></pre>
  </li>
  <li>
    <p>Database/allWeb:average_response_time</p>
    <pre><code>curl -X GET 'https://api.newrelic.com/v2/applications/${APPID}/metrics/data.json' \
     -H 'X-Api-Key:${APIKEY}' -i \
     -d 'names[]=Database/allWeb&#x26;values[]=average_response_time'
</code></pre>
  </li>
</ul>
<h2>(Ruby) Database total time [#ruby_database]</h2>
<p>If you are <strong>not</strong> using a Ruby agent, use the calculations to obtain the <a href="#database">Database</a> value. These values are only provided by the Ruby agent versions 3.10.0.279 or lower. Ruby agent version 3.11.0 or higher uses <a href="#datastore">Datastore</a> values instead.</p>
<p>The <code>(Ruby) Database</code> total time is a derived value. To calculate it, use this equation:</p>
<pre><code>(Ruby) Database = ( ActiveRecord/all:average_response_time * ActiveRecord/all:call_count ) / HttpDispatcher:call_count
</code></pre>
<p>To obtain the data for this calculation, use the following commands.</p>
<ul>
  <li>
    <p>HttpDispatcher:call_count</p>
    <pre><code>curl -X GET 'https://api.newrelic.com/v2/applications/${APPID}/metrics/data.json' \
     -H 'X-Api-Key:${APIKEY}' -i \
     -d 'names[]=HttpDispatcher&#x26;values[]=call_count'
</code></pre>
  </li>
  <li>
    <p>ActiveRecord/all:call_count</p>
    <pre><code>curl -X GET 'https://api.newrelic.com/v2/applications/${APPID}/metrics/data.json' \
     -H 'X-Api-Key:${APIKEY}' -i \
     -d 'names[]=ActiveRecord/all&#x26;values[]=call_count'
</code></pre>
  </li>
  <li>
    <p>ActiveRecord/all:average_response_time</p>
    <pre><code>curl -X GET 'https://api.newrelic.com/v2/applications/${APPID}/metrics/data.json' \
     -H 'X-Api-Key:${APIKEY}' -i \
     -d 'names[]=ActiveRecord/all&#x26;values[]=average_response_time'
</code></pre>
  </li>
</ul>
<h2>Memcache total time [#memcache]</h2>
<p>If available, the <code>Memcache</code> response time is a derived value. (Not all applications will have <code>Memcache</code> response time.) To calculate it, use this equation:</p>
<pre><code>Memcache = ( Memcache/allWeb:average_response_time * Memcache/allWeb:call_count ) / HttpDispatcher:call_count
</code></pre>
<p>To obtain the data for this calculation, use the following commands.</p>
<ul>
  <li>
    <p>HttpDispatcher:call_count</p>
    <pre><code>curl -X GET 'https://api.newrelic.com/v2/applications/${APPID}/metrics/data.json' \
     -H 'X-Api-Key:${APIKEY}' -i \
     -d 'names[]=HttpDispatcher&#x26;values[]=call_count'
</code></pre>
  </li>
  <li>
    <p>Memcache/allWeb:call_count</p>
    <pre><code>curl -X GET 'https://api.newrelic.com/v2/applications/$(APPID)/metrics/data.xml' \
     -H 'X-Api-Key:${APIKEY}' -i \
     -d 'names[]=Memcache/allWeb&#x26;values[]=call_count'
</code></pre>
  </li>
  <li>
    <p>Memcache/allWeb:average_response_time</p>
    <pre><code>curl -X GET https://api.newrelic.com/v2/applications/${APPID}/metrics/data.xml" \
     -H 'X-Api-Key:${APIKEY}' -i \
     -d 'names[]=Memcache/allWeb&#x26;values[]=average_response_time'
</code></pre>
  </li>
</ul>
<h2>Web external total time [#web_external]</h2>
<p>The <code>Web external</code> total time is a derived value. To calculate it, use this equation:</p>
<pre><code>Web external = ( External/allWeb:average_response_time * External/allWeb:call_count ) / HttpDispatcher:call_count
</code></pre>
<p>To obtain the data for this calculation, use the following commands.</p>
<ul>
  <li>
    <p>HttpDispatcher:call_count</p>
    <pre><code>curl -X GET 'https://api.newrelic.com/v2/applications/${APPID}/metrics/data.json' \
     -H 'X-Api-Key:${APIKEY}' -i \
     -d 'names[]=HttpDispatcher&#x26;values[]=call_count'
</code></pre>
  </li>
  <li>
    <p>External/allWeb:call_count</p>
    <pre><code>curl -X GET 'https://api.newrelic.com/v2/applications/${APPID}/metrics/data.json' \
     -H 'X-Api-Key:${APIKEY}' -i \
     -d 'names[]=External/allWeb&#x26;values[]=call_count'
</code></pre>
  </li>
  <li>
    <p>External/allWeb:average_response_time</p>
    <pre><code>curl -X GET 'https://api.newrelic.com/v2/applications/${APPID}/metrics/data.json' \
     -H 'X-Api-Key:${APIKEY}' -i \
     -d 'names[]=External/allWeb&#x26;values[]=average_response_time'
</code></pre>
  </li>
</ul>
