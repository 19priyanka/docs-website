
<p>This doc contains tutorials on how to use <a href="https://docs.newrelic.com/docs/introduction-new-relic-graphql">NerdGraph</a> to programmatically manage some New Relic API keys. For general information about New Relic keys, see <a href="https://docs.newrelic.com/docs/apis/get-started/intro-apis/types-new-relic-api-keys">API keys</a>.</p>
<h2>Overview of feature description [#terms]</h2>
<p>You can use the <a href="https://one.newrelic.com/launcher/api-keys-ui.api-keys-launcher">API keys UI</a> to create and manage keys. Alternatively, you can use <a href="https://docs.newrelic.com/docs/introduction-new-relic-graphql">NerdGraph</a>'s <code>ApiAccess</code> field to programmatically create and manage the following types of keys:</p>
<ul>
  <li><a href="/docs/apis/get-started/intro-apis/types-new-relic-api-keys#personal-api-key">User keys</a></li>
  <li>License keys, including:
    <ul>
      <li>General <a href="https://docs.newrelic.com/docs/accounts/install-new-relic/account-setup/license-key">license key</a> (used for APM, infrastructure monitoring, more)</li>
      <li><a href="https://docs.newrelic.com/docs/browser/new-relic-browser/configuration/copy-browser-monitoring-license-key-app-id">Browser key</a> (for browser monitoring)</li>
    </ul>
  </li>
</ul>
<p>One common use case for this feature is the ability to create and manage license keys to let you rotate keys for security purposes. Note that you can't use this NerdGraph functionality to manage or delete your original license keys; you can only create additional license keys and manage the ones you've created.</p>
<p>Notes about this functionality:</p>
<ul>
  <li>All mutations can accept multiple keys as arguments, and will return details about successful changes and errors. See examples below for details.</li>
  <li>All mutations (create, update and delete) will result in an <code>NrAuditEvent</code> that can be queried for auditing purposes. For details, see <a href="https://docs.newrelic.com/docs/insights/use-insights-ui/manage-account-data/query-account-audit-logs-nrauditevent">Audit events</a>.</li>
  <li>Regarding license keys:
    <ul>
      <li>License keys are categorized by NerdGraph as <strong>ingest keys</strong>. This is because their main use is to allow data ingest.</li>
      <li>You can create up to 1,000 keys of each license key type, which allows for key rotation.</li>
      <li>You can't manage or delete original license keys; you can only create additional license keys and manage keys you've created.</li>
    </ul>
  </li>
</ul>
<h2>Before using examples [#before-examples]</h2>
<p>Things to note before using these example queries:</p>
<ul>
  <li>The examples below use license keys (aka ingest keys), but you can query <a href="/docs/apis/get-started/intro-apis/types-new-relic-api-keys#user-api-key">user keys</a> in similar ways, replacing the ingest-key-specific fields with user-key-specific fields.</li>
  <li>To understand the data structure, we recommend experimenting with queries using the <a href="https://api.newrelic.com/graphiql">GraphiQL explorer</a>.</li>
  <li>You can also <a href="/docs/apis/get-started/intro-apis/types-new-relic-api-keys#personal-api-key">create, view, and delete user keys using the UI.</a></li>
</ul>
<h2>Create keys</h2>
<p>You can create multiple keys in a single mutation, for multiple accounts and key types. Note that the mutation can return successfully created keys as well as any errors encountered trying to create keys.</p>
<p>Example of creating a key:</p>
<pre><code>mutation {
  apiAccessCreateKeys(keys: {ingest: {accountId: YOUR_ACCOUNT_ID, ingestType:
    BROWSER, name: "Browser Key", notes: "A note."}}) {
    createdKeys {
      id
      key
      name
      notes
      type
      ... on ApiAccessIngestKey {
        ingestType
      }
    }
    errors {
      message
      type
      ... on ApiAccessIngestKeyError {
        accountId
        errorType
        ingestType
      }
    }
  }
}
</code></pre>
<p>Results will vary depending on your data. Use the <a href="https://api.newrelic.com/graphiql">GraphiQL explorer</a> to experiment with mutations and queries.</p>
<p>Here's an example of using this query to create a <a href="/docs/apis/get-started/intro-apis/types-new-relic-api-keys#user-api-key">user key</a>:</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiY3JlYXRlLXBlcnNvbmFsLWFwaS1rZXkifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IkNyZWF0ZSBhIHVzZXIga2V5In1d">
    <div data-prop-text="title">Create a user key</div>
    <p>To create a <a href="/docs/apis/get-started/intro-apis/types-new-relic-api-keys#user-api-key">user key</a>, you'd change the above query slightly, in the <code>keys</code> section:</p>
    <pre><code>mutation {
  apiAccessCreateKeys(keys: {user: {accountId: YOUR_ACCOUNT_ID, userId: YOUR_USER_ID}}) {
    createdKeys {
      id
      key
      name
      notes
      type
      ... on ApiAccessIngestKey {
        ingestType
      }
    }
    errors {
      message
      type
      ... on ApiAccessIngestKeyError {
        accountId
        errorType
        ingestType
      }
    }
  }
}

</code></pre>
  </div>
</div>
<h2>Update keys</h2>
<p>The update mutation takes the key ID, not the key string, to identify keys.</p>
<pre><code>mutation {
  apiAccessUpdateKeys(keys: {ingest: {keyId: KEY_ID, name: "Updated name", notes:
    "A new note!"}}) {
    updatedKeys {
      id
      key
      type
      name
      notes
    }
    errors {
      message
    }
  }
}
</code></pre>
<p>Results will vary depending on your data. Use the <a href="https://api.newrelic.com/graphiql">GraphiQL explorer</a> to experiment with mutations and queries.</p>
<h2>Delete keys</h2>
<p>The delete mutation takes the key ID, not the key string, to identify keys. Deleted keys will no longer grant access to New Relic systems and will no longer be returned by queries to the API access GraphQL API.</p>
<pre><code>mutation {
  apiAccessDeleteKeys(keys: {ingestKeyIds: INGEST_KEY_ID}) {
    deletedKeys {
      id
    }
    errors {
      message
    }
  }
}
</code></pre>
<p>Results will vary depending on your data. Use the <a href="https://api.newrelic.com/graphiql">GraphiQL explorer</a> to experiment with mutations and queries.</p>
<h2>Query keys</h2>
<p>You can access ingest and user keys by querying a single key or all keys, scoped to the actor. If querying for a single key, you must provide the key ID and type (INGEST or USER). Querying for multiple keys is done via a key search, which uses a mandatory types list and an optional scope to filter results. User keys belonging to other users will be obfuscated in the results.</p>
<p>Single key example query:</p>
<pre><code>query {
  actor {
    apiAccess {
      key(id: INGEST_KEY_ID, keyType: INGEST) {
        key
        name
        type
        ... on ApiAccessIngestKey {
          ingestType
        }
      }
    }
  }
}
</code></pre>
<p>Key search example query:</p>
<pre><code>query {
  actor {
    apiAccess {
      keySearch(query: {types: INGEST, scope: {ingestTypes: BROWSER}}) {
        keys {
          name
          key
          type
          ... on ApiAccessIngestKey {
            ingestType
          }
        }
      }
    }
  }
}
</code></pre>
<p>Results will vary depending on your data. Use the <a href="https://api.newrelic.com/graphiql">GraphiQL explorer</a> to experiment with mutations and queries.</p>
