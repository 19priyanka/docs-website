
<h2>Improvements</h2>
<p><strong>Change to default setting for ActiveRecord connection resolution</strong></p>
<p>Due to incompatibilities between the faster ActiveRecord connection resolution released in Ruby agent v6.3.0 and other gems that patch ActiveRecord, <code>backport_fast_active_record_connection_lookup</code> will now be set to <code>false</code> by default. This will result in significant performance improvement.</p>
<p><strong>Recommendation:</strong> If your environment includes ActiveRecord, change this setting to <code>true</code>.</p>
<p><strong>Exception:</strong> If you are using other gems that measure ActiveRecord performance, they may lose functionality when combined with this setting. If you are unsure whether to enable <code>backport_fast_active_record_connection_lookup</code>, we recommend enabling it in a development environment to make sure other gems that patch ActiveRecord are still working as expected.</p>
<h2>Fixes</h2>
<ul>
  <li>
    <p><strong>Bugfix for ActiveStorage instrumentation error</strong></p>
    <p>Version 6.4.0 of the agent introduced a bug that interfered with ActiveStorage callbacks, resulting in the agent being unable to instrument ActiveStorage operations. ActiveStorage segments are now correctly recorded.</p>
  </li>
  <li>
    <p><strong>Bugfix for ActiveRecord 4.1 and 4.2 exception logging</strong></p>
    <p>Version 6.3.0 of the agent introduced a bug that prevented ActiveRecord versions 4.1 and 4.2 from logging exceptions that occurred within a database transaction. This version of the agent restores the exception logging functionality from previous agent versions. Thanks to Oleksiy Kovyrin for the contribution!</p>
  </li>
</ul>
<h2>Notes</h2>
<p>The Ruby agent now enforces a maximum of 10,000 <a href="https://docs.newrelic.com/docs/agents/ruby-agent/configuration/ruby-agent-configuration#analytics_events-max_samples_stored">transaction events</a> and <a href="https://docs.newrelic.com/docs/agents/ruby-agent/configuration/ruby-agent-configuration#custom_insights_events-max_samples_stored">custom events</a> and 100 <a href="https://docs.newrelic.com/docs/agents/ruby-agent/configuration/ruby-agent-configuration#error_collector-max_event_samples_stored">error events</a> per minute.</p>
