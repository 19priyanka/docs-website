
<h3>New features</h3>
<ul>
  <li>
    <p>Added <code>span_events</code> and <code>transaction_segments</code> attribute destinations.</p>
    <p>Span event and segment attributes can now be filtered using the same include/exclude config rules as other types. See <a href="https://docs.newrelic.com/docs/agents/nodejs-agent/installation-configuration/nodejs-agent-configuration#node-js-attributes">agent attribute configuration</a> for more details.</p>
  </li>
  <li>
    <p>Added <code>metadata</code> field to connect payload, for collecting <code>NEW_RELIC_METADATA_</code>-prefixed environment variables.</p>
  </li>
  <li>
    <p>Added DynamoDB to datastores.</p>
  </li>
  <li>
    <p>Added <code>opaque</code> option to datastore operation spec.</p>
  </li>
  <li>
    <p>Added Kubernetes utilization detection.</p>
  </li>
  <li>
    <p>Upgraded <code>concat-stream</code> and <code>readable-stream</code> to next major version.</p>
    <p>These modules had previously been held back due to support for Node &#x3C;6. Since v5.0.0 we dropped that support thus enabling these updates.</p>
  </li>
  <li>
    <p>Added SQS as a supported messaging library name.</p>
  </li>
  <li>
    <p>Enabled tracking of callback via <code>message-shim.recordConsume</code> when no messageHandler provided.</p>
  </li>
</ul>
<h3>Improvements</h3>
<ul>
  <li>Replaced <code>make</code> rules with npm scripts.</li>
</ul>
<h3>Bug fixes</h3>
<ul>
  <li>
    <p>The agent will now consistently harvest in all response cases when in serverless mode.</p>
    <p>Previously, the agent's harvest was in a race with process suspension in the event of an uncaught exception, or responding without calling a callback. A synchronous harvesting process is now used to circumvent this racing issue.</p>
  </li>
  <li>
    <p>Fixed issue with socket connection errors causing the agent to stop attempting to connect at startup.</p>
  </li>
  <li>
    <p>Fixed opaque segment functionality for <code>message-shim.recordProduce</code>.</p>
  </li>
  <li>
    <p>Fixed opaque segment functionality for <code>message-shim.recordConsume</code>.</p>
  </li>
</ul>
