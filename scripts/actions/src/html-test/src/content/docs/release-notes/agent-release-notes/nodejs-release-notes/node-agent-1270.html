
<h3>Notes</h3>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
  <p>This release has been unpublished from npmjs.org. Use version <a href="/docs/release-notes/agent-release-notes/nodejs-release-notes/node-agent-1271">1.27.1</a> or higher.</p>
</div>
<h3>New Features</h3>
<ul>
  <li>
    <p>Reworked promise instrumentation to be more reliable and reusable.</p>
    <p>Promise instrumentation has been rewritten to be applicable to any A+ compliant promise library. This change brings more consistent instrumentation of Bluebird promises.</p>
    <p>This change also allows users to see the execution order of chained promises in their Transaction Traces. This is an opt-in process and can be achieved by setting <code>feature_flag.promise_segments</code> to true in the agent config.</p>
  </li>
</ul>
<h3>Bug fixes</h3>
<ul>
  <li>
    <p>The agent now properly checks for custom SSL certificates.</p>
    <p>The check previously was falsely positive if there was an empty list of custom certificates. This caused red herrings to be admitted into the debug logs. Thanks to Seth Shober (@sethshober) for the fix!</p>
  </li>
  <li>
    <p>Promise error handling is now more consistent.</p>
    <p>Previously the agent would notice errors being emitted on <code>unhandledRejection</code> regardless of other listeners. Errors coming in on the <code>unhandledRejection</code> event will not be recorded if there are handlers for the event - this is more in line with our error handling practices in other instrumentations.</p>
  </li>
</ul>
<h3>Improvements</h3>
<ul>
  <li>
    <p>Added a <code>.npmignore</code> file to exclude non-essential files.</p>
    <p>The agent will now omit tests and examples on install from npm, drastically improving download times. Thanks to Serge Havas (@Sinewyk) for the contribution!</p>
  </li>
  <li>
    <p>Logging has been reworked to reduce CPU overhead.</p>
    <p>The check to see if a logging call was valid happened fairly late in the logic, causing unnecessary work to be done regardless of logger state. This has been rectified, netting a large decrease in CPU overhead.</p>
  </li>
</ul>
