
<h2>Improvements</h2>
<ul>
  <li>
    <p>Added diagnostic code injector.</p>
    <p>The agent may now be configured to make transaction state checks via code injection. This may be turned on by setting <code>code_injector.diagnostics.enabled</code> to <code>true</code>. While this option is enabled, code around async boundaries will be added to track transactions, and log a message when they are not properly reinstated.</p>
  </li>
  <li>
    <p>Added back generation of entity stats logging and uninstrumented support metric generation on metric harvests.</p>
  </li>
  <li>
    <p>Removed legacy harvest code from main agent.</p>
  </li>
  <li>
    <p>Upgraded <code>tap</code> to latest version</p>
  </li>
  <li>
    <p>Upgraded <code>mocha</code> to latest version.</p>
  </li>
  <li>
    <p>Adds <code>--exit</code> flag to mocha test runs to prevent infinite runs on CI.</p>
  </li>
</ul>
<h2>Fixes</h2>
<ul>
  <li>
    <p><code>primary_application_id</code> now defaults to 'Unknown' in serverless mode to allow Distributed Tracing to function correctly when <code>NEW_RELIC_PRIMARY_APPLICATION_ID</code> is not defined.</p>
  </li>
  <li>
    <p>Updated <code>https-proxy-agent</code> to v3 for security fix.</p>
    <p>Shoutout to @asturur for the contribution.</p>
  </li>
  <li>
    <p>Fixed bug where <code>API.shutdown()</code> would not properly harvest when configured to.</p>
  </li>
  <li>
    <p>Fixed bug where multiple agent restarts would cause the number of 'stopped' listeners to exceed limit.</p>
  </li>
  <li>
    <p>Fixed inconsistent async return from collector API.</p>
    <p>This could result in an infinite loop due to attempting to merge before clearing. <em>This bug should not have impacted normal agent runs but was uncovered for certain test cases.</em></p>
  </li>
  <li>
    <p>Fixed tests that leave work scheduled on the event loop.</p>
  </li>
  <li>
    <p>Fixed issue that could result in vendor utilization detection failure. As a part of this fix, the request that hits the timeout will immediately abort instead of hanging around for the default timeout.</p>
  </li>
</ul>
