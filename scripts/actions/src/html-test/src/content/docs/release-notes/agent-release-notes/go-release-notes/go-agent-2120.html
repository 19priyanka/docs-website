
<h3>New Features</h3>
<ul>
  <li>
    <p>Added new methods to expose <code>Transaction</code> details:</p>
    <ul>
      <li><code>Transaction.GetTraceMetadata()</code> returns a <a href="https://godoc.org/github.com/newrelic/go-agent#TraceMetadata">TraceMetadata</a> which contains distributed tracing identifiers.</li>
      <li><code>Transaction.GetLinkingMetadata()</code> returns a <a href="https://godoc.org/github.com/newrelic/go-agent#LinkingMetadata">LinkingMetadata</a> which contains the fields needed to link data to a trace or entity.</li>
    </ul>
  </li>
  <li>
    <p>Added a new plugin for the <a href="https://github.com/sirupsen/logrus">Logrus logging framework</a> with the new <a href="https://github.com/newrelic/go-agent/go-agent/tree/master/_integrations/logcontext/nrlogrusplugin">_integrations/logcontext/nrlogrusplugin</a> package. This plugin leverages the new <code>GetTraceMetadata</code> and <code>GetLinkingMetadata</code> above to decorate logs.</p>
    <p>To enable, set your log's formatter to the <code>nrlogrusplugin.ContextFormatter{}</code></p>
    <pre><code>logger := logrus.New()
logger.SetFormatter(nrlogrusplugin.ContextFormatter{})
</code></pre>
    <p>The logger will now look for a <code>newrelic.Transaction</code> inside its context and decorate logs accordingly. Therefore, the Transaction must be added to the context and passed to the logger. For example, this logging call</p>
    <pre><code>logger.Info("Hello New Relic!")
</code></pre>
    <p>must be transformed to include the context, such as:</p>
    <pre><code>ctx := newrelic.NewContext(context.Background(), txn)
logger.WithContext(ctx).Info("Hello New Relic!")
</code></pre>
    <p>For full documentation see the <a href="https://godoc.org/github.com/newrelic/go-agent/_integrations/logcontext/nrlogrusplugin">godocs</a> or view the <a href="https://github.com/newrelic/go-agent/blob/master/_integrations/logcontext/nrlogrusplugin/example/main.go">example</a>.</p>
  </li>
  <li>
    <p>Added support for <a href="https://github.com/nats-io/nats.go">NATS</a> and <a href="https://github.com/nats-io/stan.go">NATS Streaming</a> monitoring with the new <a href="https://godoc.org/github.com/newrelic/go-agent/_integrations/nrnats">_integrations/nrnats</a> and <a href="https://godoc.org/github.com/newrelic/go-agent/_integrations/nrstan">_integrations/nrstan</a> packages. These packages support instrumentation of publishers and subscribers.</p>
    <ul>
      <li><a href="https://github.com/newrelic/go-agent/blob/master/_integrations/nrnats/examples/main.go">NATS Example</a></li>
      <li><a href="https://github.com/newrelic/go-agent/blob/master/_integrations/nrstan/examples/main.go">NATS Streaming Example</a></li>
    </ul>
  </li>
  <li>
    <p>Enables ability to migrate to <a href="https://docs.newrelic.com/docs/agents/manage-apm-agents/configuration/enable-configurable-security-policies">Configurable Security Policies (CSP)</a> on a per agent basis for accounts already using <a href="https://docs.newrelic.com/docs/agents/manage-apm-agents/configuration/high-security-mode">High Security Mode (HSM)</a>.</p>
    <ul>
      <li>Previously, if CSP was configured for an account, New Relic would not allow an agent to connect without the <code>security_policies_token</code>. This led to agents not being able to connect during the period between when CSP was enabled for an account and when each agent is configured with the correct token.</li>
      <li>With this change, when both HSM and CSP are enabled for an account, an agent (this version or later) can successfully connect with either <code>high_security: true</code> or the appropriate <code>security_policies_token</code> configured - allowing the agent to continue to connect after CSP is configured on the account but before the appropriate <code>security_policies_token</code> is configured for each agent.</li>
    </ul>
  </li>
</ul>
