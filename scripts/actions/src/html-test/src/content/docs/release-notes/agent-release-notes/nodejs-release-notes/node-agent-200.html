
<h3>Notes</h3>
<ul>
  <li>
    <p><a href="https://blog.newrelic.com/2017/07/18/nodejs-agent-v2-api/">The New Relic Node Agent v2 is here!</a></p>
    <p>This release contains major changes to the agent instrumentation API, making it easier to create and distribute your own instrumentation for third party modules. Check out <a href="https://docs.newrelic.com/docs/agents/nodejs-agent/installation-configuration/upgrade-nodejs-agent">Upgrade the Node agent</a> or the <a href="https://github.com/newrelic/node-newrelic/blob/master/Migration%20Guide.md">Migration Guide</a> for more information on upgrading your application to this version.</p>
  </li>
  <li>
    <p>BREAKING: Reversed naming and ignore rules.</p>
    <p>Naming rules are now applied in the order they are defined.</p>
  </li>
  <li>
    <p>BREAKING: De-duplicated HTTP request transactions.</p>
    <p>Only one transaction is created per <code>request</code> event emitted by an HTTP server. Previously this was one transaction per listener per event emitted.</p>
  </li>
  <li>
    <p>BREAKING: Stopped swallowing outbound request errors.</p>
    <p>Errors emitted by outbound HTTP requests will no longer be swallowed by the agent.</p>
  </li>
  <li>
    <p>BREAKING: Node v0.8 is no longer supported. Minimum version is now v0.10.</p>
    <p>The v1 agent will continue to support Node 0.8 but will no longer receive updates.</p>
  </li>
  <li>
    <p>BREAKING: npm v1 is no longer supported. Minimum version is now v2.0.0.</p>
  </li>
</ul>
<h3>New features</h3>
<ul>
  <li>
    <p>Added API for writing messaging framework instrumentation.</p>
    <p>Introduced new <code>MessageShim</code> class for writing instrumentation. This shim can be accessed using the <code>newrelic.instrumentMessages()</code> API method.</p>
  </li>
  <li>
    <p>Added <code>amqplib</code> instrumentation.</p>
    <p>Applications driven by <code>amqplib</code> consumers will now have transactions automatically created for consumed messages. See <a href="https://docs.newrelic.com/docs/agents/nodejs-agent/troubleshooting/troubleshoot-message-consumers">Troubleshoot message consumers</a> for more information on this instrumentation and its limitations.</p>
  </li>
  <li>
    <p>Advanced instrumentation API is now generally available.</p>
    <p>New methods for instrumenting common modules were introduced during the Agent v2 beta. These APIs are now available to everyone:</p>
    <ul>
      <li><code>newrelic.instrument()</code>/<code>Shim</code>: This method can be used to instrument generic modules, such as connection pooling libraries, task schedulers, or anything else not covered by a specialized class.</li>
      <li><code>newrelic.instrumentDatastore()</code>/<code>DatastoreShim</code>: This method is good for instrumenting datastore modules such as <code>mongodb</code>, <code>mysql</code>, or <code>pg</code>.</li>
      <li><code>newrelic.instrumentWebframework()</code>/<code>WebFrameworkShim</code>: This method is used for instrumenting web frameworks like <code>restify</code> or <code>express</code>.</li>
    </ul>
    <p>Documentation and tutorials for the new API can be found on our GitHub documentation page: <a href="http://newrelic.github.io/node-newrelic/docs/">http://newrelic.github.io/node-newrelic/docs/</a></p>
  </li>
</ul>
<h3>Improvements</h3>
<ul>
  <li>
    <p>Rewrote built-in instrumentation using the new <code>Shim</code> classes.</p>
    <p>The following instrumentations have been rewritten:</p>
    <ul>
      <li>Datastores
        <ul>
          <li><code>cassandra-driver</code></li>
          <li><code>ioredis</code></li>
          <li><code>memcached</code></li>
          <li><code>mongodb</code></li>
          <li><code>mysql</code></li>
          <li><code>node-cassandra-cql</code></li>
          <li><code>pg</code></li>
          <li><code>redis</code></li>
        </ul>
      </li>
      <li>Web frameworks
        <ul>
          <li><code>director</code></li>
          <li><code>express</code></li>
          <li><code>hapi</code></li>
          <li><code>restify</code></li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <p>The <code>@newrelic/native-metrics</code> module is now included as an optional dependency.</p>
    <p>This module will be installed automatically with Agent v2. If it fails to install the agent will still function.</p>
  </li>
</ul>
