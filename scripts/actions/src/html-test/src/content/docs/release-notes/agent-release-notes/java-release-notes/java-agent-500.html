
<h3>Improvements</h3>
<p><strong>gRPC</strong></p>
<p>The Java agent now supports gRPC. You will now see <a href="/docs/apm/applications-menu/monitoring/transactions-page-find-specific-performance-problems">transactions</a>, <a href="/docs/apm/applications-menu/error-analytics/error-analytics-explore-events-behind-errors">errors</a>, <a href="/docs/apm/applications-menu/monitoring/external-services-page">external calls</a>, and <a href="/docs/apm/distributed-tracing/getting-started/introduction-distributed-tracing">distributed traces</a> for all of your gRPC-based clients and services.</p>
<p><strong>Vert.x-3.7</strong></p>
<p>The Java agent now supports Vert.x 3.7. The agent instruments Vert.x Web, Vert.x Core, and Vert.x HTTP client. With this instrumentation, the agent will identify and name your <a href="/docs/apm/applications-menu/monitoring/transactions-page-find-specific-performance-problems">transactions</a> based on Vert.x web routing paths. The agent will also time web handlers, track async handlers, and <a href="/docs/apm/applications-menu/monitoring/external-services-page">external calls</a> made with Vert.x HTTP client.</p>
<p><strong>OkHttp 3.14.0</strong></p>
<p>This release adds support for OkHttp 3.14.x. You will now see OkHttp 3.14 calls as <a href="/docs/apm/applications-menu/monitoring/external-services-page">external calls</a> in New Relic.</p>
<p><strong>spray-can</strong></p>
<p>The Java agent now supports the spray-can client. The agent will now capture outbound http calls made with the spray-can client and report them as <a href="/docs/apm/applications-menu/monitoring/external-services-page">external calls</a> and/or <a href="/docs/apm/distributed-tracing/getting-started/introduction-distributed-tracing">distributed traces</a>.</p>
<p><strong>Embedded Derby 10.15.1.3</strong></p>
<p>The Java agent has expanded support for Derby JDBC up to and including version 10.15.1.3.</p>
<p><strong>JVM monitoring</strong></p>
<p>The Java agent now reports JMX stats for off-heap direct byte buffers. These metrics are available via the <a href="/docs/agents/java-agent/features/jvm-metrics-page">JVM page</a></p>
<p><strong>recordCustomEvent API</strong></p>
<p>The recordCustomEvent API has been updated to accept Map&#x3C;String,?> as a second parameter instead of Map&#x3C;String,Object>, allowing maps such as Map&#x3C;String,String> to be passed without having to cast the type of the map's value.</p>
<h3>Fixes</h3>
<ul>
  <li>The agent no longer requires a newrelic.yml even when the <code>app_name</code> and <code>license_key</code> configuration options are set via environment variables and/or system properties. For more information, see the <a href="/docs/agents/java-agent/configuration/java-agent-configuration-config-file#Environment_Variables">Java environment variables documentation</a>.</li>
  <li>HttpSessions JMX metrics were not reporting for Websphere Liberty Profile applications.</li>
  <li>The <code>transaction_events.max_samples_stored</code> configuration value in the <code>newrelic.yml</code> would incorrectly override the system properties or environment variable values.</li>
  <li>Applications running on WildFly 12 - 15 would fail start with <code>NoClassDefFound</code> errors for Java agent classes.</li>
  <li>Play applications where external calls inside of future callbacks using <code>async-http-client</code> would not be recorded.</li>
  <li>Setting <code>log_limit_in_kbytes</code> would result in the agent not logging to the agent log file if <code>log_file_count</code> was also set to less than 2.</li>
  <li>Webflux status codes which were not recognized by Spring Webflux caused a 500 status code to be returned and an exception in application logs.</li>
</ul>
<h3>Known Issues</h3>
<p><strong>gRPC: Fixed in 5.1.1</strong></p>
<p>This release contains two bugs in the Java agent's gRPC instrumentation. We highly recommend customers using gRPC instrumentation to upgrade to this and/or later agent versions.</p>
<ul>
  <li>References to transaction segments were not being removed correctly, which can cause a memory leak.</li>
  <li>The agent could cause the gRPC server listeners to fail to execute its <code>completed</code> and/or <code>cancelled</code> methods, which can cause unexpected behavior.</li>
</ul>
<h3>Deprecation Notes</h3>
<p><strong>Self installer</strong></p>
<p>The New Relic Java agent's self-installer has been removed in order to provide a more consistent user experience. To install the Java agent, add the full path to the <code>newrelic.jar</code> to the <code>-javaagent</code> flag in your JVM options. For more information on installing the agent on specific <a href="/docs/agents/java-agent/installation/include-java-agent-jvm-argument">application servers</a>, <a href="/docs/agents/java-agent/additional-installation/install-new-relic-java-agent-docker">Docker</a>, <a href="/docs/agents/java-agent/additional-installation/maven-installation-java">Maven</a>, or <a href="/docs/agents/java-agent/additional-installation/install-java-agent-using-gradle">Gradle</a>, see the <a href="/docs/agents/java-agent/installation/include-java-agent-jvm-argument">JVM argument documentation</a>.</p>
<p><strong>Deprecated instrumentation</strong></p>
<p>The following instrumentation modules have been moved out of the default Java agent, and are now provided as a <a href="/docs/agents/java-agent/instrumentation/additional-instrumentation-modules-java-agent">separate download</a>. To continue using these modules, just add them to the agent's <a href="/docs/agents/java-agent/configuration/java-agent-configuration-config-file#extensions-directory">extensions directory</a> in your <code>newrelic</code> folder or wherever your <a href="/docs/agents/java-agent/configuration/java-agent-configuration-config-file#cfg-extensions-dir">extensions directory is configured</a>.</p>
<ul>
  <li><a href="/docs/agents/java-agent/instrumentation/additional-instrumentation-modules-java-agent#akka-20">Akka 2.0</a></li>
  <li><a href="/docs/agents/java-agent/instrumentation/additional-instrumentation-modules-java-agent#akka-21">Akka 2.1</a></li>
  <li><a href="docs/agents/java-agent/instrumentation/additional-instrumentation-modules-java-agent#akka-http-10">Akka-http 1.0</a></li>
  <li><a href="/docs/agents/java-agent/instrumentation/additional-instrumentation-modules-java-agent#akka-http-20">Akka-http 2.0 - 2.4.1</a></li>
  <li><a href="/docs/agents/java-agent/instrumentation/additional-instrumentation-modules-java-agent#akka-http-242">Akka-http 2.4.2 - 2.4.4</a></li>
  <li><a href="/docs/agents/java-agent/instrumentation/additional-instrumentation-modules-java-agent#hystrix-102">Hystrix 1.2</a></li>
  <li><a href="https://docs.newrelic.com/docs/agents/java-agent/instrumentation/additional-instrumentation-modules-java-agent#hystrix-130">Hystrix 1.3</a></li>
  <li>Play 1 (instrumentation for Play-1.x is not available as an extension.)</li>
  <li><a href="/docs/agents/java-agent/instrumentation/additional-instrumentation-modules-java-agent#play-20">Play 2.0</a></li>
  <li><a href="/docs/agents/java-agent/instrumentation/additional-instrumentation-modules-java-agent#play-21">Play 2.1</a></li>
  <li><a href="/docs/agents/java-agent/instrumentation/additional-instrumentation-modules-java-agent#play22">Play 2.2</a></li>
  <li><a href="/docs/agents/java-agent/instrumentation/additional-instrumentation-modules-java-agent#solr-310">Solr 3.1 - 3.4</a></li>
  <li><a href="/docs/agents/java-agent/instrumentation/additional-instrumentation-modules-java-agent#solr-350">Solr 3.5</a></li>
  <li><a href="/docs/agents/java-agent/instrumentation/additional-instrumentation-modules-java-agent#solr-360">Solr 3.6</a></li>
</ul>
