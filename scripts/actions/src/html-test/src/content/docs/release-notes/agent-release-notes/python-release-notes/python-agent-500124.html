
<h2>Notes</h2>
<p>This release of the Python agent introduces:</p>
<ul>
  <li>Event loop diagnostics feature</li>
  <li>Tornado instrumentation for versions 6 or higher</li>
  <li>Improved context manager API functionality and interfaces</li>
</ul>
<p>This release also drops support for Python 3.4.</p>
<p>The agent can be installed using easy_install/pip/distribute via the <a href="https://pypi.python.org/pypi/newrelic">Python Package Index</a> or can be downloaded directly from the New Relic <a href="http://download.newrelic.com/python_agent/release">download site</a>.</p>
<h2>Event loop diagnostics</h2>
<p>Introducing event loop diagnostics for asyncio! The Python agent can now surface information about transactions that block the event loop. The agent will be able to generate information about transactions that have waited a significant amount of time to acquire control of the event loop.</p>
<p>Event loop diagnostic information will be available in both APM and via NRQL query.</p>
<p>Event loop metrics will appear in the transaction <strong>Breakdown table</strong>:</p>
<p>
  <img src="./images/python-event-loop-breakdown-table.png" alt="Image of breakdown UI page">
</p>
<p>Time spent waiting on other transactions will be shown in the transaction <em>Trace details</em> page, as shown here:</p>
<p>
  <img src="./images/python-event-loop-trace-details.png" alt="Image of breakdown UI page">
</p>
<p><code>eventLoopTime</code> and <code>eventLoopWait</code> attributes will be available via NRQL query. An example query might be:<br><code>SELECT count(*) as 'count', average(eventLoopTime) as 'loopTime', average(eventLoopWait) as 'loopWait' FROM Transaction facet name</code></p>
<p>In New Relic Insights, this might show a result like this:</p>
<p>
  <img src="./images/python-event-loop-insights-table.png" alt="Image of breakdown UI page">
</p>
<p>Diagnostics will be available by default through our existing aiohttp, sanic, and Tornado instrumentation. Diagnostic information will also be available for coroutines that use our background_task and web_transaction decorator APIs.</p>
<h2>Tornado 6 Instrumentation</h2>
<p>Instrumentation for Tornado framework version 6.x is supported without any feature flags. Support for versions earlier than Tornado 6.x has been dropped. The Tornado web server, framework, and http client are instrumented and information will show up in both APM and insights.</p>
<p><strong>Important:</strong> Using the <code>tornado.gen.coroutine</code> with instrumentation is not supported. Any usage of <code>tornado.gen.coroutine</code> should be replaced with an asyncio coroutine.</p>
<h3>Before</h3>
<pre><code>class MainHandler(tornado.web.RequestHandler):
    @tornado.gen.coroutine
    def get(self):

        yield gen.sleep(0.2)
</code></pre>
<h3>After</h3>
<pre><code>class MainHandler(tornado.web.RequestHandler):
    @asyncio.coroutine
    def get(self):

        yield from gen.sleep(0.2)
</code></pre>
<h2>Improved APIs for time trace context managers</h2>
<p>Context managers (such as FunctionTrace, ExternalTrace, DatastoreTrace) may now be used from within asyncio coroutines! Additionally, the transaction argument is no longer used for any context manager API. In order to transition to the new API, <strong>the transaction argument must be removed</strong>.</p>
<h3>Before</h3>
<pre><code>transaction = newrelic.agent.current_transaction()
with newrelic.agent.FunctionTrace(transaction, "my_trace"):
  pass
</code></pre>
<h3>After</h3>
<pre><code>with newrelic.agent.FunctionTrace("my_trace"):
  pass
</code></pre>
<h3>Updated WebTransaction context manager</h3>
<p>The WebTransaction context manager is no longer WSGI dependent. The context manager takes generic HTTP arguments, which you can use to build web transactions that appear in the APM product. For more information, see our <a href="https://docs.newrelic.com/docs/agents/python-agent/api-guides/guide-using-python-agent-api">API documentation</a>.</p>
