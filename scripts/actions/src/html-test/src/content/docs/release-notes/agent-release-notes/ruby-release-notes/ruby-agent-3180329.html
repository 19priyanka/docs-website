
<h2>v3.18.0</h2>
<ul>
  <li>
    <p>Ruby 2.4.0 support</p>
    <p>The agent is now tested against the official release of ruby 2.4.0, excluding incompatible packages.</p>
  </li>
  <li>
    <p>Agent-based metrics will not be recorded outside of active transactions</p>
    <p>The agent has historically recorded metrics outside of a transaction. In practice, this usually occurs in applications that run background job processors. The agent would record metrics for queries the background job processor is making between transactions. This can lead to display issues on the background overview page and the presence of metrics generated by the background job processor can mask the application generated metrics on the database page. The agent will no longer generate metrics outside of a transaction. Custom metrics recorded using <code>NewRelic::Agent.record_metric</code> will continue to be recorded regardless of whether there is an active transaction.</p>
  </li>
  <li>
    <p>Include ControllerInstrumentation module with ActiveSupport.on_load</p>
    <p>The agent will now use the <code>on_load :action_controller</code> hook to include the ControllerInstrumentation module in to both the <code>Base</code> and <code>API</code> classes of ActionController for Rails 5. This ensures that the proper load order is retained, minimizing side-effects of having the agent in an application.</p>
  </li>
  <li>
    <p>Ensure values for revisions on Capistrano deploy notices</p>
    <p>Previously, running the task to look up the changelog could generate an error, if there weren't previous and current revisions defined. This has now been fixed. Thanks Winfield Peterson for the contribution!</p>
  </li>
  <li>
    <p>External Segment Rewrites</p>
    <p>The agent has made internal changes to how it represents segments for external web requests.</p>
  </li>
</ul>
