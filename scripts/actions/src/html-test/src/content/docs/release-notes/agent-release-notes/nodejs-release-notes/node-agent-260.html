
<h3>New features</h3>
<ul>
  <li>
    <p>Added <code>transaction_tracer.hide_internals</code> configuration.</p>
    <p>This configuration controls the enumerability of the internal properties of the agent. Making these properties non-enumerable can have an impact on the performance of the agent. Disabling this option may decrease agent overhead.</p>
  </li>
</ul>
<h3>Improvements</h3>
<ul>
  <li>
    <p>Refactored promise instrumentation.</p>
    <p>This new instrumentation is far more performant than the previous and maintains a more sensible trace structure under a wider range of sequences.</p>
  </li>
  <li>
    <p>Added concurrent environment scanning, limited to 2 reads at a time.</p>
    <p>This improves the performance of dependency scanning at agent startup, allowing the agent to connect to our services more quickly.</p>
  </li>
  <li>
    <p>Refactored instrumentation tests to run against wide range of module versions.</p>
    <p>Instrumentation tests will be run against all supported major versions of every instrumented module. For releases, we will test against every supported minor version of the modules. This vastly improves our test coverage and should reduce the instances of regressions for specific versions of modules.</p>
  </li>
  <li>
    <p>Added tests for <em>all</em> of bluebird's promise methods.</p>
    <p>These tests ensure that we 100% instrument bluebird. Some gaps in instrumentation were found and fixed. Anyone using bluebird should upgrade.</p>
  </li>
</ul>
<h3>Bug fixes</h3>
<ul>
  <li>
    <p>Fixed a crashing error in the hapi instrumentation.</p>
    <p>When recording the execution of an extension listening to a server event (for example, 'onPreStart') the agent would crash due to the lack of a <code>raw</code> property on the first argument passed to the extension handler. The agent now checks the event before wrapping the extension handler and checks for the existence of the <code>raw</code> property before attempting to dereference off of it.</p>
  </li>
  <li>
    <p>Fixed an incompatibility with the npm module <code>mimic-response</code>.</p>
    <p>The agent's HTTP instrumentation previously did not play well with the way <code>mimic-response</code> copied properties from an <code>http.IncomingMessage</code>. This caused modules that relied on that process, such as <code>got</code>, to hang.</p>
  </li>
  <li>
    <p>Fixed naming rule testing tool to use same url scrubbing as the agent itself.</p>
  </li>
</ul>
