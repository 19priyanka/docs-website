
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
  <p>The end-of-life date for this agent version is July 29, 2019. To update to the latest agent version, see <a href="/docs/agents/manage-apm-agents/installation/update-new-relic-agent">Update the agent</a>. For more information, see <a href="/docs/agents/manage-apm-agents/maintenance/new-relic-agent-plugin-end-life-policy">End-of-life policy</a>.</p>
</div>
<h3>Notes</h3>
<ul>
  <li>
    <p>Added API for ignoring transactions</p>
    <p>This release adds three new API calls for ignoring transactions:</p>
    <ul>
      <li><code>NewRelic::Agent.ignore_transaction</code></li>
      <li><a href="/docs/agents/ruby-agent/installation-and-configuration/ignoring-specific-transactions#apdex"><code>NewRelic::Agent.ignore_apdex</code></a></li>
      <li><a href="/docs/agents/ruby-agent/installation-and-configuration/ignoring-specific-transactions#page-load-timing-rum"><code>NewRelic::Agent.ignore_enduser</code></a></li>
    </ul>
    <p><code>ignore_transaction</code> ignores a transaction completely: nothing about it will be reported to New Relic. <code>ignore_apdex</code> ignores only the Apdex metric for a single transaction. <code>ignore_enduser</code> disables Javascript injection for browser monitoring for the current transaction.</p>
    <p>These methods differ from the existing <code>newrelic_ignore_*</code> method in that they may be called <strong>during</strong> a transaction based on some dynamic runtime criteria, as opposed to at the class level on startup.</p>
    <p>For more information, see <a href="/docs/agents/ruby-agent/installation-and-configuration/ignoring-specific-transactions">ignoring specific transactions</a>.</p>
  </li>
  <li>
    <p>Improved SQL obfuscation</p>
    <p>SQL queries containing string literals ending in backslash <code>\</code> characters were not correctly obfuscated by the Ruby agent prior to transmission to New Relic. In addition, SQL comments were left un-obfuscated. This has been fixed, and the test coverage for SQL obfuscation has been improved.</p>
  </li>
  <li>
    <p><code>newrelic_ignore*</code> methods now work when called in a superclass</p>
    <p>The <code>newrelic_ignore*</code> family of methods previously did not apply to subclasses of the class from which it was called, meaning that Rails controllers inheriting from a single base class where <code>newrelic_ignore</code> had been called would not be ignored. This has been fixed.</p>
  </li>
  <li>
    <p>Fix for rare crashes in <code>Rack::Request#params</code> on Sinatra apps</p>
    <p>Certain kinds of malformed HTTP requests previously caused unhandled exceptions in the Ruby agent's Sinatra instrumentation, in the <code>Rack::Request#params</code> method. This has been fixed.</p>
  </li>
  <li>
    <p>Improved handling for rare errors caused by timeouts in Excon requests</p>
    <p>In some rare cases, the agent would emit a warning message in its log file and abort instrumentation of a transaction if a timeout occurred during an Excon request initiated from within that transaction. This has been fixed.</p>
  </li>
  <li>
    <p>Improved behavior when the agent is misconfigured</p>
    <p>When the agent is misconfigured by attempting to shut it down without it ever having been started, or by attempting to disable instrumentation after instrumentation has already been installed, the agent will no longer raise an exception, but will instead log an error to its log file.</p>
  </li>
  <li>
    <p>Fix for <code>ignore_error_filter</code> not working in some configurations</p>
    <p>The <code>ignore_error_filter</code> method allows you to specify a block to be evaluated in order to determine whether a given error should be ignored by the agent. If the agent was initially disabled, and then later enabled with a call to <code>manual_start</code>, the <code>ignore_error_filter</code> would not work. This has been fixed.</p>
  </li>
  <li>
    <p>Fix for Capistrano 3 ignoring <code>newrelic_revision</code></p>
    <p>New Relic's Capistrano recipes support passing parameters to control the values recorded with deployments, but user-provided <code>:newrelic_revision</code> values were incorrectly overwritten. This has been fixed.</p>
  </li>
  <li>
    <p>Agent errors logged with ruby-prof in production</p>
    <p>If the ruby-prof gem was available in an environment without New Relic's developer mode enabled, the agent would generate errors to its log. This has been fixed.</p>
  </li>
  <li>
    <p>Tighter requirements on naming for configuration environment variables</p>
    <p>The agent would previously assume any environment variable containing <code>NEWRELIC</code> was a configuration setting. It now looks for this string as a prefix only.</p>
    <p>Thanks to Chad Woolley for the contribution!</p>
  </li>
</ul>
