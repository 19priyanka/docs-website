
<h3>Improvements:</h3>
<ul>
  <li>
    <p>Vert.x 3.6</p>
    <p>The Java agent now provides visibility into your applications built using the Vert.x 3.6. The agent instruments Vert.x Web, Vert.x Core, and Vert.x HTTP client. With this instrumentation, the agent will identify and name your transactions based on Vert.x web routing paths. The agent will also time web handlers, track async handlers, and external calls made with Vert.x HTTP client.</p>
  </li>
  <li>
    <p>Wildfly 12-15</p>
    <p>The agent now supports Wildfly versions 12 through 15.</p>
  </li>
</ul>
<h3>Fixes:</h3>
<ul>
  <li>Fixed an issue where applications using neo4j bolt JDBC driver could fail to start.</li>
  <li>The <code>log_daily</code> configuration did not respect documented precedence.</li>
  <li>Fixed a bug that caused the Spring Webflux instrumentation to fail to apply for spring-webflux versions greater than 5.0.*.</li>
  <li>Fixed an issue where transactions would not be fully reported if <code>distributed_tracing.enabled = true</code> and <code>cross_application_tracer.enabled = false</code>.</li>
  <li>Fixed an issue where Akka Http application would not start with the agent attached when using sbt.</li>
  <li>Fixed an issue where the agent could fail to determine the hostname .</li>
</ul>
<h3>Known Issues</h3>
<p><strong>Fixes in 4.12.0</strong></p>
<ul>
  <li>Fixed an issue with Jax-RS subresource transaction naming where the root path is duplicated when a nested resource structure is used. This could lead to transactions being named incorrectly for incoming requests to a Jax-RS framework.</li>
  <li>Fixed a bug in the agent's Jetty metric sampling that could prevent Jetty specific metrics from being reported when the number of threads returned by JMX is zero.</li>
  <li>Fixed a NullPointerException that can occur when cross application tracing configuration is explicitly disabled.</li>
  <li>Fixed an issue where transactions would be named incorrectly when using custom Akka Http stream directives or a pathEnd directive followed by a Segment directive.</li>
  <li>Fixed an issue where certain usages of Akka and Scala would prevent transactions from being reported to New Relic. This would also manifest as a NullPointerException in the agent log at <code>finest</code> level.</li>
  <li>The Java agent no longer includes Jaxb or Logback dependencies. A new dependency on Log4j2 has been added.</li>
</ul>
<p><strong>Fixes in 4.12.1</strong></p>
<ul>
  <li>Fixed an issue where an exception would be thrown during agent initialization which caused the application to shut down when the log file is not writable. In previous agent versions there was an undocumented behavior where the agent would log to STDOUT instead.</li>
  <li>Fixed a regression where a NullPointerException would be logged and instrumentation would not be applied when using an XML extension with comments preceding the instrumentation section.</li>
  <li>Fixed issue where setting the <code>log_limit_in_kbytes</code> greater than 0 and <code>log_file_count</code> equal to 1 would result in the agent not logging to the agent log file.</li>
</ul>
<p><strong>Fixes in 5.0.0</strong></p>
<ul>
  <li>The agent no longer requires a newrelic.yml even when the 'app_name' and 'license_key' configuration options are set via environment variables and/or system properties. For more details, see [Java agent configuration(]<a href="https://docs.newrelic.com/docs/agents/java-agent/configuration/java-agent-configuration-config-file#Environment_Variables">https://docs.newrelic.com/docs/agents/java-agent/configuration/java-agen...</a>).</li>
  <li>HttpSessions JMX metrics were not reporting for Websphere Liberty Profile applications.</li>
  <li>The transaction_events.max_samples_stored configuration value in the newrelic.yml would incorrectly override the system properties or environment variable values</li>
  <li>Applications running on Wildfly 12 - 15 would fail start with NoClassDefFound errors for Java agent classes.</li>
  <li>Play applications where external calls inside of future callbacks using async-http-client would not be recorded.</li>
  <li>Setting log_limit_in_kbytes would result in the agent not logging to the agent log file if log_file_count was also set to less than 2.</li>
  <li>Webflux status codes which were not recognized by Spring Webflux caused a 500 status code to be returned and an exception in application logs.</li>
</ul>
<p><strong>Fixes in 5.1.0</strong></p>
<ul>
  <li>Fixed an issue in the Scala instrumentation that would cause an <code>Java.lang.IllegalArgumentException:</code> to be thrown when the Lightbend Cinnamon agent is in use.</li>
  <li>Fixed issue where <a href="https://docs.newrelic.com/docs/apm/transactions/cross-application-traces/introduction-cross-application-traces">cross application tracing headers</a> were incorrectly parsed when <a href="https://docs.newrelic.com/docs/apm/distributed-tracing/getting-started/introduction-distributed-tracing">distributed tracing</a> is enabled. Applications that use both distributed tracing and cross application tracing will no longer report external transaction breakdown metrics.</li>
  <li>Fixed an issue where the agent’s Kafka instrumentation would report <code>WakeupExceptions</code> as errors in New Relic. These exceptions will no longer be reported.</li>
  <li>Fixed a Log4J ClassCastException for applications running on the IBM J9 JVM that set a custom logging manager via the <code>-Djava.util.logging.manager</code> system parameter.</li>
  <li>The agent now supports using the <a href="https://docs.newrelic.com/docs/apm/applications-menu/events/thread-profiler-tool">thread profiler</a> when the <a href="https://docs.newrelic.com/docs/agents/java-agent/configuration/java-agent-configuration-config-file#cfg-send_environment_info">send_environment_info configuration</a> is disabled.</li>
</ul>
<p><strong>Fixes in 5.2.0</strong></p>
<ul>
  <li>Fixed an issue where very long-running transactions with a large number of <a href="https://docs.newrelic.com/docs/apm/transactions/intro-transactions/transactions-new-relic-apm#segments">segments</a> would cause an excessive amount of memory usage. The agent will no longer trace segments once the <a href="https://docs.newrelic.com/docs/agents/java-agent/configuration/java-agent-configuration-config-file#cfg-tt-segment_limit">segment_limit</a> has been reached.</li>
</ul>
<p><strong>Fixes in 5.3.0</strong></p>
<ul>
  <li>Akka-http instrumentation would name transactions incorrectly when using an asynchronous onComplete callback to match routes.</li>
  <li>The agent’s JaxRS instrumentation did not apply to cases where a concrete class implements the same method from two different interfaces.</li>
  <li>The agent would not report JMX metrics when one or more composite attributes were null.</li>
  <li>Akka-http path matching instrumentation could produce NullPointerExceptions when using a "repeat" path segment with no values. Transactions that pass some values will report as-is, but transactions that pass no values will be reported with a different segment in the metric name: "().repeat()".</li>
  <li>The <code>ignore_status_codes</code> system property was not getting applied correctly.</li>
</ul>
<p><strong>Fixes in 5.4.0</strong></p>
<ul>
  <li><a href="https://docs.newrelic.com/docs/apm/transactions/transaction-traces/introduction-transaction-traces">Transaction traces</a> would occasionally miss segments when using the spring <code>@Async</code> annotation with servlets.</li>
  <li>Jax-RS instrumentation was not starting transactions.</li>
  <li>A potential race condition during agent startup that would manifest as a <code>NoClassDefFoundError</code> for internal New Relic classes.</li>
  <li>Akka-http instrumentation would attempt multiple retransforms of the same class.</li>
  <li>The noticeError API would drop custom attributes that weren't of type String, Number, or Boolean, such as Enums or other custom types.</li>
</ul>
<p><strong>Fixes in 5.6.0</strong></p>
<ul>
  <li>Spring Webflux WebClient would not track external calls when constructed with <code>baseUrl(String baseUrl)</code>.</li>
  <li>The <code>NewRelic.getAgent().getConfig().getValue()</code> api would not check configuration values set via environment variables.</li>
  <li>The agent’s completable-future instrumentation could hold a reference to <code>Token</code>s after they were expired, which could cause excessive memory usage.</li>
  <li>Error traces could report to the wrong application when <code>auto_app_naming</code> is enabled and there were errors from two different application names getting reported during the same harvest.</li>
  <li>The agent’s MongoDB instrumentation would instrument the same builder used by the async and reactive-streams drivers, resulting in excessive memory usage and incorrect transaction times. <strong>Note:</strong> The agent will no longer instrument the sync MongoDB driver if the async and/or reactive-streams drivers are on the application’s <code>classpath</code>.</li>
</ul>
<p><strong>Fixes in 5.7.0</strong></p>
<ul>
  <li>Calls to <code>NewRelic.getAgent().getTracedMethod().addOutboundRequestHeaders()</code> will no longer throw an exception if a traced method has started but a transaction has not. This could happen by calling this in a method annotated with <code>@Trace(async=true)</code> before a token is linked.</li>
  <li>Updates Guava to the newest release.</li>
  <li><code>NoClassDefFoundError</code> would occur in agent logs when a spring controller is used without a root level RequestMapping annotation.</li>
  <li>The <code>gc_time</code> metric, which was enabled by default in version 5.2.0, has now been disabled by default since its results are often misleading.</li>
</ul>
<p><strong>Fixes in 5.8.0</strong></p>
<ul>
  <li>The Solr 7 instrumentation would not report Update JMX metrics.</li>
  <li><code>HttpURLConnection</code> instrumentation produced External metrics only when network methods (<code>getInputStream</code>, <code>getResponseCode</code>) are called.</li>
  <li>MongoDB instrumentation would report duplicate metrics when applications invoked <code>MongoClientOptions.build()</code> more than once.</li>
</ul>
<p><strong>Fixes in 5.9.0</strong></p>
<ul>
  <li>The <code>ca_bundle_path</code> configuration setting would fail to correctly import certificates when running on IBM J9</li>
  <li>Clarified the startup log message about the state of browser monitoring for the current application.</li>
  <li>The agent logger would sometimes throw a <code>NullPointerException</code></li>
  <li>The agent would stop reporting Kafka metrics when one or more clients where closed</li>
  <li><code>HttpURLConnection</code> instrumentation could cause a <code>NullPointerException</code> in the agent logs and fail to report External metrics</li>
</ul>
<p><strong>Fixes in 5.10.0</strong></p>
<ul>
  <li>
    <p>In an effort to modernize our language and improve clarity, we have renamed several configuration values. The old names will still work for now, but they will all be removed in the next major version.</p>
    <p><code>transaction_tracer.slow_query_whitelist</code> is now <code>transaction_tracer.collect_slow_queries_from</code></p>
    <p><code>strip_exception_messages.whitelist</code> is now <code>strip_exception_messages.allowed_classes</code></p>
    <p><code>command_parser.blacklist</code> is now <code>command_parser.disallow</code></p>
  </li>
  <li>
    <p>The <code>strip_exception_messages</code> config now excludes nested exception messages</p>
  </li>
  <li>
    <p>The agent will now use a lightweight tracer for SQL tracers beyond the <a href="https://docs.newrelic.com/docs/agents/java-agent/configuration/java-agent-configuration-config-file#cfg-tt-segment_limit">segment_limit</a>, improving performance in cases with a high number of segments.</p>
  </li>
  <li>
    <p>The agent would fail to report the Docker <code>containerId</code> for some combinations of systemd and Kubernetes</p>
  </li>
  <li>
    <p>The agent logger would fail to log with: <code>“ERROR RollingFileAppender 'File': No TriggeringPolicy provided”</code> when <code>newrelic.config.log_file_count>1</code> and <code>newrelic.config.isDaily=false</code> and <code>newrelic.config.log_limit_bytes=0</code></p>
  </li>
</ul>
