
<h3>New Features</h3>
<ul>
  <li>Enables ability to migrate to Configurable Security Policies (CSP) on a per agent basis for accounts already using High Security Mode (HSM). When both HSM and CSP are enabled for an account, an agent (this version or later) can successfully connect with either <code>high_security: true</code> or the appropriate <code>security_policies_token</code> configured.</li>
</ul>
<h3>Fixes</h3>
<ul>
  <li>Fixes a number of issues caused when Application Initialization has been enabled in Internet Information Services (IIS) (a.k.a. <strong>AlwaysOn</strong> in Azure App Services). The issues include the inability for the agent to name an app or possibly not instrument an app at all when app pool allow/deny listing has been applied via <code>newrelic.config</code>. In an Azure App Services scenario inadvertent instrumentation of the Kudu process could also occur. This was caused by the agent relying on the IIS environment variable <code>APP_POOL_ID</code>. When Application Initialization or AlwaysOn are enabled, the <code>APP_POOL_ID</code> environment variable is unavailable to the agent. The agent now also attempts to parse the command line of the <code>w3wp.exe</code> process to identify the application pool the app is running under.</li>
  <li>Improves the handling of OperationCanceledException errors when trying to connect or send data to New Relic.</li>
  <li>Fixes a problem with instrumenting ASP.NET Core applications that can occur when the Microsoft.AspNetCore.Diagnostics.Abstraction assembly is not available.</li>
  <li>Fixes a problem where WCF Instrumentation may shut-down due to an unexpected error.</li>
  <li>Fixes a problem that can cause the agent to fail to shutdown completely when a shutdown is triggered while the agent is still in its startup process.</li>
  <li>Fixes a problem with the <a href="https://docs.newrelic.com/docs/agents/net-agent/net-agent-api/getlinkingmetadata-net-agent-api">GetLinkingMetadata</a> API method that could cause an expected KeyValuePair to not be included in the Dictionary.</li>
</ul>
<h3>Upgrading</h3>
<ul>
  <li>Follow standard procedures to <a href="/docs/agents/net-agent/installation-configuration/update-net-agent">update the .NET agent</a>.</li>
  <li>If you are upgrading from a particularly old agent, review the list of major changes and procedures to <a href="/docs/agents/net-agent/troubleshooting/upgrade-legacy-net-agents">upgrade legacy .NET agents</a>.</li>
</ul>
