
<h1>New Relic Ruby Agent Release Notes</h1>
<ul>
  <li>
    <p><strong>Error attributes now added to each span that exits with an error or exception</strong></p>
    <p>Error attributes <code>error.class</code> and <code>error.message</code> are now included on the span event in which an error or exception was noticed, and, in the case of unhandled exceptions, on any ancestor spans that also exit with an error. The public API method <code>notice_error</code> now attaches these error attributes to the currently executing span.</p>
    <p><a href="https://docs.newrelic.com/docs/apm/distributed-tracing/ui-data/understand-use-distributed-tracing-data#rules-limits">Spans with error details are now highlighted red in the Distributed Tracing UI</a>, and error details will expose the associated <code>error.class</code> and <code>error.message</code>. It is also now possible to see when an exception leaves the boundary of the span, and if it is caught in an ancestor span without reaching the entry span. NOTE: This “bubbling up” of exceptions will impact the error count when compared to prior behavior for the same trace. It is possible to have a trace that now has span errors without the trace level showing an error.</p>
    <p>If multiple errors occur on the same span, only the most recent error information is added to the attributes. Prior errors on the same span are overwritten.</p>
    <p>These span event attributes conform to <a href="https://docs.newrelic.com/docs/agents/manage-apm-agents/agent-data/manage-errors-apm-collect-ignore-or-mark-expected#ignore">ignored errors</a> and <a href="https://docs.newrelic.com/docs/agents/manage-apm-agents/agent-data/manage-errors-apm-collect-ignore-or-mark-expected#expected">expected errors</a>.</p>
  </li>
  <li>
    <p><strong>Added tests for latest Grape / Rack combination</strong></p>
    <p>For a short period of time, the latest versions of Grape and Rack had compatibility issues. Generally, Rack 2.1.0 should be avoided in all cases due to breaking changes in many gems reliant on Rack. We recommend using either Rack &#x3C;= 2.0.9, or using latest Rack when using Grape (2.2.2 at the time of this writing).</p>
  </li>
  <li>
    <p><strong>Bugfix: Calculate Content-Length in bytes</strong></p>
    <p>Previously, the Content-Length HTTP header would be incorrect after injecting the Browser Monitoring JS when the response contained Unicode characters because the value was not calculated in bytes. The Content-Length is now correctly updated.</p>
    <p>Thanks to thaim for the contribution!</p>
  </li>
  <li>
    <p><strong>Bugfix: Fix Content-Length calculation when response is nil</strong></p>
    <p>Previously, calculating the Content-Length HTTP header would result in a <code>NoMethodError</code> in the case of a nil response. These errors will no longer occur in such a case.</p>
    <p>Thanks to Johan Van Ryseghem for the contribution!</p>
  </li>
  <li>
    <p><strong>Bugfix: DecoratingFormatter now logs timestamps as millisecond Integers</strong></p>
    <p>Previously the agent sent timestamps as a Float with milliseconds as part of the fractional value. Logs in Context was changed to only accept Integer values and this release changes DecoratingFormatter to match.</p>
  </li>
  <li>
    <p><strong>Added --force option to <code>newrelic install</code> cli command to allow overwriting newrelic.yml</strong></p>
  </li>
  <li>
    <p><strong>Bugfix: The fully qualified hostname now works correctly for BSD and Solaris</strong></p>
    <p>Previously, when running on systems such as BSD and Solaris, the agent was unable to determine the fully qualified domain name, which is used to help link Ruby agent data with data from New Relic Infrastructure. This information is now successfully collected on various BSD distros and Solaris.</p>
  </li>
</ul>
