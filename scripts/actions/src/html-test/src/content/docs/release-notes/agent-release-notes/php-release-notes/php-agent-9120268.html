
<h3>New Features</h3>
<ul>
  <li>
    <p>With the addition of attributes on spans, the PHP agent now fully supports <a href="https://docs.newrelic.com/docs/understand-dependencies/distributed-tracing/enable-configure/enable-distributed-tracing">Infinite Tracing on New Relic Edge</a>.</p>
    <p>Infinite Tracing observes 100% of your distributed traces and provides visualizations for the most actionable data so you have the examples of errors and long-running traces so you can better diagnose and troubleshoot your systems. You <a href="https://docs.newrelic.com/docs/agents/php-agent/configuration/php-agent-configuration#inivar-inftr-host">configure your agent</a> to send traces to a trace observer in New Relic Edge. You view your distributed traces through the New Relic’s UI. There is no need to install a collector on your network.</p>
    <p>Infinite Tracing is currently available on a sign-up basis. If you would like to participate, please contact your sales representative.</p>
  </li>
  <li>
    <p>Added support for attributes on spans. All custom attributes and some agent attributes previously applied as “Transaction events” are now also applied to the currently executing span, subject to the new span configuration settings.</p>
    <ul>
      <li>
        <p>Added the <code>transaction.name</code> to spans.</p>
      </li>
      <li>
        <p>Added <code>http.statusCode</code> to external spans, representing the status code on an http response.</p>
      </li>
      <li>
        <p>Added error attributes to each span that exits with an error or exception. <code>error.class</code> and <code>error.message</code> are now included on the span in which an error or exception was noticed, and, in the case of unhandled exceptions, on any ancestor spans that also exit with an error. Also, the public API method <a href="https://docs.newrelic.com/docs/agents/php-agent/php-agent-api/newrelic_notice_error"><code>newrelic_notice_error</code></a> now attaches these error attributes to the currently executing span, while still creating a Transaction Error event.</p>
        <p><a href="https://docs.newrelic.com/docs/apm/distributed-tracing/ui-data/understand-use-distributed-tracing-data#error-tips">Spans with error details are now highlighted red in the distributed tracing UI</a>, and error details will expose the associated <code>error.class</code> and <code>error.message</code>. It is also now possible to see when an exception leaves the boundary of the span, and if it is caught in an ancestor span without reaching the entry span. NOTE: This “bubbling up” of exceptions will impact the error count when compared to prior behavior for the same trace. It is possible now to have a trace that has span errors without showing an error on the root span or entry spans.</p>
      </li>
      <li>
        <p>Added a new API method <a href="https://docs.newrelic.com/docs/agents/php-agent/php-agent-api/newrelic_add_custom_parameter"><code>newrelic_add_custom_span_parameter</code></a> that allows adding custom attributes to spans. This is independent of the transaction; using this new API to add custom attributes to spans does not add them to transactions. If the maximum number of custom attributes is reached, span-level custom attributes take precedence over transaction-level custom attributes.</p>
      </li>
      <li>
        <p>Added the following span event attributes configuration to enable attribute filtering for spans:</p>
        <ul>
          <li><a href="https://docs.newrelic.com/docs/agents/php-agent/attributes/enable-or-disable-attributes#cfg-tt-attributes-enabled"><code>newrelic.span_events.attributes.enabled</code></a></li>
          <li><a href="https://docs.newrelic.com/docs/agents/php-agent/attributes/enable-or-disable-attributes#cfg-tt-attributes-include"><code>newrelic.span_events.attributes.include</code></a></li>
          <li><a href="https://docs.newrelic.com/docs/agents/php-agent/attributes/enable-or-disable-attributes#cfg-tt-attributes-exclude"><code>newrelic.span_events.attributes.exclude</code></a></li>
        </ul>
        <p>Note: Security recommendation—Review your Transaction attributes configuration. Any attribute include or exclude settings specific to Transaction events, should be applied to your Span attributes configuration or your global attributes configuration.</p>
      </li>
    </ul>
  </li>
</ul>
<h3>Bug Fixes</h3>
<ul>
  <li>In cases where the agent is configured to connect to the hostname of a daemon that exists in a separate container/host, after successfully connecting, the agent would not attempt to resolve the IP address again. This was seen when the daemon container/host goes down and then comes up again with a new IP address. Now, the agent will wait 45 seconds since either the last known good connection or the last IP address resolution and will attempt to resolve an IP address again.</li>
</ul>
