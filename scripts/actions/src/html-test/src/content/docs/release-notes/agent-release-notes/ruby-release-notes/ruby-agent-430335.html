
<h2>v4.3.0</h2>
<ul>
  <li>
    <p>Instrumentation for the Bunny AMQP Client</p>
    <p>The Bunny AMQP Client is now automatically instrumented. The agent will report data for messages sent and received by an application. Data on messages is available in both APM and Insights. Applications connected through a RabbitMQ exchange will now also be visible on Service Maps as part of Cross Application Tracing. See the <a href="https://docs.newrelic.com/docs/agents/ruby-agent/features/message-queues">message queues documentation page</a> for more details.</p>
  </li>
  <li>
    <p>Safely normalize external hostnames</p>
    <p>The agent has been updated to check for nil host values before downcasing the hostname. Thanks Rafael Valério for the contribution!</p>
  </li>
  <li>
    <p>PageView events will not be generated for ignored transactions</p>
    <p>The agent now checks if transaction is ignored before injecting the New Relic Browser Agent. This will prevent PageView events from being generated for ignored transactions.</p>
  </li>
  <li>
    <p>Datastores required explicitly in agent</p>
    <p>The agent has been modified to explicity <code>require</code> the Datastores module whereas previously there were situations where the module could be implicitly defined. Thanks Kevin Griffin for the contribution!</p>
  </li>
  <li>
    <p>Clear transaction state after forking</p>
    <p>Previously, if a transaction was started and the process forks, the transaction state survived the fork and <code>#after_fork</code> call in thread local storage. Now, this state is cleared by <code>#after_fork</code>.</p>
  </li>
  <li>
    <p>Postgis adapter reports as Postgres for datastores</p>
    <p>The agent now maps the Postgis adapter to Postgres for datastore metrics. Thanks Vojtěch Vondra for the contribution!</p>
  </li>
  <li>
    <p>Deprecate <code>:trace_only</code> option</p>
    <p>The <code>NewRelic::Agent.notice_error</code> API has been updated to deprecate the <code>:trace_only</code> option in favor of <code>:expected</code>.</p>
  </li>
</ul>
