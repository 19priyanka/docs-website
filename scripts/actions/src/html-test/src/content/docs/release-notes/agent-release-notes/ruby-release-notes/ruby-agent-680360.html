
<h2>v6.8.0</h2>
<ul>
  <li>
    <p><strong>Initial Ruby 2.7 support</strong></p>
    <p>The Ruby agent has been verified to run with Ruby 2.7.0-preview1.</p>
  </li>
  <li>
    <p><strong>New API method to add custom attributes to Spans</strong></p>
    <p>New API method for adding custom attributes to <a href="/docs/using-new-relic/welcome-new-relic/get-started/glossary#span">spans</a>. Previously, custom attributes were only available at the Transaction level. Now, with Span level custom attributes, more granular tagging is possible for easier isolation and review of traces. For more information:</p>
    <ul>
      <li><a href="https://www.rubydoc.info/gems/newrelic_rpm/NewRelic/Agent#add_custom_span_attributes-instance_method"><code>Agent#add_custom_span_attributes</code></a></li>
    </ul>
  </li>
  <li>
    <p><strong>Enables ability to migrate to configurable security policies (CSP) on a per-agent basis for accounts already using high security mode (HSM).</strong></p>
    <p>When both <a href="https://docs.newrelic.com/docs/agents/manage-apm-agents/configuration/high-security-mode">HSM</a> and <a href="https://docs.newrelic.com/docs/agents/manage-apm-agents/configuration/enable-configurable-security-policies">CSP</a> are enabled for an account, an agent (this version or later) can successfully connect with either <code>high_security: true</code> or the appropriate <code>security_policies_token</code> configured. <code>high_security</code> has been added as part of the preconnect payload.</p>
  </li>
  <li>
    <p><strong>Bugfix for logs-in-context combined with act-fluent-logger-rails</strong></p>
    <p>Previously, when using the Ruby agent's logs-in-context logger to link logging data with trace and entity metadata for an improved experience in the UI, customers who were also using the <code>act-fluent-logger-rails</code> gem would see a <code>NoMethodError</code> for <code>clear_tags!</code> that would interfere with the use of this feature. This error no longer appears, allowing customers to combine the use of logs-in-context with the use of this gem.</p>
    <p>Please note that the logs-in-context logger does not support tagged logging; if you are initializing your logger with a <code>log_tags</code> argument, your custom tags may not appear on the final version of your logs.</p>
  </li>
  <li>
    <p><strong>Bugfix for parsing invalid newrelic.yml</strong></p>
    <p>Previously, if the newrelic.yml configuration file was invalid, and the agent could not start as a result, the agent would not log any indication of the problem.</p>
    <p>This version of the agent will emit a FATAL message to STDOUT when this scenario occurs so that customers can address issues with newrelic.yml that prevent startup.</p>
  </li>
  <li>
    <p><strong>Configuration options containing the terms "whitelist" and "blacklist" deprecated</strong></p>
    <p>The following local configuration settings have been deprecated:</p>
    <ul>
      <li><code>autostart.blacklisted_constants</code>: use <code>autostart.denylisted_constants</code> instead.</li>
      <li><code>autostart.blacklisted_executables</code>: use <code>autostart.denylisted_executables</code> instead.</li>
      <li><code>autostart.blacklisted_rake_tasks</code>: use <code>autostart.denylisted_rake_tasks</code> instead.</li>
      <li><code>strip_exception_messages.whitelist</code>: use <code>strip_exception_messages.allowed_classes</code> instead.</li>
    </ul>
  </li>
  <li>
    <p><strong>Bugfix for module loading and constant resolution in Rails</strong></p>
    <p>Starting in version 6.3, the Ruby agent has caused module loading and constant resolution to sometimes fail, which caused errors in some Rails applications. These errors were generally <code>NoMethodError</code> exceptions or I18n errors <code>translation missing</code> or <code>invalid locale</code>. These errors would not appear if the agent was removed from the application's Gemfile. This version of the agent fixes these issues with module loading and constant resolution, so these errors no longer occur.</p>
  </li>
  <li>
    <p><strong>Bugfix: failed to get urandom</strong></p>
    <p>Previous versions of the agent would fail unexpectedly when the Ruby process used every available file descriptor. The failures would include this message:</p>
    <pre><code>ERROR : RuntimeError: failed to get urandom
</code></pre>
    <p>This version of the agent uses a different strategy for generating random IDs, and will not fail in the same way when no file descriptors are available.</p>
  </li>
</ul>
