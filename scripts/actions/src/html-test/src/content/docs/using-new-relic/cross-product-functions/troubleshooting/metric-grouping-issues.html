
<h2>Problem</h2>
<p>For our APM, browser monitoring, and mobile monitoring features, there can be cases when an account or application is sending many individual <a href="/docs/data-analysis/metrics/analyze-your-metrics/data-collection-metric-timeslice-event-data#timeslice-data">metrics</a> that could be better managed by grouping them together. We use the term <strong>metric grouping issue</strong> or <strong>MGI</strong> to describe this situation. When this occurs, the agent is sending unnecessarily large amounts of data to New Relic, which reduces the effectiveness of New Relic charts, tables, and reports.</p>
<p>Metric grouping issues occur most commonly with web transactions, especially if the name is based on URLs. They can also happen with other metrics reported by your application. For example:</p>
<ul>
  <li>If your application is crawling the Internet and each external call goes to a different domain</li>
  <li>If your software dynamically generates temporary database tables every time you receive a request</li>
  <li>If you are using <a href="/docs/agents/manage-apm-agents/agent-metrics/custom-instrumentation">custom instrumentation</a> that includes UUIDs, article names, or similar unique components</li>
</ul>
<p>Any situation where a potentially infinite list of metrics can be created, rather than metrics being grouped effectively (as with controllers, permanent database tables, or specific external services) can become a metric grouping issue.</p>
<h2>Solution</h2>
<p>By understanding what metric grouping is and how issues can arise, you can better understand how New Relic works with your application to group metrics effectively and help prevent metric grouping issues from occurring.</p>
<p>
  <img src="./images/metric-grouping.png" alt=" Before and after" title=" Before and after">
</p>
<p>Here is a "before" and "after" example of how metric grouping can help organize transactions, to help you more easily identify patterns with performance problems.</p>
<p>To help prevent metric grouping issues from occurring in your app:</p>
<ol>
  <li>Check the <a href="/docs/release-notes">New Relic release notes</a> to verify you're running the most current version of the New Relic agent.</li>
  <li>If needed, <a href="/docs/agents/manage-apm-agents/installation/update-new-relic-agent">upgrade your APM/mobile/browser agent</a> to the most current version.</li>
  <li>Wait a few minutes, then look at new data in the New Relic UI.</li>
</ol>
<p>If the problem persists, follow the procedures for your agent:</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>Agent</p>
      </div>
      <div>
        <p>Preventing MGIs</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p>All agents</p>
      </div>
      <div>
        <p>Review the information about <a href="#what">what causes metric grouping issues</a>.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Browser</p>
      </div>
      <div>
        <p><a href="/docs/browser/new-relic-browser/configuration/url-whitelists-grouping-browser-metrics#adding">Add URL groupings</a>.</p>
      </div>
    </div>
    <div>
      <div>
        <p>C SDK</p>
      </div>
      <div>
        <p>Avoid using URLs to name your transactions. Instead, follow the procedures to <a href="/docs/agents/c-sdk/instrumentation/instrument-your-app-c-sdk">instrument your app with the C SDK</a>.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Go</p>
      </div>
      <div>
        <p>Rename your <a href="/docs/agents/go-agent/instrumentation/instrument-go-transactions">Go transactions</a>.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Java</p>
      </div>
      <div>
        <p>See <a href="/docs/agents/java-agent/troubleshooting/resolve-metric-grouping-issues-java">Java metric grouping issues</a>.</p>
      </div>
    </div>
    <div>
      <div>
        <p>.NET</p>
      </div>
      <div>
        <p>Rename metrics with <a href="/docs/agents/net-agent/net-agent-api/set-transaction-name"><code>SetTransactionName</code></a>. For more information about using XML to add details, see <a href="/docs/agents/net-agent/custom-instrumentation/add-detail-transactions-xml-net#name-transactions">Name transactions</a>.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Node.js</p>
      </div>
      <div>
        <p>Rename transactions with <a href="https://docs.newrelic.com/docs/agents/nodejs-agent/api-guides/nodejs-agent-api#request-api">Request API calls</a>.</p>
      </div>
    </div>
    <div>
      <div>
        <p>PHP</p>
      </div>
      <div>
        <p><a href="/docs/agents/php-agent/frameworks-libraries/php-frameworks-integrating-support-new-relic#dev">Rename your PHP transactions</a>.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Python</p>
      </div>
      <div>
        <p>Rename your Python transactions with <a href="https://docs.newrelic.com/docs/agents/python-agent/python-agent-api/set_transaction_name"><code>set_transaction_name</code></a>.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Ruby</p>
      </div>
      <div>
        <p><a href="/docs/agents/ruby-agent/api-guides/ruby-custom-instrumentation#naming-transactions">Rename your Ruby transactions</a>.</p>
      </div>
    </div>
  </div>
</div>
<h2>Cause</h2>
<p>Metric grouping issues occur when the granularity of metric names (most often web transaction names) is too fine, resulting in hundreds or thousands of different web transaction names for just a small number of code paths. A few major code paths may generate many different full URL paths to unique documents, articles, or page, etc., and if the unique element of the URL path is included in the transaction name, each of these common paths will have its own unique name.</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZXhhbXBsZSJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiTUdJIGV4YW1wbGUifV0=">
    <div data-prop-text="title">MGI example</div>
    <p>In this example, you have an application that lets users write articles on any subject and post them for other users to see. Your application has three main functions: add an article, search for an article, and display an article.</p>
    <p>In order to improve search engine optimization (SEO), the "view article" code generates a unique URL to refer to each article. For example, the following URLs each refer to different articles in the example website:</p>
    <pre><code>http://example.com/article/view/How_to_Install_New_Relic
http://example.com/article/view/How_New_Relic_Saved_the_Day
http://example.com/article/view/Where_do_I_get_New_Relic

</code></pre>All three articles are different; they contain different content and their URLs are different. However, the code path that generates each article is the same: they all use the "view article" function.
    Many web frameworks use this technique. They have a controller or route (in this case named `article/view`) as part of the URL. New Relic works to automatically identify these patterns and group similar routes together, to prevent metric grouping issues from occurring.
    Without mechanisms for detecting controllers, the example application would send metrics for each individual URL requested by visitors to your site. If you have a million articles and your site is popular, in each minute there could be several thousand unique URLs visited. This produces a significant amount of additional data to be sent to New Relic for each [harvest cycle](/docs/accounts-partnerships/education/getting-started-new-relic/glossary#harvest-cycle), and the [APM **Transactions** page](/docs/apm/applications-menu/monitoring/transactions-page) would attempt to list thousands of unique URLs, resulting in metric grouping issues.
  </div>
</div>
<p>To monitor and improve your application performance, it's much more useful to know the average performance for a function (for example, viewing articles on your site) than how quickly each individual article is displayed. To prevent metric grouping issues, New Relic will normally show a single entry for that function (for example, <code>/article/view/*</code>) on the <a href="/docs/apm/applications-menu/monitoring/transactions-page">APM <strong>Transactions</strong> page</a>.</p>
<p>This grouping gives you a much better idea of how much time was spent viewing articles, and allows you to easily spot any performance problems related to viewing articles. If these statistics were spread across hundreds or thousands of transactions, detecting trends, regressions, or performance improvements would be extremely difficult.</p>
<p>Each APM agent has distinct ways of detecting controllers and frameworks. Most are automatic, but a few require you to enable or disable options in a <a href="/docs/agents/manage-apm-agents/configuration/configure-agent">config file</a>. You can also follow our recommendations to help <a href="#prevent">prevent metric grouping issues</a> from occurring.</p>
