
<p>New Relic allows you to collect custom <a href="/docs/agents/manage-apm-agents/agent-data/agent-attributes">attributes</a>. For example, you can create a custom attribute to track the user name associated with a slow or failing request. This document contains links to docs on how to do this for APM, infrastructure monitoring, browser monitoring, and mobile monitoring.</p>
<h2>APM: Record custom attributes [#enabling-custom]</h2>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
  <p>Review the list of <a href="/docs/insights/insights-data-sources/custom-data/insights-custom-data-requirements-limits#reserved-words">reserved terms used by NRQL</a>. Using reserved terms can cause issues.</p>
</div>
<p>To enable and use custom attributes for APM, follow the procedure for your APM agent:</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiYy1zZGstYXR0In0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJDIFNESyJ9XQ==">
    <div data-prop-text="title">C SDK</div>
    <p>To add custom attributes to applications monitored by the C SDK, call one of the <a href="https://newrelic.github.io/c-sdk/libnewrelic_8h.html#abfe6f64a8eec7d60d8588f8969781d34">attribute functions</a>; for example, <code>newrelic_add_attribute_double()</code>. The key name for your custom attribute depends on what you specify when you call the function.</p>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZ28tYXR0In0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJHbyJ9XQ==">
    <div data-prop-text="title">Go</div>
    <p>Custom attribute collection is enabled by default in the Go agent. However, you can <a href="/docs/agents/go-agent/instrumentation/go-agent-attributes#change-attribute-destination">disable custom attribute collection</a>.</p>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiamF2YS1hdHQifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IkphdmEifV0=">
    <div data-prop-text="title">Java</div>
    <p>Custom attribute collection is enabled by default in Java. You can collect custom attributes using XML and the Java agent APIs. These two methods can be used in conjunction with each other.</p>
    <div data-component="Table" data-prop="W10=">
      <div>
        <div>
          <div>
            <p>Method</p>
          </div>
          <div>
            <p><strong>How to do it</strong></p>
          </div>
        </div>
      </div>
      <div>
        <div>
          <div>
            <p>Specify attributes in XML</p>
          </div>
          <div>
            <p>XML allows you to specify custom attributes without changing any of your source code. You can have multiple XML files for custom attributes that are grouped by some logical facet.</p>
            <p>To set custom attributes for your Java app via XML:</p>
            <ol>
              <li>Review the New Relic Java agent's documentation about <a href="/docs/agents/java-agent/custom-instrumentation/java-custom-instrumentation-xml-examples">XML file format, methods and classes, and examples</a>.</li>
              <li>From your <code>Extensions</code> directory within the New Relic Java agent, create a single <a href="/docs/agents/java-agent/custom-instrumentation/java-instrumentation-xml">XML file</a>.</li>
              <li>Define the methods you want New Relic to monitor by <a href="/docs/agents/java-agent/custom-instrumentation/java-instrumentation-xml">editing your XML file</a> directly.</li>
              <li>Define an XML instrumentation file using the <a href="/docs/agents/java-agent/custom-instrumentation/custom-instrumentation-editor-quickly-customize-your-java-instrumentation">New Relic UI</a>. This may require additional config in the <code>common:</code> block of your <strong>newrelic.yml</strong>. See <strong>Report custom attributes</strong> under <a href="/docs/agents/java-agent/custom-instrumentation/custom-instrumentation-editor-instrument-ui#options">Instrumentation options</a> for more detail.</li>
            </ol>
          </div>
        </div>
        <div>
          <div>
            <p>Call the agent's API</p>
          </div>
          <div>
            <p><strong>Example 1: Adding custom attributes to transactions</strong></p>
            <p>To collect custom attributes using the agent's API, call the relevant methods:</p>
            <ol>
              <li>
                <p>For each method you want to record an attribute for, call <code>NewRelic.addCustomParameter(...)</code>.</p>
              </li>
              <li>
                <p>Optional: Include or exclude certain attributes with <a href="/docs/agents/java-agent/attributes/enabling-and-disabling-attributes#cfg-attributes-include"><code>attributes.include</code></a> and <a href="/docs/agents/java-agent/attributes/enabling-and-disabling-attributes#cfg-attributes-exclude"><code>attributes.exclude</code></a>.</p>
                <p>For example, to record a variable named <code>userId</code>, include this code in the parent method:</p>
                <pre><code>NewRelic.addCustomParameter("userId", userId);
</code></pre>
                <p><strong>Example 2: Adding custom attributes to spans in distributed traces</strong></p>
                <p>To collect custom attributes using the agent's API, call the relevant methods:</p>
              </li>
              <li>
                <p>For each span (currently executing method) that you want to record an attribute for, call <code>NewRelic.getAgent().getTracedMethod().addCustomAttribute(...)</code>.</p>
              </li>
              <li>
                <p>Optional: Include or exclude certain attributes with <a href="/docs/agents/java-agent/attributes/enabling-and-disabling-attributes#cfg-attributes-include"><code>span_events.attributes.include</code></a> and <a href="/docs/agents/java-agent/attributes/enabling-and-disabling-attributes#cfg-attributes-exclude"><code>span_events.attributes.exclude</code></a>.</p>
                <p>For example, to record a variable named <code>userId</code> on the current span, include this code in the associated method:</p>
                <pre><code>NewRelic.getAgent().getTracedMethod().addCustomAttribute("userId", userId);
</code></pre>
              </li>
            </ol>
          </div>
        </div>
        <div>
          <div>
            <p>Collect user attributes</p>
          </div>
          <div>
            <p>The Java agent also includes a built-in mechanism to <a href="/docs/agents/java-agent/attributes/enabling-disabling-attributes-java#user-attributes">enable user attributes</a> and collect user information from <code>HttpServletRequest.getUserPrincipal()</code> as custom attributes.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoibmV0LWF0dCJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiLk5FVCJ9XQ==">
    <div data-prop-text="title">.NET</div>
    <p>Custom attribute collection is enabled by default in .NET. To collect custom attributes, call the relevant API methods:</p>
    <ol>
      <li>
        <p>For each method for which you want to record an attribute, call <code>AddCustomAttribute</code>.</p>
      </li>
      <li>
        <p>Optional: Include or exclude attributes with the <a href="/docs/agents/net-agent/installation-configuration/net-agent-configuration#agent-attributes-include"><code>include</code></a> and <a href="/docs/agents/net-agent/installation-configuration/net-agent-configuration#agent-attributes-exclude"><code>exclude</code></a> configuration options.</p>
        <p>For example, to record attributes for a coupon code (string) and an item ID code (number), you could include this code in the parent method:</p>
        <pre><code>IAgent agent = NewRelic.Api.Agent.NewRelic.GetAgent(); 
ITransaction transaction = agent.CurrentTransaction;

transaction
    .AddCustomAttribute("Discount Code", "Summer Super Sale")
    .AddCustomAttribute("Item Code", 31456);
</code></pre>
      </li>
    </ol>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoibm9kZWpzLWF0dCJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiTm9kZS5qcyJ9XQ==">
    <div data-prop-text="title">Node.js</div>
    <p>Custom attribute collection is enabled by default in Node.js. To collect custom attributes, call the relevant API method:</p>
    <ul>
      <li>
        <p>For each attribute you want to record, call <a href="/docs/agents/nodejs-agent/supported-features/nodejs-agent-api#add-custom-attribute"><code>newrelic.addCustomAttribute</code></a>.</p>
      </li>
      <li>
        <p>To record multiple attributes using a single call, use <a href="https://docs.newrelic.com/docs/agents/nodejs-agent/supported-features/nodejs-agent-api#custom-attributes"><code>newrelic.addCustomAttributes</code></a>.</p>
        <p>For example, to record attributes for a coupon code and an item ID code, you could include this in the parent method:</p>
        <pre><code>newrelic.addCustomAttributes({
  "Discount Code": "Summer Super Sale",
  "Item Code": 31456
});
</code></pre>
      </li>
    </ul>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoicGhwLWF0dCJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiUEhQIn1d">
    <div data-prop-text="title">PHP</div>
    <p>Custom attribute collection is enabled by default in PHP. To collect custom attributes, call the relevant API method for each method that you want to record an attribute;</p>
    <ul>
      <li>
        <p><code>newrelic_add_custom_parameter</code> for transaction events and spans</p>
      </li>
      <li>
        <p><code>newrelic_add_custom_span_parameter</code> for only spans</p>
        <p>For example, to record a variable named <code>$userId</code>, include this code in the parent method:</p>
        <pre><code>newrelic_add_custom_parameter ('userID', $userId)
</code></pre>
      </li>
    </ul>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoicHl0aG9uLWF0dCJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiUHl0aG9uIn1d">
    <div data-prop-text="title">Python</div>
    <p>Custom attribute collection is enabled by default in Python. To collect custom attributes, call <a href="https://docs.newrelic.com/docs/agents/python-agent/python-agent-api/add_custom_parameter"><code>add_custom_parameter</code></a> for each method that you want to record an attribute.</p>
    <p>For example, to record a variable named <code>user_id</code>, include this code in the parent method:</p>
    <pre><code>newrelic.agent.add_custom_parameter('user_id', user_id)

</code></pre>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoicnVieS1hdHQifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IlJ1YnkifV0=">
    <div data-prop-text="title">Ruby</div>
    <p>Custom attribute collection is enabled by default in Ruby. To collect custom attributes, call the relevant API methods:</p>
    <ul>
      <li>
        <p>For Ruby agent version 3.12.0 or higher, use the <a href="http://www.rubydoc.info/github/newrelic/rpm/NewRelic/Agent#add_custom_attributes-instance_method"><code>add_custom_attributes</code></a> method. For example, to record a variable named <code>@user_id</code>, include this code in the parent method:</p>
        <pre><code>::NewRelic::Agent.add_custom_attributes({ user_id: @user.id })
</code></pre>
      </li>
      <li>
        <p>For Ruby agent version 3.11.2 or lower, use the <code>add_custom_parameters</code> method. For example, to record a variable named <code>@user_id</code>, include this code in the parent method:</p>
        <pre><code>::NewRelic::Agent.add_custom_parameters({ user_id: @user.id })
</code></pre>
      </li>
    </ul>
  </div>
</div>
<h2>Browser monitoring: Record custom attributes [#collecting_browser]</h2>
<p>The browser agent provides an API to specify extra details associated with a page view or browser interaction, either by <a href="/docs/insights/insights-data-sources/custom-data/insert-data-via-new-relic-browser#custom-attribute-forward-apm">forwarding attributes from APM to browser monitoring</a> or by <a href="/docs/browser/new-relic-browser/browser-agent-spa-api/set-custom-attribute">specifying custom attributes through JavaScript</a>. Values forwarded from the APM agent are encoded and injected into browser attributes by our browser agent.</p>
<h2>Infrastructure monitoring: Record custom attributes [#collecting_browser]</h2>
<p>Our <a href="/docs/infrastructure/new-relic-infrastructure/getting-started/welcome-new-relic-infrastructure">Infrastructure monitoring</a> lets you create <a href="/docs/infrastructure/new-relic-infrastructure/configuration/configure-infrastructure-agent#attributes">custom attributes</a> that are used to annotate the data from the infrastructure agent. You can use this metadata to build filter sets, group your results, and annotate your data.</p>
<h2>Mobile monitoring: Record custom attributes [#collecting_mobile]</h2>
<p>Mobile agents include API calls to record custom attributes:</p>
<ul>
  <li>For an overview of mobile monitoring custom data, see <a href="/docs/insights/insights-data-sources/custom-events/insert-custom-events-attributes-mobile-data">Insert custom events and attributes</a></li>
  <li>Android method: <a href="/docs/mobile-monitoring/new-relic-mobile-android/android-sdk-api/set-attribute"><code>setAttribute</code></a></li>
  <li>iOS method: <a href="/docs/mobile-monitoring/new-relic-mobile-ios/ios-sdk-api/set-attribute"><code>setAttribute</code></a></li>
</ul>
<h2>For more help [#more_help]</h2>
