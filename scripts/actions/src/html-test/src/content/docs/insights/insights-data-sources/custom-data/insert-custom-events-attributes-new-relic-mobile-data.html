
<p><a href="/docs/mobile-monitoring/new-relic-mobile/getting-started/introduction-new-relic-mobile">New Relic Mobile</a> sends some <a href="/docs/insights/insights-data-sources/default-data/mobile-default-events-insights">default event data</a> from your mobile app to New Relic, such as data about interactions, sessions, crashes, and request errors. You can also create your own custom attributes and events for more detailed querying and analysis.</p>
<h2>Create custom attributes and events [#custom-attributes-instructions]</h2>
<p>You can create custom session-level attributes for default Mobile events using the New Relic Mobile SDK. For example, to record a <code>username</code> attribute for some part of your iOS or Android app, you would use the <code>setAttribute</code> API (<a href="/docs/mobile-monitoring/new-relic-mobile-android/android-sdk-api/set-attribute">Android</a> | <a href="/docs/mobile-monitoring/new-relic-mobile-ios/ios-sdk-api/set-attribute">iOS</a>). These attributes are session-related information and are shared by multiple Mobile event types.</p>
<p>You can also create entirely new custom event types and assign them their own custom attributes, using the <code>recordCustomEvent</code> API (<a href="/docs/mobile-monitoring/new-relic-mobile-android/android-sdk-api/recordcustomevent-android-sdk-api">Android</a> | <a href="/docs/mobile-monitoring/new-relic-mobile-ios/ios-sdk-api/recordcustomevent-ios-sdk-api">iOS</a>).</p>
<p>To help with crash analysis, you can use the SDK to create <code>MobileBreadcrumb</code> &#x26; <code>MobileHandledException</code> events. These events are available for querying and also displayed in the <a href="/docs/mobile-monitoring/mobile-monitoring-ui/crashes/mobile-crash-event-trail">Mobile crash event trail</a>.</p>
<p>For more on creating custom attributes and custom events, see:</p>
<ul>
  <li><a href="/docs/mobile-monitoring/mobile-sdk-api/new-relic-mobile-sdk-api/working-android-sdk-api">Android SDK API guide</a></li>
  <li><a href="/docs/mobile-monitoring/mobile-sdk-api/new-relic-mobile-sdk-api/working-ios-sdk-api">iOS SDK API guide</a></li>
  <li><a href="#examples">NRQL query examples</a></li>
  <li><a href="/docs/insights/nrql-new-relic-query-language/nrql-query-examples/mobile-request-failures-query-examples-mobilerequesterror"><code>MobileRequestError</code> examples</a></li>
  <li><a href="https://docs.newrelic.com/docs/insights/insights-data-sources/default-attributes/mobile-request-query-examples-mobilerequest"><code>MobileRequest</code> examples</a></li>
  <li><a href="#limits">Limits and restricted characters</a></li>
</ul>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiY3VzdG9tX2V2ZW50X2NhbGxvdXQifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidmFyaWFudCIsInZhbHVlIjoiaW1wb3J0YW50In1d">
  <p>As of <a href="/docs/release-notes/mobile-release-notes/android-release-notes">Android agent version 5.12.0</a> and <a href="/docs/release-notes/mobile-release-notes/ios-release-notes">iOS agent version 5.12.0</a>, use the <code>recordCustomEvent</code> method to create custom events. The <code>recordEvent</code> methods for <a href="/docs/mobile-monitoring/new-relic-mobile-android/android-sdk-api/record-custom-event">Android</a> and <a href="/docs/mobile-monitoring/new-relic-mobile-ios/ios-sdk-api/recordcustomevent-ios-sdk-api">iOS</a> are deprecated.</p>
  <p>The deprecated <code>recordEvent</code> events do not have their own event type; they are recorded as a <code>Mobile</code> event type with a <code>category</code> attribute value of <code>custom</code>. <code>recordCustomEvent</code> creates an event with an <code>eventType</code> you can assign. But the <code>eventType</code> should only be used for one or two high-level event types, not for naming events. For example, you might have one event type <code>Gestures</code>, with many different names under that one type. For more context on this, see the <a href="#record-purchase">recordCustomEvent query example</a>.</p>
</div>
<h2>Mobile event and attribute query examples [#examples]</h2>
<p>Here are some examples of using <a href="/docs/query-data/nrql-new-relic-query-language/getting-started/introduction-nrql">NRQL</a> to query your mobile app events and attributes:</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoicmVjb3JkLXB1cmNoYXNlIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJDdXN0b20gZXZlbnQgZXhhbXBsZTogVHJhY2sgcHVyY2hhc2VzIn1d">
    <div data-prop-text="title">Custom event example: Track purchases</div>
    <p>To track purchases in your app, use <code>recordCustomEvent</code> to create an event type (such as "UserAction") and associate attributes such as "name" (with value "Purchase"), price, quantity, and SKU.</p>
    <div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJ0aXAifV0=">
      <p>For performance reasons, you should limit the total number of event types to maybe one or two. The <code>recordCustomEvent</code> parameter <code>eventType</code> is meant to be used for high-level categories. For example, you might create an event type<code>Gestures</code>, and then create many different custom event names under the <code>Gesture</code> event type.</p>
    </div>
    <p><strong>Create an event on iOS:</strong></p>
    <pre><code>BOOL purchaseRecorded = [NewRelic recordCustomEvent:@"UserAction" attributes:@{@"name": @"Purchase", @"sku": @"12345LPD", @"quantity": @1, @"unitPrice": @99.99, @"total": @99.99}];

</code></pre>
    <pre><code>
SELECT * from UserAction where name = 'Purchase' since 1 day ago

</code></pre>Replace them with the query format used with `recordCustomEvent`:
    <pre><code>
SELECT * from Mobile where category = 'Custom' and name = 'Purchase' since 1 day ago

</code></pre>**Replace deprecated `recordEvent` method:**
    As of [Android agent version 5.12.0](/docs/release-notes/mobile-release-notes/android-release-notes) and [iOS agent version 5.12.0](/docs/release-notes/mobile-release-notes/ios-release-notes), use the `recordCustomEvent` method to create these custom events. If you have replaced the deprecated `recordEvent` method for your custom events, be sure to also replace its corresponding NRQL query with the new format.
    Look for queries used with `recordEvent` method, such as this:
    <pre><code>
SELECT * from UserAction where name = 'Purchase' since 1 day ago

</code></pre>New Relic reports a custom event of type `UserAction` and name `Purchase`, which allows you to query all purchases made in your app in the last day:
    <pre><code>
Map&#x3C;String, Object> userActionAttributes = new HashMap&#x3C;String, Object>();

userActionAttributes.put("name", "Purchase"); 

userActionAttributes.put("sku", "12345LPD");

userActionAttributes.put("quantity", 1);

userActionAttributes.put("unitPrice", 99.99);

userActionAttributes.put("total", 99.99);

boolean userActionRecorded = NewRelic.recordCustomEvent("UserAction", userActionAttributes);

</code></pre>**Create an event on Android:**
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoidHJhY2stdXNlciJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiQXR0cmlidXRlIGV4YW1wbGU6IFRyYWNrIGEgc3BlY2lmaWMgdXNlciJ9XQ==">
    <div data-prop-text="title">Attribute example: Track a specific user</div>
    <p>You can create a custom attribute to track a custom user identifier across the session, and then query for all that user's interactions. To add an attribute for the <code>userId</code>, call the <code>setUserId</code> method:</p>
    <p><strong>Set the userId on iOS:</strong></p>
    <pre><code>BOOL userIdWasSet = [NewRelic setUserId:@"jsmith"];

</code></pre>
    <pre><code>
SELECT * from Mobile WHERE userId = 'jsmith' since 1 day ago

</code></pre>With this attribute, you can use a [`WHERE`](/docs/insights/new-relic-insights/using-new-relic-query-language/nrql-reference#sel-where) clause to see all actions performed by that `username` in the last day:
    <pre><code>
boolean userIdWasSet = NewRelic.setUserId("jsmith");

</code></pre>**Set the userId on Android:**
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoidHJhY2stc3RvcmUifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IkF0dHJpYnV0ZSBleGFtcGxlOiBUcmFjayBhIHNwZWNpZmljIHN0b3JlIGlkIn1d">
    <div data-prop-text="title">Attribute example: Track a specific store id</div>
    <p>You can create a custom attribute to track a store id across the session, and then query for all that store's interactions. To add an attribute for the <code>storeId</code>, call the <code>setAttribute</code> method:</p>
    <p><strong>Set the storeId on iOS:</strong></p>
    <pre><code>BOOL attributeSet = [NewRelic setAttribute:@"storeId" value:@"NY0531"];

</code></pre>
    <pre><code>
SELECT * from Mobile WHERE storeId = 'NY0531' since 1 day ago

</code></pre>With this attribute, you can use a [`WHERE`](/docs/insights/new-relic-insights/using-new-relic-query-language/nrql-reference#sel-where) clause to see all actions performed by that `storeId` in the last day:
    <pre><code>
boolean attributeSet = NewRelic.setAttribute("storeId", "NY0531");

</code></pre>**Set the storeId on Android:**
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoidHJhY2stYWN0aW9ucyJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiQ3VzdG9tIGF0dHJpYnV0ZSBleGFtcGxlOiBUcmFjayBhIHNwZWNpZmljIGFjdGlvbiJ9XQ==">
    <div data-prop-text="title">Custom attribute example: Track a specific action</div>
    <p>You can use custom attributes to track the number of times that a specific action occurs in your application. For example, you can track the number of times a button was clicked or the number of times a level was completed in a game.</p>
    <p>To track completing a game level, call <code>incrementAttribute</code> with no value specified. This creates an attribute with a default value of <code>1</code>:</p>
    <p><strong>Create a counter on iOS:</strong></p>
    <pre><code>BOOL levelIncremented = [NewRelic incrementAttribute@"level"];

</code></pre>
    <pre><code>
SELECT max(level) from Mobile where username = 'jsmith'

</code></pre>When querying, use this `level` attribute to filter your data. For example, if you have a `username` and `level` attribute, use the [`max()`](/docs/insights/new-relic-insights/using-new-relic-query-language/nrql-reference#func-max) function to find the highest level the user had reached:
    <pre><code>
levelReset = NewRelic.setAttribute("level", 1);

</code></pre>**Reset a counter on Android:**
    <pre><code>
levelReset = [NewRelic setAttribute:@"level" value:@1];

</code></pre>&#x3C;Callout variant="important">
    Be sure to reset the value to 0 when starting over.
    &#x3C;/Callout>
    To reset the level back to `1` or `0`, call `setAttribute`:
    **Reset a counter on iOS:**
    <pre><code>
levelIncremented = NewRelic.incrementAttribute("level");

</code></pre>**Increment a counter on Android:**
    <pre><code>
levelIncremented = [NewRelic incrementAttribute@"level"];

</code></pre>Each subsequent call to `incrementAttribute` adds 1 to the attribute `level`:
    **Increment a counter on iOS:**
    <pre><code>
boolean levelIncremented = NewRelic.incrementAttribute("level");

</code></pre>**Create a counter on Android:**
  </div>
</div>
<h2>Size limits and restricted characters [#limits]</h2>
<p>Limits for <a href="#event-definition">custom attributes added to default Mobile events</a>:</p>
<ul>
  <li>Attributes: 128 maximum</li>
  <li>String attributes: 4 KB maximum length (empty string values are not accepted)</li>
</ul>
<p>Limits for custom events:</p>
<ul>
  <li>Attributes: 254 maximum per event (number includes default <a href="/docs/insights/insights-data-sources/default-data/mobile-default-event-attributes-insights#session-list">session attributes</a>)</li>
  <li>String attributes: 4 KB maximum length (empty string values are not accepted)</li>
</ul>
<p>Naming syntax and rules: See <a href="/docs/insights/insights-data-sources/custom-data/data-requirements#general">Rules for custom data</a>.</p>
<h2>Set the time to send data [#data-timing]</h2>
<p>By default, New Relic transmits event data in any of these situations:</p>
<ul>
  <li>A session has been ongoing for 600 seconds.</li>
  <li>The app session ends by backgrounding.</li>
  <li>The app crashes.</li>
</ul>
<p>If the app crashes, New Relic gathers the attributes and events for that session and sends them to Insights. (On iOS, this happens the next time the app is launched). You can then use Insights to query and analyze the event and attribute data.</p>
<p>To set the maximum time (in seconds) that the agent will store events in memory, use the following SDK calls:</p>
<ul>
  <li>
    <p><a href="/docs/mobile-monitoring/new-relic-mobile-ios/ios-sdk-api/setmaxeventbuffertime-ios-sdk-api"><strong>iOS method:</strong></a></p>
    <pre><code>+ (void) setMaxEventBufferTime:(unsigned int)seconds;
</code></pre>
  </li>
  <li>
    <p><a href="/docs/mobile-monitoring/new-relic-mobile-android/android-sdk-api/setmaxeventbuffertime-android-agent-api"><strong>Android method</strong>:</a></p>
    <pre><code>public static void setMaxEventBufferTime(int maxBufferTimeInSec);
</code></pre>
  </li>
</ul>
<h2>Privacy considerations [#data-privacy]</h2>
<p>Should you want to collect personal data via custom attributes, please consult with your privacy or legal teams with regards to your notice and consent regulatory obligations.</p>
