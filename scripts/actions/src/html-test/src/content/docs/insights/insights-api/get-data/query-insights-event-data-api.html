
<p>The New Relic Insights query API is a REST API for querying your Insights <a href="/docs/data-analysis/metrics/analyze-your-metrics/data-collection-metric-timeslice-event-data">event data</a>. After you supply a standard NRQL query via HTTPS request, the query API returns a JSON response for parsing.</p>
<p>To add custom events to Insights, use the <a href="/docs/insights/explore-data/custom-events/insert-custom-events-insights-api">Insights insert API</a>.</p>
<p>For all available New Relic APIs, see <a href="/docs/apis/getting-started/introduction-new-relic-apis">Intro to APIs</a>.</p>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJ0aXAifV0=">
  <p>If your account hosts data in the EU data center, ensure you are using the proper <a href="/docs/using-new-relic/welcome-new-relic/getting-started/introduction-eu-region-data-center#endpoints">API endpoints for EU region accounts</a>.</p>
</div>
<h2>1. Register an API key [#register]</h2>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJ0aXAifV0=">
  <p><strong>Owner, Admins, or <a href="/docs/accounts-partnerships/accounts/account-setup/add-roles-permissions">add-on managers</a></strong></p>
</div>
<p>To use the Insights query API, you need a query key. You can have multiple query keys, and any query key can be used to initiate any Insights API query. If you have multiple systems querying Insights or different data destinations, New Relic recommends you use multiple query keys to enhance data security.</p>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJ0aXAifV0=">
  <p>For security reasons, query keys cannot be altered or read using the API. To change or read a query key, use the New Relic UI.</p>
</div>
<p>To create a new query key:</p>
<ol>
  <li>Go to <strong><a href="https://insights.newrelic.com">insights.newrelic.com</a> > Manage data > API keys</strong>.</li>
  <li>Select the plus icon next to the <strong>Query keys</strong> heading.</li>
  <li>Enter a short description of the key.</li>
  <li>Select <strong>Save your notes</strong>.</li>
</ol>
<h2>2. Create the API query request [#create-request]</h2>
<p>When you <a href="#register">create or edit a query key</a>, you will see an example curl query that you can use as a template. The example query won't work unless you follow these query rules:</p>
<ul>
  <li>The <a href="/docs/insights/nrql-new-relic-query-language/using-nrql/introduction-nrql">NRQL query string</a> must be <a href="http://www.w3schools.com/tags/ref_urlencode.asp">URL-encoded</a>.</li>
  <li>The query string must be less than 4000 bytes.</li>
  <li>The URL must contain a valid account ID.</li>
  <li>The <code>X-Query-Key</code> must contain a valid <a href="#register">query key</a>.</li>
  <li>The <code>Content-Type</code> must be <code>application/json</code>.</li>
</ul>
<h3>Linux [#unix]</h3>
<p>Here is a curl example:</p>
<pre><code>curl -H "Accept: application/json" -H "X-Query-Key: YOUR_QUERY_KEY" "https://insights-api.newrelic.com/v1/accounts/YOUR_ACCOUNT_ID/query?nrql=YOUR_URL_ENCODED_QUERY"
</code></pre>
<h3>Microsoft Windows [#windows]</h3>
<p>You can use <strong>Powershell</strong> to query events via API:</p>
<pre><code>Invoke-WebRequest -Uri https://insights-api.newrelic.com/v1/accounts/YOUR_ACCOUNT_ID/query?nrql=YOUR_URL_ENCODED_QUERY -Headers @{"X-Query-Key"="YOUR_QUERY_KEY"} -ContentType "application/json" -Method GET
</code></pre>
<h2>3. Process the returned JSON [#process-result]</h2>
<p>The query API returns results in JSON format. There is a limit of 2,000 results per request.</p>
<p>The structure of the JSON data depends on the NRQL that you used in the request: Different combinations of <code>SELECT</code> statements, clauses, and functions each return an appropriate response. When writing your code to process the JSON, you should do a test run of your query and examine the resulting JSON.</p>
<h2>Example</h2>
<p>The Insights query API returns JSON data. Here's an example of an Insights query, its query request format, and its returned data:</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiUXVlcnksIHF1ZXJ5IEFQSSByZXF1ZXN0LCByZXR1cm5lZCBkYXRhIn1d">
    <div data-prop-text="title">Query, query API request, returned data</div>
    <p><strong>Original NRQL query:</strong></p>
    <pre><code>SELECT count(appName) FROM PageView SINCE '2014-08-04 00:00:00+0500'

</code></pre>
    <pre><code>
{
  "results": [
    {
      "count": 80275388
    }
  ],
  "metadata": {
    "eventTypes": [
      "PageView"
    ],
    "eventType": "PageView",
    "openEnded": true,
    "beginTime": "2014-08-03T19:00:00Z",
    "endTime": "2017-01-18T23:18:41Z",
    "beginTimeMillis=": 1407092400000,
    "endTimeMillis": 1484781521198,
    "rawSince": "'2014-08-04 00:00:00+0500'",
    "rawUntil": "`now`",
    "rawCompareWith": "",
    "clippedTimeWindows": {
      "Browser": {
        "beginTimeMillis": 1483571921198,
        "endTimeMillis": 1484781521198,
        "retentionMillis": 1209600000
      }
    },
    "messages": [],
    "contents": [
      {
        "function": "count",
        "attribute": "appName",
        "simple": true
      }
    ]
  }
}

</code></pre>**Returned JSON data:**
    <pre><code>
curl -H "Accept: application/json" -H "X-Query-Key: YOUR_QUERY_KEY" "https://insights-api.newrelic.com/v1/accounts/YOUR_ACCOUNT_ID/query?nrql=SELECT+count%28appName%29+FROM+PageView+SINCE+%272014-08-04+00%3A00%3A00%2B0500%27"

</code></pre>**Query cURL request (with URL-encoded NRQL query)**:
  </div>
</div>
<h2>Rate limiting guidelines [#rate-limiting]</h2>
<p>New Relic Insights employs rate limiting to ensure a high level of availability and reliability for all users. The amount of requests you can healthily execute depends on the type of query. A query to Insights occurs anytime an event-driven query is executed; for example:</p>
<ul>
  <li>Event charts rendered on an existing dashboard</li>
  <li>Charts rendered through the NRQL query bar</li>
  <li>Insights Query API</li>
</ul>
<p>Most users rarely encounter rate limiting, especially if you follow these general guidelines:</p>
<ul>
  <li>Limit the amount of requests with complex queries (for example, queries with <code>FACET</code> or <code>TIMESERIES</code> clauses, or queries of over a million events) run at the same time.</li>
  <li>Limit the amount of requests run concurrently over extended periods of time to a maximum of 5, especially if they include complex queries.</li>
</ul>
<p>If New Relic applies <a href="/docs/insights/use-insights-ui/manage-account-data/rate-limits-insights">rate limits on your account</a>, the query API returns a 503 error. Dashboard charts in the New Relic UI also may display timeout error messages.</p>
