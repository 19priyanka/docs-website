
<p>New Relic Infrastructure <a href="/docs/integrations/host-integrations/getting-started/introduction-host-integrations">on-host integrations</a> can use one of two types of <a href="/docs/integrations/integrations-sdk/file-specifications/config-file-overview">configuration formats</a>.</p>
<p>In December 2019, <a href="https://docs.newrelic.com/docs/release-notes/infrastructure-release-notes/infrastructure-agent-release-notes">Infrastructure agent version 1.8.0</a> began supporting a newer configuration format that makes use of a single configuration file (instead of two separate files), and provides other improvements. This document will explain how this newer format works.</p>
<p>The older <a href="/docs/integrations/host-integrations/configuration/host-integrations-standard-configuration-specs">standard configuration format</a> is supported by current Infrastructure agents.</p>
<p>For an introduction to configuration, see <a href="/docs/integrations/integrations-sdk/file-specifications/config-file-overview">Config overview</a>.</p>
<h2>Configuration structure [#configuration-basics]</h2>
<p>An on-host integration's configuration YAML must have an <code>integrations</code> top-level section containing a YAML array, where each entry represents an integration and its configuration.</p>
<p>For each integration entry, only the <code>name</code> property is mandatory. The other properties are optional.</p>
<p>Here's an example configuration featuring two integrations: our built-in <a href="https://github.com/newrelic/nri-docker">Docker integration</a>, which requires no configuration, and our <a href="/docs/integrations/host-integrations/host-integrations-list/mysql-monitoring-integration">MySQL integration</a>:</p>
<pre><code>integrations:
  # New Relic integration that does not require any configuration
  - name: nri-docker
  # New Relic integration that gets its configuration from the environment
  - name: nri-mysql
    env:
      PORT: 3306
      USERNAME: newrelic
      PASSWORD: 123456789 # to hide this field, read the secrets management documentation
  # Any free-form integration executed via a user-provided command
  - name: my-own-integration
    exec: python /opt/integrations/my-script.py --host=127.0.0.1
</code></pre>
<p>You can have as many configuration YAML files as you want and can group your integration instances.</p>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJ0aXAifV0=">
  <p>We recommend <a href="http://www.yamllint.com/">linting</a> the YAML configuration files before using them to avoid formatting issues.</p>
</div>
<p>Each configuration YAML file can also contain <a href="https://docs.newrelic.com/docs/integrations/host-integrations/installation/container-auto-discovery"><code>discovery</code></a> and <a href="https://docs.newrelic.com/docs/integrations/host-integrations/installation/secrets-management"><code>variables</code></a> top-level sections.</p>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
  <p>This configuration format does not require an agent restart. When saved, changes are detected and implemented immediately. This means that saving intermediate configuration changes may cause the integration to stop working.</p>
</div>
<h2>List of configuration properties [#options-list]</h2>
<p>This is a list of the general properties used to configure an integration. For more details about using these properties, including example values, see the documentation following the table.</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>Config</p>
      </div>
      <div>
        <p>Description</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p><a href="#name"><code>name</code></a></p>
      </div>
      <div>
        <p>Name of the integration. This is the only mandatory configuration property across all on-host integrations. If the <code>exec</code> field is not set it will also be the name of the integration executable.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>cli_args</code></p>
      </div>
      <div>
        <p>Optional list of command line arguments when <code>name</code> is used to provide the integration executable.<br><em>Available since agent version <strong>1.13.0</strong>.</em></p>
      </div>
    </div>
    <div>
      <div>
        <p><a href="#exec"><code>exec</code></a></p>
      </div>
      <div>
        <p>Full path to the integration executable, plus arguments. It may be a single-line string or a string array. If left unspecified, the <code>exec</code> field defaults to the <code>name</code> field.</p>
      </div>
    </div>
    <div>
      <div>
        <p><a href="#env"><code>env</code></a></p>
      </div>
      <div>
        <p>YAML map containing the environment variables to be passed to the integration, where <code>key</code> is the environment variable name, and <code>value</code> is the variable value.</p>
      </div>
    </div>
    <div>
      <div>
        <p><a href="#config"><code>config</code></a></p>
      </div>
      <div>
        <p>Configuration that is written as an external file and the path that is passed to the integration with the <code>CONFIG_PATH</code> environment variable or the <code>${config.path}</code> variable placeholder.</p>
      </div>
    </div>
    <div>
      <div>
        <p><a href="#config_template_path"><code>config_template_path</code></a></p>
      </div>
      <div>
        <p>Any external file whose path is passed to the integration with the <code>CONFIG_PATH</code> environment variable or the <code>${config.path}</code> variable placeholder. Its usage allows applying discovery and secrets binding to any external configuration.</p>
      </div>
    </div>
    <div>
      <div>
        <p><a href="#integration_user"><code>integration_user</code></a></p>
      </div>
      <div>
        <p>Name of the user who runs the integration.</p>
      </div>
    </div>
    <div>
      <div>
        <p><a href="#interval"><code>interval</code></a></p>
      </div>
      <div>
        <p>Time between consecutive executions of the integration. It must be a number followed by a time unit (<code>s</code>, <code>m</code> or <code>h</code>), without spaces.</p>
      </div>
    </div>
    <div>
      <div>
        <p><a href="#inventory_source"><code>inventory_source</code></a></p>
      </div>
      <div>
        <p>Allows overriding the category and term of the inventory source.</p>
      </div>
    </div>
    <div>
      <div>
        <p><a href="#labels"><code>labels</code></a></p>
      </div>
      <div>
        <p>Map with labels that decorate the data (metrics, events, inventory) reported by the integration.</p>
      </div>
    </div>
    <div>
      <div>
        <p><a href="#timeout"><code>timeout</code></a></p>
      </div>
      <div>
        <p>A number followed by a time unit (<code>ms</code>, <code>s</code>, <code>m</code> or <code>h</code>). An integration that hasn't responded in this time period is killed and restarted.</p>
      </div>
    </div>
    <div>
      <div>
        <p><a href="#working_dir"><code>working_dir</code></a></p>
      </div>
      <div>
        <p>Working directory for the integration binary.</p>
      </div>
    </div>
  </div>
</div>
<p>The remainder of this document describes config properties grouped by their functionality:</p>
<ul>
  <li><a href="#select-integration">Select an integration to run</a></li>
  <li><a href="#pass-configuration">Pass configuration to the integration command</a></li>
  <li><a href="#configure-agent-execution">Configure how the agent executes integrations</a></li>
</ul>
<h2>Select an integration to run</h2>
<p>There are two properties to select which integration will run: <code>name</code> and <code>exec</code>.</p>
<p>The only mandatory property across all on-host integrations is <code>name</code>. The remaining properties specified in this document are optional.</p>
<p>Example:</p>
<pre><code>integrations:
  - name: nri-docker
  - name: my-integration
    exec: /usr/local/bin/my-integration --metrics --inventory
</code></pre>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoibmFtZSJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjp7InR5cGUiOiJtZHhWYWx1ZUV4cHJlc3Npb24iLCJ2YWx1ZSI6IjxJbmxpbmVDb2RlPm5hbWU8L0lubGluZUNvZGU+IiwicG9zaXRpb24iOnsic3RhcnQiOnsibGluZSI6MjIyLCJjb2x1bW4iOjExLCJvZmZzZXQiOjc0NDZ9LCJlbmQiOnsibGluZSI6MjIyLCJjb2x1bW4iOjQyLCJvZmZzZXQiOjc0Nzd9fX19XQ==">
    <div data-prop-text="title">[object Object]</div>
    <p>The mandatory <code>name</code> property can work in two ways:</p>
    <ul>
      <li>
        <p><strong>If the <code>exec</code> property is set</strong>: The <code>name</code> property only provides an identifier for the integration instance. This identifier is used in log messages and to provide a default <a href="https://docs.newrelic.com/docs/infrastructure/infrastructure-ui-pages/infra-ui-pages/infrastructure-inventory-page-search-your-entire-infrastructure">inventory category/source</a> in the form <code>integration/&#x3C;name></code> (for example, <code>integration/nri-redis</code>). This inventory path can be overridden with the <code>inventory_source</code> configuration option.</p>
      </li>
      <li>
        <p><strong>If the <code>exec</code> property is not set</strong>: The agent looks for (and executes) an executable with the <code>name</code> value in any of the following folders:</p>
        <ul>
          <li>Linux:
            <ul>
              <li><code>/var/db/newrelic-infra/newrelic-integrations/bin</code></li>
              <li><code>/var/db/newrelic-infra/newrelic-integrations</code></li>
              <li><code>/var/db/newrelic-infra/custom-integrations/bin</code></li>
              <li><code>/var/db/newrelic-infra/custom-integrations</code></li>
            </ul>
          </li>
          <li>Windows
            <ul>
              <li><code>C:\Program Files\New Relic\newrelic-infra\newrelic-integrations\bin</code></li>
              <li><code>C:\Program Files\New Relic\newrelic-infra\newrelic-integrations</code></li>
            </ul>
          </li>
        </ul>
        <p>If there is no executable with this name in the above folders the agent logs an error and the integration is not executed.</p>
        <div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
          <p>In Windows, do not append the <code>.exe</code> extension to the name. The agent does this for you (for example, <code>name: nri-mysql</code> would look for <code>nri-mysql.exe</code> in the above folders).</p>
        </div>
      </li>
    </ul>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZXhlYyJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjp7InR5cGUiOiJtZHhWYWx1ZUV4cHJlc3Npb24iLCJ2YWx1ZSI6IjxJbmxpbmVDb2RlPmV4ZWM8L0lubGluZUNvZGU+IiwicG9zaXRpb24iOnsic3RhcnQiOnsibGluZSI6MjQ3LCJjb2x1bW4iOjExLCJvZmZzZXQiOjkwNDJ9LCJlbmQiOnsibGluZSI6MjQ3LCJjb2x1bW4iOjQyLCJvZmZzZXQiOjkwNzN9fX19XQ==">
    <div data-prop-text="title">[object Object]</div>
    <p>The <code>exec</code> optional property specifies the path, command, and command-line arguments of the integration to execute. When none of the path folders or arguments have spaces, it can be written in a single-line string:</p>
    <pre><code>- name: my-integration
  exec: /usr/bin/python /opt/integrations/my-script.py --host=127.0.0.1

</code></pre>The default working directory is the root directory of the agent configuration. It can be overridden with the `working_dir` property.
    <pre><code>
- name: my-integration
  exec:
    - C:\Program Files\My Integration\integration.exe
    - --host
    - 127.0.0.1
    - --port
    - 8080

</code></pre>If any of the path/arguments have spaces that are part of a single element, you can use a YAML array notation:
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiY2xpLWFyZ3MifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6eyJ0eXBlIjoibWR4VmFsdWVFeHByZXNzaW9uIiwidmFsdWUiOiI8SW5saW5lQ29kZT5jbGlfYXJnczwvSW5saW5lQ29kZT4iLCJwb3NpdGlvbiI6eyJzdGFydCI6eyJsaW5lIjoyNzMsImNvbHVtbiI6MTEsIm9mZnNldCI6OTkxMn0sImVuZCI6eyJsaW5lIjoyNzMsImNvbHVtbiI6NDYsIm9mZnNldCI6OTk0N319fX1d">
    <div data-prop-text="title">[object Object]</div>
    <p>The <code>cli_args</code> optional property specifies command line arguments that should be passed to the integration. It is useful when using <code>name</code> as it only provides the integration name identifier (not compatible with <code>exec</code>).</p>
    <pre><code>- name: my-integration
  cli_args: [ -interval 10s ]

</code></pre>
    <pre><code>
- name: my-integration
  cli_args:
    - -interval
    - 10s

</code></pre>Usual YAML multi-line list format can be used as well:
  </div>
</div>
<h2>Pass configuration to the integration executable</h2>
<p>Often integration executables need to receive a configuration to work properly (for example, hostname and port of the monitored system, user credentials, etc.).</p>
<p>The Infrastructure agent allows you to configure the integration commands in three ways (which you can combine):</p>
<ul>
  <li>Command-line arguments, passed in the <a href="#exec"><code>exec</code> property</a>.</li>
  <li>Environment variables, using the <a href="#env"><code>env</code> property</a>.</li>
  <li>Configuration files, whose path needs to be passed through environment variables or command-line arguments (see the <a href="#config">config</a>) property.</li>
</ul>
<p>Example:</p>
<pre><code>integrations:
  - name: my-integration
    exec: /opt/path/bin/script --host 127.0.0.1 --port 8081
  - name: nri-mysql
    env:
      STATUS_URL: http://10.0.0.3/server-status?auto
      REMOTE_MONITORING: true
</code></pre>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZW52In0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOnsidHlwZSI6Im1keFZhbHVlRXhwcmVzc2lvbiIsInZhbHVlIjoiPElubGluZUNvZGU+ZW52PC9JbmxpbmVDb2RlPiIsInBvc2l0aW9uIjp7InN0YXJ0Ijp7ImxpbmUiOjMxOCwiY29sdW1uIjoxMSwib2Zmc2V0IjoxMTMyOH0sImVuZCI6eyJsaW5lIjozMTgsImNvbHVtbiI6NDEsIm9mZnNldCI6MTEzNTh9fX19XQ==">
    <div data-prop-text="title">[object Object]</div>
    <p>The <code>env</code> property allows you to set environment variables that are passed to the executable. It is a key-value map with the required variables.</p>
    <p>Example:</p>
    <pre><code>integrations:
  - name: nri-postgresql
    env:
      DATABASE: postgres
      PORT: 6432
      COLLECTION_LIST: '["postgres"]'
      COLLECT_DB_LOCK_METRICS: false
      VERBOSE: 1

</code></pre>If you expect your integration to receive the configuration from the host's environment rather than specifying it explicitly in the configuration file, you need to set the required variables in the Infrastructure agent [`passthrough_environment`](https://docs.newrelic.com/docs/integrations/host-integrations/troubleshooting/pass-infrastructure-agent-parameters-host-integration) global configuration property
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiY29uZmlnIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOnsidHlwZSI6Im1keFZhbHVlRXhwcmVzc2lvbiIsInZhbHVlIjoiPElubGluZUNvZGU+Y29uZmlnPC9JbmxpbmVDb2RlPiIsInBvc2l0aW9uIjp7InN0YXJ0Ijp7ImxpbmUiOjM0MCwiY29sdW1uIjoxMSwib2Zmc2V0IjoxMjIyN30sImVuZCI6eyJsaW5lIjozNDAsImNvbHVtbiI6NDQsIm9mZnNldCI6MTIyNjB9fX19XQ==">
    <div data-prop-text="title">[object Object]</div>
    <p>This section describes various ways to pass configuration information to an integration.</p>
    <p><strong>Pass configuration file directly</strong></p>
    <p>Some integration commands may get their configuration from an external file. If your integration requires a configuration file, nothing prevents you from directly passing its path directly as a command-line argument or an environment variable. Here's an example using configuration of our <a href="/docs/integrations/host-integrations/host-integrations-list/flex-integration-tool-build-your-own-integration">Flex integration</a>:</p>
    <pre><code>integrations:
  - name: nri-flex
    env:
      CONFIG_FILE: /etc/nri-flex/configs/http-service.yaml
  - name: other-integration
    exec: /opt/integration/integration -f /opt/integration/config.properties

</code></pre>After the `config` variable placeholders have been replaced and the temporary files have been created, the `/opt/foo/bin/monitor` executable is executed three times (one per matched container), replacing the `${config.path}` command-line placeholder with the temporary file corresponding to each discovered configuration:
    * First match: `/opt/foo/bin/monitor --config=/tmp/123_discovered`
    * Second match: `/opt/foo/bin/monitor --config=/tmp/456_discovered`
    * Third match: `/opt/foo/bin/monitor --config=/tmp/789_discovered`
    To ensure security and to minimize the chance of leaking secrets to disk, the agent:
    * Creates the files owned by the agent user, for example, `root` or `nri-agent`, depending on the user you have configured to run the agent.
    * Sets read permissions only for the owner.
    * Removes the created files when the integration instance finishes its execution.
    <pre><code>
  foo.host=10.0.0.3 
  foo.port=8082
  foo.user=monitorer
  foo.password=5up3r53cr3t!
  
</code></pre>* Third match (`/tmp/789_discovered`)
    <pre><code>
  foo.host=10.0.0.3 
  foo.port=8081
  foo.user=monitorer
  foo.password=5up3r53cr3t!
  
</code></pre>* Second match (`/tmp/456_discovered`):
    <pre><code>
  foo.host=10.0.0.3 
  foo.port=8080
  foo.user=monitorer
  foo.password=5up3r53cr3t!
  
</code></pre>At the moment of executing the `foo-monitor` integration, there are three running containers labeled with `service=foo`:
    1. ip: `10.0.0.3`, port: `8080`
    2. ip: `10.0.0.3`, port: `8081`
    3. ip: `10.0.0.3`, port: `8082`
    The agent then creates the following three temporary files, using the contents of the `config` property as a template, but replacing the `${placeholders}` by the acquired variables and discovered items (files' path is invented for the sake of simplicity):
    * First match (`/tmp/123_discovered`):
    <pre><code>
{"user":"monitorer","password":"5up3r53cr3t!"}

</code></pre>&#x3C;Callout variant="tip">
    (For more details about the `variables` and `discovery` sections, please visit the [discovery](https://docs.newrelic.com/docs/integrations/host-integrations/installation/container-auto-discovery) and [secrets management](https://docs.newrelic.com/docs/integrations/host-integrations/installation/secrets-management) documentation).
    &#x3C;/Callout>
    The above example relies on the following premises:
    * There is a [Vault](https://www.vaultproject.io/) service that allows retrieving a JSON object formed by the `user` and `password` fields.
    * There may be a variable number of Docker containers labeled with `service=foo`, which are accessible from the agent host via a discoverable public IP and Port.
    * The user has configured the `foo-monitor` integration to monitor all the `service=foo` labeled containers, which share a common user and password. Each instance of the `foo-monitor` integration requires executing the `/opt/foo/bin/monitor` executable, passing the text configuration inside the `config` section via the `--config=&#x3C;path>` command-line argument.
    As example of workflow, imagine that the Vault invocation returns the following JSON:
    <pre><code>
variables:
  my_credentials:
    vault:
      http:
        url: http://my.vault.host/v1/newengine/data/secret
        headers:
          X-Vault-Token: my-vault-token
discovery:
  docker:
    match:
      label.service: foo
integrations:
  - name: foo-monitor
    exec: /opt/foo/bin/monitor --config=${config.path}
    config: |
      foo.host=${discovery.ip} 
      foo.port=${discovery.port}
      foo.user=${my_credentials.user}
      foo.password=${my_credentials.password}

</code></pre>**Pass secrets and discovery through `config` section**
    The main benefit for using a `config` section instead of hardcoding the full path of an external file is that you can insert `${variable}` placeholders to apply our [auto-discovery feature](https://docs.newrelic.com/docs/integrations/host-integrations/installation/container-auto-discovery) and [secrets management](https://docs.newrelic.com/docs/integrations/host-integrations/installation/secrets-management).
    Here's an example followed by some explanations:
    <pre><code>
# assuming that nri-example command is prepared to receive the configuration
# file via the CONFIG_PATH environment variable
integrations:
  - name: nri-example
    config:
      name: csvFileExample
      apis: 
        - name: csvFile
          file: /Users/hello/test.csv

</code></pre>It replaces the `-f ${config.path}` command-line placeholder with the temporary path of the written file.
    By convention, if you do not place the `${config.path}` variable in any command-line argument or environment variable value, the agent passes the path of the configuration file via the `CONFIG_PATH` environment variable:
    <pre><code>
example.cfg.verbose=true
example.cfg.logger=/var/logs/integration.log
example.cfg.hostid=localhost
example.cfg.port=9025

</code></pre>The above YAML is only a configuration example for the `nri-flex` integration. The agent ignores its contents; instead, it creates a temporary file and replaces the `${config.path}` variable placeholder with its path. When the integration completes execution the temporary file is removed.
    Also, the agent creates another temporary file before executing the `other-integration` integration:
    <pre><code>
name: csvFileExample
apis: 
  - name: csvFile
    file: /Users/hello/test.csv

</code></pre>In the above examples, every time the `nri-flex` integration is executed, the agent creates a temporary file with the following contents:
    <pre><code>
integrations:
  - name: nri-flex
    env:
      CONFIG_FILE: ${config.path}
    config:
      name: csvFileExample
      apis: 
        - name: csvFile
          file: /Users/hello/test.csv
  - name: other-integration
    exec: /opt/integration/integration -f ${config.path}
    config: |
      example.cfg.verbose=true
      example.cfg.logger=/var/logs/integration.log
      example.cfg.hostname=localhost
      example.cfg.port=9025

</code></pre>The above example assumes that the `http-service.yaml` and `config.properties` files exist. We can see that the `nri-flex` integration is expecting the `http-service.yaml` complete path via the `CONFIG_FILE` environment variable and the `other-integration` expects the complete `config.properties` path after the `-f` command-line flag.
    In the above example, it's necessary for the integration installer/configurator that the configuration files exist in the provided path and that the agent and integrations have read permissions on them.
    **Pass configuration through `config` section**
    If you prefer to keep your configuration file with the rest of the integration configuration, you can use the `config` section in the integration entry, which can contain a valid YAML object or just a multi-line string:
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiY29uZmlnX3RlbXBsYXRlX3BhdGgifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6eyJ0eXBlIjoibWR4VmFsdWVFeHByZXNzaW9uIiwidmFsdWUiOiI8SW5saW5lQ29kZT5jb25maWdfdGVtcGxhdGVfcGF0aDwvSW5saW5lQ29kZT4iLCJwb3NpdGlvbiI6eyJzdGFydCI6eyJsaW5lIjo1MTIsImNvbHVtbiI6MTEsIm9mZnNldCI6MjAyNDV9LCJlbmQiOnsibGluZSI6NTEyLCJjb2x1bW4iOjU4LCJvZmZzZXQiOjIwMjkyfX19fV0=">
    <div data-prop-text="title">[object Object]</div>
    <p>If you want to use the secrets management and discovery in the configuration files that you're passing to the integration executable, but you prefer to keep them as an individual file, you can use the <code>config_template_path: &#x3C;path></code> option. It works exactly as in the <code>config</code> section:</p>
    <ol>
      <li>
        <p>The agent applies <a href="https://docs.newrelic.com/docs/integrations/host-integrations/installation/secrets-management">secrets management</a> and <a href="https://docs.newrelic.com/docs/integrations/host-integrations/installation/container-auto-discovery">discovery</a> to the file contents.</p>
      </li>
      <li>
        <p>The agent creates different temporary files that are passed to the integration via the <code>${config.path}</code> placeholder (or the <code>CONFIG_PATH</code> environment variable).</p>
        <p>Example:</p>
        <pre><code>discovery:
    docker:
      match:
        name: /^redis/ 
  integrations:
    - name: nri-flex
      env:
        CONFIG_FILE: ${config.path}
      config_template_path: /etc/flex-configs/redis.yml
</code></pre>
        <p>In the above example, the <code>redis.yml</code> external file can contain container discovery variable placeholders, like <code>${discovery.ip}</code> or <code>${discovery.port}</code>.</p>
      </li>
    </ol>
  </div>
</div>
<h2>Configure how the agent executes your integrations</h2>
<p>The properties of this section modify the way the Infrastructure agent executes and interacts with the integrations, or the way the agent decorates the integrations' data.</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiaW50ZWdyYXRpb25fdXNlciJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjp7InR5cGUiOiJtZHhWYWx1ZUV4cHJlc3Npb24iLCJ2YWx1ZSI6IjxJbmxpbmVDb2RlPmludGVncmF0aW9uX3VzZXI8L0lubGluZUNvZGU+IiwicG9zaXRpb24iOnsic3RhcnQiOnsibGluZSI6NTQ0LCJjb2x1bW4iOjExLCJvZmZzZXQiOjIxNzg5fSwiZW5kIjp7ImxpbmUiOjU0NCwiY29sdW1uIjo1NCwib2Zmc2V0IjoyMTgzMn19fX1d">
    <div data-prop-text="title">[object Object]</div>
    <p>The integration commands run as the same user as the agent (usually <code>root</code> or <code>nri-agent</code>). If due to permission restrictions an integration needs to run as another user, its name must be specified in the <code>integration_user</code> property.</p>
    <p>Example:</p>
    <pre><code>integrations:
  - name: dbus-inventory
    exec: python my-dbus-script.py
    integration_user: dbus

</code></pre>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiaW50ZXJ2YWwifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6eyJ0eXBlIjoibWR4VmFsdWVFeHByZXNzaW9uIiwidmFsdWUiOiI8SW5saW5lQ29kZT5pbnRlcnZhbDwvSW5saW5lQ29kZT4iLCJwb3NpdGlvbiI6eyJzdGFydCI6eyJsaW5lIjo1NjAsImNvbHVtbiI6MTEsIm9mZnNldCI6MjIyODB9LCJlbmQiOnsibGluZSI6NTYwLCJjb2x1bW4iOjQ2LCJvZmZzZXQiOjIyMzE1fX19fV0=">
    <div data-prop-text="title">[object Object]</div>
    <p>The <code>interval</code> option sets the time between consecutive executions of an integration. The accepted format is an integer immediately followed by a time unit (<code>s</code> for seconds, <code>m</code> for minutes, <code>h</code> for hours).</p>
    <p>The default is <code>30s</code>, and the minimum accepted value is <code>15s</code>. Any value lower than <code>15s</code> is automatically set to <code>15s</code>.</p>
    <p>Example:</p>
    <pre><code>integrations:
  - name: nri-nginx
    env:
      STATUS_URL: http://127.0.0.1/status
      STATUS_MODULE: discover
    interval: 20s

</code></pre>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiaW52ZW50b3J5X3NvdXJjZSJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjp7InR5cGUiOiJtZHhWYWx1ZUV4cHJlc3Npb24iLCJ2YWx1ZSI6IjxJbmxpbmVDb2RlPmludmVudG9yeV9zb3VyY2U8L0lubGluZUNvZGU+IiwicG9zaXRpb24iOnsic3RhcnQiOnsibGluZSI6NTgwLCJjb2x1bW4iOjExLCJvZmZzZXQiOjIyOTEwfSwiZW5kIjp7ImxpbmUiOjU4MCwiY29sdW1uIjo1NCwib2Zmc2V0IjoyMjk1M319fX1d">
    <div data-prop-text="title">[object Object]</div>
    <p>Any inventory item must be catalogued under a <code>category/source</code> taxonomy. By default, each integration inventory is stored as <code>integration/</code> + <code>name</code> value (for example, <code>integration/nri-apache</code>, <code>integration/nri-mysql</code>).</p>
    <p>The <code>inventory_source</code> property allows you to override the default taxonomy of inventory data.</p>
    <p>Example:</p>
    <pre><code>integrations:
  - name: nri-nginx
  - name: nri-apache
    exec:
      - /var/db/newrelic-infra/newrelic-integrations/bin/nri-apache
      - --inventory
    inventory_source: config/apache

</code></pre>In the above example, the `nri-nginx` inventory, if any, would be visible in the New Relic UI under the `integration/nri-nginx` source. The `nri-apache` inventory would be visible under `config/apache`.
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoibGFiZWxzIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOnsidHlwZSI6Im1keFZhbHVlRXhwcmVzc2lvbiIsInZhbHVlIjoiPElubGluZUNvZGU+bGFiZWxzPC9JbmxpbmVDb2RlPiIsInBvc2l0aW9uIjp7InN0YXJ0Ijp7ImxpbmUiOjYwMywiY29sdW1uIjoxMSwib2Zmc2V0IjoyMzc5NX0sImVuZCI6eyJsaW5lIjo2MDMsImNvbHVtbiI6NDQsIm9mZnNldCI6MjM4Mjh9fX19XQ==">
    <div data-prop-text="title">[object Object]</div>
    <p><code>labels</code> is a key-value map that allows extra metadata to be provided for the integration. The agent uses those labels to decorate the metrics, events, and inventory that it receives from a given integration instance.</p>
    <p>Example:</p>
    <pre><code>integrations:
  - name: nri-apache
    inventory_source: config/apache
    labels:
      env: production
      role: load_balancer

</code></pre>In the above example, the agent decorates all the metrics and events from the `nri-apache` instance with the following fields:
    * `label.env`: `production`
    * `label.role`: `load_balancer`
    Also, the following entries are added to the integration inventory:
    * `config/apache/labels/env`: `production`
    * `config/apache/labels/role`: `load_balancer`
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoidGltZW91dCJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjp7InR5cGUiOiJtZHhWYWx1ZUV4cHJlc3Npb24iLCJ2YWx1ZSI6IjxJbmxpbmVDb2RlPnRpbWVvdXQ8L0lubGluZUNvZGU+IiwicG9zaXRpb24iOnsic3RhcnQiOnsibGluZSI6NjMxLCJjb2x1bW4iOjExLCJvZmZzZXQiOjI0NjcwfSwiZW5kIjp7ImxpbmUiOjYzMSwiY29sdW1uIjo0NSwib2Zmc2V0IjoyNDcwNH19fX1d">
    <div data-prop-text="title">[object Object]</div>
    <p>If an integration has not returned any metric (or a heartbeat message as described below) before the time specified in the <code>timeout</code> value, the agent kills the integration process and restarts it after the corresponding <code>interval</code>. The accepted format is an integer number immediately followed (without spaces) by a time unit (<code>ms</code> for milliseconds, <code>s</code> for seconds, <code>m</code> for minutes, <code>h</code> for hours).</p>
    <p>If a zero (or negative) <code>timeout</code> value is provided, the integration can run forever without being killed by a timeout expiration.</p>
    <p>For long-running integrations (integrations that keep running, periodically returning metrics/events/inventory), each time the integration submits a metrics/events/inventory payload, the timeout deadline is restarted. That means that long-running integrations must return a valid JSON payload in an interval that is lower than <code>timeout</code>.</p>
    <p>Returning an empty JSON (<code>{}</code>) is interpreted as a <em>heart-beat</em> message that restarts the timeout, preventing the long-running integration from being killed, even if they don't have information to report.</p>
    <p>The default is <code>120s</code>, and the minimum accepted value is <code>100ms</code>. Any value lower than <code>100ms</code> is automatically set to <code>100ms</code>.</p>
    <p>Example:</p>
    <pre><code>integrations:
  - name: nri-jmx
    arguments:
      JMX_HOST: jmx-host.localnet
      JMX_PORT: 7096
      COLLECTION_FILES: "/etc/newrelic-infra/integrations.d/jvm-metrics.yml"
    timeout: 30s

</code></pre>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoid29ya2luZ19kaXIifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6eyJ0eXBlIjoibWR4VmFsdWVFeHByZXNzaW9uIiwidmFsdWUiOiI8SW5saW5lQ29kZT53b3JraW5nX2RpcjwvSW5saW5lQ29kZT4iLCJwb3NpdGlvbiI6eyJzdGFydCI6eyJsaW5lIjo2NTgsImNvbHVtbiI6MTEsIm9mZnNldCI6MjYyNTB9LCJlbmQiOnsibGluZSI6NjU4LCJjb2x1bW4iOjQ5LCJvZmZzZXQiOjI2Mjg4fX19fV0=">
    <div data-prop-text="title">[object Object]</div>
    <p><code>working_dir</code> sets the working directory of the command. If empty or unspecified, the agent runs the command in the Infrastructure agent's current directory.</p>
    <p>The default is the Infrastructure agent root directory.</p>
    <p>Example:</p>
    <pre><code>integrations:
  - name: my-integration
    exec: /opt/integration/bin/integration
    working_dir: /opt/integration/scratch-zone

</code></pre>
  </div>
</div>
<h2>Update older integration configuration [#update]</h2>
<p>In December 2019, the <a href="/docs/release-notes/infrastructure-release-notes/infrastructure-agent-release-notes">Infrastructure agent version 1.8.0</a> began using a different configuration format. For details, see <a href="#config-formats">Config format differences</a>.</p>
<p>The main difference between these formats is that the older configuration format uses two separate configuration files (a <code>INTEGRATION_NAME-definition.yml</code> file and a <code>INTEGRATION_NAME-config.yml</code> file) and the newer version uses a single configuration file.</p>
<p>Here are some of the features added by the newer configuration functionality:</p>
<ul>
  <li>Flexible configuration via command-line arguments, environment variables, or external files.</li>
  <li>Ability to group different integrations in the same file.</li>
  <li>Hot reload: adding a new integration or changing its configuration does not require restarting the agent.</li>
  <li>Timeouts: if an integration doesn't respond before a user-specified time, the integration process is killed and restarted.</li>
</ul>
<p>Not all on-host integrations come with the newer configuration format, but you can update the configuration to the new format for all on-host integrations to take advantage of the new features.</p>
<p>The following YAML shows an example <a href="/docs/integrations/host-integrations/host-integrations-list/apache-monitoring-integration">Apache integration</a> configuration using the older configuration format. Note that this configuration will still work with newer agents, but we recommend updating your integrations to take full advantage of features.</p>
<pre><code>integration_name: com.newrelic.apache

instances:
  - name: apache-server-metrics
    command: metrics
    arguments:
      status_url: http://127.0.0.1/server-status?auto
      remote_monitoring: true
    labels:
      env: production
      role: load_balancer
  - name: apache-server-inventory
    command: inventory
    arguments:
      remote_monitoring: true
    labels:
      env: production
      role: load_balancer
</code></pre>
<p>To update an older integration configuration to the new format, you must perform two steps:</p>
<ul>
  <li>Rename the <code>instances</code> top-level section to <code>integrations</code>.</li>
  <li>Remove the <code>integration_name</code> top-level section and add it to each integration entry. You are no longer required to keep a separate file for each integration type and you can group your legacy integration entries in the same file as other integrations.</li>
</ul>
<p>The new version of the Apache integration config:</p>
<pre><code>integrations:
  - name: apache-server-metrics
    integration_name: com.newrelic.apache
    command: metrics
    arguments:
      status_url: http://127.0.0.1/server-status?auto
      remote_monitoring: true
    labels:
      env: production
      role: load_balancer
  - name: apache-server-inventory
    integration_name: com.newrelic.apache
    command: inventory
    arguments:
      remote_monitoring: true
    labels:
      env: production
      role: load_balancer
</code></pre>
<p>Please note that because the older configuration format doesn't support hot reloading. You will need to restart the Infrastructure agent to remove the old integrations configuration (otherwise the old instances will coexist with the new ones).</p>
