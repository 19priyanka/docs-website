
<p>New Relic Infrastructure <a href="/docs/integrations/host-integrations/getting-started/introduction-host-integrations">on-host integrations</a> can use one of two types of <a href="/docs/integrations/integrations-sdk/file-specifications/config-file-overview">configuration formats</a>. This document explains the older, standard configuration format. This format is used by most on-host integrations and is supported by newer Infrastructure agents (which also support a <a href="/docs/integrations/host-integrations/configuration/host-integrations-newer-configuration-format">newer, improved configuration format</a>).</p>
<p>For an introduction to configuration, see <a href="/docs/integrations/integrations-sdk/file-specifications/config-file-overview">Config overview</a>.</p>
<h2>Configuration file structure [#structure]</h2>
<p>An on-host integration that uses the standard configuration format requires two configuration files:</p>
<ul>
  <li>A <a href="#definition-file">definition file</a></li>
  <li>A <a href="#config-file">configuration file</a></li>
</ul>
<h2>Definition file</h2>
<p>The definition file has a naming format like <code>INTEGRATION_NAME-definition.yml</code>. This file provides descriptive information about the integration, such as: the version of the JSON protocol it supports, a list of commands it can execute, and arguments that it accepts. It lives in this directory:</p>
<ul>
  <li>
    <p>Linux:</p>
    <pre><code>/var/db/newrelic-infra/newrelic-integrations
</code></pre>
  </li>
  <li>
    <p>Windows:</p>
    <pre><code>C:\Program Files\New Relic\newrelic-infra\newrelic-integrations
</code></pre>
  </li>
</ul>
<p>Here's an example of an NGINX integration definition file with two command sections on a Linux system:</p>
<pre><code>name: com.myorg.nginx
protocol_version: 2
description: Collect metric and configuration data from NGINX
os: linux
commands:
  metrics:
    command: 
      - myorg-nginx 
      - --metrics
    interval: 15
  inventory:
    command: 
      - myorg-nginx 
      - --inventory
    interval: 120
    prefix: integration/myorg-nginx
</code></pre>
<p>A definition file can be broken down into two parts:</p>
<ul>
  <li>The <a href="#def-header">header</a></li>
  <li>The <a href="#def-commands">commands section</a></li>
</ul>
<h3>Definition file header [#def-header]</h3>
<p>Here are explanations of a definition file's header elements:</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>Definition header field</p>
      </div>
      <div>
        <p>Description</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p><code>name</code></p>
      </div>
      <div>
        <p>Required. A unique name <code>name</code> to identify the integration for logging, internal metrics, etc. When the agent loads the config file, New Relic uses the <code>name</code> to look up the integration in the agent's registry.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>protocol_version</code></p>
      </div>
      <div>
        <p>Required. The version number of the protocol. New Relic uses this to ensure compatibility between the integration and the agent. If the agent does not recognize an integration's version, it will filter out that integration and create a log message.</p>
        <p>The current version of the JSON protocol is <code>2</code>. For more on protocol changes, see <a href="/docs/integrations/integrations-sdk/getting-started/compatibility-requirements-infrastructure-integrations-sdk#change-log">SDK changes</a>.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>description</code></p>
      </div>
      <div>
        <p>Optional. Human-friendly explanation of what the integration does.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>os</code></p>
      </div>
      <div>
        <p>Optional. The operating system where the integration runs. New Relic uses this to filter integrations that you intend to run only on specific operating systems.</p>
        <p>Default: Run the integration regardless of the <code>os</code> value.</p>
        <p>To restrict the integration to a specific operating system, use either of these options:</p>
        <ul>
          <li><code>linux</code></li>
          <li><code>windows</code></li>
        </ul>
      </div>
    </div>
  </div>
</div>
<h3>Definition file commands [#def-commands]</h3>
<p>After the header is a list of commands. The commands section defines:</p>
<ul>
  <li>One or more independent operating modes for the executable</li>
  <li>The runtime data required for it to be executed</li>
</ul>
<p>The commands section is a YAML map of command definitions, where each key is the unique alias name of the command in the integration's config file that specifies the executable to run.</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>Definition commands</p>
      </div>
      <div>
        <p>Description</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p><code>command</code></p>
      </div>
      <div>
        <p>Required. The actual command line to be executed as a YAML array of command parts. These are assembled to run the actual command. For simple commands, the array might be only a single element.</p>
        <p>Additional command rules include:</p>
        <ul>
          <li>
            <p><code>command</code> arguments: The command and any command line arguments that are shared for all instances of the integration configuration.</p>
          </li>
          <li>
            <p><code>command</code> execution: The command will be executed in the same directory as the definition file.</p>
          </li>
          <li>
            <p><code>command</code> path: Any commands available on the host's <code>$PATH</code> can be used. Executables located in the same directory as the definition file, or in a subdirectory of it, can be executed using a relative path. For example:</p>
            <ul>
              <li><strong>Linux:</strong> To run an executable called <code>myorg-nginx</code> in the same directory as the definition file, you could use <code>myorg-nginx</code> or <code>./myorg-nginx</code>. Linux systems will execute <code>myorg-nginx</code> as if the user used <code>./myorg-nginx</code>.</li>
              <li><strong>Windows:</strong> To run an executable called <code>myorg-nginx.exe</code> in the same directory as the definition file, you could use <code>\myorg-nginx.exe</code> or <code>.\myorg-nginx.exe</code>. Windows systems writing <code>myorg-nginx.exe</code> will be executed as if indicating the current path: <code>.\myorg-nginx.exe</code>.</li>
              <li>To use a command installed inside a directory on the host's <code>$PATH</code>, simply use the command name. Example: <code>python</code>.</li>
              <li>To run any other executable which is neither on the host's <code>$PATH</code> nor within the integration's directory, use an absolute path to the executable. Example: <code>/opt/jdk/bin/java</code>.</li>
            </ul>
            <p>If the given executable name exists within the integration's directory but also exists elsewhere on the system <code>$PATH</code>, the version in the integration's directory takes precedence.</p>
          </li>
        </ul>
      </div>
    </div>
    <div>
      <div>
        <p><code>interval</code></p>
      </div>
      <div>
        <p>Optional. The number of seconds between two consecutive executions of the command, in particular between the end of the previous execution and the start of the next execution.</p>
        <ul>
          <li>Default for metric polling: 30 seconds.</li>
          <li>Minimum (floor): 15 seconds.</li>
          <li>Alerts: For metrics being used for alerts, use an interval of 30 seconds or less.</li>
        </ul>
      </div>
    </div>
    <div>
      <div>
        <p><code>prefix</code></p>
      </div>
      <div>
        <p>Optional. The categorization of the inventory in the form of <code>category/short_integration_name</code>. Example: <code>integration/myorg-nginx</code>.</p>
        <p>The prefix is not a platform-specific path. The forward slash is the correct separator between the category and <code>short_integration_name</code>.</p>
        <p>The prefix can have a maximum of two levels. Otherwise inventory will not be reported.</p>
        <p>Default value if not set: <code>integration/integration_name</code>.</p>
      </div>
    </div>
  </div>
</div>
<h2>Configuration file [#config-file]</h2>
<p>The <a href="/docs/infrastructure/infrastructure-integrations/custom-integrations/create-integration-config-file">configuration file</a> has a naming format like <code>INTEGRATION_NAME-config.yml</code>. This file specifies which executables to run and the parameters required to run them. It lives in this directory:</p>
<ul>
  <li>
    <p>Linux:</p>
    <pre><code>/etc/newrelic-infra/integrations.d/
</code></pre>
  </li>
  <li>
    <p>Windows:</p>
    <pre><code>C:\Program Files\New Relic\newrelic-infra\integrations.d
</code></pre>
  </li>
</ul>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJ0aXAifV0=">
  <p>We recommend <a href="http://www.yamllint.com/">linting</a> the YAML configuration files before using them to avoid formatting issues.</p>
</div>
<p>Here's an example of a config file with one instance defined. Explanations of these fields are explained below the example.</p>
<pre><code>integration_name: com.myorg.nginx
instances:
  - name: nginx1.myorg.com-metrics
    command: metrics
    arguments:
      status_url: http://127.0.0.1/status
    labels: 
      environment: production
      role: load_balancer
</code></pre>
<p>Another example of a config file with two instances defined.</p>
<pre><code>integration_name: com.myorg.nginx
instances:
  - name: nginx1.myorg.com-metrics
    command: metrics
    arguments:
      status_url: http://one.url/status
    labels: 
      environment: production
      role: load_balancer
 - name: nginx2.myorg.com-metrics
   command: metrics
   arguments:
     status_url: http://another.url/status
   labels:
     environment: production
     role: load_balancer
</code></pre>
<h3>Config file field definitions [#config-fields]</h3>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>Config file field</p>
      </div>
      <div>
        <p>Description</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p><code>integration_name</code></p>
      </div>
      <div>
        <p>Required. This is the header and is used to identify which executables to run. This name must exactly match the name specified in the integration's <a href="#definition-file">definition file</a>.</p>
        <p><strong>Recommendation:</strong> To ensure unique names, use reverse domain name notation.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>name</code></p>
      </div>
      <div>
        <p>Required. This is the name for the specific invocation (instance) of the integration. This is used to help identify any log messages generated by this integration and is also useful for <a href="/docs/infrastructure/new-relic-infrastructure/troubleshooting/generate-logs-troubleshooting-infrastructure">troubleshooting</a>.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>command</code></p>
      </div>
      <div>
        <p>Required. This is the command to be executed. This must exactly match one of the unique alias names specified in the integration's <a href="/docs/infrastructure/integrations-sdk/file-specifications/integration-definition-file-specifications">definition file</a>.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>arguments</code></p>
      </div>
      <div>
        <p>Optional. A YAML object where:</p>
        <ul>
          <li>
            <p>Keys: The argument name. Transformed to upper case when set as environment variable.</p>
          </li>
          <li>
            <p>Values: The argument values. Passed through as is.</p>
            <p>The arguments are made available to an integration as a set of environment variables.</p>
            <p>Arguments in the config file cannot be capitalised and should use underscores to separate words.</p>
          </li>
        </ul>
      </div>
    </div>
    <div>
      <div>
        <p><code>labels</code></p>
      </div>
      <div>
        <p>Optional. A YAML object where:</p>
        <ul>
          <li>Keys: The label name.</li>
          <li>Values: The defined label value.</li>
        </ul>
      </div>
    </div>
    <div>
      <div>
        <p><code>integration_user</code></p>
      </div>
      <div>
        <p>Optional. String with the name the agent will use for executing the integration binary.</p>
        <p>Default: depends on the <code>usermode</code>. By default, integrations are executed with the same user that's running the integration agent, nri-agent for privileged and unprivileged mode and root user for root mode.</p>
        <p>When present, the Infrastructure agent will execute the integration binary as the specified user. For example, to run the integration binary as the root user when running the agent in a <code>usermode</code> different than <code>root</code>, just add <code>integration_user: root</code> to the configuration file.</p>
      </div>
    </div>
  </div>
</div>
