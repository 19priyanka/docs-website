
<p>Successfully scaling DevOps requires a robust understanding of dependencies across application teams and related services. Use <a href="https://docs.newrelic.com/docs/using-new-relic/service-maps/get-started/introduction-service-maps">New Relics service maps</a> to discover and mitigate risky dependencies from upstream and downstream services.</p>
<h2>Prerequisites</h2>
<p>This tutorial assumes you’ve completed the <a href="/docs/using-new-relic/welcome-new-relic/measure-devops-success/guide-measuring-devops-success">previous DevOps procedures</a>.</p>
<h2>1. Analyze dependencies with service maps</h2>
<p>Use <a href="/docs/using-new-relic/service-maps/get-started/introduction-service-maps">service maps</a> for each application and note any dependent systems and transactions.</p>
<p>New Relic recommends that you start by viewing the entire architecture using the <strong>Discover your environment</strong> option.</p>
<p>
  <img src="./images/service_maps_response_time.png" alt="service_maps_response_time.png" title="service_maps_response_time.png">
</p>
<p><strong><a href="https://rpm.newrelic.com/apm">rpm.newrelic.com/apm</a> > Service Maps > App/Service list</strong></p>
<p>This initial view shows all applications that are configured in your account. Applications that have violated a warning threshold are shown in yellow, and those with an active alert are shown in red. Healthy applications appear in green.</p>
<p>New Relic uses a bold line to map applications to the services (such as databases) they connect to. Familiarize yourself with these maps to see how applications and their services fit together. Take note of which applications have the most dependencies and which rely on the same dependency, such as an API.</p>
<p>Click an application to see high level metrics about that app, including throughput, response time, Apdex score, and error rate for the last 30 minutes. Tracking throughput is a good way to determine which of your applications are serving the most traffic.</p>
<p>After looking at the architecture as a whole, review the applications that have the most dependencies. Select the <strong>App/Services</strong> list to see a full list of your applications.</p>
<p>
  <img src="./images/APM-service-maps-connect.png" alt="APM-service-maps-connect.png" title="APM-service-maps-connect.png">
</p>
<p><strong><a href="https://rpm.newrelic.com/apm">rpm.newrelic.com/apm</a> > Service Maps > App/Service list</strong></p>
<p>In this example, we’ve chosen <strong>Tower-Chicago</strong> from the <strong>App/Services</strong> list. All of the traffic being sent to <strong>Tower-Chicago</strong> is coming from <strong>Proxy-East</strong>. In this case, <strong>Tower-Chicago</strong> is showing 48.3 requests per minute, or 11.3% of the 426 requests per minute flowing through <strong>Proxy-East</strong>.</p>
<p>
  <img src="./images/apm_service_maps_dependencies.png" alt="apm_service_maps_dependencies.png" title="apm_service_maps_dependencies.png">
</p>
<p><strong><a href="https://rpm.newrelic.com/apm">rpm.newrelic.com/apm</a> > Service Maps > App/Service list</strong></p>
<p>In most cases, the separate applications and services represented in service maps are created and maintained by separate teams. This exercise of walking through the dependencies of your architecture should involve representatives from each of those teams.</p>
<p>Teams should work together to ask questions such as:</p>
<ul>
  <li>How critical is this particular dependency?</li>
  <li>What would happen if it were to go down?</li>
  <li>What happened last time it went down?</li>
  <li>Was there a revenue loss?</li>
</ul>
<h2>2. Identify back-end application dependency risks</h2>
<p>Once you’ve analyzed your applications’ dependencies, you’ll want to examine the quality of dependency execution. For example, is the dependency stable and predictable for each application or transaction you’ve identified?</p>
<p>To do this, you’ll first need to gather as much information as you can about the applications from <a href="https://newrelic.com/solutions/real-time-analytics">New Relic Insights</a>, which helps you analyze data that is collected about the applications in more detail.</p>
<p>Here is an example <a href="https://docs.newrelic.com/docs/insights/nrql-new-relic-query-language/nrql-resources/nrql-syntax-components-functions">NRQL</a> query to further analyze back-end service performance:</p>
<pre><code>SELECT count(appName)/30 as 'Throughput', apdex(duration), average(duration), stddev(duration), max(duration), count(error_type), uniquecount(host) FROM Transaction FACET appName SINCE 30 MINUTES AGO
</code></pre>
<p>This query shows you each application’s request per minute (throughput), Apdex score, and an overview of how the application is performing overall (through the standard deviation calculation, in which lower numbers are generally better). It also shows errors for the time period and the number of hosts on which the application is running.</p>
<p>
  <img src="./images/apm_application_performance_chart.png" alt="apm_application_performance_chart.png" title="apm_application_performance_chart.png">
</p>
<p><strong><a href="https://insights.newrelic.com">insights.newrelic.com</a> > query results</strong></p>
<p>Next, gather information on incidents and events related to the services from <a href="https://docs.newrelic.com/docs/alerts">New Relic Alerts</a>:</p>
<ul>
  <li>
    <p>Click <strong>Alerts</strong> > <strong>Incidents</strong> > <strong>All Incidents</strong>.</p>
    <p>
      <img src="./images/Alerts-Incidents-catalyst.png" alt="Alerts-Incidents-catalyst.png" title="Alerts-Incidents-catalyst.png">
    </p>
    <p><strong><a href="https://alerts.newrelic.com">alerts.newrelic.com</a> > Incidents > All Incidents</strong></p>
  </li>
  <li>
    <p>Click <strong>Alerts</strong> > <strong>Events</strong> > <strong>All Events</strong>.</p>
    <p>
      <img src="./images/alerts-events-all-events.png" alt="alerts-events-all-events.png" title="alerts-events-all-events.png">
    </p>
    <p><strong><a href="https://alerts.newrelic.com">alerts.newrelic.com</a> > Incidents > All Events</strong></p>
  </li>
</ul>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJ0aXAifV0=">
  <p>Using webhooks to send alert events to <a href="https://newrelic.com/solutions/real-time-analytics">New Relic Insights</a>, allows you to supplement your dashboards with Alerts data. The process is outlined in <a href="https://discuss.newrelic.com/t/sending-alerts-data-to-insights/34693">this community discussion post</a>.</p>
</div>
<p>Here is a simplified example of the results of this exercise:</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>Application</p>
      </div>
      <div>
        <p>Number of dependencies</p>
      </div>
      <div>
        <p>RPM</p>
      </div>
      <div>
        <p>Hosts</p>
      </div>
      <div>
        <p>APDEX (avg)</p>
      </div>
      <div>
        <p>Last outage</p>
      </div>
      <div>
        <p>TTR (hrs)</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p>Routing Service</p>
      </div>
      <div>
        <p>10</p>
      </div>
      <div>
        <p>983</p>
      </div>
      <div>
        <p>4</p>
      </div>
      <div>
        <p>.93</p>
      </div>
      <div>
        <p>2/19/18</p>
      </div>
      <div>
        <p>.75</p>
      </div>
    </div>
    <div>
      <div>
        <p>Tower Austin</p>
      </div>
      <div>
        <p>1</p>
      </div>
      <div>
        <p>58</p>
      </div>
      <div>
        <p>1</p>
      </div>
      <div>
        <p>.95</p>
      </div>
      <div>
        <p>10/11/17</p>
      </div>
      <div>
        <p>1.5</p>
      </div>
    </div>
    <div>
      <div>
        <p>Proxy-East</p>
      </div>
      <div>
        <p>11</p>
      </div>
      <div>
        <p>498</p>
      </div>
      <div>
        <p>4</p>
      </div>
      <div>
        <p>.92</p>
      </div>
      <div>
        <p>1/4/18</p>
      </div>
      <div>
        <p>.25</p>
      </div>
    </div>
    <div>
      <div>
        <p>Proxy-West</p>
      </div>
      <div>
        <p>11</p>
      </div>
      <div>
        <p>495</p>
      </div>
      <div>
        <p>4</p>
      </div>
      <div>
        <p>.97</p>
      </div>
      <div>
        <p>12/3/17</p>
      </div>
      <div>
        <p>.25</p>
      </div>
    </div>
    <div>
      <div>
        <p>WebPortal</p>
      </div>
      <div>
        <p>7</p>
      </div>
      <div>
        <p>396</p>
      </div>
      <div>
        <p>8</p>
      </div>
      <div>
        <p>.98</p>
      </div>
      <div>
        <p>4/1/18</p>
      </div>
      <div>
        <p>2.5</p>
      </div>
    </div>
  </div>
</div>
<p>Supplement this data with the data that your teams know about your service and that you gathered from the dependency exercise in step 1, and use that data to develop hypotheses about the highest risk areas in your services that should be mitigated.</p>
<h2>3. Identify front-end dependency risk</h2>
<p>Once you’ve analyzed back-end dependencies, explore front-end dependencies. This is a critical step because as you walk higher up the stack and closer to the user, you will likely have more dependencies and abstractions.</p>
<p>Service maps seamlessly integrate data from <a href="https://docs.newrelic.com/docs/browser/new-relic-browser/getting-started/introduction-new-relic-browser">New Relic Browser</a> and <a href="https://docs.newrelic.com/docs/mobile-monitoring">New Relic Mobile</a> to help you understand the dependencies from front-end user interfaces to back-end services.</p>
<p>
  <img src="./images/apm-service-maps-browser-portal.png" alt="apm-service-maps-browser-portal.png" title="apm-service-maps-browser-portal.png">
</p>
<p><strong><a href="https://rpm.newrelic.com/apm">rpm.newrelic.com/apm</a> > Service Maps</strong></p>
<p>Use the service map view to drill into front-end dependencies, and execute a similar exercise to the one you executed for back-end dependencies. This exercise will again expose data to help you identify risk areas you should address and optimize. We recommend that you conduct the analysis with user interface (UI) teams so that you can also gather a complementary qualitative understanding of what the UI teams consider critical based on their experience. A ranking from the UI teams of the most critical dependency is a useful output of this work.</p>
<h2>4. Identify Microservice Dependencies</h2>
<p>If you are using microservices, you can have dozens, if not hundreds, of services that are calling each other. Use <strong>Distributed Tracing</strong> to see how all those services connect together and how your requests flow through those different services.</p>
<p>Distributed tracing lets you see the path that a request takes as it travels through a distributed system. A distributed trace is composed of multiple "spans," which represent time spent in services or resources of those services.</p>
<p>Click on the <strong>Distributed tracing menu</strong> in New Relic APM left nav. You can see “trace listing” view where you’ll be able to quickly identify slow traces and traces with errors. The scatter plot lets you easily see outliers. Below that are the trace summaries, click on a trace to see details. Dive into distributed traces to see how long each span takes. Click into each span to see historical performance charts and associated attributes that layer in the context you need to understand and troubleshoot issues.</p>
<p>
  <img src="./images/distributed-trace_0.png" alt="New Relic - devops - distributed trace" title="distributed-trace.png">
</p>
<p><strong><a href="https://one.newrelic.com">one.newrelic.com</a> > APM > (select an app) > Distributed tracing</strong></p>
<p>This rounds out your list of dependencies.</p>
<h2>5. Create an action plan for risk mitigation</h2>
<p>Once you’ve analyzed the dependencies across your application from both front-end and back-end services, create an action plan to reduce dependency risks and achieve your service level objectives (SLO).</p>
<p>As you prioritize these next steps, we recommend you keep these four principles in mind:</p>
<ol>
  <li><strong>Understand your risk tolerance.</strong> It’s helpful to have a clear picture of your tolerance for risk, which ideally should be informed by your service level objectives (refer to the <a href="/docs/establish-objectives-baselines">Establish Objectives and Baselines</a> tutorial for more information). Set an alert policy to monitor dependencies that you’ve determined have a high relationship to SLO achievement.</li>
  <li><strong>Minimize dependencies.</strong> The simpler you keep your code, the less functions you'll have referring to other modules. Removing unnecessary complexity is an important way to ensure you have a maintainable system that meets your customers’ expectations.</li>
  <li><strong>Localize dependencies.</strong> For the code you write, package together functions that depend on each other whenever possible.</li>
  <li><strong>Stabilize dependencies.</strong> When dependencies are unavoidable, mitigate risks by ensuring these dependencies point to modules that are the least likely to change or are easier to substitute.</li>
</ol>
<p>When your action plan is complete, monitor the results of the efforts. The efficacy of your actions to resolve dependency risks should ultimately be measured by your SLOs</p>
