
<p>You can use <a href="/docs/browser/new-relic-browser/getting-started/introduction-new-relic-browser">Browser monitoring</a> with APM for Java to measure end-user load times. This document explains best practices for setting up Browser monitoring. For information on how to set up Browser monitoring for your Java app, see <a href="/docs/agents/java-agent/instrumentation/page-load-timing-java">Browser monitoring and the Java agent</a>.</p>
<h2>Ensure you are using the Apache Jasper compiler. [#jasper]</h2>
<p>The New Relic Java agent only auto-instruments pages compiled with the Apache Jasper compiler. The following application servers use the Jasper compiler by default:</p>
<ul>
  <li>Tomcat</li>
  <li>Jetty</li>
  <li>Glassfish</li>
  <li>JBoss 4</li>
</ul>
<h2>Place meta tags immediately after the initial head tag. [#meta-tags]</h2>
<p><strong>Recommendation:</strong> Place all <code>&#x3C;meta></code> tags immediately after the initial <code>&#x3C;head></code> tag. Some meta tags have requirements on how close they need to be to the beginning of an HTML document. <a href="http://www.w3.org/TR/html-markup/syntax.html#character-encoding">The character encoding</a> must be declared within the first 512 bytes of the HTML document. If the New Relic header is placed before the character encoding, it is possible for the character encoding to then be outside that 512 byte limit. Placing the character encoding meta tag immediately after the <code>&#x3C;head></code> tag will ensure that the New Relic header is positioned after the character encoding.</p>
<pre><code>&#x3C;!DOCTYPE html>
&#x3C;html>
&#x3C;head>
&#x3C;meta charset="utf-8">
&#x3C;%= com.newrelic.api.agent.NewRelic.getBrowserTimingHeader() %>
 . . .
&#x3C;/head>
</code></pre>
<p>The <code>X-UA-Compatible</code> meta tag should be within the meta tags immediately after the <code>&#x3C;head></code> tag. This tag allows page authors to set the document mode used for rending the page in Internet Explorer. This tag should be placed before any script tags. If the New Relic header is positioned before the <code>X-UA-Compatible</code> meta tag, the page might display incorrectly in Internet Explorer.</p>
<pre><code>&#x3C;!DOCTYPE html>
&#x3C;html>
&#x3C;head>
&#x3C;meta http-equiv="X-UA-Compatible" content="IE=9">
&#x3C;%= com.newrelic.api.agent.NewRelic.getBrowserTimingHeader() %>
 . . .
&#x3C;/head>
</code></pre>
<h2>Avoid if ... else statements in the head section. [#if-else]</h2>
<p>The auto instrumentation script does not recognize <code>if ... else</code> statements within a JSP page. If you have an <code>if ... else</code> block before your first non-meta, non-title tag, the New Relic header might be placed in the incorrect position in the page. For example, this code could potentially cause the auto instrumentation script to be inserted before the meta tags:</p>
<pre><code>if (expression) {
  &#x3C;nonmeta tag>
}
&#x3C;meta tag>
&#x3C;meta tag>
</code></pre>
<h2>Avoid expressions with the less than sign in the head section. [#for-loops]</h2>
<p>The New Relic Java agent looks for the open angle bracket <code>&#x3C;</code> to mark the beginning of an HTML tag. This means if you have an expression using a less than sign, then you will either need to change your expression to use a greater than sign or use manual instrumentation. For example:</p>
<pre><code>&#x3C;head>
&#x3C;% for (i = 0; i &#x3C; variable; i++)
. . . 
%>
</code></pre>
