
<p>In the cloud, it's important to look regularly and closely at how your applications and services are architected and utilized. It's the best way to identify opportunities that will let you right-size your instances, fine tune your databases, modify your storage usage, better configure your load balancers, or even re-architect your applications.</p>
<p>For example, if you have a set of 20 instances all running at 10% CPU usage, you might consider using smaller instances or consolidating more work onto those instances. This kind of thinking about your cloud utilization and spend will help you optimize your environment and save money quickly.</p>
<p>Optimizing your cloud architecture has three main goals:</p>
<ol>
  <li>Improve performance, availability, and end-user experience by taking better advantage of cloud services</li>
  <li>Optimize your cloud spend, striking the delicate balance between cost and performance</li>
  <li>Capture business and technical metrics that help justify your current cloud spend that can be referenced as justification for a larger cloud budget as growth dictates</li>
</ol>
<p>In this tutorial, we'll show you how to use the New Relic platform to capture all the data you should leverage to optimize your cloud architecture and spend.</p>
<h2>1. Instrument your application and cloud environment [#instrument]</h2>
<p>Make sure the following products and integrations are instrumented:</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>Instrument</p>
      </div>
      <div>
        <p>Details</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p><a href="https://docs.newrelic.com/docs/infrastructure/new-relic-infrastructure/installation">Install Infrastructure</a></p>
      </div>
      <div>
        <p>Instrument infrastructure: If you haven't already done so, review the requirements for the <a href="https://docs.newrelic.com/docs/infrastructure">Infrastructure agent</a>. Infrastructure comes with several types of integrations, including <a href="https://docs.newrelic.com/docs/integrations/amazon-integrations/aws-integrations-list">Amazon Web Services (AWS)</a>, <a href="https://docs.newrelic.com/docs/integrations/microsoft-azure-integrations/azure-integrations-list">Microsoft Azure</a>, and <a href="https://docs.newrelic.com/docs/integrations/host-integrations/host-integrations-list">on-host integrations</a>. After you've installed the Infrastructure agent on your host(s), you'll immediately have access to the broad spectrum of metrics the agent collects out-of-the-box.</p>
      </div>
    </div>
    <div>
      <div>
        <p><a href="https://docs.newrelic.com/docs/agents/manage-apm-agents/installation/install-agent">Install the APM agent</a></p>
      </div>
      <div>
        <p>Instrument your applications with <a href="https://docs.newrelic.com/docs/apm">APM</a>. Doing so will let you monitor how your applications are performing while you are optimizing the underlying cloud services. That way, you can confirm that your changes to the infrastructure are in fact improving application performance.</p>
      </div>
    </div>
    <div>
      <div>
        <p><a href="https://docs.newrelic.com/docs/integrations/amazon-integrations/get-started/connect-aws-infrastructure">Configure the AWS integration</a></p>
      </div>
      <div>
        <p>New Relic Infrastructure's Amazon integrations let you monitor your AWS data in several New Relic products, including Infrastructure, dashboards, and New Relic Alerts.</p>
      </div>
    </div>
    <div>
      <div>
        <p><a href="https://docs.newrelic.com/docs/integrations/amazon-integrations/aws-integrations-list/aws-billing-monitoring-integration">Connect AWS Billing</a></p>
      </div>
      <div>
        <p>If you are hosted in an AWS environment, New Relic can help you monitor your cloud spend with our <a href="https://docs.aws.amazon.com/account-billing/index.html#lang/en_us">AWS Billing</a> integration. To leverage New Relic's AWS Billing integration, follow the procedures in the <a href="https://docs.newrelic.com/docs/integrations/amazon-integrations/aws-integrations-list/aws-billing-monitoring-integration">Connect AWS Billing documentation</a></p>
      </div>
    </div>
  </div>
</div>
<h2>2. Create dashboards to display baseline infrastructure metrics; include AWS budgets if available [#create]</h2>
<p><a href="https://newrelic.com/insights/">D</a><a href="/docs/query-your-data/explore-query-data/dashboards/introduction-new-relic-one-dashboards">ashboards</a> lets you write powerful custom queries about your data and visualize the results in widgets displayed on a common dashboard. You can also feed the results of your queries directly into <a href="https://newrelic.com/alerts">New Relic Alerts</a>, where you can get immediate notifications on any deviation identified.</p>
<p>For this step, you should display baseline infrastructure metrics related to performance and usage (CPU, memory, disk, database, etc.). Include AWS Budgets if available. To get you started, here are ways to use Insights dashboards to visualize your AWS cloud utilization and spend data:</p>
<p>
  <img src="./images/image-1.png" alt="image-1.png" title="image-1.png">
</p>
<p>This dashboard shows data broken out by the applications and budgets you set up in the AWS budgeting area.</p>
<p>
  <img src="./images/image-2a.png" alt="image-2a.png" title="image-2a.png">
</p>
<p>Create individual dashboards for each application, and then collect those dashboards into a single “<a href="https://docs.newrelic.com/docs/insights/use-insights-ui/manage-dashboards/data-apps-build-collections-linked-dashboards">data app</a>,” as shown here. This AWS Production Overview data app displays a set of widgets relevant to an AWS production budget. Data apps are great for presentations where you want to step through a series of topics and also provide a clear overview of an entire environment or service.</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoib3JnLWRhc2hib2FyZHMifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IkNyZWF0ZSBkYXNoYm9hcmRzIGZvciBlYWNoIGxldmVsIG9mIHlvdXIgb3JnYW5pemF0aW9uIn1d">
    <div data-prop-text="title">Create dashboards for each level of your organization</div>
    <p>Whether you're a developer, operator, or executive, having information about your cloud utilization can help you optimize your cloud environment:</p>
    <ul>
      <li>
        <p>Developers: Understanding what applications currently cost can help developers configure applications to use more services more efficiently. For example, could developers cut cloud costs using <a href="https://aws.amazon.com/lambda/">AWS Lambda</a> or properly sized instances?</p>
      </li>
      <li>
        <p>Operators: Monitoring application utilization allows operators to catch possible overruns due to mis-configured services. For example, is the ops team's auto-scaling configuration scaling down properly?</p>
      </li>
      <li>
        <p>Executives: An overall view of both fore-casted and actual cloud spend, for individual applications, per region, and overall totals, can help executives make better business decisions.</p>
        <p>Use New Relic to keep track of your cloud spend, and make sure your teams get alerted immediately when you exceed thresholds.</p>
      </li>
    </ul>
  </div>
</div>
<h2>3. Identify resources for optimization</h2>
<p>This step shows you how to use the metrics New Relic has captured to determine which resources to optimize.</p>
<p>
  <img src="./images/%232.png" alt="#2.png" title="#2.png">
</p>
<p>In the sample dashboard above, the CPU-usage widget on the left reveals that this application uses many instances sizes. Note that the “c4.xlarge” instance (in coral) consistently consumes only around 20% CPU capacity. However, when you analyze the c4.xlarge Memory usage in the center widget (light green), you'll see that memory usage for this instance ranges from 20% to 80%. This suggests that the application is more memory-intensive than CPU-intensive. In this case, the instance type should be changed from a compute-optimized instance to one that is memory-optimized. (Note: the chart on the right of the dashboard can be used to monitor the application's average response time as you make these optimizations.)</p>
<p>This is just one example of how to identify cloud-based resources that could be candidates for optimization.</p>
<p>Now that you've identified architecture for optimization, go ahead and do so. Whether you right-size your instances, fine tune your databases, modify your storage usage, better configure your load balancers, or even re-architect your applications, in the end your goal is to be able to compare your new, optimized architecture against the baselines you captured in Step 2. For more about baselines please review the <a href="/docs/1-adopt-easily-establish-objectives-baselines-define-team-slos">Establish Objectives &#x26; Baselines tutorial</a>.</p>
<h2>4. Optional: Set up alerts [#alerts]</h2>
<p>You can create an alert condition for NRQL queries. Be sure to reference the <a href="https://docs.newrelic.com/docs/alerts/new-relic-alerts/defining-conditions/create-alert-conditions-nrql-queries">complete documentation</a> as needed.</p>
<p>In the data app for the AWS production budget introduced in Step 2, this was one of the widgets:</p>
<p>
  <img src="./images/%233.png" alt="#3.png" title="#3.png">
</p>
<p>Here is the query that we used to create that widget:</p>
<pre><code>SELECT latest(`provider.actualAmount`) as '$ Actual', 
latest(`provider.forecastedAmount`) as '$ Forecast', 
max(`provider.limitAmount`) as '$ Limit' 
FROM FinanceSample WHERE provider = 'BillingBudget' 
AND `provider.budgetName` = '[Your Cloud Budget]'
</code></pre>
<p>If you can write queries on your data and show them in Insights, then you can easily use them to generate Alert conditions.</p>
<h3>Baseline queries</h3>
<p>New Relic also lets you write “baseline queries” against your data. These are queriesy you write without setting hard limits on the results. Rather, you let <a href="https://newrelic.com/platform/applied-intelligence">New Relic Applied Intelligence</a> “machine-learn” your performance data, and then alert you when your data strays too far outside of your baseline numbers.</p>
<p>To create a baseline query, head over the the <a href="https://docs.newrelic.com/docs/alerts/new-relic-alerts/configuring-alert-policies/create-or-rename-alert-policy#alert-policy-name">Alert console</a>, go into Alert policies, and add a New alert policy. Then follow these steps:</p>
<ol>
  <li>
    <p>Create alert policy. Give your policy a concise and descriptive name and select an Incident Preference. Then select Create alert policy.</p>
  </li>
  <li>
    <p>Create a condition. Select <strong>NRQL</strong></p>
  </li>
  <li>
    <p>Define your query, and decide how restrictively Applied Intelligence should analyze your data using a simple slider and visualization based on your recent performance.</p>
    <p>
      <img src="./images/%234.png" alt="#4.png" title="#4.png">
    </p>
    <p>The slider at the bottom of the chart either increases or decreases the gray band around your budget threshold (the blue line). The setting shown would have resulted in zero violations based on recent data, and that is what you're looking for. However, if that blue line spikes up or down out of the gray band, New Relic will immediately notify you.</p>
  </li>
</ol>
<p>Using New Relic Applied Intelligence is a great way to help you proactively learn about your cloud spending or about any of your performance data.</p>
<h2>Lean More</h2>
<ul>
  <li>For a quick primer on the New Relic platform, check out <a href="https://blog.newrelic.com/2017/10/16/digital-intelligence-platform-learn-video/">Learn the New Relic Digital Intelligence Platform in 30 Minutes or Less</a>.</li>
  <li>Review the <a href="https://docs.newrelic.com/docs/4-fail-fast-set-proactive-alerts-align-teams-tools-processes-incident-response">Proactive alerting and incident orchestration</a> tutorial for a deeper dive on some of the best practices outlined above.</li>
</ul>
