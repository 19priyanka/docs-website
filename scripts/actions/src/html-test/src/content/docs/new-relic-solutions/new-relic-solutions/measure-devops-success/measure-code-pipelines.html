
<p>High functioning DevOps teams use instrumentation to push changes to production more frequently and with less risk. This process yields important insights: How is your build pipeline performing? Where are the issues? They key is to instrument your pipeline in order to track it and to make improvements.</p>
<h2>Prerequisite</h2>
<p>Before starting this tutorial, be sure to complete the <a href="https://docs.newrelic.com/docs/using-new-relic/welcome-new-relic/measure-devops-success/establish-team-dashboards-gather-visualize-key-metrics">Establish team dashboards</a> tutorial.</p>
<h2>1. Identify what to track</h2>
<p>Look at your CI/CD system and determine the stats you'd like to gather. We recommend, at a minimum, starting with commit metadata, build status, test results, deploy status, and performance metrics.</p>
<p>
  <img src="./images/codepipeline2NR.png" alt="codepipeline2NR.png" title="codepipeline2NR.png">
</p>
<p>Determine which stats you want to report to New Relic.</p>
<h2>2. Capture the events required to instrument your pipeline</h2>
<ol>
  <li>Capture timestamped state changes to your pipeline/CI/CD system indicating when a given stage started; and whether it succeeded or failed. This step, in turn, makes it easy to track your deployment process over time—looking for trends in the frequency of deployments, build quality, and other performance indicators.</li>
  <li>For easiest tracking, capture timestamped changes to your source code management system (SCM) with at least the author and a hash or unique change ID. Propagate this information wherever possible.</li>
  <li>If you have your own build system, add code to emit custom events at each stage. For hosted services, create a lightweight intermediary service/function-as-a-service (FaaS) to format and forward these custom events.</li>
</ol>
<p>The example below uses <a href="https://aws.amazon.com/codepipeline/">AWS CodePipeline</a> to manage the flow of an application that is sourced in GitHub, built and tested with <a href="https://aws.amazon.com/codebuild/">AWS CodeBuild</a>, and deployed with <a href="https://aws.amazon.com/elasticbeanstalk/">Elastic Beanstalk</a>. It utilizes a simple service written in Node.js, plus some "glue code" and event handlers needed to push data from GitHub and AWS to New Relic. Code for this example is available at <a href="https://github.com/newrelic/webinar">github.com/newrelic/webinar</a>.</p>
<p>
  <img src="./images/codepipelineAWS.png" alt="codepipelineAWS.png" title="codepipelineAWS.png">
</p>
<p>Use AWS CodePipeline to understand different parts of your flow.</p>
<p>We chose the tools and products used here as examples—with the goal of illustrating the concepts around the types of data and events you should be thinking about when instrumenting your own code pipeline. The sample code, however, should be generic enough to adapt readily to almost any toolset.</p>
<h2>Outcomes</h2>
<p>Here is a sample dashboard you could create to track your code pipeline.</p>
<p>
  <img src="./images/codepipelinedashboard-edited.png" alt="codepipelinedashboard-edited.png" title="codepipelinedashboard-edited.png">
</p>
<p>Track your code pipeline by creating dashboards in New Relic Insights.</p>
<p>A dashboard like this yields a number of benefits, including:</p>
<ul>
  <li>Faster deploy cycles.</li>
  <li>The ability to prioritize reliability work by identifying services with frequent deploy failures or gaps in test coverage.</li>
  <li>Ensuring teams don’t achieve speed at the expense of quality.</li>
  <li>Responding more effectively to change-related failures.</li>
</ul>
