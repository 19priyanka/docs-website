
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJ0aXAifV0=">
  <p>Thank you for participating in the <strong>Windows services integration beta program</strong>. We'd appreciate your feedback. To join the beta program, and for comments or questions, <a href="mailto:ikavanagh@newrelic.com?subject=Windows%20services%20integration%20beta%20-%20Feedback">contact us</a>.</p>
</div>
<p>New Relic's Windows services integration collects data about the services running on your Windows hosts and sends it to our platform. You can check the state and start mode of each service, find out which hosts are running a service, set up alerts for services, and more.</p>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
  <p>Our integration is bundled with the <a href="/docs/infrastructure/install-configure-manage-infrastructure/windows-installation/install-infrastructure-windows-server-using-msi-installer">Windows infrastructure agent</a>: if you are monitoring Windows hosts on New Relic, you just need to enable the integration to get Windows services data into our platform.</p>
</div>
<h2>Why it matters</h2>
<p><a href="https://docs.microsoft.com/en-us/dotnet/framework/windows-services/introduction-to-windows-service-applications">Windows services</a> are the Windows equivalent of daemons in Unix and Linux, long-running executables that can be started, stopped, paused, and restarted without a graphical interface. Knowing which services are enabled, their state, and their status or health is essential when monitoring Windows infrastructure.</p>
<p>With our Windows services integration you can:</p>
<ul>
  <li>Check all your Windows services, their <a href="#state">state</a> (running, stopped, etc.), <a href="#status">status</a> (OK, error, degraded), and <a href="#startmode">start mode</a> (auto, manual, etc.), including service <a href="#metadata">metadata</a>.</li>
  <li>See which hosts are running specific Windows services.</li>
  <li><a href="#set-alerts">Set alerts</a> based on any Windows services that you are monitoring using New Relic.</li>
  <li>Create <a href="/docs/dashboards/new-relic-one-dashboards/get-started/introduction-new-relic-one-dashboards">dashboards</a> to track your Windows services.</li>
</ul>
<p>
  <img src="./images/nr1-ohi-windows-services-metric.png" alt="New Relic One - Windows services integration - Metric data" title="New Relic One - Windows services integration - Metric data">
</p>
<p><strong><a href="https://one.newrelic.com">one.newrelic.com</a> > Dashboards</strong>: You can use the Windows services integration metrics to create tables for your services.</p>
<h2>Compatibility and requirements [#requirements]</h2>
<p>Our integration is compatible with all Windows versions <a href="/docs/infrastructure/new-relic-infrastructure/getting-started/compatibility-requirements-new-relic-infrastructure">supported</a> by the New Relic agent.</p>
<p>You must have the <a href="/docs/infrastructure/install-configure-manage-infrastructure">New Relic infrastructure agent</a> <strong>version 1.12.1 or above</strong> installed on a supported host.</p>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
  <p>x86 Windows versions are not yet supported.</p>
</div>
<h2>Install and activate [#install]</h2>
<p>To install the Windows services integration:</p>
<ol>
  <li>
    <p>Change the directory to the integrations folder:</p>
    <pre><code>cd C:\Program Files\New Relic\newrelic-infra\integrations.d\
</code></pre>
  </li>
  <li>
    <p>Copy of the sample configuration file:</p>
    <pre><code>copy winservices-config.yml.sample winservices-config.yml
</code></pre>
  </li>
  <li>
    <p>Edit the <code>winservices-config.yml</code> file as described in the <a href="#config">configuration settings</a> and save it.</p>
  </li>
</ol>
<h3>Update your integration [#update]</h3>
<p>The Windows services integration is bundled with the Infrastructure agent. To update the integration, <a href="/docs/infrastructure/install-configure-manage-infrastructure/update-or-uninstall/update-infrastructure-agent#update">update the agent</a> to the latest version.</p>
<h2>Configure the integration [#config]</h2>
<p>To enable the integration, edit and save the <code>winservices-config.yml</code> :</p>
<ul>
  <li>Uncomment <code>exporter_bind_address:</code> and <code>exporter_bind_port:</code></li>
  <li>Add the name of the services you want to monitor to <code>include_matching_entities:</code></li>
</ul>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
  <p>By default, no service is included. To include and filter services, you must edit <code>include_matching_entities:</code></p>
</div>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
  <p>The configuration option <a href="https://docs.newrelic.com/docs/integrations/integrations-sdk/file-specifications/host-integrations-newer-configuration-format#inventory_source">inventory_source</a> is not compatible with the integration.</p>
</div>
<p>Example configuration</p>
<p>Here is an example of the Windows services integration configuration:</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZXhhbXBsZSJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoid2luc2VydmljZXMtY29uZmlnLnltbCJ9XQ==">
    <div data-prop-text="title">winservices-config.yml</div>
    <pre><code>integrations:
  - name: com.newrelic.winservices
    exec:
      - C:\Program Files\New Relic\newrelic-infra\newrelic-integrations\nri-winservices.exe
    config:
      # IP address and port used by the Prometheus exporter to bind the server.
      # 
      # exporter_bind_address: 127.0.0.1
      # exporter_bind_port: 9182

      # To include services, create a list of filters to be applied to the
      # service names. Services that find a match with any of the matching
      # lists are included. By default, no service is included.
      #
      # Currently, only windowsService.name metadata is supported for filtering.
      # Prepend "regex" to indicate that the pattern is a regular expression.
      #
      include_matching_entities:
        windowsService.name:
          # - regex "^*$"
          # - "ServiceNameToBeIncluded"

      # Time between consecutive metric collection of the integration.
      # It must be a number followed by a time unit (s, m or h), without spaces.
      #
      scrape_interval: 30s

    # Timeout used by the agent to restart the integration if no heartbeats are
    # sent from the integration. Heartbeats are sent every 5s, so this timeout
    # shouldn't be less than that.
    #
    timeout: 10s

    # Since this is a long-running integration, interval is ignored. To
    # configure the interval period for collecting and sending data, edit
    # the scrape_interval parameter.
    #
    # interval:

</code></pre>For more information, see our documentation about the [general structure of on-host integration configurations](/docs/integrations/integrations-sdk/file-specifications/host-integration-configuration-overview).
  </div>
</div>
<h2>Set up an alert [#set-alerts]</h2>
<p>You can <a href="/docs/alerts/new-relic-alerts/defining-conditions/create-alert-conditions-nrql-queries">create Windows services alerts using NRQL conditions</a> to get notified about status or state changes of the services you wish to monitor. Below are two examples of alert conditions that use Windows services data:</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJTZXJ2aWNlIGlzIG5vdCBydW5uaW5nIn1d">
    <div data-prop-text="title">Service is not running</div>
    <pre><code>SELECT count(*) FROM Metric WHERE metricName = 'windowsService.service.state' AND windowsService.state != 'running' AND windowsService.name = 'lfsvc' FACET windowsService.entityName

</code></pre>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOnsidHlwZSI6Im1keFZhbHVlRXhwcmVzc2lvbiIsInZhbHVlIjoiPD5TdGFydCBtb2RlIGlzIDxJbmxpbmVDb2RlPmF1dG88L0lubGluZUNvZGU+LCBidXQgY3VycmVudCBzdGF0ZSBpcyBub3QgPElubGluZUNvZGU+cnVubmluZzwvSW5saW5lQ29kZT48Lz4iLCJwb3NpdGlvbiI6eyJzdGFydCI6eyJsaW5lIjoxNTMsImNvbHVtbiI6MTEsIm9mZnNldCI6NzIzNn0sImVuZCI6eyJsaW5lIjoxNTMsImNvbHVtbiI6MTIwLCJvZmZzZXQiOjczNDV9fX19XQ==">
    <div data-prop-text="title">[object Object]</div>
    <pre><code>FROM Metric SELECT count(*) WHERE windowsService.startMode='auto' AND windowsService.state!='running' FACET windowsService.name

</code></pre>
  </div>
</div>
<h2>How it works</h2>
<p>To get data from Windows hosts, our Windows services integration uses a reduced version of the <a href="https://github.com/prometheus-community/windows_exporter">Prometheus exporter for Windows</a>, which exposes Prometheus metrics on the port specified in the agent configuration. The integration collects these metrics, transforms them into entities, filters them, and then sent them to New Relic.</p>
<p>
  <img src="./images/WindowsServicesOHI.png" alt="Windows services integration architecture" title="Windows services integration architecture">
</p>
<p>The Windows services integration collects <a href="https://en.wikipedia.org/wiki/Windows_Management_Instrumentation">Windows Management Instrumentation</a> (WMI) data using the Windows Prometheus exporter. It then transforms and filters the data before sending it to New Relic.</p>
<h2>Metric data [#metrics]</h2>
<p>The Windows services integration provides the following data:</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>Metric</p>
      </div>
      <div>
        <p>Description</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p><code>windowsService.service.startMode</code></p>
      </div>
      <div>
        <p>Start mode of the service. Possible values are:</p>
        <ul>
          <li><code>boot</code></li>
          <li><code>system</code></li>
          <li><code>auto</code></li>
          <li><code>manual</code></li>
          <li><code>disabled</code></li>
        </ul>
      </div>
    </div>
    <div>
      <div>
        <p><code>windowsService.service.state</code></p>
      </div>
      <div>
        <p>State of the service. Possible values are:</p>
        <ul>
          <li><code>stopped</code></li>
          <li><code>start pending</code></li>
          <li><code>stop pending</code></li>
          <li><code>running</code></li>
          <li><code>continue pending</code></li>
          <li><code>pause pending</code></li>
          <li><code>paused</code></li>
          <li><code>unknown</code></li>
        </ul>
      </div>
    </div>
    <div>
      <div>
        <p><code>windowsService.service.status</code></p>
      </div>
      <div>
        <p>Status of the service. Possible values are:</p>
        <ul>
          <li><code>ok</code></li>
          <li><code>error</code></li>
          <li><code>degraded</code></li>
        </ul>
      </div>
    </div>
  </div>
</div>
<h2>Metadata</h2>
<p>The Windows services integration sends the following metadata to New Relic:</p>
<ul>
  <li>
    <p><code>windowsService.displayName</code>: Name of the service as viewed in the services snap-in</p>
  </li>
  <li>
    <p><code>windowsService.entityName</code>: Composed of hostname plus service name</p>
  </li>
  <li>
    <p><code>windowsService.hostname</code>: Name of the host where the integration is running</p>
  </li>
  <li>
    <p><code>windowsService.name</code>: Unique identifier of the service</p>
  </li>
  <li>
    <p><code>windowsService.processId</code>: Process identifier of the service</p>
  </li>
  <li>
    <p><code>windowsService.runAs</code>: Account name under which a service runs. Depending on the service type, the format of the account name may be <code>DomainName\Username</code> or <code>Username@DomainName</code> (UPN). The value is taken from the <code>StartName</code> attribute of the <code>Win32_Service</code> class, which can be <code>NULL</code> (in that case, the label is reported as an empty string).</p>
    <div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
      <p>If the <code>StartName</code> attribute is <code>NULL</code>, the service is logged on under the <code>LocalSystem</code> account or, for kernel or system-level drive, it runs with a default object name created by the I/O system based on the service name, for example, <code>DWDOM\Admin</code>.</p>
    </div>
  </li>
</ul>
<h2>Source code</h2>
<p>The Windows services integration is open source software. That means you can <a href="https://github.com/newrelic/nri-winservices/">browse its source code</a> and <a href="https://github.com/newrelic/nri-winservices/blob/master/CONTRIBUTING.md">send improvements</a>, or create your own fork and build it. For more information, see the <a href="https://github.com/newrelic/nri-winservices/blob/master/README.md">README</a>.</p>
