
<p>The New Relic PostgreSQL <a href="https://docs.newrelic.com/docs/integrations/host-integrations/getting-started/introduction-host-integrations">on-host integration</a> receives and sends inventory metrics from your PostgreSQL instance to the New Relic platform, where you can aggregate and visualize key performance metrics. Data from instances, databases, and clusters helps you find the source of problems.</p>
<p>Read on to install the integration, and to see what data we collect.</p>
<h2>Compatibility and requirements [#comp-req]</h2>
<p>Our integration is compatible with PostgreSQL 9.0 or higher.</p>
<p>If PostgreSQL is <strong>not</strong> running on Kubernetes or Amazon ECS, you must <a href="/docs/infrastructure/install-infrastructure-agent/get-started/install-infrastructure-agent-new-relic">install the infrastructure agent</a> on a host running PostgreSQL. Otherwise:</p>
<ul>
  <li>If running on Kubernetes, see <a href="https://docs.newrelic.com/docs/monitor-service-running-kubernetes#requirements">these requirements</a>.</li>
  <li>If running on ECS, see <a href="/docs/integrations/host-integrations/host-integrations-list/monitor-services-running-amazon-ecs">these requirements</a>.</li>
</ul>
<h2>Install and activate [#install]</h2>
<p>To install the PostgreSQL integration, follow the instructions for your environment:</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZWNzLWluc3RhbGwifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IkVDUyJ9XQ==">
    <div data-prop-text="title">ECS</div>
    <p>See <a href="/docs/integrations/host-integrations/host-integrations-list/monitor-services-running-amazon-ecs">Monitor service running on ECS</a>.</p>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiazhzLWluc3RhbGwifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6Ikt1YmVybmV0ZXMifV0=">
    <div data-prop-text="title">Kubernetes</div>
    <p>See <a href="/docs/monitor-service-running-kubernetes">Monitor service running on Kubernetes</a>.</p>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoibGludXgtaW5zdGFsbCJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiTGludXgifV0=">
    <div data-prop-text="title">Linux</div>
    <ol>
      <li>
        <p>Follow the procedures to <a href="https://docs.newrelic.com/docs/integrations/host-integrations/installation/install-host-integrations-built-new-relic">install the infrastructure integration package</a> using the file name <code>nri-postgresql</code>.</p>
      </li>
      <li>
        <p>Change directory to the integrations folder:</p>
        <pre><code>cd /etc/newrelic-infra/integrations.d
</code></pre>
      </li>
      <li>
        <p>Copy of the <a href="#example-postgresSQL-config">sample configuration file</a>:</p>
        <pre><code>sudo cp postgresql-config.yml.sample postgresql-config.yml
</code></pre>
      </li>
      <li>
        <p>Edit the <code>postgresql-config.yml</code> file as described in the <a href="#config">configuration settings</a>.</p>
      </li>
      <li>
        <p>Before you restart the infrastructure agent, <a href="#create-user">create a user</a> with <code>READ</code> permissions on the required functions.</p>
      </li>
      <li>
        <p><a href="https://docs.newrelic.com/docs/infrastructure/new-relic-infrastructure/configuration/start-stop-restart-check-infrastructure-agent-status">Restart the infrastructure agent.</a></p>
      </li>
    </ol>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoid2luZG93cy1pbnN0YWxsIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJXaW5kb3dzIn1d">
    <div data-prop-text="title">Windows</div>
    <ol>
      <li>
        <p>Download the <code>nri-postgresql</code> .MSI installer image from:</p>
        <p><a href="http://download.newrelic.com/infrastructure_agent/windows/integrations/nri-postgresql/nri-postgresql-amd64.msi">http://download.newrelic.com/infrastructure_agent/windows/integrations/nri-postgresql/nri-postgresql-amd64.msi</a></p>
      </li>
      <li>
        <p>To install from the Windows command prompt, run:</p>
        <pre><code>msiexec.exe /qn /i PATH\TO\nri-postgresql-amd64.msi
</code></pre>
      </li>
      <li>
        <p>In the Integrations directory, <code>C:\Program Files\New Relic\newrelic-infra\integrations.d\</code>, create a copy of the sample configuration file by running:</p>
        <pre><code>cp postgresql-config.yml.sample postgresql-config.yml
</code></pre>
      </li>
      <li>
        <p>Edit the <code>postgresql-config.yml</code> file as described in the <a href="#config">configuration settings</a>.</p>
      </li>
      <li>
        <p><a href="https://docs.newrelic.com/docs/infrastructure/new-relic-infrastructure/configuration/start-stop-restart-check-infrastructure-agent-status">Restart the infrastructure agent</a>.</p>
      </li>
    </ol>
  </div>
</div>
<p>Additional notes:</p>
<ul>
  <li><strong>Advanced:</strong> Integrations are also available in <a href="/docs/integrations/host-integrations/installation/install-host-integrations-built-new-relic#tarball">tarball format</a> to allow for install outside of a package manager.</li>
  <li><strong>On-host integrations do not automatically update.</strong> For best results, regularly <a href="/docs/integrations/host-integrations/installation/update-infrastructure-host-integration-package">update the integration package</a> and <a href="/docs/infrastructure/new-relic-infrastructure/installation/update-infrastructure-agent">the infrastructure agent</a>.</li>
</ul>
<h2>PostgreSQL users and permissions [#create-user]</h2>
<p>Create a user with <code>READ</code> permissions on:</p>
<ul>
  <li><code>pg_stat_database</code></li>
  <li><code>pg_stat_database_conflicts</code></li>
  <li><code>pg_stat_bgwriter</code></li>
</ul>
<p>You can complete this step before or after you <a href="#config">configure the <code>postgresql-config.yml</code> file</a>. To create the user for the PostgreSQL integration:</p>
<pre><code>CREATE USER new_relic WITH PASSWORD 'PASSWORD';
GRANT SELECT ON pg_stat_database TO new_relic;
GRANT SELECT ON pg_stat_database_conflicts TO new_relic;
GRANT SELECT ON pg_stat_bgwriter TO new_relic;
</code></pre>
<h2>Configure the integration [#config]</h2>
<p>An integration's YAML-format configuration is where you can place required login credentials and configure how data is collected. Which options you change depend on your setup and preference.</p>
<p>There are several ways to configure the integration, depending on how it was installed:</p>
<ul>
  <li>If enabled via Kubernetes: see <a href="/docs/monitor-service-running-kubernetes">Monitor services running on Kubernetes</a>.</li>
  <li>If enabled via Amazon ECS: see <a href="/docs/integrations/host-integrations/host-integrations-list/monitor-services-running-amazon-ecs">Monitor services running on ECS</a>.</li>
  <li>If installed on-host: edit the config in the integration's YAML config file, <code>postgresql-config.yml</code>.</li>
</ul>
<p>Config options are below. For an example configuration, see the <a href="#example-postgresSQL-config">example config file</a>.</p>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
  <p>With secrets management, you can configure on-host integrations with New Relic infrastructure's agent to use sensitive data (such as passwords) without having to write them as plain text into the integration's configuration file. For more information, see <a href="https://docs.newrelic.com/docs/integrations/host-integrations/installation/secrets-management">Secrets management</a>.</p>
</div>
<h3>Commands</h3>
<p>The configuration accepts the following commands:</p>
<ul>
  <li><code>all_data</code>: collects both inventory and metric data for the configured PostgreSQL instance..</li>
</ul>
<h3>Arguments</h3>
<p>The <code>all_data</code> command accepts the following arguments:</p>
<ul>
  <li>
    <p><code>username</code>: the user name for the PostgreSQL connection. <strong>Required.</strong></p>
  </li>
  <li>
    <p><code>password</code>: the password for the PostgreSQL connection. <strong>Required.</strong></p>
  </li>
  <li>
    <p><code>hostname</code>: the hostname for the PostgreSQL connection. Default: <code>localhost.</code></p>
  </li>
  <li>
    <p><code>port</code>: the port where PostgreSQL is running. Default: <code>5432</code>.</p>
  </li>
  <li>
    <p><code>collection_list</code>: a JSON array, a JSON object, or the string literal <code>ALL</code> that specifies the entities to be collected. <strong>Required except for PgBouncer.</strong></p>
    <ul>
      <li>
        <p>JSON array: Interpreted as a list of database names from which to collect all relevant metrics, including any tables and indexes belonging to that database. For example:</p>
        <pre><code>collection_list: '["postgres"]'
</code></pre>
      </li>
      <li>
        <p>JSON object: only entities specified in the object will be collected, no automatic discovery will be performed. The levels of JSON are <code>database name -> schema name -> table name -> index name</code>. For example:</p>
        <pre><code>collection_list: '{"postgres":{"public":{"pg_table1":["pg_index1","pg_index2"],"pg_table2":[]}}}'
</code></pre>
      </li>
      <li>
        <p><code>ALL</code>: collect metrics for all databases, schemas, tables, and indexes discovered. For example:</p>
        <pre><code>collection_list: 'ALL'
</code></pre>
      </li>
    </ul>
  </li>
  <li>
    <p><code>pgbouncer</code>: collect <code>pgbouncer</code> metrics. Default: <code>false</code>.</p>
  </li>
  <li>
    <p><code>enable_ssl</code>: determines if SSL is enabled. If <code>true</code>, <code>ssl_cert_location</code> and <code>ssl_key_location</code> are required. Default: <code>false</code>.</p>
  </li>
  <li>
    <p><code>trust_server_certificates</code>: if <code>true</code>, the server certificate is not verified for SSL. If <code>false</code>, the server certificate identified in <code>ssl_root_cert_location</code> is verified. Default: <code>false</code>.</p>
  </li>
  <li>
    <p><code>ssl_root_cert_location</code>: absolute path to PEM-encoded root certificate file. Required if <code>trust_server_certificates</code> is <code>false</code>.</p>
  </li>
  <li>
    <p><code>ssl_cert_location</code>: absolute path to PEM-encoded client certificate file. Required if <code>enable_ssl</code> is <code>true</code>.</p>
  </li>
  <li>
    <p><code>ssl_key_location</code>: absolute path to PEM-encoded client key file. Required if <code>enable_ssl</code> is <code>true</code>.</p>
  </li>
  <li>
    <p><code>timeout</code>: maximum wait for connection, in seconds. Set to <code>0</code> for no timeout. Default: <code>10</code>.</p>
  </li>
  <li>
    <p><code>database</code>: the PostgreSQL database to connect to. Default: <code>postgres</code>.</p>
  </li>
  <li>
    <p><code>custom_metrics_query</code>: a SQL query that required <code>columns metric_name</code>, <code>metric_type</code>, and <code>metric_value.metric_type</code> can be <code>gauge</code>, <code>rate</code>, <code>delta</code>, or <code>attribute</code>. Additional columns collected with the query are added to the metric set as attributes.</p>
  </li>
  <li>
    <p><code>custom_metrics_config</code>: a path to a YAML file with a list of custom queries, along with their metric type, database, and sample name overrides. See example for details.</p>
  </li>
  <li>
    <p><code>collect_db_lock_metrics</code>: Enable collecting database lock metrics, which can be performance intensive. Default: <code>true</code>.</p>
  </li>
  <li>
    <p><code>collect_bloat_metrics</code>: Enable tablespace bloat metrics, which can be performance intensive. Default: <code>true</code>.</p>
  </li>
</ul>
<h3>Example configuration [#example-config]</h3>
<p>Example <code>postgresql-config.yml</code> file configuration:</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZXhhbXBsZS1wb3N0Z3Jlc1NRTC1jb25maWcifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IlBvc3RncmVTUUwgY29uZmlndXJhdGlvbiBmaWxlIn1d">
    <div data-prop-text="title">PostgreSQL configuration file</div>
    <pre><code>integration_name: com.newrelic.postgresql

instances:
  # A name for the collection
  - name: sample_postgres
    # The only supported command is all_data.
    command: all_data
    arguments:
      # The username for the Postgres instance. Required.
      username: postgres
      # The password for the Postgres instance. Required.
      password: pass
      # The hostname for the Postgres instance. Defaults to localhost.
      hostname: psql-sample.localnet
      # The port of the Postgres instance. If PgBouncer is being used,
      # use the port it is running on. Defaults to 5432.
      port: 6432
      # The JSON object which contains the entities to monitor. The nesting
      # levels of JSON are database name -> schema name -> table name -> index name.
      collection_list: '{"postgres":{"public":{"pg_table1":["pg_index1","pg_index2"],"pg_table2":[]}}}'
      # True if SSL is to be used. Defaults to false.
      enable_ssl: true
      # True if the SSL certificate should be trusted without validating.
      # Setting this to true may open up the monitoring service to MITM attacks.
      # Defaults to false.
      trust_server_certificate: false
      ssl_root_cert_location: /etc/newrelic-infra/root_cert.crt
      ssl_cert_location: /etc/newrelic-infra/postgresql.crt
      ssl_key_location: /etc/newrelic-infra/postgresql.key
      timeout:  10
      # custom_metrics_query:
        # select
          # 'rows_inserted' as "metric_name",
          # 'delta' as "metric_type",
          # sd.tup_inserted as "metric_value",
          # sd.datid as "database_id"
        # from pg_stat_database sd;
    # Used to label your data.
    labels:
      env: production
      role: postgresql

</code></pre>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZXhhbXBsZS1wb3N0Z3Jlc1NRTC1jb25maWcifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IlBvc3RncmVTUUwgY3VzdG9tIG1ldHJpY3MgY29uZmlnIn1d">
    <div data-prop-text="title">PostgreSQL custom metrics config</div>
    <pre><code>---
queries:

  # Metric names are set to the column names in the query results
  - query: >-
      SELECT
      BG.checkpoints_timed AS scheduled_checkpoints_performed,
      BG.checkpoints_req AS requested_checkpoints_performed,
      BG.buffers_checkpoint AS buffers_written_during_checkpoint,
      BG.buffers_clean AS buffers_written_by_background_writer,
      BG.maxwritten_clean AS background_writer_stops,
      BG.buffers_backend AS buffers_written_by_backend,
      BG.buffers_alloc AS buffers_allocated
      FROM pg_stat_bgwriter BG;

    # database defaults to the auth database in the main config
    database: new_frontier_config_dev

    # If not set explicitly here, metric type will default to
    # 'gauge' for numbers and 'attribute' for strings
    metric_types:
      buffers_allocated: rate

    # If unset, sample_name defaults to PostgresqlCustomSample
    sample_name: MyCustomSample

</code></pre>
  </div>
</div>
<p>For more about the general structure of on-host integration configuration, see <a href="/docs/integrations/integrations-sdk/file-specifications/host-integration-configuration-overview">Configuration</a>.</p>
<h2>Find and use data [#find-and-use]</h2>
<p>Data from this service is reported to an <a href="/docs/integrations/new-relic-integrations/getting-started/infrastructure-integration-dashboards-charts">integration dashboard</a>.</p>
<p>Metrics are attached to these <a href="/docs/using-new-relic/data/understand-data/new-relic-data-types#events-new-relic">event types</a>:</p>
<ul>
  <li><a href="#databaseSample"><code>PostgresqlDatabaseSample</code></a></li>
  <li><a href="#indexSample"><code>PostgresqlIndexSample</code></a></li>
  <li><a href="#instanceSample"><code>PostgresqlInstanceSample</code></a></li>
  <li><a href="#tableSample"><code>PostgresqlTableSample</code></a></li>
  <li><a href="#pgBouncerSample"><code>PgBouncerSample</code></a></li>
</ul>
<p>You can <a href="/docs/using-new-relic/data/understand-data/query-new-relic-data">query this data</a> for troubleshooting purposes or to create custom charts and dashboards.</p>
<p>For more on how to find and use your data, see <a href="/docs/infrastructure/integrations/find-use-infrastructure-integration-data">Understand integration data</a>.</p>
<h2>Metric data [#metrics]</h2>
<p>The PostgreSQL integration collects the following database metric attributes. Some attributes apply to <a href="#all-metrics">all PostgreSQL event types</a>. Some metric names are prefixed with a category indicator and a period, such as <code>db.</code> or <code>index.</code> metric names.</p>
<h3>PostgresqlDatabaseSample metrics [#databaseSample]</h3>
<p>These attributes are attached to the <code>PostgresqlDatabaseSample</code> event type:</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>PostgreSQLDatabaseSample attributes</p>
      </div>
      <div>
        <p>Description</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p><code>db.connections</code></p>
      </div>
      <div>
        <p>Number of backends currently connected to this database.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>db.commitsPerSecond</code></p>
      </div>
      <div>
        <p>Committed transactions per second.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>db.rollbacksPerSecond</code></p>
      </div>
      <div>
        <p>Transactions rolled back per second.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>db.readsPerSecond</code></p>
      </div>
      <div>
        <p>Number of disk blocks read in this database per second.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>db.bufferHitsPerSecond</code></p>
      </div>
      <div>
        <p>Number of times disk blocks were found already in the buffer cache, so that a read was not necessary. This only includes hits in the PostgreSQL buffer cache, not the operating system's file system cache.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>db.rowsReturnedPerSecond</code></p>
      </div>
      <div>
        <p>Rows returned by queries per second.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>db.rowsFetchedPerSecond</code></p>
      </div>
      <div>
        <p>Rows fetched by queries per second.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>db.rowsInsertedPerSecond</code></p>
      </div>
      <div>
        <p>Rows inserted per second.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>db.rowsUpdatedPerSecond</code></p>
      </div>
      <div>
        <p>Rows updated per second.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>db.rowsDeletedPerSecond</code></p>
      </div>
      <div>
        <p>Rows deleted per second.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>db.conflicts.tablespacePerSecond</code></p>
      </div>
      <div>
        <p>Number of queries in this database that have been canceled due to dropped tablespaces.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>db.conflicts.locksPerSecond</code></p>
      </div>
      <div>
        <p>Number of queries in this database that have been canceled due to lock timeouts.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>db.conflicts.snapshotPerSecond</code></p>
      </div>
      <div>
        <p>Number of queries in this database that have been canceled due to old snapshots.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>db.conflicts.bufferpinPerSecond</code></p>
      </div>
      <div>
        <p>Number of queries in this database that have been canceled due to pinned buffers.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>db.conflicts.deadlockPerSecond</code></p>
      </div>
      <div>
        <p>Number of queries in this database that have been canceled due to deadlocks.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>db.tempFilesCreatedPerSecond</code></p>
      </div>
      <div>
        <p>Number of temporary files created by queries in this database. All temporary files are counted, regardless of why the temporary file was created (for example, sorting or hashing), and regardless of the <code>log_temp_files</code> setting.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>db.tempWrittenInBytesPerSecond</code></p>
      </div>
      <div>
        <p>Total amount of data written to temporary files by queries in this database. All temporary files are counted, regardless of why the temporary file was created, and regardless of the <code>log_temp_files</code> setting.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>db.deadlocksPerSecond</code></p>
      </div>
      <div>
        <p>Number of deadlocks detected in this database.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>db.readTimeInMillisecondsPerSecond</code></p>
      </div>
      <div>
        <p>Time spent reading data file blocks by backends in this database, in milliseconds.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>db.writeTimeInMillisecondsPerSecond</code></p>
      </div>
      <div>
        <p>Time spent writing data file blocks by backends in this database, in milliseconds.</p>
      </div>
    </div>
  </div>
</div>
<h3>PostgresqlIndexSample metrics [#indexSample]</h3>
<p>These attributes are attached to the <code>PostgresqlIndexSample</code> event type:</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>PostgreSQLIndexSample attributes</p>
      </div>
      <div>
        <p>Description</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p><code>index.sizeInBytes</code></p>
      </div>
      <div>
        <p>The size of an index.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>index.rowsReadPerSecond</code></p>
      </div>
      <div>
        <p>The number of index entries returned by scans on this index.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>index.rowsFetchedPerSecond</code></p>
      </div>
      <div>
        <p>The number of index entries fetched by scans on this index.</p>
      </div>
    </div>
  </div>
</div>
<h3>PostgresqlInstanceSample metrics [#instanceSample]</h3>
<p>These attributes are attached to the <code>PostgresqlInstanceSample</code> event type:</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>PostgreSQLInstanceSample attributes</p>
      </div>
      <div>
        <p>Description</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p><code>bgwriter.checkpointsScheduledPerSecond</code></p>
      </div>
      <div>
        <p>Number of scheduled checkpoints that have been performed.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>bgwriter.checkpointsRequestedPerSecond</code></p>
      </div>
      <div>
        <p>Number of requested checkpoints that have been performed.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>bgwriter.buffersWrittenForCheckpointsPerSecond</code></p>
      </div>
      <div>
        <p>Number of buffers written during checkpoints.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>bgwriter.buffersWrittenByBackgroundWriterPerSecond</code></p>
      </div>
      <div>
        <p>Number of buffers written by the background writer.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>bgwriter.backgroundWriterStopsPerSecond</code></p>
      </div>
      <div>
        <p>Number of times the background writer stopped a cleaning scan because it had written too many buffers.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>bgwriter.buffersWrittenByBackendPerSecond</code></p>
      </div>
      <div>
        <p>Number of buffers written directly by a backend.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>bgwriter.buffersAllocatedPerSecond</code></p>
      </div>
      <div>
        <p>Number of buffers allocated.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>bgwriter.backendFsyncCallsPerSecond</code></p>
      </div>
      <div>
        <p>Number of times a backend had to execute its own <code>fsync</code> call. Normally the background writer handles them even when the backend does its own write.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>bgwriter.checkpointWriteTimeInMillisecondsPerSecond</code></p>
      </div>
      <div>
        <p>Total amount of time that has been spent in the portion of checkpoint processing where files are written to disk, in milliseconds.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>bgwriter.checkpointSyncTimeInMillisecondsPerSecond</code></p>
      </div>
      <div>
        <p>Total amount of time that has been spent in the portion of checkpoint processing where files are synchronized to disk, in milliseconds.</p>
      </div>
    </div>
  </div>
</div>
<h3>PostgresqlTableSample metrics [#tableSample]</h3>
<p>These attributes are attached to the <code>PostgresqlTableSample</code> event type:</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>PostgreSQLTableSample attributes</p>
      </div>
      <div>
        <p>Description</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p><code>table.totalSizeInBytes</code></p>
      </div>
      <div>
        <p>The total disk space used by the table, including indexes and TOAST data.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>table.indexSizeInBytes</code></p>
      </div>
      <div>
        <p>The total disk space used by indexes attached to the specified table.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>table.liveRows</code></p>
      </div>
      <div>
        <p>Number of live rows.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>table.deadRows</code></p>
      </div>
      <div>
        <p>Number of dead rows.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>table.indexBlocksReadPerSecond</code></p>
      </div>
      <div>
        <p>The number of disk blocks read from all indexes on this table.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>table.indexBlocksHitPerSecond</code></p>
      </div>
      <div>
        <p>The number of buffer hits in all indexes on this table.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>table.indexToastBlocksReadPerSecond</code></p>
      </div>
      <div>
        <p>The number of disk blocks read from this table's TOAST table index.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>table.indexToastBlocksHitPerSecond</code></p>
      </div>
      <div>
        <p>The number of buffer hits in this table's TOAST table index.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>table.lastVacuum</code></p>
      </div>
      <div>
        <p>Time of last vacuum on table.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>table.lastAutoVacuum</code></p>
      </div>
      <div>
        <p>Time of last automatic vacuum on table.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>table.lastAnalyze</code></p>
      </div>
      <div>
        <p>Time of last analyze on table.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>table.lastAutoAnalyze</code></p>
      </div>
      <div>
        <p>Time of last automatic analyze on table.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>table.sequentialScansPerSecond</code></p>
      </div>
      <div>
        <p>Number of sequential scans initiated on this table per second.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>table.sequentialScanRowsFetchedPerSecond</code></p>
      </div>
      <div>
        <p>Number of live rows fetched by sequential scans per second.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>table.indexScansPerSecond</code></p>
      </div>
      <div>
        <p>Number of index scans initiated on this table.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>table.indexScanRowsFetchedPerSecon</code></p>
      </div>
      <div>
        <p>Number of live rows fetched by index scans.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>table.rowsInsertedPerSecond</code></p>
      </div>
      <div>
        <p>Rows inserted per second.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>table.rowsUpdatedPerSecond</code></p>
      </div>
      <div>
        <p>Rows updated per second.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>table.rowsDeletedPerSecond</code></p>
      </div>
      <div>
        <p>Rows deleted per second.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>table.bloatSizeInBytes</code></p>
      </div>
      <div>
        <p>Size of bloat in bytes.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>table.dataSizeInBytes</code></p>
      </div>
      <div>
        <p>Size of disk spaced used by the main fork of the table.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>table.bloatRatio</code></p>
      </div>
      <div>
        <p>Fraction of table data size that is bloat.</p>
      </div>
    </div>
  </div>
</div>
<h3>PgBouncerSample metrics [#pgBouncerSample]</h3>
<p>These attributes are attached to the <code>PgBouncerSample</code> event type:</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>PgBouncerSample attributes</p>
      </div>
      <div>
        <p>Description</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p><code>pgbouncer.stats.transactionsPerSecond</code></p>
      </div>
      <div>
        <p>The transaction rate.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>pgbouncer.stats.queriesPerSecond</code></p>
      </div>
      <div>
        <p>The query rate.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>pgbouncer.stats.bytesInPerSecond</code></p>
      </div>
      <div>
        <p>The total network traffic received.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>pgbouncer.stats.bytesOutPerSecond</code></p>
      </div>
      <div>
        <p>The total network traffic sent.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>pgbouncer.stats.totalTransactionDurationInMillisecondsPerSecond</code></p>
      </div>
      <div>
        <p>Time spent by <code>pgbouncer</code> in transaction.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>pgbouncer.stats.totalQueryDurationInMillisecondsPerSecond</code></p>
      </div>
      <div>
        <p>Time spent by <code>pgbouncer</code> actively querying PostgreSQL.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>pgbouncer.stats.avgTransactionCount</code></p>
      </div>
      <div>
        <p>The average number of transactions per second in last stat period.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>pgbouncer.stats.avgTransactionDurationInMilliseconds</code></p>
      </div>
      <div>
        <p>The average transaction duration.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>pgbouncer.stats.avgQueryCount</code></p>
      </div>
      <div>
        <p>The average number of queries per second in last stat period.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>pgbouncer.stats.avgBytesIn</code></p>
      </div>
      <div>
        <p>The client network traffic received.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>pgbouncer.stats.avgBytesOut</code></p>
      </div>
      <div>
        <p>The client network traffic sent.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>pgbouncer.stats.avgQueryDurationInMilliseconds</code></p>
      </div>
      <div>
        <p>The average query duration.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>pgbouncer.pools.clientConnectionsActive</code></p>
      </div>
      <div>
        <p>Client connections linked to server connection and able to process queries.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>pgbouncer.pools.clientConnectionsWaiting</code></p>
      </div>
      <div>
        <p>Client connections waiting on a server connection.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>pgbouncer.pools.serverConnectionsActive</code></p>
      </div>
      <div>
        <p>Server connections linked to a client connection.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>pgbouncer.pools.serverConnectionsIdle</code></p>
      </div>
      <div>
        <p>Server connections idle and ready for a client query.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>pgbouncer.pools.serverConnectionsUsed</code></p>
      </div>
      <div>
        <p>Server connections idle more than <code>server_check_delay</code>, needing <code>server_check_query</code>.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>pgbouncer.pools.serverConnectionsTested</code></p>
      </div>
      <div>
        <p>Server connections currently running either <code>server_reset_query</code> or <code>server_check_query</code>.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>pgbouncer.pools.serverConnectionsLogin</code></p>
      </div>
      <div>
        <p>Server connections currently in the process of logging in.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>pgbouncer.pools.maxwaitInMilliseconds</code></p>
      </div>
      <div>
        <p>Age of oldest unserved client connection.</p>
      </div>
    </div>
  </div>
</div>
<h2>Inventory data [#inventory]</h2>
<p>The PostgreSQL integration collects each setting from <code>pg_settings</code> along with its <code>boot_val</code> and <code>reset_val</code>. The <a href="/docs/infrastructure/integrations-getting-started/getting-started/understand-integration-data-data-types#inventory-data">inventory data</a> appears on the <a href="/docs/infrastructure/new-relic-infrastructure/infrastructure-ui-pages/infrastructure-inventory-page-search-your-entire-infrastructure">Inventory page</a>, under the <strong>config/postgresql</strong> source.</p>
<h2>Troubleshooting</h2>
<p>Here are some troubleshooting tips for the PostgreSQL integration:</p>
<ul>
  <li>If you have connection problems, make sure you can connect to the cluster from the same box with <code>psql</code>.</li>
  <li>If you have problems collecting <code>PgBouncer</code> metrics, make sure you are connected to the instance through <code>PgBouncer</code>. Default port is <code>6432</code>.</li>
  <li>If you get the error message <code>Error creating list of entities to collect: pq: unsupported startup parameter: extra_float_digits</code>, set <code>ignore_startup_parameters = extra_float_digits</code> in the PgBouncer config file.</li>
</ul>
<h2>Check the source code [#source-code]</h2>
<p>This integration is open source software. That means you can <a href="https://github.com/newrelic/nri-postgresql" title="Link opens in a new window.">browse its source code</a> and send improvements, or create your own fork and build it.</p>
