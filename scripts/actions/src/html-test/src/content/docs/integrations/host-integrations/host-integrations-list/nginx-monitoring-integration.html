
<p>Our NGINX <a href="https://docs.newrelic.com/docs/integrations/host-integrations/getting-started/introduction-host-integrations">integration</a> collects and sends inventory and metrics from your NGINX server to our platform, where you can see data on connections and client requests so that you can find the source of any problems.</p>
<p>Read on to install the integration, and to see what data we collect.</p>
<h2>Compatibility and requirements [#req]</h2>
<p>Our integration is compatible with both NGINX Open Source and NGINX Plus.</p>
<p>Before installing the integration, make sure that you meet the following requirements:</p>
<ul>
  <li>NGINX extension enabled, as described in the <a href="/docs/infrastructure/integrations/integrations/nginx-integration-new-relic-infrastructure#config">Configure the integration</a> section.</li>
  <li>If NGINX is <strong>not</strong> running on Kubernetes or Amazon ECS, you must <a href="/docs/infrastructure/install-infrastructure-agent/get-started/install-infrastructure-agent-new-relic">install the infrastructure agent</a> on a Linux OS host that's running NGINX. Otherwise:
    <ul>
      <li>If running on Kubernetes, see <a href="https://docs.newrelic.com/docs/monitor-service-running-kubernetes#requirements">these requirements</a>.</li>
      <li>If running on ECS, see <a href="/docs/integrations/host-integrations/host-integrations-list/monitor-services-running-amazon-ecs">these requirements</a>.</li>
    </ul>
  </li>
</ul>
<h2>Install and activate the integration [#install]</h2>
<p>To install the NGINX integration, follow the instructions for your environment:</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZWNzLWluc3RhbGwifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IkVDUyJ9XQ==">
    <div data-prop-text="title">ECS</div>
    <p>See <a href="/docs/integrations/host-integrations/host-integrations-list/monitor-services-running-amazon-ecs">Monitor service running on ECS</a>.</p>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiazhzLWluc3RhbGwifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6Ikt1YmVybmV0ZXMifV0=">
    <div data-prop-text="title">Kubernetes</div>
    <p>See <a href="/docs/monitor-service-running-kubernetes">Monitor service running on Kubernetes</a>.</p>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoibGludXgtaW5zdGFsbCJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiTGludXgifV0=">
    <div data-prop-text="title">Linux</div>
    <ol>
      <li>
        <p>Follow <a href="/docs/install-integrations-package">the general instructions for installing an integration</a>, using the filename <code>nri-nginx</code>. Then continue on to the steps below.</p>
      </li>
      <li>
        <p>Change the directory to the integrations configuration folder:</p>
        <pre><code>cd /etc/newrelic-infra/integrations.d
</code></pre>
      </li>
      <li>
        <p>Copy the sample configuration file:</p>
        <pre><code>sudo cp nginx-config.yml.sample nginx-config.yml
</code></pre>
      </li>
      <li>
        <p><a href="#config">Edit the configuration file</a> <code>nginx-config.yml</code>.</p>
      </li>
      <li>
        <p><a href="/docs/infrastructure/new-relic-infrastructure/configuration/start-stop-restart-check-infrastructure-agent-status">Restart</a> the infrastructure agent.</p>
      </li>
    </ol>
  </div>
</div>
<p>Additional notes:</p>
<ul>
  <li><strong>Advanced:</strong> Integrations are also available in <a href="/docs/integrations/host-integrations/installation/install-host-integrations-built-new-relic#tarball">tarball format</a> to allow for install outside of a package manager.</li>
  <li><strong>On-host integrations do not automatically update.</strong> For best results, regularly <a href="/docs/integrations/host-integrations/installation/update-infrastructure-host-integration-package">update the integration package</a> and <a href="/docs/infrastructure/new-relic-infrastructure/installation/update-infrastructure-agent">the infrastructure agent</a>.</li>
</ul>
<h2>Configure the integration [#config]</h2>
<p>An integration's YAML-format configuration is where you can place required login credentials and configure how data is collected. Which options you change depend on your setup and preference.</p>
<p>To capture data from the NGINX integration, you must first enable and configure the applicable extension module:</p>
<ul>
  <li>For NGINX Open Source: <a href="https://nginx.org/en/docs/http/ngx_http_stub_status_module.html">HTTP stub status module</a></li>
  <li>For NGINX Plus: <a href="https://nginx.org/en/docs/http/ngx_http_status_module.html">HTTP status module</a> and <a href="http://nginx.org/en/docs/http/ngx_http_api_module.html">HTTP API module</a></li>
</ul>
<p>There are several ways to configure the integration, depending on how it was installed:</p>
<ul>
  <li>If enabled via Kubernetes: see <a href="/docs/monitor-service-running-kubernetes">Monitor services running on Kubernetes</a>.</li>
  <li>If enabled via Amazon ECS: see <a href="/docs/integrations/host-integrations/host-integrations-list/monitor-services-running-amazon-ecs">Monitor services running on ECS</a>.</li>
  <li>If installed on-host: edit the config in the integration's YAML config file, <code>nginx-config.yml</code>.</li>
</ul>
<p>Config options include:</p>
<ul>
  <li>
    <p><code>metrics</code>: This command captures the metrics of a particular NGINX server. Arguments:</p>
    <ul>
      <li>
        <p><code>status_url</code>: The URL set up to provide the metrics using the status module. If the default value of <code>127.0.0.1</code> is incorrect, substitute the address/FQDN/URL for your system. Example:</p>
        <pre><code>status_url: http://127.0.0.1/status
</code></pre>
      </li>
    </ul>
  </li>
  <li>
    <p><code>inventory</code>: This command captures the configuration parameters set in the NGINX config file as <a href="#inventory">inventory data</a>. Arguments:</p>
    <ul>
      <li><code>config_path</code>: The path to the NGINX configuration file.</li>
      <li><code>status_url</code>: The URL is used to attach inventory data to the same NGINX instance for which we collect metrics.</li>
    </ul>
    <p>To disable inventory data collection, remove the inventory command.</p>
    <div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
      <p>When running in a container, to retrieve inventory data you <strong>need to</strong> map the local <strong>config_path</strong> into the container, otherwise the integration terminates. See instructions for <a href="https://docs.docker.com/storage/volumes/">Docker on how to map volumes to share files between the host and the container</a>.</p>
      <p>For Kubernetes, ECS, and potentially other environments where you can have more than one instance running, <code>inventory</code> is complex to configure. We <strong>strongly</strong> suggest disabling <code>inventory</code> in this case.</p>
    </div>
  </li>
  <li>
    <p><code>labels</code>: The <code>env</code> label controls the <code>environment</code> attribute. The default value is <code>production</code>.</p>
  </li>
</ul>
<h3>Activate remote monitoring [#remote-monitoring]</h3>
<p>You can use the <code>remote_monitoring</code> configuration parameter to enable remote monitoring and multi-tenancy for this integration. You must also have infrastructure agent version 1.2.25 or higher to use <code>remote_monitoring</code>.</p>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
  <p>Activating <code>remote_monitoring</code> may change some attributes and/or affect your configured alerts. For more information, see <a href="https://docs.newrelic.com/docs/remote-monitoring-host-integrations">remote monitoring in on-host integrations</a>.</p>
</div>
<h3>Environment variable passthroughs [#environment-variables]</h3>
<p>Environment variables can be used to control config settings, such as your license key, and are then passed through to the Infrastructure agent. For instructions on how to use this feature, see <a href="https://docs.newrelic.com/docs/infrastructure/new-relic-infrastructure/configuration/configure-infrastructure-agent#passthrough">Configure the Infrastructure agent</a>.</p>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
  <p>With secrets management, you can configure on-host integrations with New Relic Infrastructure's agent to use sensitive data (such as passwords) without having to write them as plain text into the integration's configuration file. For more information, see <a href="https://docs.newrelic.com/docs/integrations/host-integrations/installation/secrets-management">Secrets management</a>.</p>
</div>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiU1RBVFVTX1VSTCJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiU1RBVFVTX1VSTCJ9XQ==">
    <div data-prop-text="title">STATUS_URL</div>
    <p>The URL set up to provide the metrics using the status module.</p>
    <div data-component="Table" data-prop="W10=">
      <div>
        <div>
          <div>
            <p>Type</p>
          </div>
          <div>
            <p>String</p>
          </div>
        </div>
        <div>
          <div>
            <p>Default</p>
          </div>
          <div>
            <p><code>http://127.0.0.1/status</code></p>
          </div>
        </div>
      </div>
    </div>
    <p>Example:</p>
    <pre><code>STATUS_URL='http://your.ip.address:8080/status'

</code></pre>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiQ09ORklHX1BBVEgifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IkNPTkZJR19QQVRIIn1d">
    <div data-prop-text="title">CONFIG_PATH</div>
    <p>The path to the NGINX configuration file.</p>
    <div data-component="Table" data-prop="W10=">
      <div>
        <div>
          <div>
            <p>Type</p>
          </div>
          <div>
            <p>String</p>
          </div>
        </div>
        <div>
          <div>
            <p>Default</p>
          </div>
          <div>
            <p>/etc/nginx/nginx.conf</p>
          </div>
        </div>
      </div>
    </div>
    <p>Example:</p>
    <pre><code>CONFIG_PATH='/etc/nginx/custom/mynginx.conf'

</code></pre>
  </div>
</div>
<p>For more about the general structure of on-host integration configuration, see <a href="/docs/integrations/integrations-sdk/file-specifications/host-integration-configuration-overview">Configuration</a>.</p>
<h2>Find and use data [#find-and-use]</h2>
<p>Data from this service is reported to an <a href="/docs/integrations/new-relic-integrations/getting-started/infrastructure-integration-dashboards-charts">integration dashboard</a>.</p>
<p>Metrics are attached to the <code>NginxSample</code> <a href="/docs/using-new-relic/data/understand-data/new-relic-data-types#events-new-relic">event type</a>. You can <a href="/docs/using-new-relic/data/understand-data/query-new-relic-data">query this data</a> for troubleshooting purposes or to create custom charts and dashboards.</p>
<p>For more on how to find and use your data, see <a href="/docs/infrastructure/integrations/find-use-infrastructure-integration-data">Understand integration data</a>.</p>
<h2>Metrics</h2>
<p>The NGINX integration collects the following metric data attributes. To find these attributes, query the <code>NginxSample</code> event type.</p>
<h3>NGINX Open Source [#open-source]</h3>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>Metric</p>
      </div>
      <div>
        <p>Description</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p><code>net.connectionsActive</code></p>
      </div>
      <div>
        <p>Number of connections that are currently active</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>net.connectionsAcceptedPerSecond</code></p>
      </div>
      <div>
        <p>Number of accepted client connections per second</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>net.connectionsDroppedPerSecond</code></p>
      </div>
      <div>
        <p>Number of connections per second that were accepted but could not he handled and hence dropped</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>net.connectionsReading</code></p>
      </div>
      <div>
        <p>Current number of connections where NGINX is reading the request header</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>net.connectionsWaiting</code></p>
      </div>
      <div>
        <p>Current number of idle client connections waiting for a request</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>net.connectionsWriting</code></p>
      </div>
      <div>
        <p>Current number of connections where NGINX is writing the response back to the client</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>net.requestsPerSecond</code></p>
      </div>
      <div>
        <p>Total number of client requests per second</p>
      </div>
    </div>
  </div>
</div>
<h3>NGINX Plus [#plus]</h3>
<p>Our integration retrieves all available metric data from the following <a href="http://nginx.org/en/docs/http/ngx_http_api_module.html">HTTP API</a> endpoints: <code>/nginx</code>, <code>/processes</code>, <code>/connections</code>, <code>/http/requests</code>, and <code>/ssl</code>.</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>Metric</p>
      </div>
      <div>
        <p>Description</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p><code>net.connectionsAcceptedPerSecond</code></p>
      </div>
      <div>
        <p>Accepted client connections as requests per second</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>net.connectionsDroppedPerSecond</code></p>
      </div>
      <div>
        <p>Dropped client connections as requests per second</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>net.connectionsActive</code></p>
      </div>
      <div>
        <p>Current number of active client connections</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>net.connectionsIdle</code></p>
      </div>
      <div>
        <p>Current number of idle client connections</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>net.requests</code></p>
      </div>
      <div>
        <p>Current number of requests</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>net.requestsPerSecond</code></p>
      </div>
      <div>
        <p>Current number of requests per second</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>processes.respawned</code></p>
      </div>
      <div>
        <p>Current number of abnormally terminated and respawned child processes</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>ssl.handshakes</code></p>
      </div>
      <div>
        <p>Current number for successful SSL handshakes</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>ssl.failedHandshakes</code></p>
      </div>
      <div>
        <p>Current number of failed SSL handshakes</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>ssl.sessionReuses</code></p>
      </div>
      <div>
        <p>Current number of session reuses during SSL handshake</p>
      </div>
    </div>
  </div>
</div>
<h2>Inventory data [#inventory]</h2>
<p>The integration captures configuration options defined in the NGINX master config file (usually <code>nginx.conf</code>).</p>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJ0aXAifV0=">
  <p>The master NGINX config file can contain <code>"include OTHER_FILE_NAME"</code> commands for splitting the configuration into multiple files. The Infrastructure agent ignores (does not parse) configuration set via <code>include</code> commands.</p>
</div>
<h2>System metadata [#metadata]</h2>
<p>The integration collects these additional <a href="/docs/accounts-partnerships/education/getting-started-new-relic/glossary#attribute">attributes</a> about the NGINX service:</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>Name</p>
      </div>
      <div>
        <p>Description</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p><code>software.edition</code></p>
      </div>
      <div>
        <p>The NGINX edition: either <code>"open source"</code> or <code>"plus"</code>.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>software.version</code></p>
      </div>
      <div>
        <p>The version of NGINX.</p>
      </div>
    </div>
  </div>
</div>
<h2>Check the source code [#source-code]</h2>
<p>This integration is open source software. That means you can <a href="https://github.com/newrelic/nri-nginx" title="Link opens in a new window.">browse its source code</a> and send improvements, or create your own fork and build it.</p>
