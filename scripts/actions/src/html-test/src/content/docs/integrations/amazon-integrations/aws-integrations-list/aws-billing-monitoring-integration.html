
<p><a href="/docs/infrastructure/integrations-getting-started/getting-started/introduction-infrastructure-integrations">New Relic infrastructure integrations</a> include an integration for reporting your AWS Billing data to New Relic. This document explains how to activate this integration and describes the data that can be reported.</p>
<h2>Features</h2>
<p>New Relic's AWS Billing integration collects financial data for all your applications and AWS accounts, and then groups it in one place to make it easier for teams to gain cost visibility. This integration collects data from different sub-accounts and services, and also evaluates your <a href="http://docs.aws.amazon.com/awsaccountbilling/latest/aboutv2/budgets-managing-costs.html">AWS budgets</a> in terms of actual spend and forecasted spend.</p>
<p>For a practical look at how to set up and use this integration, read the <a href="https://blog.newrelic.com/2017/07/25/aws-billing-monitoring-integration/">AWS Billing integration blog post</a>.</p>
<h2>Requirements</h2>
<p>Before you <a href="#configure-budget">enable AWS budgets</a>, you must:</p>
<ul>
  <li>Set up an AWS budget through AWS Console for New Relic to collect AWS Billing data.</li>
  <li>Enable the <strong>Receive Billing Alerts</strong> checkbox in <strong>AWS console > Billing > Billing preferences</strong>.</li>
</ul>
<h2>Activate integration [#activate]</h2>
<p>To enable this integration follow standard procedures to <a href="https://docs.newrelic.com/docs/infrastructure/infrastructure-integrations/getting-started/connect-aws-integrations-infrastructure">Connect AWS services to New Relic</a>.</p>
<h2>Enable AWS budgets [#configure-budget]</h2>
<p>Enabling AWS budgets allows New Relic to capture service consumptions as well as usage and costs information for the budgets you configured in AWS.</p>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJ0aXAifV0=">
  <p>If you have <strong>not</strong> created a role in AWS, follow the procedure to <a href="/docs/infrastructure/infrastructure-integrations/getting-started/connect-aws-integrations-infrastructure#connect">connect AWS to New Relic</a> before configuring a budget policy.</p>
</div>
<ol>
  <li>
    <p>From the AWS Management console, select <strong>Services</strong> > <strong>IAM</strong> > <strong>Roles</strong>.</p>
  </li>
  <li>
    <p>Select the role you have configured for New Relic, then select <strong>Permissions</strong>.</p>
  </li>
  <li>
    <p>From the selected role's <strong>Inline policy</strong> tab, select the expand
      <div data-component="Icon" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJuYW1lIiwidmFsdWUiOiJmZS1jaGV2cm9uLWRvd24ifV0="></div>icon if one already exists, or select the option to add a new inline policy to the role.
    </p>
  </li>
  <li>
    <p>Select the option to add a custom policy.</p>
  </li>
  <li>
    <p>Enter a new custom policy name; for example, NewRelicBudget.</p>
  </li>
  <li>
    <p>Enter the following permission statement in the <strong>Policy Document</strong>:</p>
    <pre><code>{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "budgets:ViewBudget"
      ],
      "Resource": "*"
    }
  ]
}
</code></pre>
  </li>
  <li>
    <p>Save your changes.</p>
  </li>
</ol>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJ0aXAifV0=">
  <p>If you're configuring New Relic to fetch <a href="http://docs.aws.amazon.com/awsaccountbilling/latest/aboutv2/budgets-managing-costs.html">AWS budgets</a> data from an AWS member account, make sure that the account owner has <a href="https://docs.aws.amazon.com/awsaccountbilling/latest/aboutv2/grantaccess.html">activated IAM user access to the Billing and Cost Management console</a>.</p>
</div>
<h2>Find and use data [#find-data]</h2>
<p>To find your integration data in Infrastructure, go to <a href="http://one.newrelic.com"><strong>one.newrelic.com</strong></a> <strong>> Infrastructure > AWS</strong> and select one of the AWS Billing integration links.</p>
<p>For general information about how to find and use integration data, see <a href="/docs/infrastructure/integrations/find-use-infrastructure-integration-data">Understand integration data</a>.</p>
<p>Data is attached to the <code>FinanceSample</code> <a href="/docs/insights/use-insights-ui/getting-started/introduction-new-relic-insights#event-type">event type</a>. That event type can have four different <code>provider</code> values, depending on the type of billing data:</p>
<ul>
  <li><a href="#billing-budget">Budgets</a></li>
  <li><a href="#billing-service-cost">AWS service expenses</a></li>
  <li><a href="#billing-account-cost">Aggregated account and sub-account expenses</a></li>
  <li><a href="#billing-account-service">Unaggregated account/sub-account data, and unaggregated AWS service expenses</a></li>
</ul>
<p>Details for these types of billing data and how to query them are below:</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiYmlsbGluZy1idWRnZXQifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IkJ1ZGdldHMifV0=">
    <div data-prop-text="title">Budgets</div>
    <p>Data from the <code>BillingBudget</code> provider is related to AWS budgets. This data allows you to monitor:</p>
    <ul>
      <li>
        <p>Money spent on a budget</p>
      </li>
      <li>
        <p>Limits you set for each budget</p>
      </li>
      <li>
        <p>Forecasted expenses</p>
        <p>You can configure budgets based on usage or expense, in different currencies, or for a monthly, quarterly, or annual time period. Budgets are a great tool to monitor and control costs and take advantage of the AWS predictive model to see forecasted costs.</p>
        <p><strong>NRQL example</strong>: For a table of different budgets with actual spend, forecast, limits, and usage vs. monetary cost, run the following NRQL query:</p>
        <pre><code>SELECT latest(`provider.budgetType`) as 'Budget Type',
	max(`provider.actualAmount`) as 'Actual Amount',
	max(`provider.limitAmount`) as 'Budget Limit',
	latest(`provider.forecastedAmount`) as 'Forecast' 
FROM FinanceSample 
WHERE provider='BillingBudget' 
AND providerAccountId = 'NEW_RELIC_ID_FOR_YOUR_CLOUD_ACCOUNT*' 
FACET `provider.budgetName` 
SINCE 1 day ago
</code></pre>
        <p>*You can find New Relic's ID representing your cloud service account in the URL of any New Relic AWS dashboard.</p>
      </li>
    </ul>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiYmlsbGluZy1zZXJ2aWNlLWNvc3QifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IkFnZ3JlZ2F0ZWQgc2VydmljZSBjb3N0cyJ9XQ==">
    <div data-prop-text="title">Aggregated service costs</div>
    <p>The data stored in the <code>BillingServiceCost</code> provider is aggregated for service costs containing the latest and most recent data for all AWS service costs in all registered accounts.</p>
    <div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJ0aXAifV0=">
      <p>If you have configured multiple AWS accounts, New Relic recommends filtering by each account with the attribute <code>providerAccountName</code> or <code>providerAccountId</code>.</p>
    </div>
    <p><strong>NRQL example</strong>: To group providers by service names, run the following NRQL query:</p>
    <pre><code>SELECT latest(`provider.estimatedCharges.Maximum`) 
FROM FinanceSample  
WHERE provider='BillingServiceCost' 
AND providerAccountId = 'NEW_RELIC_ID_FOR_YOUR_CLOUD_ACCOUNT*' 
SINCE 1 day ago 
FACET `provider.serviceName` 
LIMIT 20

</code></pre>\*You can find New Relic's ID representing your cloud service account in the URL of any New Relic AWS dashboard.
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiYmlsbGluZy1hY2NvdW50LWNvc3QifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IkFnZ3JlZ2F0ZWQgYWNjb3VudC9zdWJhY2NvdW50IGNvc3RzIn1d">
    <div data-prop-text="title">Aggregated account/subaccount costs</div>
    <p>The <code>BillingAccountCost</code> provider stores aggregated data for account and sub-accounts containing the latest and most recent aggregate of financial data. Please bear in mind that if you have many AWS Accounts configured it is recommended to filter by each account with the attribute <code>providerAccountName</code> or <code>providerAccountId</code>.</p>
    <p><strong>NRQL example</strong>: To group providers by account names, run the following NRQL query:</p>
    <pre><code>SELECT latest(`provider.estimatedCharges.Maximum`) 
FROM FinanceSample  
WHERE provider='BillingAccountCost' 
AND providerAccountId = 'NEW_RELIC_ID_FOR_YOUR_CLOUD_ACCOUNT*' 
SINCE 1 day ago 
FACET `provider.accountId` 
LIMIT 20

</code></pre>\*You can find New Relic's ID representing your cloud service account in the URL of any New Relic AWS dashboard.
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiYmlsbGluZy1hY2NvdW50LXNlcnZpY2UifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IlVuYWdncmVnYXRlZCBhY2NvdW50L3N1YmFjY291bnQgYW5kIEFXUyBzZXJ2aWNlIGNvc3RzIn1d">
    <div data-prop-text="title">Unaggregated account/subaccount and AWS service costs</div>
    <p>The <code>BillingAccountServiceCost</code> provider contains unaggregated data filterable by AWS account ID or AWS service name.</p>
    <p><strong>NRQL example</strong>: To understand the cost split of AWS services for a particular AWS account ID, run the following NRQL query:</p>
    <pre><code>SELECT latest(`provider.estimatedCharges.Maximum`) 
FROM FinanceSample 
WHERE provider='BillingAccountServiceCost' 
AND providerAccountId = 'NEW_RELIC_ID_FOR_YOUR_CLOUD_ACCOUNT*' 
SINCE 1 day ago 
FACET `provider.serviceName`
LIMIT 100

</code></pre>\*You can find New Relic's ID representing your cloud service account in the URL of any New Relic AWS dashboard.
    <pre><code>
SELECT latest(`provider.estimatedCharges.Maximum`) 
	FROM FinanceSample 
	WHERE provider='BillingAccountServiceCost' 
	AND providerAccountId = 'NEW_RELIC_ID_FOR_YOUR_CLOUD_ACCOUNT*' 
	AND `provider.serviceName`='AmazonEC2' 
	FACET `provider.accountId` 
	SINCE 1 day ago 
	LIMIT 100

</code></pre>**NRQL example**: To understand the cost split of AWS accounts for your AWS EC2 service, run the following NRQL query:
  </div>
</div>
<h2>Configuration and polling [#polling]</h2>
<p>You can change the polling frequency and filter data using <a href="/docs/integrations/new-relic-integrations/getting-started/configure-polling-frequency-data-collection-cloud-integrations">configuration options</a>.</p>
<p><a href="/docs/infrastructure/amazon-integrations/aws-integrations-list/aws-polling-intervals-infrastructure-integrations">Default polling</a> information for the AWS Billing integration:</p>
<ul>
  <li>New Relic polling interval: 1 hour</li>
  <li>Amazon CloudWatch data interval: 4 hours</li>
</ul>
<h2>Metric data [#metrics]</h2>
<p>The New Relic infrastructure AWS Billing integration collects the following metric data:</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p><strong>Data</strong></p>
      </div>
      <div>
        <p><strong>Description</strong></p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p>AWS Billing metrics</p>
      </div>
      <div>
        <p><code>EstimatedCharges</code>: The estimated charges for your AWS usage. This can either be estimated charges for one service or a rollup of estimated charges for all services. The currency is USD.</p>
      </div>
    </div>
    <div>
      <div>
        <p>AWS Budgets metrics</p>
      </div>
      <div>
        <ul>
          <li><code>actualAmount</code>: The actual cost or usage being tracked by a budget.</li>
          <li><code>limitAmount</code>: The total amount of cost or usage that you want to track with a budget as an upper limit.</li>
          <li><code>forecastedAmount</code>: The forecasted cost or usage being tracked by a budget.</li>
        </ul>
      </div>
    </div>
  </div>
</div>
<h2>Inventory data [#inventory]</h2>
<p>Inventory data provides information about the service's state and configuration. For more about inventory data, see <a href="/docs/infrastructure/integrations-getting-started/getting-started/understand-integration-data-data-types#inventory-data">Understand and use data</a>.</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>Name</p>
      </div>
      <div>
        <p>Description</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p><strong>/budgets</strong></p>
      </div>
      <div>
        <ul>
          <li><code>name</code>: The name of a budget. Unique within accounts.</li>
          <li><code>startTime</code>: Start date for the period of time covered by a budget.</li>
          <li><code>endTime</code>: End date for the period of time covered by a budget.</li>
          <li><code>limitAmount</code>: The total amount of cost or usage that you want to track with a budget as an upper limit.</li>
          <li><code>limitUnit</code>: The unit of measurement used for the budget forecast, actual spend, or budget threshold, such as dollars or GB.</li>
          <li><code>timeUnit</code>: The length of time until a budget resets the actual and forecasted spend. Valid values: monthly, quarterly, annually.</li>
          <li><code>type</code>: Whether this budget tracks monetary cost or usage.</li>
        </ul>
      </div>
    </div>
    <div>
      <div>
        <p><strong>/budgets/costFilters</strong></p>
      </div>
      <div>
        <p><code>name</code>: The name of a budget. Unique within accounts.</p>
      </div>
    </div>
  </div>
</div>
<h2>Other system data [#attributes]</h2>
<p>The AWS Billing integration also collects the following <a href="/docs/accounts-partnerships/education/getting-started-new-relic/glossary#attribute">attributes</a>:</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p><strong>Attributes</strong></p>
      </div>
      <div>
        <p><strong>Description</strong></p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p>AWS Billing attributes</p>
      </div>
      <div>
        <ul>
          <li><code>Service Name</code>: The name of the AWS service. This dimension is omitted for the total of estimated charges across all services.</li>
          <li><code>Linked Account</code>: The linked account number.</li>
        </ul>
      </div>
    </div>
    <div>
      <div>
        <p>AWS Budgets attributes</p>
      </div>
      <div>
        <ul>
          <li><code>budgetName</code>: The name of a budget. Unique within accounts</li>
          <li><code>budgetType</code>: Whether the budget tracks monetary cost or usage</li>
        </ul>
      </div>
    </div>
  </div>
</div>
