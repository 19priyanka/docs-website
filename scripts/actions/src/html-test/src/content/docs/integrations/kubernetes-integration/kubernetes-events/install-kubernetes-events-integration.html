
<p>The New Relic Kubernetes events integration watches for events happening in your Kubernetes clusters and sends those events to New Relic. To visualize your event data, use the <a href="/docs/integrations/kubernetes-integration/cluster-explorer/kubernetes-cluster-explorer">Kubernetes cluster explorer</a> in <a href="/docs/new-relic-one/use-new-relic-one/get-started/introduction-new-relic-one">New Relic One</a> platform, or use the infrastructure <a href="/docs/infrastructure/new-relic-infrastructure/infrastructure-ui-pages/infrastructure-events-page-live-feed-every-config-change">events UI</a>.</p>
<h2>Requirements</h2>
<p>The Kubernetes events integration requires:</p>
<ul>
  <li>New Relic <a href="/docs/integrations/kubernetes-integration/installation/kubernetes-installation-configuration">Kubernetes integration</a> installed and activated.</li>
  <li>Kubernetes pod with the label <code>app.kubernetes.io/name=nri-kube-events</code> and two containers, one used to capture events in the Kubernetes cluster and the other to forward the events to New Relic.</li>
</ul>
<h2>Install the Kubernetes events integration [#install]</h2>
<p>To install the New Relic Kubernetes events integration in a Kubernetes environment:</p>
<ol>
  <li>
    <p>Download the integration manifest YAML file:</p>
    <pre><code>curl -O https://download.newrelic.com/infrastructure_agent/integrations/kubernetes/nri-kube-events-latest.yaml
</code></pre>
  </li>
  <li>
    <p>Edit the <code>nri-kube-events-latest.yaml</code> manifest file, adding both a cluster name, to identify your Kubernetes cluster (required), and your <a href="/docs/accounts-partnerships/accounts/account-setup/license-key">New Relic license key</a> (required).</p>
    <pre><code>clusterName: "YOUR_CLUSTER_NAME"
[...]
	- name: "NRIA_LICENSE_KEY"
	value: "YOUR_LICENSE_KEY"
</code></pre>
  </li>
  <li>
    <p>Deploy the integration in your Kubernetes cluster:</p>
    <pre><code>kubectl apply -f nri-kube-events-latest.yaml
</code></pre>
  </li>
  <li>
    <p>To confirm that the integration has been configured correctly, wait a few minutes, then go to <strong><a href="https://one.newrelic.com">one.newrelic.com</a> > Query builder</strong>, and run the following NRQL query to see if data has been reported:</p>
    <pre><code>FROM InfrastructureEvent SELECT count(*) WHERE clusterName = 'YOUR_CLUSTER_NAME' since 1 hour ago
</code></pre>
  </li>
</ol>
<h2>View your Kubernetes events [#use-data]</h2>
<p>Once you have successfully installed the Kubernetes event integration, you can view and query your events in New Relic.</p>
<p>To add events to your <a href="/docs/dashboards/new-relic-one-dashboards/get-started/introduction-new-relic-one-dashboards">New Relic One dashboard</a>:</p>
<ol>
  <li>
    <p>Add a chart to a <a href="/docs/insights/new-relic-insights/managing-dashboards-data/building-insights-dashboards">new or existing dashboard</a> or create a chart using the New Relic <a href="/docs/chart-builder/use-chart-builder/get-started/introduction-chart-builder">chart builder</a>.</p>
  </li>
  <li>
    <p>When creating or updating your chart, select the chart type <strong>table</strong> and use the following event query, replacing YOUR_CLUSTER_NAME with the name of your cluster:</p>
    <pre><code>FROM InfrastructureEvent SELECT
event.involvedObject.kind,event.involvedObject.name,event.reason,event.message 
WHERE clusterName = 'YOUR_CLUSTER_NAME' limit 100
</code></pre>
  </li>
</ol>
<h2>Query events [#data-insights]</h2>
<p>Here are a few examples to <a href="/docs/using-new-relic/data/understand-data/query-new-relic-data">query your data</a>:</p>
<h3>Get attributes names [#attributes-names]</h3>
<p>To see all the attributes names, use the following query:</p>
<pre><code>FROM InfrastructureEvent SELECT keyset() WHERE category = 'kubernetes'
</code></pre>
<h3>See event details [#event-details]</h3>
<p>To see details about the latest events in a cluster, use the following query, replacing YOUR_CLUSTER_NAME with the name of your cluster:</p>
<pre><code>FROM InfrastructureEvent SELECT event.involvedObject.kind, 
event.involvedObject.name, event.type, event.message, event.reason WHERE 
category = 'kubernetes' AND clusterName='YOUR_CLUSTER_NAME'â€‹
</code></pre>
<p>The events collected by New Relic will have the exact same attributes as given by Kubernetes. For a reference of these attributes, see the <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.10/#event-v1-core">Kubernetes documentation's event v1 core reference</a>.</p>
<h3>Search events in New Relic [#data-infrastructure]</h3>
<p>To search events in the New Relic Infrastructure UI:</p>
<ol>
  <li><a href="http://one.newrelic.com">Navigate to the Infrastructure event page</a>: Go to <a href="http://one.newrelic.com"><strong>one.newrelic.com</strong></a> <strong>> Infrastructure</strong> <strong>> Events</strong>.</li>
  <li>In <strong>Category</strong>, select <strong>kubernetes</strong>.</li>
  <li>Use the
    <div data-component="Icon" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJuYW1lIiwidmFsdWUiOiJmZS1zZWFyY2gifV0="></div><strong>Search events</strong> field to look for specific events. To focus on a specific set of events, select or change the <a href="/docs/scopes-organize-your-infrastructure">filter set</a>.
  </li>
</ol>
<h3>View events in the Kubernetes cluster explorer [#data-cluster]</h3>
<p>To view events in the Kubernetes cluster explorer, use either of these methods:</p>
<ul>
  <li><strong>In New Relic One</strong>: Go to <strong><a href="http://one.newrelic.com">one.newrelic.com</a> > Kubernetes cluster explorer</strong>.</li>
</ul>
<p>Then, to view the pod details:</p>
<ol>
  <li>In the Kubernetes cluster explorer, select a pod.</li>
  <li>Select <strong>Show pod events</strong>.</li>
</ol>
<h2>Optional: Collect metrics of the event collector [#events-mentrics]</h2>
<p>To collect metric data for the event collector itself, install the New Relic Prometheus OpenMetrics integration. To get started:</p>
<ol>
  <li>Install the New Relic <a href="/docs/integrations/prometheus-integrations/prometheus-kubernetes/new-relic-prometheus-openmetrics-integration-kubernetes">Prometheus OpenMetrics integration</a>.</li>
  <li>Label the deployment of your Kubernetes events integration with your configured scrape label (default is <code>prometheus.io/scrape=true</code>).</li>
</ol>
<h2>Optional: Define custom attributes [#custom-attributes]</h2>
<p>To add custom attributes to the events sent by the integration these need to be specified as environment variables following the nomenclature <code>NRI_KUBE_EVENTS_attributeKey=attributeValue</code>. These environment variables should be defined as part of the spec for the <code>kube-events</code> container.</p>
<p>For example, to add the attribute <code>environment</code> with value <code>staging</code> to all the events, you need to add the following to your manifest:</p>
<pre><code>env: 
  - name: NRI_KUBE_EVENTS_environment 
    value: dev
</code></pre>
<p>Remember that the environment should be specified in the spec for the <code>kube-events</code> container, making your manifest look something like:</p>
<pre><code>...
kind: Deployment
...
spec:
  ...
  template:
    ...
    spec:
      containers:
        - name: kube-events
          ...
          env:
            - name: NRI_KUBE_EVENTS_environment
              value: dev
</code></pre>
<h2>Troubleshooting</h2>
<p>Here are some troubleshooting tips when using the Kubernetes events integration.</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoibG9ncy1vbi1jb2xsZWN0aW9uIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJHZXQgbG9ncyBvbiBldmVudCBjb2xsZWN0aW9uIn1d">
    <div data-prop-text="title">Get logs on event collection</div>
    <p>To check the logs of our event collector:</p>
    <pre><code>kubectl logs deploy/nr-kube-events kube-events

</code></pre>To add more details, enable verbose mode by adding `verbose: "true"` in the `config` section of you configuration file, either before or after the `clusterName`.
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoibG9ncy1vbi1zZW5kaW5nIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJHZXQgbG9ncyBvbiBzZW5kaW5nIGV2ZW50cyJ9XQ==">
    <div data-prop-text="title">Get logs on sending events</div>
    <p>To check the logs of the agent responsible for sending the events to New Relic:</p>
    <pre><code>kubectl logs deploy/nr-kube-events infra-agent

</code></pre>
  </div>
</div>
