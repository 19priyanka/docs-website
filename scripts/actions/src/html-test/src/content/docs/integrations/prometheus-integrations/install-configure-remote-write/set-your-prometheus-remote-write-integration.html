
<p>You can get Prometheus data flowing in New Relic with just a few simple steps. If you don't already have an account, you can <a href="https://newrelic.com/signup/">sign up for New Relic right now</a>.</p>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
  <p>This page covers basic setup for the remote write integration, as well as a few common troubleshooting topics. For information on integrating Prometheus servers in a high availability (HA) configuration, see the <a href="/docs/prometheus-high-availability-ha">Prometheus High Availability</a> resource.</p>
</div>
<h2>Set up the integration [#setup]</h2>
<p>From the <a href="https://one.newrelic.com/launcher/nr1-core.settings?pane=eyJuZXJkbGV0SWQiOiJwcm9tZXRoZXVzLXJlbW90ZS13cml0ZS1pbnRlZ3JhdGlvbi1uZXJkbGV0cy5zZXR1cC1wcm9tZXRoZXVzIn0=">Prometheus remote write setup page</a>, complete these steps.</p>
<ol>
  <li>
    <p>Enter a name for the Prometheus server youâ€™re connecting to and your <code>remote_write</code> URL.</p>
    <div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
      <p>The name you enter for the server will create an attribute on your data, and will be the name used to identify which Prometheus server you're sending data from.</p>
    </div>
  </li>
  <li>
    <p>Add a new <code>remote_write</code> URL to your Prometheus YML file. A good place to add this information is under <code>global_config</code> in the file, at the same indentation level as the <code>global</code> section. We recommend to use the following syntax:</p>
    <pre><code>remote_write: 
- url: https://metric-api.newrelic.com/prometheus/v1/write?prometheus_server=YOUR_DATA_SOURCE_NAME  
  bearer_token:YOUR_LICENSE_KEY
</code></pre>
    <p>Alternatively, you could use this configuration:</p>
    <pre><code>remote_write: 
- url: https://metric-api.newrelic.com/prometheus/v1/write?X-License-Key=YOUR_LICENSE_KEY&#x26;prometheus_server=YOUR_DATA_SOURCE_NAME
</code></pre>
    <div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
      <p>If you are completing the remote write integration using Kubernetes and Helm, you should instead add the remote write URL to your Helm <a href="https://github.com/helm/charts/blob/c40486ab2eba0391119b7cc1509d6958fd21c31d/stable/prometheus/values.yaml#L631"><code>values.yaml</code></a> file. Replace <code>remoteWrite: []</code> with two lines similar to the example below. Be sure to use your remote write URL and use indentation that matches the rest of the file:</p>
      <pre><code>remoteWrite: 
- url: https://metric-api.newrelic.com/prometheus/v1/write?prometheus_server=YOUR_DATA_SOURCE_NAME 
  bearerToken:YOUR_LICENSE_KEY
</code></pre>
    </div>
    <div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJ0aXAifV0=">
      <p>If you're connecting from the EU, use the url</p>
      <p><code>https://metric-api.eu.newrelic.com/prometheus/v1/write.</code></p>
    </div>
  </li>
  <li>
    <p>Restart your Prometheus server.</p>
  </li>
  <li>
    <p>View your data.</p>
    <div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJ0aXAifV0=">
      <p>You can use the remote write <a href="/docs/query-your-data/explore-query-data/dashboards/introduction-dashboards">dashboard</a> we automatically create when you set up your integration.</p>
    </div>
  </li>
</ol>
<div data-component="ButtonLink" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJkYXRhLXRlc3NlbiIsInZhbHVlIjoic3RpdGNoZWRQYXRoTGlua0NsaWNrIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InJvbGUiLCJ2YWx1ZSI6ImJ1dHRvbiJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0byIsInZhbHVlIjoiaHR0cHM6Ly9vbmUubmV3cmVsaWMuY29tL2xhdW5jaGVyL25yMS1jb3JlLnNldHRpbmdzP3BhbmU9ZXlKdVpYSmtiR1YwU1dRaU9pSndjbTl0WlhSb1pYVnpMWEpsYlc5MFpTMTNjbWwwWlMxcGJuUmxaM0poZEdsdmJpMXVaWEprYkdWMGN5NXpaWFIxY0Mxd2NtOXRaWFJvWlhWekluMD0ifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidmFyaWFudCIsInZhbHVlIjoicHJpbWFyeSJ9XQ==">
  <p>Add Prometheus data</p>
</div>
<h2>Mapping of Prometheus metric types [#mapping]</h2>
<p>The Prometheus remote write protocol does not include <a href="/docs/telemetry-data-platform/ingest-manage-data/understand-data/metric-data-type#metric-types">metric type</a> information or other helpful metric metadata when sending metrics to New Relic. Because the remote write protocol doesn't include this information, New Relic infers the metric type based on Prometheus naming conventions. Metrics not following these naming conventions may not be mapped correctly.</p>
<p>New Relic maps Prometheus metrics types into New Relic metric types based on Prometheus metric naming conventions as follows:</p>
<ul>
  <li><code>metricName_bucket</code> is stored as a New Relic count metric type</li>
  <li><code>metricName_count</code> is stored as a New Relic count metric type</li>
  <li><code>metricName_total</code> is stored as a New Relic count metric type</li>
  <li><code>metricName_sum</code> is stored as a New Relic summary metric type</li>
</ul>
<p>Everything else is stored as a New Relic gauge metric type.</p>
<h2>Customize remote write behavior [#customize]</h2>
<p>You may be interested in customizing the following parameters if you are writing to more than one account in New Relic or are connecting more than one Prometheus data source to the same account in New Relic. For more information, see the <a href="https://prometheus.io/docs/practices/remote_write/">docs on remote write tuning</a>.</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoieC1saWNlbnNlLWtleSJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiWC1MaWNlbnNlIEtleSJ9XQ==">
    <div data-prop-text="title">X-License Key</div>
    <p>Your account's <a href="/docs/accounts/install-new-relic/account-setup/license-key">license key</a> is not an API key. The license key is used for authentication and to identify which account to write data into.</p>
    <p>Details:</p>
    <ul>
      <li>If you are configuring Prometheus to write into different New Relic accounts or sub-accounts you should use a different key on each remote write URL.</li>
    </ul>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoicHJvbWV0aGV1c19zZXJ2ZXItdXJsLXBhcmFtZXRlciJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjp7InR5cGUiOiJtZHhWYWx1ZUV4cHJlc3Npb24iLCJ2YWx1ZSI6Ijw+PElubGluZUNvZGU+cHJvbWV0aGV1c19zZXJ2ZXI8L0lubGluZUNvZGU+IFVSTCBwYXJhbWV0ZXI8Lz4iLCJwb3NpdGlvbiI6eyJzdGFydCI6eyJsaW5lIjoxMDksImNvbHVtbiI6MTEsIm9mZnNldCI6NTQ0MH0sImVuZCI6eyJsaW5lIjoxMDksImNvbHVtbiI6NzQsIm9mZnNldCI6NTUwM319fX1d">
    <div data-prop-text="title">[object Object]</div>
    <p>The <code>prometheus_server</code> parameter is a label or attribute used to add to stats that are written to <a href="https://newrelic.com/resources/ebooks/inside-nrdb-flexible-unified-database">NRDB</a>. You should use this same label when <a href="/docs/configure-prometheus-data-source-grafana">configuring your Grafana data source</a> to limit results to just those from a particular <code>prometheus_server</code>.</p>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoib3B0aW1pemUtdGhyb3VnaHB1dCJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiT3B0aW1pemUgdGhyb3VnaHB1dCBhbmQgbWVtb3J5IGNvbnN1bXB0aW9uIn1d">
    <div data-prop-text="title">Optimize throughput and memory consumption</div>
    <p>Remote write <a href="https://prometheus.io/docs/practices/remote_write/#memory-usage">increases the total memory consumption</a> of your Prometheus servers.</p>
    <p>If you're experiencing issues we recommend the following:</p>
    <ul>
      <li>Increase <a href="https://prometheus.io/docs/practices/remote_write/#max_samples_per_send"><code>max_samples_per_send</code></a> for higher throughput workloads, along a proportional increase in <a href="https://prometheus.io/docs/practices/remote_write/#capacity"><code>capacity</code></a>.</li>
      <li>If memory consumption is still a problem, try limiting the number of <a href="https://prometheus.io/docs/practices/remote_write/#max_shards"><code>max_shards</code></a> per server.</li>
    </ul>
  </div>
</div>
<h2>Error messages</h2>
<p>If you receive an integration error message from New Relic or error messages in your Prometheus server logs after restarting your Prometheus server, there are several actions you can take to get data flowing properly.</p>
<p>For detailed information about common errors including missing or incorrect characters, bad request errors, request entity too large errors, rate limit errors and the associated fixes, see <a href="/docs/integrations/prometheus-integrations/install-configure-remote-write/remote-write-errors-error-messages">Remote write errors and error messages</a>.</p>
<h2>Remove the integration [#remove-integration]</h2>
<p>To remove the integration, remove the configuration code snippet from your Prometheus YML file and restart the server.</p>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
  <p>When you remove the integration, this stops new data from flowing, but will not purge or remove any historical data.</p>
</div>
