
<p>You can configure a <a href="https://grafana.com/docs/grafana/latest/features/datasources/prometheus/">Prometheus data source</a> in <a href="https://grafana.com/login">Grafana</a> to query data stored in the New Relic Database (NRDB) using our <a href="/docs/integrations/prometheus-integrations/view-query-data/supported-promql-features">PromQL-style query language</a>.</p>
<h2>Add a Prometheus data source [#create-update]</h2>
<p>Follow these steps to add New Relic as a Prometheus data source for Grafana.</p>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
  <p>You must <a href="/docs/integrations/prometheus-integrations/install-configure/set-your-prometheus-remote-write-integration">complete the Prometheus remote-write integration</a> process prior to beginning the configuration process.</p>
</div>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
  <p>These instructions detail how to complete the process when working with Grafana versions 6.7 and higher.</p>
</div>
<ol>
  <li>
    <p>On New Relic, <a href="/docs/apis/get-started/intro-apis/types-new-relic-api-keys">Create a new Query key</a>.</p>
    <div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
      <p>Note: In Grafana, you'll need put this in a custom <strong>X-Query-Key</strong> HTTP header (see step 7 below), but it is the same entity as the New Relic Query key.</p>
    </div>
  </li>
  <li>
    <p>From the <a href="https://grafana.com/login">Grafana</a> <strong>Home</strong> screen, go to <strong>Configuration > Data Sources</strong> and click <strong>Add data source</strong>.</p>
  </li>
  <li>
    <p>From the <strong>Add data source</strong> screen under <strong>Time series databases</strong> options, select <strong>Prometheus</strong>.</p>
  </li>
  <li>
    <p>Enter the <strong>Name</strong> you want to use for your new Prometheus data source.</p>
  </li>
  <li>
    <p>Set the <strong>Default</strong> toggle to the on or off position, depending on whether you want this to be your default data source for Prometheus queries.</p>
    <ul>
      <li>Off: this is not your default data source</li>
      <li>On: this is your default data source</li>
    </ul>
  </li>
  <li>
    <p>Enter the correct <strong>URL</strong>:</p>
    <ul>
      <li>US: <a href="https://prometheus-api.newrelic.com">https://prometheus-api.newrelic.com</a></li>
      <li>EU: <a href="https://prometheus-api.eu.newrelic.com">https://prometheus-api.eu.newrelic.com</a></li>
    </ul>
  </li>
  <li>
    <p>Under <strong>Custom Headers</strong>, select <strong>Add Header</strong>. Set the <strong>Header</strong> name to <strong>X-Query-Key.</strong> For the <strong>Value</strong>, enter to the Query key you created in step 1.</p>
  </li>
  <li>
    <p>Click <strong>Save &#x26; Test</strong>.</p>
  </li>
</ol>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJ0aXAifV0=">
  <p>If your line graphs appear as a series of dots and not as connected lines, you can change in Graphana's <strong><a href="https://grafana.com/docs/grafana/latest/panels/visualizations/graph-panel/">Graph panel</a></strong> and selecting <strong>Stacking and null value > connected</strong>.</p>
</div>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
  <p>New Relic strongly recommends using versions 6.7.x and higher to configure New Relic as a Prometheus data source. If you do chose to complete the configuration while running an earlier version, you will need to do one of the following to successfully configure your data source:</p>
  <ul>
    <li>Configure the new data source to use basic authentication and then enter the Query-key as the password in the basic authentication workflow.</li>
    <li>Configure the new data source URL to include the Query-key: <code>https://prometheus-api.newrelic.com/auth/`&#x3C;query-key>`</code></li>
  </ul>
</div>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJTYW1wbGUgY29uZmlndXJhdGlvbiBpbWFnZSJ9XQ==">
    <div data-prop-text="title">Sample configuration image</div>
    <p>
      <img src="./images/Grafana-Data-Source-Config_0.png" alt="Screen capture of the add data source workflow in Grafana" title="Configure New Relic as a Prometheus data source for Grafana">
    </p>
    <p>Grafana Data Source Config.png, by <a href="/users/dbarnesbrownnewreliccom">dbarnesbrown.newrelic.com</a></p>
  </div>
</div>
<h2>Customize Prometheus API behavior [#customize-API]</h2>
<p>Headers are particularly important if you have connected multiple Prometheus servers to New Relic using the <a href="/docs/integrations/prometheus-integrations/install-configure/set-your-prometheus-remote-write-integration">remote write integration</a>. Here are some details about customization.</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJYLVF1ZXJ5LUtleSAoUXVlcnkga2V5KSJ9XQ==">
    <div data-prop-text="title">X-Query-Key (Query key)</div>
    <p>The <a href="/docs/apis/get-started/intro-apis/types-new-relic-api-keys#x-query-key">Query key</a> parameter is required to authenticate with New Relic and identify the account containing your metrics. Grafana calls this an <strong>X-Query key</strong>, while it appears as a <strong>Query key</strong> in the New Relic UI.</p>
    <p>Details:</p>
    <ul>
      <li>Required</li>
      <li>An API query key used for authentication</li>
      <li>If you are using the Prometheus remote write integration, the X-Query-Key should correspond to the same account as the X-License-Key used to integrate for remote write</li>
    </ul>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJYLVByb21ldGhldXMtT25seSJ9XQ==">
    <div data-prop-text="title">X-Prometheus-Only</div>
    <div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
      <p>Grafana's auto-complete support doesn't handle metrics that fail to strictly conform to Prometheus naming conventions. New Relic recommends you exclude any metrics that do not conform from this parameter.</p>
    </div>
    <p>Details:</p>
    <ul>
      <li>Optional</li>
      <li>Limits metrics exposed by the API to those originating from Prometheus</li>
      <li>Default = true if not specified</li>
    </ul>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJYLVByb21ldGhldXMtU2VydmVyIn1d">
    <div data-prop-text="title">X-Prometheus-Server</div>
    <p>This parameter is useful if you are collecting metrics from multiple Prometheus servers. For example, if you are using Grafana, you might want to create a data source for each Prometheus server connected to New Relic and then another data source that can be used to query across all Prometheus servers.</p>
    <p>Details:</p>
    <ul>
      <li>Optional</li>
      <li>Limits metrics exposed by the API to those collected from the specified Prometheus server</li>
      <li>This value should match the <code>prometheus_server</code> URL parameter in the remote write URL used to connect to your prometheus server to New Relic</li>
      <li>Defaults to return metrics collected from all servers</li>
    </ul>
  </div>
</div>
<h2>Delete a Prometheus data source [#delete]</h2>
<p>To delete a data source in Grafana:</p>
<ol>
  <li>Go to <strong>Configuration > Data Sources</strong>.</li>
  <li>Click on the data source you want to delete.</li>
  <li>Click the <strong>Delete</strong> button at the bottom of the page.</li>
</ol>
