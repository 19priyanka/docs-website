
<p>To query and visualize the metrics collected for your Prometheus OpenMetrics or remote write integration with New Relic, you can use <a href="/docs/query-data/nrql-new-relic-query-language/getting-started/nrql-syntax-components-functions">NRQL</a>. You can also <a href="https://docs.newrelic.com/docs/integrations/prometheus-integrations/view-query-data/translate-promql-queries-nrql">translate your PromQL-style queries to NRQL</a> using either Grafana or the <a href="/docs/query-your-data/explore-query-data/query-builder/use-advanced-promql-style-mode-query-data">query builder</a>.</p>
<p>All metrics for Docker and Kubernetes are stored in the <code>Metric</code> type.</p>
<h2>Default attributes for the OpenMetrics integration [#default-attributes]</h2>
<p>By default, the following attributes will be added to all metrics for Docker and Kubernetes integrations:</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>Default attributes<br>(all integrations)</p>
      </div>
      <div>
        <p>Description</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p><code>clusterName</code></p>
      </div>
      <div>
        <p>The name of the cluster provided in the scraper configuration.</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p><code>integrationName</code></p>
      </div>
      <div>
        <p>The name of this integration (<code>nri-prometheus</code>).</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>integrationVersion</code></p>
      </div>
      <div>
        <p>The version of the integration; for example, <code>0.2.0</code>.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>metricName</code></p>
      </div>
      <div>
        <p>The name of the metric itself.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>nrMetricType</code></p>
      </div>
      <div>
        <p>The type of the New Relic <code>Metric</code> type; for example, <code>Gauges</code>.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>promMetricType</code></p>
      </div>
      <div>
        <p>The metric type of the Prometheus metric</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>scrapedEndpoint</code></p>
      </div>
      <div>
        <p>The URL of the endpoint is being scraped.</p>
      </div>
    </div>
  </div>
</div>
<p>
  <img src="./images/img-integration-k8s%402x.png" alt="img-integration-k8s@2x.png" title="img-integration-k8s@2x.png"> <strong>Kubernetes:</strong> If the scraper is running in Kubernetes, New Relic also adds the following attributes to all the metrics:
</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>Additional Kubernetes attributes</p>
      </div>
      <div>
        <p>Description</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p><code>deploymentName</code></p>
      </div>
      <div>
        <p>Name of the deployment, if scraping a pod.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>label</code></p>
      </div>
      <div>
        <p>The Kubernetes labels of the object being scraped, prefixed by <code>"label"</code>.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>namespaceName</code></p>
      </div>
      <div>
        <p>Name of the namespace.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>nodeName</code></p>
      </div>
      <div>
        <p>Name of the node where the pod being scraped is running, if applicable.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>podName</code></p>
      </div>
      <div>
        <p>Name of the pod being scraped, if applicable.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>serviceName</code></p>
      </div>
      <div>
        <p>Name of the service being scraped, if applicable</p>
      </div>
    </div>
  </div>
</div>
<h2>Default attributes for the remote write integration [#default-attributes-remote-write]</h2>
<p>By default, the following attributes will be added to Prometheus remote write metrics:</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>Default attributes<br>(all integrations)</p>
      </div>
      <div>
        <p>Description</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p>prometheus_server</p>
      </div>
      <div>
        <p>A user supplied label specified as a Prometheus remote write URL parameter. The value supplied should be unique as it is intended to differentiate between source Prometheus servers at query time. Unspecified by default.</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p><code>newrelic.source</code></p>
      </div>
      <div>
        <p>The name of the New Relic ingest point (<code>prometheusAPI</code>).</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>instrumentation.provider</code></p>
      </div>
      <div>
        <p><code>prometheus</code></p>
      </div>
    </div>
    <div>
      <div>
        <p><code>instrumentation.name</code></p>
      </div>
      <div>
        <p><code>remote-write</code></p>
      </div>
    </div>
    <div>
      <div>
        <p><code>instrumentation.source</code></p>
      </div>
      <div>
        <p>A user supplied identifier for the source of the Prometheus data that matches the value of <code>prometheus_server</code>.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>instrumentation.version</code></p>
      </div>
      <div>
        <p>Used to identify the version of the remote write API; for example, <code>0.0.1.</code></p>
      </div>
    </div>
  </div>
</div>
<h2>NRQL query examples [#nrql-examples]</h2>
<p>When you <a href="/docs/query-your-data/explore-query-data/query-builder/use-advanced-nrql-mode-specify-data">build queries</a>, be aware that there is no linking between the metrics, entities, and attributes. Use the following NRQL queries to find out which metrics are available and which attributes are present on these metrics:</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZ2V0LW5hbWVzIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJHZXQgbWV0cmljIG5hbWVzIn1d">
    <div data-prop-text="title">Get metric names</div>
    <p>To get all metric names for OpenMetrics:</p>
    <pre><code>FROM Metric SELECT uniques(metricName)

</code></pre>
    <pre><code>
FROM Metric SELECT uniques(metricName) WHERE podName='&#x3C;pod>'

</code></pre>
    <pre><code>
FROM Metric SELECT uniques(metricName) WHERE namespaceName='&#x3C;ns>'

</code></pre>
    <pre><code>
FROM Metric SELECT uniques(metricName) WHERE clusterName='&#x3C;cn>'

</code></pre>To get metric names for a specific OpenMetrics cluster, namespace, or pod:
    <pre><code>
FROM Metric SELECT uniques(metricName) WHERE scrapedEndpoint='&#x3C;ep>'

</code></pre>To get metric names for a specific OpenMetrics endpoint:
    <pre><code>
FROM Metric SELECT uniques(metricName) WHERE instrumentation.provider='prometheus' AND instrumentation.name='remote-write' AND instrumentation.source='&#x3C;ds>'

</code></pre>To get metric names for a remote write integration from a single Prometheus source:
    <pre><code>
FROM Metric SELECT uniques(metricName) WHERE instrumentation.provider='prometheus' AND instrumentation.name='remote-write'

</code></pre>To get metric names for a remote write integration:
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZ2V0LWF0dHJpYnV0ZXMifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IkdldCB0aGUgYXR0cmlidXRlcyBmb3IgYSBtZXRyaWMifV0=">
    <div data-prop-text="title">Get the attributes for a metric</div>
    <p>To get all attributes for the selected metric:</p>
    <pre><code>FROM Metric SELECT keyset() WHERE metricName='&#x3C;mn>'

</code></pre>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZ2V0LWF0dHJpYnV0ZS12YWx1ZXMifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IkdldCB0aGUgdmFsdWVzIGZvciBhbiBhdHRyaWJ1dGUgaW4gT3Blbk1ldHJpY3MifV0=">
    <div data-prop-text="title">Get the values for an attribute in OpenMetrics</div>
    <p>The autocomplete will show all values of the attribute, regardless of the pod. To determine the attribute values for a specific pod:</p>
    <pre><code>FROM Metric SELECT uniques(&#x3C;attribute>) WHERE metricName='&#x3C;mn>' AND podName='&#x3C;pod>'

</code></pre>
  </div>
</div>
<h2>Build the query [#build-query]</h2>
<p>Using <a href="#nrql-examples">metric name and attributes</a>, you can query your data. For more information about facets, time series, and time selection, see the <a href="/docs/query-data/nrql-new-relic-query-language/getting-started/nrql-syntax-components-functions">NRQL documentation</a>.</p>
<p>To build PromQL-style queries, <a href="/docs/integrations/prometheus-integrations/view-query-data/supported-promql-features">see our docs</a>.</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZ2V0LXJhdyJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiR2V0IG1ldHJpYyB2YWx1ZXMifV0=">
    <div data-prop-text="title">Get metric values</div>
    <p>To get raw metric values:</p>
    <pre><code>FROM Metric SELECT &#x3C;metricName> WHERE &#x3C;attribute>='&#x3C;value>'

</code></pre>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZ2V0LWdyYXBoIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJHZXQgYSBjaGFydCBvZiB0aGUgbWV0cmljIn1d">
    <div data-prop-text="title">Get a chart of the metric</div>
    <p>To get a chart of the metric with an aggregator of <code>average</code>, <code>min</code>, <code>max</code>, or <code>sum</code>:</p>
    <pre><code>FROM Metric SELECT &#x3C;aggregator>(&#x3C;metricname>) WHERE &#x3C;attribute>='&#x3C;value>' TIMESERIES

</code></pre>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoicXVlcnktY291bnRlci1tZXRyaWNzIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJRdWVyeSBjb3VudGVyIG1ldHJpY3MgKGRlbHRhcykifV0=">
    <div data-prop-text="title">Query counter metrics (deltas)</div>
    <p>Currently the integration calculates the deltas for counter metrics. This is why queries on counter metrics will show the deltas of the counter instead of the absolute value of the counter.</p>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiY2xpZW50cy1wb2QtbmFtZXNwYWNlIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJWaWV3IGNvbm5lY3RlZCBSZWRpcyBjbGllbnRzIHBlciBwb2Qgd2l0aCBPcGVuTWV0cmljcyJ9XQ==">
    <div data-prop-text="title">View connected Redis clients per pod with OpenMetrics</div>
    <p>
      <img src="./images/docker-logo-crop.png" alt="Docker icon" title="Docker icon"> <strong>Docker:</strong> This example assumes you are scraping Redis exporters. To view the number of connected Redis clients per endpoint in a cluster:
    </p>
    <pre><code>FROM Metric SELECT latest(redis_connected_clients) WHERE clusterName='my-cluster' FACET scrapedEndpoint TIMESERIES

</code></pre>
    <pre><code>
FROM Metric SELECT latest(redis_connected_clients) WHERE namespaceName='default' FACET podName TIMESERIES

</code></pre>![img-integration-k8s@2x.png](./images/img-integration-k8s%402x.png "img-integration-k8s@2x.png") **Kubernetes:** This example assumes that you have Redis pods with the Redis exporter installed. To view the number of connected Redis clients per pod in the default namespace:
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoieHgifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IkRvY2tlcjogVmlldyBhdmVyYWdlIG1lbW9yeSBmcmVlIGZvciBzY3JhcGVkIGVuZHBvaW50cyJ9XQ==">
    <div data-prop-text="title">Docker: View average memory free for scraped endpoints</div>
    <p>This example assumes you are scraping node exporters for Docker and want to use OpenMetrics. To view average memory free for all scraped endpoints in a cluster:</p>
    <pre><code>FROM Metric SELECT average(node_memory_MemFree_bytes) WHERE clusterName='my-cluster'

</code></pre>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiYXZlcmFnZS1tZW1vcnktcG9kcyJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiS3ViZXJuZXRlczogVmlldyBhdmVyYWdlIG1lbW9yeSB1c2FnZSBmb3IgcG9kcyBpbiBhIGRlcGxveW1lbnQifV0=">
    <div data-prop-text="title">Kubernetes: View average memory usage for pods in a deployment</div>
    <p>To view average memory usage for all pods in a Kubernetes deployment using OpenMetrics:</p>
    <pre><code>FROM Metric SELECT average(container_memory_usage_bytes) WHERE deploymentName='my-app-deployment' AND namespaceName='default'

</code></pre>
  </div>
</div>
<h2>View data in New Relic [#view-ui]</h2>
<p>When you query the data, you can view the results in the New Relic UI. You can also visualize the data as charts, histograms, etc.</p>
<p>To view the NRQL query results for your Prometheus integration's data: Go to <strong><a href="https://one.newrelic.com">one.newrelic.com</a> > Query your data</strong>. For more information, see New Relic's <a href="https://docs.newrelic.com/docs/chart-builder/use-chart-builder/get-started/introduction-chart-builder">query builder documentation</a>.</p>
<h2>Create histograms and summaries [#histograms-summaries]</h2>
<p>With remote write or version 1.2.0 or higher of the Prometheus OpenMetrics integration, you can create histograms and percentiles (summaries) of your data. The OpenMetrics data is based on <a href="https://github.com/newrelic/newrelic-exporter-specs/blob/master/Guidelines.md">New Relic's guidelines in GitHub for higher level metric abstractions</a>, while the remote write data closely matches the schema of the original Prometheus data.</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>Data presentation</p>
      </div>
      <div>
        <p>Comments</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p>Histograms</p>
      </div>
      <div>
        <p>A bucket <code>&#x3C;basename>_bucket{le="42"}</code> will be sent as this:</p>
        <ul>
          <li>
            <p>For OpenMetrics: <code>&#x3C;basename>_buckets</code></p>
          </li>
          <li>
            <p>For remote write: <code>&#x3C;basename>_bucket</code></p>
            <p>The dimension will be this:</p>
          </li>
          <li>
            <p>For OpenMetrics: <code>{histogram.bucket.upperBound="42"}</code></p>
          </li>
          <li>
            <p>For remote write: <code>{histogram.bucket.le="42"}</code></p>
          </li>
        </ul>
      </div>
    </div>
    <div>
      <div>
        <p>Percentiles</p>
      </div>
      <div>
        <p>Quantiles (summaries) are transformed into percentiles.</p>
        <p>A metric <code>&#x3C;basename>{quantile="0.3"}</code> will be sent to New Relic as <code>&#x3C;basename>.percentiles</code>.</p>
        <p>The dimension will be this:</p>
        <p><code>{percentile="30"}</code></p>
      </div>
    </div>
  </div>
</div>
<p>NRQL has two functions that work on remote write ingested PromQL: <a href="/docs/query-your-data/nrql-new-relic-query-language/get-started/nrql-syntax-clauses-functions#func-bucket-percentile"><code>bucketPercentile()</code></a> and <a href="/docs/query-your-data/nrql-new-relic-query-language/get-started/nrql-syntax-clauses-functions#func-histogram"><code>histogram()</code></a>. The links include query examples.These two functions don't work on OpenMetrics ingested buckets.</p>
<p>To better support visualization of histograms, percentiles are calculated based on the histogram metrics and sent to New Relic. To configure the calculated percentiles for OpenMetrics, use the <code>percentiles</code> configuration option.</p>
