
<p>New Relic supports PromQL-style queries, and our query builder offers a PromQL-style query mode that translates PromQL syntax queries into the closest NRQL approximation. Although the method of approximation means that a handful of edge cases are not fully supported, it provides coverage for an overwhelming majority of queries, supporting over 97% of queries across the 7 million top Grafana dashboard downloads.</p>
<p>Read on to learn about how we work with PromQL queries, as well as differences between standard PromQL and our PromQL-like query language we want you to be aware of.</p>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
  <p>For general information about Prometheus queries and operators, see the <a href="https://prometheus.io/docs/prometheus/latest/querying/operators/">Prometheus.io</a> documentation.</p>
</div>
<h2>Supported features [#features]</h2>
<p>We support the following aggregation, arithmetic, mathematical, and rate-like functions. As we continue to expand support for Prometheus and PromQL, this list will be updated.</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJBZ2dyZWdhdGlvbiBvcGVyYXRvcnMgYW5kIGZ1bmN0aW9ucyJ9XQ==">
    <div data-prop-text="title">Aggregation operators and functions</div>
    <ul>
      <li>
        <p>Aggregation operators:</p>
        <ul>
          <li><a href="http://prometheus.io/docs/prometheus/latest/querying/operators/#aggregation-operators"><code>avg()</code></a></li>
          <li><a href="http://prometheus.io/docs/prometheus/latest/querying/operators/#aggregation-operators"><code>count()</code></a></li>
          <li><a href="http://prometheus.io/docs/prometheus/latest/querying/operators/#aggregation-operators"><code>min()</code></a></li>
          <li><a href="http://prometheus.io/docs/prometheus/latest/querying/operators/#aggregation-operators"><code>max()</code></a></li>
          <li><a href="https://prometheus.io/docs/prometheus/latest/querying/operators/#aggregation-operators"><code>quantile()</code></a></li>
          <li><a href="http://prometheus.io/docs/prometheus/latest/querying/operators/#aggregation-operators"><code>stddev()</code></a></li>
          <li><code>stdvar()</code></li>
          <li><a href="http://prometheus.io/docs/prometheus/latest/querying/operators/#aggregation-operators"><code>sum()</code></a></li>
          <li><a href="http://prometheus.io/docs/prometheus/latest/querying/operators/#aggregation-operators"><code>topk()</code></a></li>
        </ul>
        <p>Aggregation functions:</p>
        <ul>
          <li><code>histogram_quantile()</code></li>
        </ul>
      </li>
      <li>
        <p><code>&#x3C;aggregation>_over_time()</code> functions:</p>
        <ul>
          <li><a href="https://prometheus.io/docs/prometheus/latest/querying/functions/#aggregation_over_time"><code>avg_over_time</code></a></li>
          <li><a href="https://prometheus.io/docs/prometheus/latest/querying/functions/#aggregation_over_time"><code>count_over_time</code></a></li>
          <li><a href="https://prometheus.io/docs/prometheus/latest/querying/functions/#aggregation_over_time"><code>min_over_time</code></a></li>
          <li><a href="https://prometheus.io/docs/prometheus/latest/querying/functions/#aggregation_over_time"><code>max_over_time</code></a></li>
          <li><a href="https://prometheus.io/docs/prometheus/latest/querying/functions/#aggregation_over_time"><code>quantile_over_time</code></a></li>
          <li><a href="https://prometheus.io/docs/prometheus/latest/querying/functions/#aggregation_over_time"><code>stdev_over_time</code></a></li>
          <li><a href="https://prometheus.io/docs/prometheus/latest/querying/functions/#aggregation_over_time"><code>stvar_over_time</code></a></li>
          <li><a href="https://prometheus.io/docs/prometheus/latest/querying/functions/#aggregation_over_time"><code>sum_over_time</code></a></li>
        </ul>
      </li>
    </ul>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJBcml0aG1ldGljIGJpbmFyeSBvcGVyYXRvcnMifV0=">
    <div data-prop-text="title">Arithmetic binary operators</div>
    <ul>
      <li><a href="https://prometheus.io/docs/prometheus/latest/querying/operators/#arithmetic-binary-operators"><code>+</code> (addition)</a></li>
      <li><a href="https://prometheus.io/docs/prometheus/latest/querying/operators/#arithmetic-binary-operators"><code>-</code> (subtraction)</a></li>
      <li><a href="https://prometheus.io/docs/prometheus/latest/querying/operators/#arithmetic-binary-operators"><code>*</code> (multiplication)</a></li>
      <li><a href="https://prometheus.io/docs/prometheus/latest/querying/operators/#arithmetic-binary-operators"><code>/</code> (division)</a></li>
      <li><a href="https://prometheus.io/docs/prometheus/latest/querying/operators/#arithmetic-binary-operators"><code>%</code> (percent)</a></li>
      <li><a href="https://prometheus.io/docs/prometheus/latest/querying/operators/#arithmetic-binary-operators"><code>^</code> (power/exponents)</a></li>
    </ul>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiTG9naWNhbCBvcGVyYXRvcnMifV0=">
    <div data-prop-text="title">Logical operators</div>
    <ul>
      <li><a href="https://prometheus.io/docs/prometheus/latest/querying/operators/#logical-set-binary-operators"><code>and</code></a></li>
      <li><a href="https://prometheus.io/docs/prometheus/latest/querying/operators/#logical-set-binary-operators"><code>or</code></a></li>
    </ul>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJEYXRlL3RpbWUgZnVuY3Rpb25zIn1d">
    <div data-prop-text="title">Date/time functions</div>
    <ul>
      <li><code>day_of_month()</code></li>
      <li><code>day_of_week()</code></li>
      <li><a href="https://prometheus.io/docs/prometheus/latest/querying/functions/#days_in_month"><code>days_in_month()</code></a></li>
      <li><code>hour()</code></li>
      <li><code>minute()</code></li>
      <li><code>month()</code></li>
      <li><code>timestamp()</code></li>
      <li><code>year()</code></li>
    </ul>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJNYXRoZW1hdGljYWwgZnVuY3Rpb25zIn1d">
    <div data-prop-text="title">Mathematical functions</div>
    <ul>
      <li><a href="https://prometheus.io/docs/prometheus/latest/querying/functions/#abs"><code>abs()</code></a></li>
      <li><a href="https://prometheus.io/docs/prometheus/latest/querying/functions/#ceil"><code>ceil()</code></a></li>
      <li><a href="https://prometheus.io/docs/prometheus/latest/querying/functions/#clamp_max"><code>clamp_max()</code></a></li>
      <li><a href="https://prometheus.io/docs/prometheus/latest/querying/functions/#clamp_min"><code>clamp_min()</code></a></li>
      <li><a href="https://prometheus.io/docs/prometheus/latest/querying/functions/#exp"><code>exp()</code></a></li>
      <li><a href="https://prometheus.io/docs/prometheus/latest/querying/functions/#floor"><code>floor()</code></a></li>
      <li><a href="https://prometheus.io/docs/prometheus/latest/querying/functions/#ln"><code>ln()</code></a></li>
      <li><a href="https://prometheus.io/docs/prometheus/latest/querying/functions/#log10"><code>log10()</code></a></li>
      <li><a href="https://prometheus.io/docs/prometheus/latest/querying/functions/#log2"><code>log2()</code></a></li>
      <li><a href="https://prometheus.io/docs/prometheus/latest/querying/functions/#round"><code>round()</code></a></li>
      <li><a href="https://prometheus.io/docs/prometheus/latest/querying/functions/#sqrt"><code>sqrt()</code></a></li>
    </ul>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJSYXRlLWxpa2UgZnVuY3Rpb25zIn1d">
    <div data-prop-text="title">Rate-like functions</div>
    <ul>
      <li><a href="https://prometheus.io/docs/prometheus/latest/querying/functions/#delta"><code>delta()</code></a></li>
      <li><a href="https://prometheus.io/docs/prometheus/latest/querying/functions/#deriv"><code>deriv()</code></a></li>
      <li><a href="https://prometheus.io/docs/prometheus/latest/querying/functions/#idelta"><code>idelta()</code></a></li>
      <li><a href="https://prometheus.io/docs/prometheus/latest/querying/functions/#increase"><code>increase()</code></a></li>
      <li><a href="https://prometheus.io/docs/prometheus/latest/querying/functions/#irate"><code>irate()</code></a></li>
      <li><a href="https://prometheus.io/docs/prometheus/latest/querying/functions/#rate"><code>rate()</code></a></li>
    </ul>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiUHJlZGljdGl2ZSBmdW5jdGlvbnMifV0=">
    <div data-prop-text="title">Predictive functions</div>
    <ul>
      <li><code>predict_linear</code></li>
    </ul>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJUaW1lLXNlcmllcyBzZWxlY3RvcnMifV0=">
    <div data-prop-text="title">Time-series selectors</div>
    <p>We offer support for PromQL time-series selectors including the following:</p>
    <ul>
      <li>
        <p><a href="https://prometheus.io/docs/prometheus/latest/querying/basics/#instant-vector-selectors">instant vector selectors</a></p>
      </li>
      <li>
        <p><a href="https://prometheus.io/docs/prometheus/latest/querying/basics/#range-vector-selectors">range series selectors</a></p>
      </li>
      <li>
        <p><a href="https://prometheus.io/docs/prometheus/latest/querying/basics/#offset-modifier"><code>offset</code> modifier</a></p>
        <div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
          <p>We only support <code>offset</code> queries if every vector in the query has the same offset value.</p>
        </div>
      </li>
    </ul>
  </div>
</div>
<h2>PromQL troubleshooting [#troubleshooting]</h2>
<p>This section describes differences in behavior between PromQL and our PromQL-style query behavior and how to work with and around these differences. This is particularly relevant if you want to use advanced queries and our <a href="/docs/query-your-data/explore-query-data/chart-builder/use-advanced-promql-mode-specify-data">PromQL-style mode</a> in the chart builder.</p>
<h3>Metric types</h3>
<p>Prometheus recommendations note that you should only use some functions, like delta(), on gauges, and only use others like rate() and increase() on counters, but queries in Prometheus still work most of the time even if they don’t follow those instructions.</p>
<p>However, because NRDB converts PromQL-style accumulating counters to <code>delta</code> counters, our implementation is unforgiving when using these functions on the wrong data type and will produce different or incorrect answers.</p>
<p>For this reason, it's best to follow all Prometheus recommendations when working with our PromQL-style queries, even if you don't follow these recommendations in Prometheus.</p>
<h3>Limits</h3>
<ul>
  <li>In order to ensure the stability and performance of our system for all users, we place some limits on what queries can be run. In all cases, we enforce a limit of 366 steps in range queries. We also default to only returning 100 timeseries from queries by default.</li>
  <li>If you want to see more (or fewer), you need to explicitly add a <code>topk()</code> to your query. (Note that the <code>topk()</code> implementation in our PromQL-style query is different from that of Prometheus.)</li>
  <li>We limit the total memory a query can use. This means that requests for large numbers of time steps or large numbers of time series may be rejected, particularly if they are combined with an aggregation like unique <code>count</code> or <code>quantile</code> which require significantly more memory to compute than simple arithmetic aggregations.</li>
</ul>
<h3>Range vector selectors (sliding windows and smoothing behavior)</h3>
<p>We provide support for sliding window timeseries aggregations. For more information, see our <a href="/docs/query-your-data/nrql-new-relic-query-language/get-started/nrql-syntax-clauses-functions#slide-by">NRQL syntax, clauses, and functions resource</a> and our <a href="/docs/query-your-data/nrql-new-relic-query-language/nrql-query-tutorials/create-smoother-charts-sliding-windows">sliding windows deep dive</a>.</p>
<p>For information on translating between NRQL and our PromQL-style language, see <a href="/docs/integrations/prometheus-integrations/view-query-data/translate-promql-queries-nrql">Translate PromQL queries to NRQL</a>.</p>
