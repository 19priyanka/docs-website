
<p>Our Apache <a href="https://docs.newrelic.com/docs/integrations/host-integrations/getting-started/introduction-host-integrations">integration</a> sends performance <a href="#metrics">metrics</a> and <a href="#inventory">inventory data</a> from your Apache web server to the New Relic platform. You can view pre-built dashboards of your Apache metric data, create alert policies, and create your own custom queries and charts.</p>
<p>The integration works by gathering data from Apache's <a href="https://httpd.apache.org/docs/2.4/mod/mod_status.html">status module</a>, so that module must be enabled and configured for your Apache instance (more details in <a href="#comp-req">Requirements</a>).</p>
<p>Read on to install the integration, and to see what data we collect.</p>
<h2>Compatibility and requirements [#comp-req]</h2>
<p>Our integration is compatible with Apache versions 2.2 or 2.4.</p>
<p>Before installing the integration, make sure that you meet the following requirements:</p>
<ul>
  <li><a href="https://httpd.apache.org/docs/2.4/mod/mod_status.html">Apache status module</a> enabled and configured for Apache instance.</li>
  <li>Apache status module endpoint (default <code>server-status</code>) available from the host containing the Apache integration.</li>
  <li>If Apache is <strong>not</strong> running on Kubernetes or Amazon ECS, you must have the <a href="/docs/infrastructure/install-infrastructure-agent/get-started/install-infrastructure-agent-new-relic">infrastructure agent installed</a> on a Linux OS host that's running Apache. Otherwise:
    <ul>
      <li>If running on Kubernetes, see <a href="https://docs.newrelic.com/docs/monitor-service-running-kubernetes#requirements">these requirements</a>.</li>
      <li>If running on ECS, see <a href="/docs/integrations/host-integrations/host-integrations-list/monitor-services-running-amazon-ecs">these requirements</a>.</li>
    </ul>
  </li>
</ul>
<h2>Install and activate [#install]</h2>
<p>To install the Apache integration, follow the instructions for your environment:</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZWNzLWluc3RhbGwifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IkVDUyJ9XQ==">
    <div data-prop-text="title">ECS</div>
    <p>See <a href="/docs/integrations/host-integrations/host-integrations-list/monitor-services-running-amazon-ecs">Monitor service running on ECS</a>.</p>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiazhzLWluc3RhbGwifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6Ikt1YmVybmV0ZXMifV0=">
    <div data-prop-text="title">Kubernetes</div>
    <p>See <a href="/docs/monitor-service-running-kubernetes">Monitor service running on Kubernetes</a>.</p>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoibGludXgtaW5zdGFsbCJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiTGludXgifV0=">
    <div data-prop-text="title">Linux</div>
    <ol>
      <li>
        <p>Follow the instructions for <a href="/docs/install-integrations-package">installing an integration</a>, using the file name <code>nri-apache</code>.</p>
      </li>
      <li>
        <p>Change directory to the integration's folder:</p>
        <pre><code>cd /etc/newrelic-infra/integrations.d
</code></pre>
      </li>
      <li>
        <p>Copy of the sample configuration file:</p>
        <pre><code>sudo cp apache-config.yml.sample apache-config.yml
</code></pre>
      </li>
      <li>
        <p>Edit the <code>apache-config.yml</code> file as described in the <a href="#config">configuration settings</a>.</p>
      </li>
      <li>
        <p><a href="/docs/infrastructure/new-relic-infrastructure/configuration/start-stop-restart-check-infrastructure-agent-status">Restart the infrastructure agent</a>.</p>
      </li>
    </ol>
  </div>
</div>
<p>Additional notes:</p>
<ul>
  <li><strong>Advanced:</strong> Integrations are also available in <a href="/docs/integrations/host-integrations/installation/install-host-integrations-built-new-relic#tarball">tarball format</a> to allow for install outside of a package manager.</li>
  <li><strong>On-host integrations do not automatically update.</strong> For best results, regularly <a href="/docs/integrations/host-integrations/installation/update-infrastructure-host-integration-package">update the integration package</a> and <a href="/docs/infrastructure/new-relic-infrastructure/installation/update-infrastructure-agent">the infrastructure agent</a>.</li>
</ul>
<h2>Configure the integration [#config]</h2>
<p>The Apache integration configuration is how you can set required login credentials and configure how data is collected. Which options you change depend on your setup and preference.</p>
<p>There are several ways to configure the integration, depending on how it was installed:</p>
<ul>
  <li>If enabled via Kubernetes: see <a href="/docs/monitor-service-running-kubernetes">Monitor services running on Kubernetes</a>.</li>
  <li>If enabled via Amazon ECS: see <a href="/docs/integrations/host-integrations/host-integrations-list/monitor-services-running-amazon-ecs">Monitor services running on ECS</a>.</li>
  <li>If installed on-host: edit the config in the integration's YAML config file, <code>apache-config.yml</code>.</li>
</ul>
<p>Configuration options include:</p>
<ul>
  <li><code>metrics</code>: This command captures the metrics of a particular Apache server. This takes a single argument:
    <ul>
      <li><code>status_url</code>: The URL set up to provide the metrics using the <a href="https://httpd.apache.org/docs/2.4/mod/mod_status.html">Apache status info module</a>. Default value: <code>http://127.0.0.1/server-status?auto</code>. If you have customized your setup to use a different endpoint, you will need to set this value.</li>
    </ul>
  </li>
  <li><code>inventory</code>: This command captures the modules loaded by Apache as <a href="#inventory">inventory data</a>, using Apache's binary file. To disable the collection of inventory data, delete the inventory command from the config file.
    <ul>
      <li><code>status_url</code>: The URL is used to attach the inventory data to the same Apache instance for which we collect metrics data.</li>
    </ul>
  </li>
  <li><code>labels</code>: The <code>env</code> label controls the <code>environment</code> attribute. The default value is <code>production</code>.</li>
</ul>
<p>For more about general configuration structure, see <a href="/docs/integrations/integrations-sdk/file-specifications/host-integration-configuration-overview">Configuration</a>.</p>
<h3>Activate remote monitoring [#remote-monitoring]</h3>
<p>The <code>remote_monitoring</code> parameter enables remote monitoring and multi-tenancy for this integration.</p>
<p>Activating <code>remote_monitoring</code> may change some attributes and/or affect your configured alerts. For more information, see <a href="https://docs.newrelic.com/docs/remote-monitoring-host-integrations">remote monitoring in on-host integrations</a>.</p>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
  <p>Infrastructure agent version 1.2.25 or higher is required to use <code>remote_monitoring</code>.</p>
</div>
<h3>Environment variable passthroughs [#environment-variables]</h3>
<p>Environment variables can be used to control config settings, and are then passed through to the infrastructure agent. For instructions on how to use this feature, see <a href="https://docs.newrelic.com/docs/infrastructure/new-relic-infrastructure/configuration/configure-infrastructure-agent#passthrough">Configure the infrastructure agent</a>.</p>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
  <p>With secrets management, you can configure on-host integrations with New Relic infrastructure's agent to use sensitive data (such as passwords) without having to write them as plain text into the integration's configuration file. For more information, see <a href="https://docs.newrelic.com/docs/integrations/host-integrations/installation/secrets-management">Secrets management</a>.</p>
</div>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiU1RBVFVTX1VSTCJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiU1RBVFVTX1VSTCJ9XQ==">
    <div data-prop-text="title">STATUS_URL</div>
    <p>The URL set up to provide the metrics using the <a href="https://httpd.apache.org/docs/2.4/mod/mod_status.html">Apache status info module</a>.</p>
    <div data-component="Table" data-prop="W10=">
      <div>
        <div>
          <div>
            <p>Type</p>
          </div>
          <div>
            <p>String</p>
          </div>
        </div>
        <div>
          <div>
            <p>Default</p>
          </div>
          <div>
            <p><a href="http://127.0.0.1/server-status?auto">http://127.0.0.1/server-status?auto</a></p>
          </div>
        </div>
      </div>
    </div>
    <p>Example:</p>
    <pre><code>STATUS_URL='http://your.ip.address:8080/server-status?auto'

</code></pre>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiQ0FfQlVORExFX0ZJTEUifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IkNBX0JVTkRMRV9GSUxFIn1d">
    <div data-prop-text="title">CA_BUNDLE_FILE</div>
    <p>Alternative file to use for custom SSL certificate.</p>
    <div data-component="Table" data-prop="W10=">
      <div>
        <div>
          <div>
            <p>Type</p>
          </div>
          <div>
            <p>String</p>
          </div>
        </div>
        <div>
          <div>
            <p>Default</p>
          </div>
          <div>
            <p>(none)</p>
          </div>
        </div>
      </div>
    </div>
    <p>Example:</p>
    <pre><code>CA_BUNDLE_FILE='/etc/ssl/certs/custom-ca.crt'

</code></pre>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiQ0FfQlVORExFX0RJUiJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiQ0FfQlVORExFX0RJUiJ9XQ==">
    <div data-prop-text="title">CA_BUNDLE_DIR</div>
    <p>Alternative path to use to find SSL certificate bundle file.</p>
    <div data-component="Table" data-prop="W10=">
      <div>
        <div>
          <div>
            <p>Type</p>
          </div>
          <div>
            <p>String</p>
          </div>
        </div>
        <div>
          <div>
            <p>Default</p>
          </div>
          <div>
            <p>(none)</p>
          </div>
        </div>
      </div>
    </div>
    <p>Example:</p>
    <pre><code>CA_BUNDLE_DIR='/etc/ssl/certs/custom/'

</code></pre>
  </div>
</div>
<h2>Find and use data [#find-and-use]</h2>
<p>Data from this service is reported to an <a href="/docs/integrations/new-relic-integrations/getting-started/infrastructure-integration-dashboards-charts">integration dashboard</a>.</p>
<p>Apache data is attached to the <code>ApacheSample</code> <a href="/docs/using-new-relic/data/understand-data/new-relic-data-types#events-new-relic">event type</a>. You can <a href="/docs/using-new-relic/data/understand-data/query-new-relic-data">query this data</a> for troubleshooting purposes or to create charts and dashboards.</p>
<p>For more on how to find and use your data, see <a href="/docs/infrastructure/integrations/find-use-infrastructure-integration-data">Understand integration data</a>.</p>
<h2>Metric data [#metrics]</h2>
<p>The Apache integration collects the following metric data attributes. Each metric name is prefixed with a category indicator and a period, such as <code>net.</code> or <code>server.</code>.</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>Name</p>
      </div>
      <div>
        <p>Description</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p><code>net.bytesPerSecond</code></p>
      </div>
      <div>
        <p>Rate of the number of bytes served, in bytes per second.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>net.requestsPerSecond</code></p>
      </div>
      <div>
        <p>Rate of the number of client requests, in requests per second.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>server.busyWorkers</code></p>
      </div>
      <div>
        <p>Current number of busy workers.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>server.idleWorkers</code></p>
      </div>
      <div>
        <p>Current number of idle workers.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>server.scoreboard.closingWorkers</code></p>
      </div>
      <div>
        <p>Current number of workers closing TCP connection after serving the response.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>server.scoreboard.dnsLookupWorkers</code></p>
      </div>
      <div>
        <p>Current number of workers performing a DNS lookup.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>server.scoreboard.finishingWorkers</code></p>
      </div>
      <div>
        <p>Current number of workers gracefully finishing.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>server.scoreboard.idleCleanupWorkers</code></p>
      </div>
      <div>
        <p>Current number of idle workers ready for cleanup.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>server.scoreboard.keepAliveWorkers</code></p>
      </div>
      <div>
        <p>Current number of workers maintaining a keep-alive connection.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>server.scoreboard.loggingWorkers</code></p>
      </div>
      <div>
        <p>Current number of workers that are logging.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>server.scoreboard.readingWorkers</code></p>
      </div>
      <div>
        <p>Current number of workers reading requests (headers or body).</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>server.scoreboard.startingWorkers</code></p>
      </div>
      <div>
        <p>Current number of workers that are starting up.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>server.scoreboard.totalWorkers</code></p>
      </div>
      <div>
        <p>Total number of workers available. Workers that are not needed to process requests may not be started.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>server.scoreboard.writingWorkers</code></p>
      </div>
      <div>
        <p>Current number of workers that are writing.</p>
      </div>
    </div>
  </div>
</div>
<h2>Inventory data [#inventory]</h2>
<p>Inventory data captures the version numbers from running Apache and from all loaded Apache modules, and adds those version numbers under the <code>config/apache</code> namespace. For more about inventory data, see <a href="/docs/infrastructure/integrations-getting-started/getting-started/understand-integration-data-data-types#inventory-data">Understand data</a>.</p>
<h2>System metadata [#metadata]</h2>
<p>Besides the standard attributes collected by the infrastructure agent, the integration collects inventory data associated with the <code>ApacheSample</code> <a href="/docs/using-new-relic/data/understand-data/new-relic-data-types#events-new-relic">event type</a>:</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>Name</p>
      </div>
      <div>
        <p>Description</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p><code>software.version</code></p>
      </div>
      <div>
        <p>The version of the Apache server. Example: <code>Apache/2.4.7 (Ubuntu)</code>.</p>
      </div>
    </div>
  </div>
</div>
<h2>Troubleshooting</h2>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiaHR0cHMtYWNjZXNzIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJQcm9ibGVtIGFjY2Vzc2luZyBIVFRQUyBlbmRwb2ludCBmb3IgQXBhY2hlIn1d">
    <div data-prop-text="title">Problem accessing HTTPS endpoint for Apache</div>
    <p>If you are having issues accessing the HTTPS endpoint for Apache, here are two possible solutions:</p>
    <ul>
      <li>
        <p>Although you cannot ignore the SSL certification, you can set the config file parameters <code>ca_bundle_file</code> and <code>ca_bundle_dir</code> to point to an unsigned certificate in the Apache config file. Example:</p>
        <pre><code>instances:
	- name: apache-server-metrics
command: metrics
arguments:
	status_url: http://127.0.0.1/server-status?auto
	ca_bundle_file: /etc/newrelic-infra/integrations.d/ssl/b2b.ca-bundle
</code></pre>
        <p>An example using <code>ca_bundle_dir</code>:</p>
        <pre><code>ca_bundle_dir: /etc/newrelic-infra/integrations.d/ssl
</code></pre>
      </li>
      <li>
        <p>Alternatively, you can use HTTP instead of HTTPS.</p>
      </li>
    </ul>
  </div>
</div>
<h2>Check the source code [#source-code]</h2>
<p>This integration is open source software. That means you can <a href="https://github.com/newrelic/nri-apache/" title="Link opens in a new window.">browse its source code</a> and send improvements, or create your own fork and build it.</p>
