
<p>Our StatsD integration lets you send data of your choosing to the New Relic platform, where it can be analyzed, used to create queries and custom charts, and used as a basis for <a href="/docs/alerts">alert conditions</a>.</p>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
  <p>We have a <a href="/docs/integrations/host-integrations/host-integrations-list/statsd-monitoring-integration-version-2">newer, improved StatsD integration version</a>.</p>
</div>
<p>The diagram shows the basics of how the StatsD integration sends data to New Relic.</p>
<p>
  <img src="./images/NR-StatsD-integration-diagram.png" alt="New Relic StatsD integration diagram " title="New Relic StatsD integration diagram">
</p>
<p>Your app or components send data to StatsD. The New Relic backend takes the aggregated StatsD metric data and sends it to the infrastructure agent using socket communication. Finally, the agent sends the data to the <a href="/docs/accounts-partnerships/education/getting-started-new-relic/glossary#collector">New Relic collector</a>.</p>
<p>Read on to install the integration, and to see what data we collect.</p>
<h2>Requirements [#req]</h2>
<p>Before installing the integration, make sure that you meet the following requirements:</p>
<ul>
  <li>A StatsD service</li>
  <li><a href="/docs/infrastructure/install-infrastructure-agent/get-started/install-infrastructure-agent-new-relic">Install the infrastructure agent</a> on the host you are monitoring</li>
  <li>A Linux distribution <a href="/docs/infrastructure/new-relic-infrastructure/getting-started/compatibility-requirements-new-relic-infrastructure#operating-systems">compatible with the infrastructure agent</a></li>
</ul>
<h2>Install and activate [#install]</h2>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
  <p>Note that we have a <a href="/docs/integrations/host-integrations/host-integrations-list/statsd-monitoring-integration-version-2">newer StatsD integration</a>.</p>
</div>
<p>To activate the New Relic StatsD integration:</p>
<ol>
  <li>
    <p>Ensure that you have the most up-to-date version of the <a href="/docs/infrastructure/new-relic-infrastructure/installation/update-infrastructure-agent">infrastructure agent</a>.</p>
  </li>
  <li>
    <p>Edit the <a href="/docs/infrastructure/new-relic-infrastructure/configuration/configure-infrastructure-agent">infrastructure agent config file</a> to enable the HTTP endpoint by adding:</p>
    <pre><code>http_server_enabled: true		
http_server_host: 127.0.0.1 #(default host)
http_server_port: 8001 #(default port)
</code></pre>
    <p>This is the default URL and port; you can edit them based on your preferences.</p>
  </li>
  <li>
    <p>Restart the agent.</p>
  </li>
  <li>
    <p>Install the New Relic .js backend in the StatsD <code>backends</code> directory. Example:</p>
    <pre><code>cd /path/to/statsd
npm install @newrelic/statsd-infra-backend
</code></pre>
  </li>
  <li>
    <p>Configure StatsD to run the New Relic StatsD backend by adding <code>@newrelic/statsd-infra-backend</code> to the StatsD <code>config.js</code> list of backends, like so:</p>
    <pre><code>backends: ["@newrelic/statsd-infra-backend"]
</code></pre>
    <p><strong>Recommendation:</strong> Before doing further <a href="#config">configuration</a>, finish this installation process and then <a href="#test-verify">verify that integration is working</a>.</p>
  </li>
  <li>
    <p>Restart StatsD.</p>
  </li>
</ol>
<p>Additional notes:</p>
<ul>
  <li><strong>Advanced:</strong> It's also possible to <a href="/docs/integrations/host-integrations/installation/install-host-integrations-built-new-relic#tarball">install the integration from a tarball file</a>. This gives you full control over the installation and configuration process.</li>
  <li><strong>On-host integrations do not automatically update.</strong> For best results, regularly <a href="/docs/integrations/host-integrations/installation/update-infrastructure-host-integration-package">update the integration package</a> and <a href="/docs/infrastructure/new-relic-infrastructure/installation/update-infrastructure-agent">the infrastructure agent</a>.</li>
</ul>
<h2>Verify that the integration is working [#test-verify]</h2>
<p>Before you <a href="#config">configure</a> the StatsD config file, verify that the integration is capable of sending data:</p>
<ol>
  <li>
    <p>Use the <a href="#example-config">example StatsD config file</a> in place of your StatsD configuration file.</p>
  </li>
  <li>
    <p>Tell the config file to send data with this terminal command:</p>
    <pre><code>echo "app1.production.localhost.sample_metric:2000|c" | nc -w 1 -u 127.0.0.1 8125
</code></pre>
  </li>
  <li>
    <p>Wait a few minutes, then run the following New Relic Insights query to confirm the data was reported:</p>
    <pre><code>Select * from MyorgApplicationSample
</code></pre>
  </li>
</ol>
<h2>Configure the integration [#config]</h2>
<p>After <a href="#install">installation</a> and <a href="#test-verify">verification</a>, you can further configure the StatsD config file. The config file accepts the following parameters. For more information, see the <a href="#example-config">example config files</a>.</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>Parameter</p>
      </div>
      <div>
        <p>Description</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p>port</p>
      </div>
      <div>
        <p>The port where the infrastructure agent is listening for StatsD data, as configured in <code>/etc/newrelic-infra.yml</code>.</p>
      </div>
    </div>
    <div>
      <div>
        <p>host</p>
      </div>
      <div>
        <p>The IP address of the parent host containing the New Relic infrastructure agent.</p>
      </div>
    </div>
    <div>
      <div>
        <p>rules</p>
      </div>
      <div>
        <p>An array of rules to filter metrics sent by StatsD to the New Relic StatsD backend. Using rules allows you to be specific about which metrics to record and how they should be sent to New Relic. Each rule can include one or more of these parameters:</p>
        <div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
          <p>The <code>eventType</code> parameter is required in order to query the metrics in Insights.</p>
        </div>
        <div data-component="CollapserGroup" data-prop="W10=">
          <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoibWF0Y2gifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6Im1hdGNoRXhwcmVzc2lvbiJ9XQ==">
            <div data-prop-text="title">matchExpression</div>
            <p>Report only metrics matching a JavaScript regular expression.</p>
          </div>
          <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoibWV0cmljLXNjaGVtYSJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoibWV0cmljU2NoZW1hIn1d">
            <div data-prop-text="title">metricSchema</div>
            <p>The schema to be matched to the regular expression. This allows you to use parts of the metric name received by StatsD to define the metric name in New Relic and its associated metadata.</p>
            <p>The elements defined in the schema, which are inherited from the <code>metricExpression</code>, can be used in other parameters. For example, in the config file example, <code>{hostname}</code> is used to represent one of the parameters. If you used <code>{hostname}</code> in another parameter, it would substitute the detected value, in this case <code>localhost</code>.</p>
          </div>
          <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZXZlbnQtdHlwZSJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiZXZlbnRUeXBlIChuYW1pbmcgZGF0YSkifV0=">
            <div data-prop-text="title">eventType (naming data)</div>
            <p>The name of the <a href="/docs/insights/use-insights-ui/getting-started/introduction-new-relic-insights#event-type">event type</a> sample where all metrics matching this rule will be stored. New Relic strongly recommends following the convention below when naming your event types:</p>
            <ul>
              <li>
                <p>Use camel case.</p>
              </li>
              <li>
                <p>Use the name of your organization as a prefix. This is to ensure the event type you use is unique. More detail on this below.</p>
              </li>
              <li>
                <p>Use a name that clearly identifies what data it contains.</p>
                <p>Examples: <code>MyorgNginxStatsdSample</code>, <code>MyorgApplicationStatsdSample</code>.</p>
                <p>The organizational prefix is important to avoid collision with New Relic's default event types. For example, if you named your event type <code>NginxSample</code>, you would be mixing your data with the standard Nginx data generated by the out-of-the-box New Relic integration. This would cause confusion to your users and create some unexpected results when running queries.</p>
                <p>For more information, see <a href="#tips">Naming tips</a>.</p>
              </li>
            </ul>
          </div>
          <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoibGFiZWxzIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJsYWJlbHMifV0=">
            <div data-prop-text="title">labels</div>
            <p>A hash containing a list of key-value pairs that will be applied to metrics matching this the rule.</p>
            <p>Labels will be stored in a namespace named <code>label</code> in New Relic; for example: <code>label.environment = "production"</code>.</p>
            <p>You can use variables defined in the <code>metricSchema</code> as values for your labels.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<h2>Find and use data [#find-and-use]</h2>
<p>To use your integration data in Infrastructure, go to <strong><a href="https://infrastructure.newrelic.com">infrastructure.newrelic.com</a> > Third-party services</strong> and select one of the StatsD integration links.</p>
<p>In <a href="/docs/insights">New Relic Insights</a>, StatsD <a href="/docs/infrastructure/integrations/find-use-infrastructure-integration-data">integration data</a> is attached to the <code>MyorgApplicationSample</code> <a href="/docs/insights/use-insights-ui/getting-started/introduction-new-relic-insights#event-type">event type</a> (assuming you've followed the <a href="#event-type">event naming conventions</a>).</p>
<p>For more on how to find and use your data, see <a href="/docs/infrastructure/integrations/find-use-infrastructure-integration-data">Understand integration data</a>.</p>
<h2>Tips for naming your data [#tips]</h2>
<p>Metrics are sent and stored in New Relic in the form of samples. This is a list of key-value pairs that include metric data and metadata. Each sample is stored as an event in New Relic's event database.</p>
<p>You are responsible for creating and naming the StatsD data reported to New Relic. For this reason, it's recommended you follow the <a href="#event-type">event naming conventions</a> to ensure you have a consistent naming scheme.</p>
<p>It's also recommended you use the same naming scheme for similar metrics across different applications. For example: suppose you have an application named <code>app1</code> and <code>app2</code> that reports the following metrics:</p>
<pre><code>App1.net.requests
App1.net.average_response_time
App1.system.memory_used
</code></pre>
<pre><code>App2.net.requests
App2.net.average_response_time
app2.system.memory_used
</code></pre>
<p>By giving each app a different name but the same metrics, you could generate a sample for each similar to:</p>
<pre><code>application: "app1"
net.requests: 234
net.average_reponse_time: 23
</code></pre>
<pre><code>application: "app2"
net.requests: 234
net.average_reponse_time: 23
</code></pre>
<h2>Example StatsD configuration files [#example-config]</h2>
<p>The first example StatsD configuration file in this section can be used for doing an initial <a href="#test-verify">test of the integration</a> after installation. The second config file is more complete and complex, and should give you an idea of how your own StatsD config file will look after <a href="#config">configuration</a>.</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoic2ltcGxlLWV4YW1wbGUifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IlNpbXBsZSBleGFtcGxlIGNvbmZpZyBmaWxlIn1d">
    <div data-prop-text="title">Simple example config file</div>
    <p>This example config file is used for <a href="#test-verify">install verification</a>.</p>
    <pre><code>{
  debug: false,
  port: 8125,
  backends: [ "@newrelic/statsd-infra-backend" ],
  newrelic: {
    port: 8001,
    host: "localhost",
    rules: [
            {
        matchExpression: "app1.production.localhost.sample_metric",
        metricSchema: "{app}.{environment}.{hostname}.{metricName}",
        eventType: "MyorgApplicationSample",
        labels: {
          role: "test",
          environment: "{environment}"
        }
      },
    ]
  }
}

</code></pre>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiY29tcGxldGUtZXhhbXBsZSJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiQ29tcGxldGUgZXhhbXBsZSBjb25maWcgZmlsZSJ9XQ==">
    <div data-prop-text="title">Complete example config file</div>
    <p>This example should give you an idea of how your own StatsD config file will look after <a href="#config">configuration</a>.</p>
    <pre><code>{
  debug: false,
  graphitePort: 2003,
  graphiteHost: "localhost",
  port: 8125,
  backends: [ "@newrelic/statsd-infra-backend" ],
  newrelic: {
    port: 8001,
    host: "localhost",
    rules: [
      // statsd metric keys:
      //  - myapp.production.redis.redisA.replication.connected_slaves
      //  - myapp.staging.redis.redisA.replication.connected_slaves
      // schema substitution:
      //  - {app: "myapp", environment: "production", service: "redis", serviceName: "redisA", metricName: "replication.connected_slaves"}
      //  - {app: "myapp", environment: "staging", service: "redis", serviceName: "redisA", metricName: "replication.connected_slaves"}
      {
        matchExpression: "myapp.*redis.*",
        metricSchema: "{app}.{environment}.{service}.{serviceName}.{metricName}",
        eventType: "MyOrgRedisStatsdSample",
        labels: {
          role: "cache",
          environment: "{environment}"
        }
      },
      // statsd metric keys:
      //  - mywebsite.staging.myhostname.connections.accepted
      // schema substitution:
      //  - {app: "mywebsite", environment: "staging", hostname: "myhostname", notimportant: "connections", metricName: "accepted"}
      {
        matchExpression: "mywebsite.*",
        metricSchema: "{app}.{environment}.{hostname}.{notimportant}.{metricName}",
        eventType: "MyOrgNginxStatsdSample",
        labels: {
          role: "webserver",
          environment: "{environment}"
        }
      },
    ]
  }
}

</code></pre>
  </div>
</div>
