
<p>Our <a href="https://github.com/newrelic/newrelic-pcf-nozzle-tile">VMware Tanzu integration</a> helps you understand the health and performance of your Tanzu environment. Query data from different Tanzu instances and cloud providers, and go from high level views down to the most granular data, such as the last duration of the garbage collector pause.</p>
<p>
  <img src="./images/newrelicone-dashboards-vmware-tanzu_0.png" alt="newrelicone-dashboards-vmware-tanzu.png" title="newrelicone-dashboards-vmware-tanzu.png">
</p>
<p>VMware Tanzu data visualized in a New Relic One dashboard.</p>
<p>The integration uses <a href="https://docs.pivotal.io/platform/application-service/2-8/loggregator/architecture.html">Loggregator</a> to collect metrics and events generated by all Tanzu platform components and applications that run on cells. It connects to our platform by instrumenting the VMware Tanzu Application Service (TAS) and the Cloud Foundry Application Runtime (CFAR).</p>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJ0aXAifV0=">
  <p>To collect data from VMware PKS, use the <a href="https://docs.pivotal.io/partners/new-relic-cluster-monitoring/index.html">New Relic Cluster Monitoring</a> integration.</p>
</div>
<h2>Features</h2>
<p>With the New Relic VMware Tanzu integration you can:</p>
<ul>
  <li>Monitor the health of your deployments using our extensive collection of charts and dashboards.</li>
  <li>Set alerts based on any metrics collected from Firehose.</li>
  <li>Retrieve logs and metrics related to user apps deployed on the platform.</li>
  <li>Stream metrics from platform components and health metrics from BOSH-deployed VMs.</li>
  <li>Filter logs and metrics by <a href="https://docs.pivotal.io/partners/new-relic-nozzle/index.html#filters">configuring the nozzle</a> during and after the installation.</li>
  <li>Scale the number of instances of the nozzle to support different volumes of data.</li>
  <li>Use the data retrieved to monitor <a href="https://docs.pivotal.io/platform/2-8/monitoring/kpi.html">Key Performance</a> and <a href="https://docs.pivotal.io/platform/2-8/monitoring/key-cap-scaling.html">Key Capacity Scaling</a> indicators.</li>
  <li>Instrument and monitor multiple VMware Tanzu instances using the same account.</li>
  <li>Optionally send LogMessage and HttpStartStop envelopes to <a href="https://docs.newrelic.com/docs/logs/log-management/get-started/get-started-log-management">New Relic Logs</a>, including <a href="https://docs.newrelic.com/docs/logs/enable-log-management-new-relic/configure-logs-context/configure-logs-context-apm-agents">logs in context support</a> for LogMessage envelopes.</li>
</ul>
<h2>Compatibility and requirements [#requirements]</h2>
<p>Our integration is compatible with VMware Tanzu (Pivotal Platform) version 2.5 to 2.10, and Ops Manager version 2.5 to 2.10. BOSH stemcells must be based on Ubuntu Xenial.</p>
<p>Before installing the integration, make sure that you need a VMware Tanzu account.</p>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJ0aXAifV0=">
  <p>This integration sends <a href="/docs/using-new-relic/welcome-new-relic/getting-started/data-retention-components#components-insights-events">custom events</a> <a href="https://docs.newrelic.com/docs/accounts/original-accounts-billing/product-based-pricing/overview-data-retention-components#components-insights-events">and logs</a>. If you find you are reaching the custom event data collection and data retention limits of your subscription, please reach out to your New Relic representative.</p>
</div>
<h2>Install and activate [#install-activate]</h2>
<p>The quickest way to install the VMware Tanzu integration is by importing the <a href="https://network.pivotal.io/products/nr-firehose-nozzle">nr-firehose-nozzle</a> tile into Ops Manager. For more information, <a href="https://docs.pivotal.io/partners/new-relic-nozzle/index.html">see the VMware Tanzu documentation</a>.</p>
<p>You can also deploy the nozzle as a standard application, edit the manifest, and run <code>cf push</code> from the command line; see how to build and deploy the integration <a href="https://github.com/newrelic/newrelic-pcf-nozzle-tile">in our GitHub repository</a>.</p>
<h2>Find and use data [#find-use-data]</h2>
<p>Once you install and activate the VMware Tanzu integration, you can find the data and predefined charts in <a href="http://one.newrelic.com"><strong>one.newrelic.com</strong></a> <strong>> Infrastructure > Third-party services > VMware Tanzu dashboard</strong>. You can query the data to create custom charts and dashboards, and add them to your account.</p>
<p>If you collect data from multiple Tanzu environments, use <code>pcf.domain</code> and <code>pcf.IP</code> attributes with <code>WHERE</code> or <code>FACET</code> to discriminate between events from different Tanzu deployments.</p>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
  <p>Tanzu metrics are aggregated in order to reduce memory and network consumption. However, you can increase the number of samples acting on the drain interval in the configuration.</p>
</div>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJ0aXAifV0=">
  <p>Many <strong>prebuilt dashboards and charts</strong> displaying VMware Tanzu data are <strong>available upon request</strong>. Contact your New Relic representative to get them added to your New Relic account.</p>
</div>
<h2>Set up an alert [#setup-alert]</h2>
<p>VMware Tanzu provides a list of indicators on <a href="https://docs.pivotal.io/platform/2-8/monitoring/kpi.html">key performance</a> and <a href="https://docs.pivotal.io/platform/2-8/monitoring/key-cap-scaling.html">key capacity scaling</a>, together with warning and critical values that you can monitor using <a href="https://docs.newrelic.com/docs/alerts/new-relic-alerts/defining-conditions/create-alert-conditions-nrql-queries">NRQL alert conditions</a>.</p>
<p>Here is a sample <a href="/docs/query-data/nrql-new-relic-query-language/getting-started/introduction-nrql">NRQL query</a> that sets up an alert on memory consumption related to the <code>system</code> space:</p>
<pre><code>SELECT average(app.memory.used) FROM PCFContainerMetric WHERE metric.name = 'app.memory' AND app.space.name = 'system' FACET app.instance.uid
</code></pre>
<p>Here is the resulting chart in New Relic One:</p>
<p>
  <img src="./images/tanzu-alert-chart.png" alt="VMWare Tanzu NRQL alert chart" title="tanzu-alert-chart.png">
</p>
<p>For more information on NRQL queries and how to set up different notification channels for alerts, see <a href="https://docs.newrelic.com/docs/alerts/new-relic-alerts/defining-conditions/create-alert-conditions-nrql-queries">Create alert conditions for NRQL queries</a>.</p>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
  <p>Creating alert conditions from <strong>Infrastructure > Settings</strong> is currently not supported for this integration.</p>
</div>
<h2>Metric data</h2>
<p>The VMware Tanzu integration provides the following metric data:</p>
<ul>
  <li><a href="#pcfcontainermetric">PCFContainerMetric</a></li>
  <li><a href="#pcfcounterevent">PCFCounterEvent</a></li>
  <li><a href="#pcfhttpstartstop">PCFHttpStartStop</a></li>
  <li><a href="#pcflogmessage">PCFLogMessage</a></li>
  <li><a href="#pcfvaluemetric">PCFValueMetric</a></li>
  <li><a href="#sharedfields">Shared fields</a> (<a href="#aggregation">Aggregation</a>, <a href="#app">App</a>, <a href="#decoration">Decoration</a>)</li>
</ul>
<p>PCFContainerMetric</p>
<p>Resource usage of an app in a container. Contains all the shared <a href="#aggregation">Aggregation</a>, <a href="#app">App</a>, and <a href="#decoration">Decoration</a> fields.</p>
<p>If the value of <code>metric.name</code> is <code>app.disk</code>, two additional fields are available:</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>Name</p>
      </div>
      <div>
        <p>Description</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p><code>app.disk.quota</code></p>
      </div>
      <div>
        <p>Total available disk in bytes</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>app.disk.used</code></p>
      </div>
      <div>
        <p>Disk currently used in percentage</p>
      </div>
    </div>
  </div>
</div>
<p>If the value of <code>metric.name</code> is <code>app.memory</code>, two additional fields are available:</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>Name</p>
      </div>
      <div>
        <p>Description</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p><code>app.memory.quota</code></p>
      </div>
      <div>
        <p>Total available memory in bytes</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>app.memory.used</code></p>
      </div>
      <div>
        <p>Memory currently used as percentage</p>
      </div>
    </div>
  </div>
</div>
<h3>PCFCounterEvent</h3>
<p>Increment of a counter. Contains all the shared <a href="#aggregation">Aggregation</a> and <a href="#decoration">Decoration</a> fields.</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>Name</p>
      </div>
      <div>
        <p>Description</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p><code>total.reported</code></p>
      </div>
      <div>
        <p>Current value of the counter</p>
      </div>
    </div>
  </div>
</div>
<h3>PCFHttpStartStop</h3>
<p>The whole lifecycle of an HTTP request. Contains all the shared <a href="#decoration">Decoration</a> fields. These events can optionally be sent to New Relic Logs for visualization in the <a href="https://docs.newrelic.com/docs/logs/new-relic-logs/ui-data/explore-your-data-new-relic-logs-ui">Logs UI</a>.</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>Name</p>
      </div>
      <div>
        <p>Description</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p><code>http.content.length</code></p>
      </div>
      <div>
        <p>Length of response (in bytes)</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>http.duration</code></p>
      </div>
      <div>
        <p>Duration of the HTTP request (in milliseconds)</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>http.method</code></p>
      </div>
      <div>
        <p>Method of the request</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>http.peer.type</code></p>
      </div>
      <div>
        <p>Role of the emitting process in the request cycle (server or client)</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>http.remote.address</code></p>
      </div>
      <div>
        <p>Remote address of the request. For a server, this should be the origin of the request</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>http.request.id</code></p>
      </div>
      <div>
        <p>ID for tracking the lifecycle of the request</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>http.start.timestamp</code></p>
      </div>
      <div>
        <p>UNIX timestamp (in nanoseconds) when the request was sent (by a client) or received (by a server)</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>http.status</code></p>
      </div>
      <div>
        <p>Status code returned with the response to the request</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>http.stop.timestamp</code></p>
      </div>
      <div>
        <p>UNIX timestamp (in nanoseconds) when the request was received</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>http.uri</code></p>
      </div>
      <div>
        <p>Destination of the request</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>http.user.agent</code></p>
      </div>
      <div>
        <p>Contents of the UserAgent header on the request</p>
      </div>
    </div>
  </div>
</div>
<h3>PCFLogMessage</h3>
<p>Log lines and associated metadata. Contains all the shared <a href="#aggregation">Aggregation</a>, <a href="#app">App</a>, and <a href="#decoration">Decoration</a> fields. These events can optionally be sent to New Relic Logs for visualization in the <a href="https://docs.newrelic.com/docs/logs/new-relic-logs/ui-data/explore-your-data-new-relic-logs-ui">Logs UI</a>.</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>Name</p>
      </div>
      <div>
        <p>Description</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p><code>log.app.id</code></p>
      </div>
      <div>
        <p>Application that emitted the message (or to which the application is related)</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>log.message</code></p>
      </div>
      <div>
        <p>Log message</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>log.message.type</code></p>
      </div>
      <div>
        <p>Type of the message (<code>OUT</code> or <code>ERR</code>)</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>log.source.instance</code></p>
      </div>
      <div>
        <p>Instance that emitted the message</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>log.source.type</code></p>
      </div>
      <div>
        <p>Source of the message. For Cloud Foundry, this can be <code>APP</code>, <code>RTR</code>, <code>DEA</code>, <code>STG</code>, etc.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>log.timestamp</code></p>
      </div>
      <div>
        <p>UNIX timestamp (in nanoseconds) when the log was written</p>
      </div>
    </div>
  </div>
</div>
<h3>PCFValueMetric</h3>
<p>A flat list of key-value pairs fetched from Loggregator. For an extensive list, <a href="https://docs.cloudfoundry.org/running/all_metrics.html">see the official documentation</a>.</p>
<p>Contains all the shared <a href="#aggregation">Aggregation</a> and <a href="#decoration">Decoration</a> fields.</p>
<h3>Fields shared across metric data [#sharedmetrics]</h3>
<p>VMWare Tanzu metrics contain shared data fields in the following categories:</p>
<ul>
  <li><a href="#aggregation">Aggregation fields</a></li>
  <li><a href="#app">App fields</a></li>
  <li><a href="#decoration">Decoration fields</a></li>
</ul>
<p><strong>Aggregation fields</strong></p>
<p>Fields generated by the aggregation process.</p>
<p>Shared by <code>PCFCounterEvent</code>, <code>PCFContainerMetric</code>, and <code>PCFValueMetric</code>.</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>Name</p>
      </div>
      <div>
        <p>Description</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p><code>metric.max</code></p>
      </div>
      <div>
        <p>Maximum value of the metric recorded by the nozzle from the last aggregated metric sent</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>metric.min</code></p>
      </div>
      <div>
        <p>Minimum value of the metric recorded by the nozzle from the last aggregated metric sent</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>metric.name</code></p>
      </div>
      <div>
        <p>Name of the reported metric</p>
        <p><strong>Note:</strong> the field may contain hundreds of different values</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>metric.sample.last.value</code></p>
      </div>
      <div>
        <p>Last received value of the metric</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>metric.samples.count</code></p>
      </div>
      <div>
        <p>Number of samples of the metric received by the nozzle since the last aggregated metric sent</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>metric.sum</code></p>
      </div>
      <div>
        <p>Sum of all the metric values recorded by the nozzle from the last aggregated metric sent</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>metric.type</code></p>
      </div>
      <div>
        <p>Metric type (for example, <code>integer</code>)</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>metric.unit</code></p>
      </div>
      <div>
        <p>Metric unit. For example, <code>delta</code>, <code>seconds</code>, or <code>bytes</code></p>
      </div>
    </div>
  </div>
</div>
<p><strong>App fields</strong></p>
<p>Fields that describe the source of the data.</p>
<p>Shared by <code>PCFContainerMetric</code> and <code>PCFLogMessage</code>.</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>Name</p>
      </div>
      <div>
        <p>Description</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p><code>app.instance.state</code></p>
      </div>
      <div>
        <p>Status of the application</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>app.instance.uid</code></p>
      </div>
      <div>
        <p>Id of the application instance</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>app.instances.desired</code></p>
      </div>
      <div>
        <p>Number of instances required</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>app.name</code></p>
      </div>
      <div>
        <p>Name of the application</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>app.org.name</code></p>
      </div>
      <div>
        <p>Organization the application belongs to</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>app.space.name</code></p>
      </div>
      <div>
        <p>Space where the application is running</p>
      </div>
    </div>
  </div>
</div>
<p><strong>Decoration fields</strong></p>
<p>Fields that contain information related to the agent, the PCF environment, and a timestamp.</p>
<p>Shared by all data types.</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>Name</p>
      </div>
      <div>
        <p>Description</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p><code>agent.instance</code></p>
      </div>
      <div>
        <p>Nozzle ID</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>agent.ip</code></p>
      </div>
      <div>
        <p>Nozzle IP address</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>agent.subscription</code></p>
      </div>
      <div>
        <p>Agent subscription ID, registered at the firehose</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>agent.version</code></p>
      </div>
      <div>
        <p>Version of the nozzle</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>bosh.domain</code></p>
      </div>
      <div>
        <p>API URL of your Tanzu environment</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>pcf.IP</code></p>
      </div>
      <div>
        <p>IP address (used to uniquely identify source)</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>pcf.deployment</code></p>
      </div>
      <div>
        <p>Deployment name (used to uniquely identify source)</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>pcf.domain</code></p>
      </div>
      <div>
        <p>API URL of your Tanzu environment</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>pcf.index</code></p>
      </div>
      <div>
        <p>Index of job (used to uniquely identify the source)</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>pcf.job</code></p>
      </div>
      <div>
        <p>Job name (used to uniquely identify the source)</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>pcf.origin</code></p>
      </div>
      <div>
        <p>Unique description of the origin of the event</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>timestamp</code></p>
      </div>
      <div>
        <p>UNIX timestamp (in milliseconds) of the event.</p>
        <p>Example: <code>1582023990236</code></p>
      </div>
    </div>
    <div>
      <div>
        <p><code>pcf.envelope.type</code></p>
      </div>
      <div>
        <p>Type of wrapped event</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>nr.customEventSource</code></p>
      </div>
      <div>
        <p>source of the custom event</p>
      </div>
    </div>
  </div>
</div>
