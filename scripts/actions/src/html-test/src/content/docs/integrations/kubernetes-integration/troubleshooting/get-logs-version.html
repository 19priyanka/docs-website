
<p>To generate verbose logs and get version and configuration information, follow these procedures.</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoidmVyYm9zZSJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiR2V0IHZlcmJvc2UgbG9ncyJ9XQ==">
    <div data-prop-text="title">Get verbose logs</div>
    <p>For the Kubernetes integration, the infrastructure agent adds a log entry only in the event of an error. Most common errors are displayed in the standard (non-verbose) logs. If you are doing a more in-depth investigation on your own or with New Relic Support, you can enable verbose mode.</p>
    <div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJjYXV0aW9uIn1d">
      <p>Verbose mode significantly increases the amount of infor sent to log files. Temporarily enable this mode only for troubleshooting purposes, and reset the log level when finished.</p>
    </div>
    <p>To get verbose logging details:</p>
    <ol>
      <li>
        <p>Enable <code>verbose</code> logging: In the deployment file, set the value of <code>NRIA_VERBOSE</code> to <code>1</code>.</p>
      </li>
      <li>
        <p>Apply the modified configuration by running:</p>
        <pre><code>kubectl apply -f your_newrelic_k8s.yaml
</code></pre>
      </li>
      <li>
        <p>Leave on verbose mode for a few minutes, or until you feel enough activity has occurred.</p>
      </li>
      <li>
        <p>Disable verbose mode: Set the <code>NRIA_VERBOSE</code> value back to <code>0</code>.</p>
      </li>
      <li>
        <p>Apply the restored configuration by running:</p>
        <pre><code>kubectl apply -f your_newrelic_k8s.yaml
</code></pre>
      </li>
      <li>
        <p>Get a list of nodes in the environment:</p>
        <pre><code>kubectl get nodes --all-namespaces
</code></pre>
      </li>
      <li>
        <p>Get a list of infrastructure and kube-state-metrics pods:</p>
        <pre><code>kubectl get pods --all-namespaces -o wide | egrep 'newrelic|kube-state-metrics'
</code></pre>
      </li>
      <li>
        <p><a href="#logs-pod-kubestatemetrics">Get logs from the pod connecting to kube-state-metrics</a>.</p>
      </li>
      <li>
        <p><a href="#kube-state-metrics-version">Retrieve kube-state-metrics service configuration</a>.</p>
      </li>
    </ol>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiaW5mcmEtdmVyc2lvbiJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiR2V0IHRoZSBpbmZyYXN0cnVjdHVyZSBhZ2VudCB2ZXJzaW9uIn1d">
    <div data-prop-text="title">Get the infrastructure agent version</div>
    <p>For the Kubernetes integration, the infrastructure agent is distributed as a Docker image that contains the infrastructure agent and the Kubernetes integration. The Docker image is tagged with a version, and the infrastructure agent also has its own version.</p>
    <p>When the agent is successfully sending information to New Relic, you can retrieve the versions of the infrastructure agent for Kubernetes (the Docker image) you are running in your clusters by using the following Insights query:</p>
    <pre><code>FROM K8sContainerSample SELECT uniqueCount(entityId) WHERE containerName = 'newrelic-infra' facet clusterName, containerImage

</code></pre>
    <pre><code>
   newrelic/infrastructure-k8s:1.0.0
   
</code></pre>2. Look for output similar to this:
    <pre><code>
   kubectl get pods --all-namespaces -l name=newrelic-infra -o jsonpath="{.items..spec..containers..image}"
   
</code></pre>If the agent is not reporting any data:
    1. Get the version(s) of the New Relic integration for Kubernetes that you are running in a cluster using `kubectl`:
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoia3ViZS1zdGF0ZS1tZXRyaWNzLXZlcnNpb24ifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IkdldCBrdWJlLXN0YXRlLW1ldHJpY3MgdmVyc2lvbiJ9XQ==">
    <div data-prop-text="title">Get kube-state-metrics version</div>
    <p>To retrieve the version of kube-state-metrics running on your clusters, run the following Insights NRQL query:</p>
    <pre><code>FROM K8sContainerSample SELECT uniqueCount(entityId) WHERE containerName LIKE '%kube-state-metrics%' facet clusterName, containerImage

</code></pre>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoibG9ncy1wb2Qta3ViZXN0YXRlbWV0cmljcyJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiR2V0IGxvZ3MgZnJvbSBwb2QgY29ubmVjdGluZyB0byBrdWJlLXN0YXRlLW1ldHJpY3MifV0=">
    <div data-prop-text="title">Get logs from pod connecting to kube-state-metrics</div>
    <p>To get the logs from the pod connecting to kube-state-metrics:</p>
    <ol>
      <li>
        <p>Get the node that kube-state-metrics is running on:</p>
        <pre><code>kubectl get pods --all-namespaces -o wide | grep kube-state-metrics
</code></pre>
        <p>Look for output similar to this:</p>
        <pre><code>kube-system   kube-state-metrics-5c6f5cb9b5-pclhh     2/2       
Running   4          4d        172.17.0.3   minikube
</code></pre>
      </li>
      <li>
        <p>Get the New Relic pod that is running on the same node as kube-state-metrics:</p>
        <pre><code>kubectl describe node minikube | grep newrelic-infra
</code></pre>
        <p>Look for output similar to this:</p>
        <pre><code>default                    newrelic-infra-5wcv6                     100m (5%)
0 (0%)      100Mi (5%)       100Mi (5%)
</code></pre>
      </li>
      <li>
        <p>Retrieve the logs for that node by running:</p>
        <pre><code>kubectl logs newrelic-infra-5wcv6
</code></pre>
      </li>
    </ol>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoicmV0cmlldmUtc2VydmljZS1jb25maWcifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IlJldHJpZXZlIGt1YmUtc3RhdGUtbWV0cmljcyBzZXJ2aWNlIGNvbmZpZ3VyYXRpb24ifV0=">
    <div data-prop-text="title">Retrieve kube-state-metrics service configuration</div>
    <p>To retrieve the configuration:</p>
    <ol>
      <li>
        <p>Run:</p>
        <pre><code>kubectl get pods --all-namespaces | grep "kube-state-metrics"
</code></pre>
      </li>
      <li>
        <p>Look for a response similar to this:</p>
        <pre><code>kube-system   kube-state-metrics-5c6f5cb9b5-5wf9m     2/2       
Running       8          6d
</code></pre>
      </li>
      <li>
        <p>Review the namespace in the first column.</p>
        <pre><code>kubectl describe service kube-state-metrics -n &#x3C;namespace>
</code></pre>
      </li>
    </ol>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoibG9ncy1wb2Qta3ViZXN0YXRlbWV0cmljcyJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiR2V0IGxvZ3MgZnJvbSBwb2QgcnVubmluZyBvbiBhIG1hc3RlciBub2RlIn1d">
    <div data-prop-text="title">Get logs from pod running on a master node</div>
    <p>To get the logs from a pod running on a master node:</p>
    <ol>
      <li>
        <p>Get the nodes that are labelled as master:</p>
        <pre><code>kubectl get nodes -l node-role.kubernetes.io/master=""
</code></pre>
        <p>Or,</p>
        <pre><code>kubectl get nodes -l kubernetes.io/role="master"
</code></pre>
        <p>Look for output similar to this:</p>
        <pre><code>NAME                         STATUS  ROLES   AGE   VERSION
ip-10-42-24-4.ec2.internal   Ready   master  42d   v1.14.8
</code></pre>
      </li>
      <li>
        <p>Get the New Relic pod that is running on one of the nodes returned in the previous step:</p>
        <pre><code>kubectl get pods --field-selector spec.nodeName=ip-10-42-24-4.ec2.internal -l name=newrelic-infra --all-namespaces
</code></pre>
        <p>Look for output similar to this:</p>
        <pre><code>newrelic-infra-whvzt
</code></pre>
      </li>
      <li>
        <p>Retrieve the logs for that node by running:</p>
        <pre><code>kubectl logs newrelic-infra-whvzt
</code></pre>
      </li>
    </ol>
  </div>
</div>
<p>For troubleshooting help, see <a href="/docs/integrations/host-integrations/troubleshooting/kubernetes-integration-troubleshooting-not-seeing-data">Not seeing data</a> or <a href="/docs/integrations/host-integrations/troubleshooting/kubernetes-integration-troubleshooting-error-messages">Error messages</a>.</p>
<h2>For more help [#more_help]</h2>
