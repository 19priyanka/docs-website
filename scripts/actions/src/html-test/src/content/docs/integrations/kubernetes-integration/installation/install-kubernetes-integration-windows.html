
<p>To run our Kubernetes installation for Windows, follow the steps below to:</p>
<ul>
  <li>Check the <a href="#k8-windows-req">compatibility and requirements</a>.</li>
  <li><a href="#k8-windows-install">Update the manifest</a> file.</li>
  <li>Learn about the <a href="#k8-windows-limitations">limitations</a> of the integration.</li>
</ul>
<h2>Compatibility and requirements [#k8-windows-req]</h2>
<p>Before you install <a href="/docs/integrations/kubernetes-integration/get-started/introduction-kubernetes-integration">New Relic's Kubernetes integration</a>, review the <a href="/docs/integrations/kubernetes-integration/get-started/kubernetes-integration-compatibility-requirements">compatibility and requirements</a>.</p>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
  <p>When using containers in Windows, the container host version and the container image version must be the same. Our Kubernetes integration supports Windows versions 1809 and 1909.</p>
</div>
<p>To check your Windows version:</p>
<ol>
  <li>
    <p>Open a command window.</p>
  </li>
  <li>
    <p>Run the following command:</p>
    <pre><code>Reg Query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion" /v 
ReleaseIdcmd.exe
</code></pre>
  </li>
</ol>
<h3>Example: Get Kubernetes for Windows from a BusyBox container.</h3>
<pre><code>$ kubectl exec -it busybox1-766bb4d6cc-rmsnj -- Reg Query 
    "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion" /v ReleaseId
</code></pre>
<pre><code>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion
	ReleaseId	REG_SZ	1809
</code></pre>
<h2>Install [#k8-windows-install]</h2>
<p>To install the Kubernetes integration for Windows:</p>
<ol>
  <li>
    <p>Install <a href="https://github.com/kubernetes/kube-state-metrics#kubernetes-deployment">kube-state-metrics</a> and run it in your cluster using this snippet:</p>
    <pre><code>curl -L -o kube-state-metrics-1.9.5.zip 
https://github.com/kubernetes/kube-state-metrics/archive/v1.9.5.zip &#x26;&#x26; 
unzip kube-state-metrics-1.9.5.zip &#x26;&#x26; kubectl apply -f 
kube-state-metrics-1.9.5/examples/standard
</code></pre>
  </li>
  <li>
    <p>Download the manifest file that matches your Windows version:</p>
    <ul>
      <li>
        <p>For Windows 1809:</p>
        <pre><code>curl -0 
http://download.newrelic.com/infrastructure_agent/integrations/kubernetes/newrelic-infrastructure-k8s-linux-windows1809-1.21.0-alpha.yaml
</code></pre>
      </li>
      <li>
        <p>For Windows 1909:</p>
        <pre><code>curl -0 
http://download.newrelic.com/infrastructure_agent/integrations/kubernetes/newrelic-infrastructure-k8s-linux-windows1909-1.21.0-alpha.yaml"
</code></pre>
      </li>
    </ul>
  </li>
  <li>
    <p>Update the manifest with your cluster name and <a href="/docs/accounts/install-new-relic/account-setup/license-key">New Relic license key</a>. Since our manifest provides two <code>DaemonSets</code> (one for Windows and one for Linux), you need to add this information in two places:</p>
    <ul>
      <li>
        <p>Line 87:</p>
        <pre><code>- name: "CLUSTER_NAME"
  value: YOUR_CLUSTER_NAME
- name: "NRIA_LICENSE_KEY"
  value: YOUR_LICENSE_KEY
</code></pre>
      </li>
      <li>
        <p>Line 187:</p>
        <pre><code>- name: "CLUSTER_NAME"
  value: YOUR_CLUSTER_NAME
- name: "NRIA_LICENSE_KEY"
  value: YOUR_LICENSE_KEY
</code></pre>
      </li>
    </ul>
    <div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJ0aXAifV0=">
      <p>We recommend not to change the NRIA_PASSTHROUGH_ENVIRONMENT or NRIA_DISPLAY_NAME value in your manifest.</p>
    </div>
  </li>
  <li>
    <p>Review our <a href="/docs/integrations/kubernetes-integration/installation/kubernetes-installation-configuration#">Configuration docs</a> and adapt the manifest to fit your environment.</p>
  </li>
  <li>
    <p>Confirm that <code>kube-state-metrics</code> is installed:</p>
    <pre><code>kubectl get pods --all-namespaces | grep kube-state-metrics
</code></pre>
  </li>
  <li>
    <p>Create the <code>DaemonSet</code>:</p>
    <ul>
      <li>
        <p>For Windows 1809:</p>
        <pre><code>kubectl apply -f 
newrelic-infrastructure-k8s-linux-windows1809-1.21.0-alpha.yaml
</code></pre>
      </li>
      <li>
        <p>For Windows 1909:</p>
        <pre><code>kubectl apply -f 
newrelic-infrastructure-k8s-linux-windows1909-1.21.0-alpha.yaml
</code></pre>
      </li>
    </ul>
  </li>
  <li>
    <p>Confirm that the <code>DaemonSet</code> has been created successfully by looking for <code>newrelic-infra</code> in the results generated by this command:</p>
    <pre><code>kubectl get daemonsets
</code></pre>
  </li>
</ol>
<h2>Limitations [#k8-windows-limitations]</h2>
<p>The following limitations apply to the Kubernetes integration for Windows:</p>
<ul>
  <li>The Windows agent only sends the <a href="/docs/integrations/kubernetes-integration/understand-use-data/understand-use-data#event-types">Kubernetes samples</a> (<code>K8sNodeSample</code>, <code>K8sPodSample</code>, etc.)
    <ul>
      <li><code>SystemSample</code>, <code>StorageSample</code>, <code>NetworkSample</code>, and <code>ProcessSample</code> are not generated.</li>
    </ul>
  </li>
  <li>Some <a href="/docs/integrations/kubernetes-integration/understand-use-data/understand-use-data#metrics">Kubernetes metrics</a> are missing because the Windows kubelet doesnâ€™t have them:
    <ul>
      <li>Node:
        <ul>
          <li><code>fsInodes</code>: not sent</li>
          <li><code>fsInodesFree</code>: not sent</li>
          <li><code>fsInodesUsed</code>: not sent</li>
          <li><code>memoryMajorPageFaultsPerSecond</code>: always returns zero as a value</li>
          <li><code>memoryPageFaults</code>: always returns zero as a value</li>
          <li><code>memoryRssBytes</code>: always returns zero as a value</li>
          <li><code>runtimeInodes</code>: not sent</li>
          <li><code>runtimeInodesFree</code>: not sent</li>
          <li><code>runtimeInodesUsed</code>: not sent</li>
        </ul>
      </li>
      <li>Pod:
        <ul>
          <li><code>net.errorsPerSecond</code>: not sent</li>
          <li><code>net.rxBytesPerSecond</code>: not sent</li>
          <li><code>net.txBytesPerSecond</code>: not sent</li>
        </ul>
      </li>
      <li>Container:
        <ul>
          <li><code>containerID</code>: not sent</li>
          <li><code>containerImageID</code>: not sent</li>
          <li><code>memoryUsedBytes</code>: in the UI, this is displayed in the pod card that appears when you click on a pod, and will show no data. We will soon fix this by updating our charts to use <code>memoryWorkingSetBytes</code> instead.</li>
        </ul>
      </li>
      <li>Volume:
        <ul>
          <li><code>fsUsedBytes</code>: zero, so <code>fsUsedPercent</code> is zero</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<h2>Known issues with the Windows Kubelet [#k8-windows-limitations]</h2>
<p>There are a couple of issues with the Windows version of Kubelet that can prevent the integration from fetching data:</p>
<ul>
  <li>
    <p><a href="https://github.com/kubernetes/kubernetes/pull/90554">Issue 90554:</a> This issue makes the Kubelet return 500 errors when the integration makes a request to the <code>/stats/summary</code> endpoint. It will be included in the Kubernetes 1.19 release and has been backported to the releases 1.16.11, 1.17.7, and 1.18.4. There is no solution on the integration side for this problem, we advise you to update to one of the patch versions as soon as possible. You can see if you're being affected by this problem by <a href="https://docs.newrelic.com/docs/integrations/kubernetes-integration/troubleshooting/get-logs-version#verbose">enabling verbose logs</a> and looking for messages of the type:</p>
    <pre><code>error querying Kubelet. Get "https://&#x3C;KUBELET_IP>/stats/summary": error calling kubelet endpoint. Got status code: 500
</code></pre>
  </li>
  <li>
    <p><a href="https://github.com/kubernetes/kubernetes/pull/87730">Issue 87730:</a> This issue makes the Kubelet metrics very slow when running minimal load. It makes the integration fail with a timeout error. A patch for this issue has been added for Kubernetes 1.18 and backported to 1.15.12, 1.16.9, and 1.17.5. We advise you to update to one of the patch versions as soon as possible. To mitigate this issue you can increase the integration timeout with the <a href="https://docs.newrelic.com/docs/integrations/kubernetes-integration/installation/kubernetes-integration-install-configure#kube-state-metrics-timeout-change"><code>TIMEOUT</code> config option</a>. You can see if you're being affected by this problem by <a href="https://docs.newrelic.com/docs/integrations/kubernetes-integration/troubleshooting/get-logs-version#verbose">enabling verbose logs</a> and looking for messages of the type:</p>
    <pre><code>error querying Kubelet. Get "https://&#x3C;KUBELET_IP>/stats/summary": context deadline exceeded (Client.Timeout exceeded while awaiting headers)
</code></pre>
  </li>
</ul>
