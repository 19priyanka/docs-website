
<p>Do you have a PromQL query youâ€™d like to convert to <a href="/docs/query-data/nrql-new-relic-query-language/getting-started/introduction-nrql">NRQL</a>? This document provides examples that show you how to convert some common PromQL queries to NRQL queries. You can use our PromQL-style query language to explore your Prometheus OpenMetrics integration data along with other data sent to New Relic.</p>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJ0aXAifV0=">
  <p>To run PromQL-style queries in <a href="/docs/new-relic-one/use-new-relic-one/get-started/introduction-new-relic-one">New Relic One</a>, go to the <a href="/docs/query-your-data/explore-query-data/chart-builder/use-advanced-promql-mode-specify-data">query builder advanced PromQL-style mode</a>.</p>
</div>
<h2>Prometheus and New Relic metric types [#compare]</h2>
<p>The different metric types supported by Prometheus and New Relic are related to each other:</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>New Relic</p>
      </div>
      <div>
        <p>Prometheus</p>
      </div>
      <div>
        <p>Description</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p>Count</p>
      </div>
      <div>
        <p>Counter</p>
      </div>
      <div>
        <p>The Prometheus counter is a cumulative sum while the New Relic count is a delta sum.</p>
        <p>For example, if you see 2 requests in the first reporting period and 3 requests in the second reporting period. The Prometheus counter will report 2 and then 5, while the New Relic count will report 2 and then 3.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Gauge</p>
      </div>
      <div>
        <p>Gauge</p>
      </div>
      <div>
        <p>A Prometheus gauge is similar to a New Relic gauge.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Multiple counts</p>
      </div>
      <div>
        <p>Histogram</p>
      </div>
      <div>
        <p>Prometheus automatically maps a histogram to a set of counters. In New Relic, these counters should be changed to deltas and reported as counts.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Gauges and counts</p>
      </div>
      <div>
        <p>Summary</p>
      </div>
      <div>
        <p>Prometheus automatically maps a summary to a set of counters and gauges. These can be translated to New Relic counts and gauges.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Summary</p>
      </div>
      <div>
        <p>(No equivalent in Prometheus)</p>
      </div>
      <div>
        <p>New Relic has a distinct metric type called a summary that is different than the Prometheus summary. It is designed for reporting aggregated discrete events so that you can query the count, sum, min, max, and average values.</p>
      </div>
    </div>
  </div>
</div>
<h2>Mapping between NRQL and our PromQL-style queries [#explore-data]</h2>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJ0aXAifV0=">
  <p>To see how New Relic translates PromQL-style queries to NRQL, write a query in the <a href="/docs/query-your-data/explore-query-data/chart-builder/use-advanced-promql-mode-specify-data">query builder PromQL-style tab</a>, then switch to the <a href="/docs/chart-builder/use-chart-builder/choose-data/use-advanced-nrql-mode-specify-data">NRQL tab</a>.</p>
</div>
<p>This table shows the mapping between NRQL and our PromQL-style queries when exploring data. For more contextual information, see the <a href="#prom-ql-example">examples</a>.</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>Description</p>
      </div>
      <div>
        <p>Mapping between NRQL and PromQL-style queries</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p><strong>Search for attributes:</strong></p>
        <p>Explore the attributes on the <code>container_memory_usage_bytes</code> metric.</p>
      </div>
      <div>
        <ul>
          <li>
            <p>PromQL:</p>
            <pre><code>container_memory_usage_bytes
</code></pre>
          </li>
          <li>
            <p>NRQL:</p>
            <pre><code>FROM Metric SELECT keyset() WHERE metricName = 'container_memory_usage_bytes'
</code></pre>
          </li>
        </ul>
      </div>
    </div>
    <div>
      <div>
        <p><strong>Find attribute's value:</strong></p>
        <p>Explore the current value of the <code>container_memory_usage_bytes</code> metric for unique <code>id</code> attributes.</p>
      </div>
      <div>
        <ul>
          <li>
            <p>PromQL:</p>
            <pre><code>sum(container_memory_usage_bytes) by (id)
</code></pre>
          </li>
          <li>
            <p>NRQL:</p>
            <pre><code>FROM Metric SELECT latest(container_memory_usage_bytes) FACET id
</code></pre>
          </li>
        </ul>
      </div>
    </div>
    <div>
      <div>
        <p><strong>Visualize the attribute's value:</strong></p>
        <p>Chart the value of the <code>container_memory_usage_bytes</code> metric with the given <code>id</code> attribute value.</p>
      </div>
      <div>
        <ul>
          <li>
            <p>PromQL:</p>
            <pre><code>container_memory_usage_bytes{id="/"}
</code></pre>
          </li>
          <li>
            <p>NRQL:</p>
            <pre><code>FROM Metric SELECT latest(container_memory_usage_bytes) WHERE id = '/' TIMESERIES
</code></pre>
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoicHJvbS1xbC1leGFtcGxlIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJQcm9tUUwtc3R5bGUgcXVlcnkgZXhhbXBsZSJ9XQ==">
    <div data-prop-text="title">PromQL-style query example</div>
    <p><strong>1. Start your query.</strong></p>
    <p>When exploring your data for a particular metric in PromQL, such as memory by container usage in bytes, you can start with a query such as:</p>
    <pre><code>container_memory_usage_bytes

</code></pre>![a query using PromQL](./images/PROMQL-query-2.png "PROMQL-query-2.png")
    **PromQL-style example:** To filter the data, run this PromQL-style query: container_memory_usage_bytes&#x26;#x7B;id="/"}.
    <pre><code>
container_memory_usage_bytes{id="/"}

</code></pre>This will chart all the unique metric timeseries for the input metric.
    **2. Filter the query results.**
    Looking at the data, you can add more query parameters to filter down the number of metric timeseries. For example, if you only want timeseries where the `id` is `/`, the PromQL-style query will be:
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoibnJxbC1xdWVyeS1leGFtcGxlIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJOUlFMIHF1ZXJ5IGV4YW1wbGUifV0=">
    <div data-prop-text="title">NRQL query example</div>
    <p><strong>1. Query available metrics.</strong></p>
    <p>To explore your data, start by looking at all the available metrics. Use the following NRQL query:</p>
    <pre><code>FROM Metric SELECT uniques(metricName)

</code></pre>![NRQL-query-example-5.png](./images/NRQL-query-example-5.png "NRQL-query-example-5.png")
    **[one.newrelic.com](https://one.newrelic.com) > Query your data**: This example shows the data displayed after running `From Metric select latest(container_memory_usage_bytes) where id = "/" timeseries`.
    <pre><code>
FROM Metric SELECT latest(container_memory_usage_bytes) WHERE id = "/" timeseries

</code></pre>![NRQL-query-example-4.png](./images/NRQL-query-example-4.png "NRQL-query-example-4.png")
    **[one.newrelic.com](https://one.newrelic.com) > Query your data**: This example shows the data you see after running FROM Metric SELECT latest(container_memory_usage_bytes) FACET id.
    **5. Add the selected ID to the query.**
    Next you can select an `id` value and put it in the NRQL `where` clause.
    <pre><code>
FROM Metric SELECT latest(container_memory_usage_bytes) FACET id

</code></pre>The results will show each available attribute key and the value type (string, boolean, or number).
    **3. Aggregate and chart the metrics.**
    To chart metrics using NRQL, you first need an aggregation function. For example, you can use `latest` for gauges, `sum` for counts, and `average` for summaries.
    As the following chart shows, all the unique timeseries are aggregated into one unique timeseries by default:
    ![NRQL-example-3.png](./images/NRQL-example-3.png "NRQL-example-3.png")
    **[one.newrelic.com](https://one.newrelic.com) > Query your data**: This example shows the data you see after running FROM Metric SELECT keyset() WHERE metricName = 'container_memory_usage_bytes'.
    **4. View metrics by ID.**
    To view the unique metric timeseries with various `id` values, run the following query:
    <pre><code>
FROM Metric SELECT keyset() WHERE metricName = 'container_memory_usage_bytes'

</code></pre>**2. Find unique attributes.**
    Once you have found the metric you want to review, such as `container_memory_usage_bytes`, you can find the unique attributes with the following query:
  </div>
</div>
<h2>Filter examples [#filter-data]</h2>
<p>Both our PromQL-style query language and NRQL provide syntax to filter down the number of unique metric timeseries.</p>
<ul>
  <li>PromQL-style uses brackets to filter.</li>
  <li>NRQL uses a <code>WHERE</code> clause.</li>
</ul>
<p>Here are some example queries:</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>Description</p>
      </div>
      <div>
        <p>PromQL-style and NRQL queries</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p>Select data with specific values.</p>
      </div>
      <div>
        <ul>
          <li>
            <p>PromQL:</p>
            <pre><code>go_memstats_heap_alloc_bytes{job="apiserver", instance="1234"})
</code></pre>
          </li>
          <li>
            <p>NRQL:</p>
            <p>To only select data with specific values in NRQL, use the <code>WHERE</code> clause with <code>=</code>. In this example, all data must have the selected value for job and handler.</p>
            <pre><code>FROM Metric SELECT latest(go_memstats_heap_alloc_bytes) WHERE job = 'apiserver' AND instance = '1234' TIMESERIES
</code></pre>
          </li>
        </ul>
      </div>
    </div>
    <div>
      <div>
        <p>Select data with multiple values.</p>
      </div>
      <div>
        <ul>
          <li>
            <p>PromQL:</p>
            <pre><code>go_memstats_heap_alloc_bytes{environment=~"staging|testing|development",method!="GET"}
</code></pre>
          </li>
          <li>
            <p>NRQL:</p>
            <p>In NRQL use the <code>in</code> clause to select multiple values for an attribute and the <code>!=</code> sign to select all values but the one listed. In this example, the environment can be <code>staging</code>, <code>testing</code>, or <code>development</code>, and the method cannot be <code>GET</code>.</p>
            <pre><code>FROM Metric SELECT latest(go_memstats_heap_alloc_bytes) WHERE environment IN ('staging', 'testing', 'development') AND method != 'GET' TIMESERIES
</code></pre>
          </li>
        </ul>
      </div>
    </div>
    <div>
      <div>
        <p>Select data using partial string values.</p>
      </div>
      <div>
        <ul>
          <li>
            <p>PromQL:</p>
            <pre><code>go_memstats_heap_alloc_bytes{job=~"api.*"}
</code></pre>
          </li>
          <li>
            <p>NRQL:</p>
            <p>In NRQL use the <code>LIKE</code> clause to match part of a string value. In this example, all data will be returned where the job attributes start with <code>api</code>.</p>
            <pre><code>FROM Metric SELECT latest(go_memstats_heap_alloc_bytes) WHEREe job LIKE 'api%' TIMESERIES
</code></pre>
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>
<h2>PromQL-style to NRQL query examples [#examples]</h2>
<p>You can simulate the following PromQL-style queries with NRQL queries:</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>Description</p>
      </div>
      <div>
        <p>PromQL-style and NRQL queries</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p>Measure the per second rate over the last minute of the <code>http_request_total</code> metric.</p>
      </div>
      <div>
        <ul>
          <li>
            <p>PromQL:</p>
            <pre><code>sum(rate(http_requests_total[1m]))
</code></pre>
          </li>
          <li>
            <p>NRQL:</p>
            <pre><code>FROM Metric SELECT rate(sum(http_request_total), 1 second) TIMESERIES 1 minute
</code></pre>
          </li>
        </ul>
      </div>
    </div>
    <div>
      <div>
        <p>Chart the difference of the two metrics, then divide by 1024.</p>
      </div>
      <div>
        <ul>
          <li>
            <p>PromQL:</p>
            <pre><code>(instance_memory_limit_bytes - instance_memory_usage_bytes) / 1024
</code></pre>
          </li>
          <li>
            <p>NRQL:</p>
            <pre><code>FROM Metric SELECT (latest(instance_memory_limit_bytes) - latest(instance_memory_usage_bytes)) / 1024 TIMESERIES
</code></pre>
          </li>
        </ul>
      </div>
    </div>
    <div>
      <div>
        <p>Provide the summed rate per 30-second interval by each handler.</p>
      </div>
      <div>
        <ul>
          <li>
            <p>PromQL:</p>
            <pre><code>sum(rate(http_requests_total[30s])) by (handler)
</code></pre>
          </li>
          <li>
            <p>NRQL:</p>
            <pre><code>FROM Metric SELECT rate(sum(http_requests_total), 30 seconds) FACET handler TIMESERIES
</code></pre>
          </li>
        </ul>
      </div>
    </div>
    <div>
      <div>
        <p>Chart the difference in the two metrics where the instance is named <code>foo</code> and the <code>fstype</code> is either <code>ext4</code> or <code>xfs</code>.</p>
      </div>
      <div>
        <ul>
          <li>
            <p>PromQL:</p>
            <pre><code>(node_filesystem_free_bytes{instance='foo',fstype=~"ext4|xfs"} / node_filesystem_size_bytes{instance='foo',fstype=~"ext4|xfs"})
</code></pre>
          </li>
          <li>
            <p>NRQL:</p>
            <pre><code>FROM Metric SELECT latest(node_filesystem_free_bytes) / latest(node_filesystem_size_bytes) WHERE instance = 'foo' AND fstype IN ('ext4', 'xfs')
</code></pre>
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>
<h2>For more help [#more_help]</h2>
