
<p>Our Nagios <a href="https://docs.newrelic.com/docs/integrations/host-integrations/getting-started/introduction-host-integrations">integration</a> lets you use your service checks directly, without the need to run a Nagios instance.</p>
<p>Read on to install the integration, and to see what data we collect.</p>
<h2>Compatibility and requirements [#comp-req]</h2>
<p>Our integration is compatible with any existing service that conform to the <a href="https://assets.nagios.com/downloads/nagioscore/docs/nagioscore/3/en/pluginapi.html">Nagios Plugin API</a>.</p>
<p>Before installing the integration, make sure that you meet the following requirements:</p>
<ul>
  <li><a href="/docs/infrastructure/install-infrastructure-agent/get-started/install-infrastructure-agent-new-relic">Install the infrastructure agent</a>.</li>
  <li>Linux distribution or Windows OS version <a href="/docs/infrastructure/new-relic-infrastructure/getting-started/compatibility-requirements-new-relic-infrastructure">compatible with New Relic's infrastructure agent</a>.</li>
</ul>
<h2>Install and activate [#install]</h2>
<p>To install the Nagios integration:</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoibGludXgtaW5zdGFsbCJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiTGludXggaW5zdGFsbGF0aW9uIn1d">
    <div data-prop-text="title">Linux installation</div>
    <ol>
      <li>
        <p>Follow the instructions for <a href="/docs/install-integrations-package">installing an integration</a>, using the file name <code>nri-nagios</code>.</p>
      </li>
      <li>
        <p>Change directory to the integrations folder:</p>
        <pre><code>cd /etc/newrelic-infra/integrations.d
</code></pre>
      </li>
      <li>
        <p>Copy of the sample configuration file:</p>
        <pre><code>sudo cp nagios-config.yml.sample nagios-config.yml
</code></pre>
      </li>
      <li>
        <p>Create a copy of the sample service checks file by running:</p>
        <pre><code>sudo cp nagios-service-checks.yml.sample nagios-service-checks.yml
</code></pre>
      </li>
      <li>
        <p>Edit the <code>nagios-config.yml</code> file as described in the <a href="#config">configuration settings</a>.</p>
      </li>
      <li>
        <p><a href="https://docs.newrelic.com/docs/infrastructure/new-relic-infrastructure/configuration/start-stop-restart-check-infrastructure-agent-status">Restart the infrastructure agent</a>.</p>
      </li>
    </ol>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoid2luZG93cy1pbnN0YWxsIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJXaW5kb3dzIGluc3RhbGxhdGlvbiJ9XQ==">
    <div data-prop-text="title">Windows installation</div>
    <ol>
      <li>
        <p>Download the <code>nri-nagios</code> .MSI installer image from:</p>
        <p><a href="http://download.newrelic.com/infrastructure_agent/windows/integrations/nri-nagios/nri-nagios-amd64.msi">http://download.newrelic.com/infrastructure_agent/windows/integrations/nri-nagios/nri-nagios-amd64.msi</a></p>
      </li>
      <li>
        <p>To install from the Windows command prompt, run:</p>
        <pre><code>msiexec.exe /qn /i PATH\TO\nri-nagios-amd64.msi
</code></pre>
      </li>
      <li>
        <p>In the Integrations directory, <code>C:\Program Files\New Relic\newrelic-infra\integrations.d\</code>, create a copy of the sample configuration file by running:</p>
        <pre><code>cp nagios-config.yml.sample nagios-config.yml
</code></pre>
      </li>
      <li>
        <p>Edit the <code>nagios-config.yml</code> file as described in the <a href="#config">configuration settings</a>.</p>
      </li>
      <li>
        <p>In the Integrations directory, <code>C:\Program Files\New Relic\newrelic-infra\integrations.d\</code>, create a <code>nagios-service-checks.yml</code> file that describes the service checks to be run by the integration.</p>
        <p>For an example configuration, see the <a href="#example-service-checks-yml">example service checks file</a>.</p>
      </li>
      <li>
        <p><a href="https://docs.newrelic.com/docs/infrastructure/new-relic-infrastructure/configuration/start-stop-restart-check-infrastructure-agent-status">Restart the infrastructure agent</a>.</p>
      </li>
    </ol>
  </div>
</div>
<p>Additional notes:</p>
<ul>
  <li><strong>Advanced:</strong> It's also possible to <a href="/docs/integrations/host-integrations/installation/install-host-integrations-built-new-relic#tarball">install the integration from a tarball file</a>. This gives you full control over the installation and configuration process.</li>
  <li><strong>On-host integrations do not automatically update.</strong> For best results, regularly <a href="/docs/integrations/host-integrations/installation/update-infrastructure-host-integration-package">update the integration package</a> and <a href="/docs/infrastructure/new-relic-infrastructure/installation/update-infrastructure-agent">the Infrastructure agent</a>.</li>
</ul>
<h2>Configure the integration [#config]</h2>
<p>An integration's YAML-format configuration is where you can place required login credentials and configure how data is collected. Which options you change depend on your setup and preference.</p>
<p>For an example configuration, see the <a href="#example-config">example config file</a>.</p>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
  <p>With secrets management, you can configure on-host integrations with New Relic Infrastructure's agent to use sensitive data (such as passwords) without having to write them as plain text into the integration's configuration file. For more information, see <a href="https://docs.newrelic.com/docs/integrations/host-integrations/installation/secrets-management">Secrets management</a>.</p>
</div>
<h3>Arguments</h3>
<p>The <code>nagios-config.yml</code> contains two configurable arguments:</p>
<ul>
  <li><code>service_checks_config</code>: This points to a yaml file containing definitions of the service checks that will be run by the integration.</li>
  <li><code>concurrency</code>: The number of services checks to be run concurrently (Default: 1).</li>
</ul>
<h3>Commands</h3>
<p>The <code>service_checks_config</code> yaml file contains the top-level array <code>service_checks</code>. Each service check must contain both a <code>name</code> and a <code>command</code>.</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>Key</p>
      </div>
      <div>
        <p>Description</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p><code>name</code></p>
      </div>
      <div>
        <p>The naming convention is not specific, and allows for easy recognition in the Infrastructure UI.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>command</code></p>
      </div>
      <div>
        <p>The command is an array of strings, with the first position containing the path to the executable and the remaining positions containing the arguments to the executable.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>labels</code></p>
      </div>
      <div>
        <p>A collection of key: value pairs which help to identify and group service checks in Insights.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>parse_output</code></p>
      </div>
      <div>
        <p>Attempts to parse the output of service checks that conform to the <a href="https://assets.nagios.com/downloads/nagioscore/docs/nagioscore/3/en/pluginapi.html">Nagios Plugin API spec</a>. Default: <code>false</code>.</p>
      </div>
    </div>
  </div>
</div>
<h3>Permissions</h3>
<p>Non-configurable commands are run by the infrastructure agent, which itself is run by the root user. For the integration to run properly, ensure that the permissions on the yaml file are appropriately restrictive as indicated below:</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoibGludXgtcGVybWlzc2lvbnMifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IkxpbnV4IHBlcm1pc3Npb25zIn1d">
    <div data-prop-text="title">Linux permissions</div>
    <p>Set the user permissions flag to <code>0600</code>, restricting read and write privileges to the file owner. If permissions do not meet this requirement, an <a href="#config-parsing-failed">error will be logged</a> and the integration will fail to run.</p>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoid2luZG93cy1wZXJtaXNzaW9ucyJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiV2luZG93cyBwZXJtaXNzaW9ucyJ9XQ==">
    <div data-prop-text="title">Windows permissions</div>
    <p>By default, the agent and any commands in the yaml file run as an Administrator. As the integration is unable to check permissions, it is up to the user to appropriately restrict permissions for the file.</p>
  </div>
</div>
<h3>Example configurations [#example-config]</h3>
<p>Example file configurations:</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZXhhbXBsZS1jb25maWcteW1sIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOnsidHlwZSI6Im1keFZhbHVlRXhwcmVzc2lvbiIsInZhbHVlIjoiPD5FeGFtcGxlIDxJbmxpbmVDb2RlPm5hZ2lvcy1jb25maWcueW1sPC9JbmxpbmVDb2RlPiBjb25maWd1cmF0aW9uPC8+IiwicG9zaXRpb24iOnsic3RhcnQiOnsibGluZSI6MTg5LCJjb2x1bW4iOjExLCJvZmZzZXQiOjc1MTB9LCJlbmQiOnsibGluZSI6MTg5LCJjb2x1bW4iOjgyLCJvZmZzZXQiOjc1ODF9fX19XQ==">
    <div data-prop-text="title">[object Object]</div>
    <pre><code>integration_name: com.newrelic.nagios

instances:
  - name: nagios
    # Command can only be metrics
    command: metrics
    arguments:
      # The absolute path to the service checks config file
      service_checks_config: /etc/newrelic-infra/integrations.d/nagios-service-checks.yml

</code></pre>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZXhhbXBsZS1zZXJ2aWNlLWNoZWNrcy15bWwifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6eyJ0eXBlIjoibWR4VmFsdWVFeHByZXNzaW9uIiwidmFsdWUiOiI8PkV4YW1wbGUgPElubGluZUNvZGU+bmFnaW9zLXNlcnZpY2UtY2hlY2tzLnltbDwvSW5saW5lQ29kZT4gY29uZmlndXJhdGlvbjwvPiIsInBvc2l0aW9uIjp7InN0YXJ0Ijp7ImxpbmUiOjIwNiwiY29sdW1uIjoxMSwib2Zmc2V0Ijo3OTk2fSwiZW5kIjp7ImxpbmUiOjIwNiwiY29sdW1uIjo5MCwib2Zmc2V0Ijo4MDc1fX19fV0=">
    <div data-prop-text="title">[object Object]</div>
    <pre><code>service_checks:
  - name: check_users
    command: ["/usr/local/nagios/libexec/check_users", "-w", "5", "-c", "10"]
    parse_output: true
    labels:
      env: staging
      key1: val1
  - name: check_yum
    command: ["/usr/local/nagios/libexec/check_yum"]

</code></pre>
  </div>
</div>
<p>For more about the general structure of on-host integration configuration, see <a href="/docs/integrations/integrations-sdk/file-specifications/host-integration-configuration-overview">Configuration</a>.</p>
<h2>Find and use data [#find-and-use]</h2>
<p>To find your integration data go to <a href="http://one.newrelic.com"><strong>one.newrelic.com</strong></a> <strong>> Infrastructure > Third-party services</strong> and select one of the Nagios integration links.</p>
<p>In <a href="/docs/insights">New Relic Insights</a>, Nagios data is attached to the <code>NagiosServiceCheckSample</code> Insights <a href="/docs/using-new-relic/welcome-new-relic/getting-started/glossary#event">event type</a>.</p>
<p>For more on how to find and use your data, see <a href="/docs/infrastructure/integrations/find-use-infrastructure-integration-data">Understand integration data</a>.</p>
<h2>Metric data [#metrics]</h2>
<p>The Nagios integration collects the following metric data attributes.</p>
<h3>Nagios service check sample metrics [#nagios-service-check-sample]</h3>
<p>These attributes can be found by querying the <code>NagiosServiceCheckSample</code> event types in Insights.</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>Metric</p>
      </div>
      <div>
        <p>Description</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p><code>serviceCheck.command</code></p>
      </div>
      <div>
        <p>The command used to run the service check.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>serviceCheck.error</code></p>
      </div>
      <div>
        <p>The standard error (stderr) output of the service check.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>serviceCheck.longServiceOutput</code></p>
      </div>
      <div>
        <p>The portion of the message that is parsed by Nagios as <code>$LONGSERVICEOUTPUT$</code>. Only enabled if <code>parse_output</code> is set.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>serviceCheck.message</code></p>
      </div>
      <div>
        <p>The standard output (stdout) of the service check.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>serviceCheck.name</code></p>
      </div>
      <div>
        <p>The descriptive name of the service check being performed.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>serviceCheck.serviceOutput</code></p>
      </div>
      <div>
        <p>The portion of the message that is parsed by Nagios as <code>$SERVICEOUTPUT$</code>. Only enabled if <code>parse_output</code> is set.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>serviceCheck.status</code></p>
      </div>
      <div>
        <p>The <a href="https://nagios-plugins.org/doc/guidelines.html#AEN78">return code</a> of the service check. Options:</p>
        <ul>
          <li><code>0</code> = Ok</li>
          <li><code>1</code> = Warning</li>
          <li><code>2</code> = Critical</li>
          <li><code>3</code> = Unknown</li>
        </ul>
      </div>
    </div>
    <div>
      <div>
        <p><code>*</code></p>
      </div>
      <div>
        <p>Any additional metrics defined and reported by the service check. Only enabled if <code>parse_output</code> is set.</p>
      </div>
    </div>
  </div>
</div>
<h2>Troubleshooting</h2>
<p>Troubleshooting tips:</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiY29uZmlnLXBhcnNpbmctZmFpbGVkIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJDb25maWcgcGFyc2luZyBmYWlsZWQgZXJyb3IifV0=">
    <div data-prop-text="title">Config parsing failed error</div>
    <p>The following error appears in the <a href="/docs/infrastructure/new-relic-infrastructure/troubleshooting/generate-logs-troubleshooting-infrastructure">log file</a>:</p>
    <pre><code>Config parsing failed: service checks file permissions are not restrictive enough. Required file permissions are 0600. See documentation for details

</code></pre>### Solution:
    Set the user permissions flag to `0600`, restricting read and write privileges to the file owner.
    ### Cause:
    If the file is not owned by the root user or the file can be written to by a user other than the root user, the integration will allow users to run arbitrary commands as though they are a root user. If permissions do not meet the requirement, an error will be logged and the integration will fail to run.
  </div>
</div>
<h2>Check the source code [#source-code]</h2>
<p>This integration is open source software. That means you can <a href="https://github.com/newrelic/nri-nagios" title="Link opens in a new window.">browse its source code</a> and send improvements, or create your own fork and build it.</p>
