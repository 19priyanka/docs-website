
<p><a href="https://helm.sh/">Helm</a> is a package manager on top of Kubernetes. It facilitates installation, upgrades, or revision tracking, and manages dependencies for the services that you install in Kubernetes.</p>
<p>To install the integration using Helm, we recommend our Kubernetes automated installer, or you can complete the manual steps that follow.</p>
<div data-component="ButtonLink" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJyb2xlIiwidmFsdWUiOiJidXR0b24ifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidG8iLCJ2YWx1ZSI6Imh0dHBzOi8vb25lLm5ld3JlbGljLmNvbS9sYXVuY2hlci9ucjEtY29yZS5zZXR0aW5ncz9wYW5lPWV5SnVaWEprYkdWMFNXUWlPaUpyT0hNdFkyeDFjM1JsY2kxbGVIQnNiM0psY2kxdVpYSmtiR1YwTG1zNGN5MXpaWFIxY0NKOSJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJwcmltYXJ5In1d">
  <p>Start the installer</p>
</div>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJ0aXAifV0=">
  <p>To install the integration using manifests, see <a href="/docs/integrations/kubernetes-integration/installation/kubernetes-installation-configuration">Kubernetes integration: install and configure</a>.</p>
</div>
<h2>Compatibility and requirements</h2>
<p>Our Helm chart is compatible with both Helm 2 and 3. Make sure <a href="https://github.com/helm/helm#install">Helm</a> is installed on your machine.</p>
<p>To install the Kubernetes integration using Helm you will need your New Relic account license key and your Kubernetes cluster's name:</p>
<ol>
  <li>
    <p>Find and copy your <a href="/docs/accounts/install-new-relic/account-setup/license-key">New Relic license key</a>.</p>
  </li>
  <li>
    <p>Find the name of your cluster with this command:</p>
    <pre><code>kubectl config current-context
</code></pre>
  </li>
  <li>
    <p>Make sure that <code>kube-state-metrics</code> is installed on your machine:</p>
    <pre><code>kubectl get deployment --all-namespaces | grep kube-state-metrics
</code></pre>
    <p>If it's not installed, follow the <a href="https://github.com/kubernetes/kube-state-metrics#kubernetes-deployment">instructions in the kube-state-metrics GitHub repo</a> to install it.</p>
  </li>
</ol>
<h2>Install Kubernetes integration with Helm [#install-k8-helm]</h2>
<p>Follow the instructions for your version of Helm:</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJjbGFzc05hbWUiLCJ2YWx1ZSI6ImZyZXEtbGluayJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiaW5zdGFsbC1oZWxtMyJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiSGVsbSAzIn1d">
    <div data-prop-text="title">Helm 3</div>
    <p>To install using Helm 3:</p>
    <ol>
      <li>
        <p>Set the cluster you want to install the agent in:</p>
        <pre><code>kubectl config set-cluster DESIRED_CLUSTER
</code></pre>
        <div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJ0aXAifV0=">
          <p>To see the available clusters, run <code>kubectl config get-clusters</code></p>
        </div>
      </li>
      <li>
        <p>Add the <code>New Relic Helm charts</code> repo:</p>
        <pre><code>helm repo add newrelic https://helm-charts.newrelic.com
</code></pre>
      </li>
      <li>
        <p>Make sure everything is configured properly in the chart by running the following command (this step uses the <code>--dry-run</code> and <code>--debug</code> switches and therefore the agent is not installed):</p>
        <pre><code>helm install newrelic/newrelic-infrastructure \
    --dry-run \
    --debug \
    --set licenseKey=YOUR_NEW_RELIC_LICENSE_KEY \
    --set cluster=K8S_CLUSTER_NAME \
    --set config.custom_attributes.cluster=K8S_CLUSTER_NAME \
    --generate-name
</code></pre>
      </li>
      <li>
        <p>Install the Kubernetes integration:</p>
        <pre><code>helm install newrelic/newrelic-infrastructure \
    --set licenseKey=yYOUR_NEW_RELIC_LICENSE_KEY \ 
    --set cluster=K8S_CLUSTER_NAME \ 
    --set config.custom_attributes.cluster=K8S_CLUSTER_NAME \
    --generate-name
</code></pre>
      </li>
      <li>
        <p>Ensure the <code>DaemonSet</code> and pods have been created:</p>
        <pre><code>kubectl get daemonsets,pods
</code></pre>
        <div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
          <p>You may need to wait for a few seconds.</p>
        </div>
        <p>Make sure you see a <code>DaemonSet</code>, and one pod per node.</p>
      </li>
    </ol>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJjbGFzc05hbWUiLCJ2YWx1ZSI6ImZyZXEtbGluayJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiaW5zdGFsbC1oZWxtMiJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiSGVsbSAyIn1d">
    <div data-prop-text="title">Helm 2</div>
    <p>To install using Helm 2:</p>
    <ol>
      <li>
        <p>Set the cluster you want to install the agent in:</p>
        <pre><code>kubectl config set-cluster DESIRED_CLUSTER
</code></pre>
        <div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJ0aXAifV0=">
          <p>To see the available clusters, run <code>kubectl config get-clusters</code></p>
        </div>
      </li>
      <li>
        <p>If your cluster uses role-based access, create a service account for tiller (Helm's service which runs inside the Kubernetes cluster) using a Kubernetes manifest file:</p>
        <ol>
          <li>
            <p>Paste the following in a manifest file <code>rbac-config.yaml</code>:</p>
            <pre><code>apiVersion: v1 
kind: ServiceAccount 
metadata: 
  name: tiller 
  namespace: kube-system 
--- 
apiVersion: rbac.authorization.k8s.io/v1 
kind: ClusterRoleBinding 
metadata: 
  name: tiller 
roleRef: 
  apiGroup: rbac.authorization.k8s.io 
  kind: ClusterRole 
  name: cluster-admin 
subjects: 
  - kind: ServiceAccount 
    name: tiller 
    namespace: kube-system
</code></pre>
          </li>
          <li>
            <p>Create the service account and role by running:</p>
            <pre><code>kubectl create -f rbac-config.yaml
</code></pre>
          </li>
        </ol>
      </li>
      <li>
        <p>Initialize Helm so that Tiller is installed in the cluster:</p>
        <pre><code>helm init --history-max 200
</code></pre>
      </li>
      <li>
        <p>Add the <code>New Relic Helm charts</code> repo:</p>
        <pre><code>helm repo add newrelic https://helm-charts.newrelic.com
</code></pre>
      </li>
      <li>
        <p>Make sure everything is configured properly in the chart running the following command (this step uses the <code>--dry-run</code> and <code>--debug</code> switches and therefore the agent is not installed):</p>
        <pre><code>helm install newrelic/newrelic-infrastructure \
    --dry-run \
    --debug \
    --set licenseKey=YOUR_NEW_RELIC_LICENSE_KEY \
    --set cluster=K8S_CLUSTER_NAME \
    --set config.custom_attributes.cluster=K8S_CLUSTER_NAME
</code></pre>
      </li>
      <li>
        <p>Install the New Relic Kubernetes integration:</p>
        <div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
          <p>Note that the test switches have been removed.</p>
        </div>
        <pre><code>helm install newrelic/newrelic-infrastructure \
    --set licenseKey=your_new_relic_license_key \
    --set cluster=K8S_CLUSTER_NAME \
    --set config.custom_attributes.cluster=K8S_CLUSTER_NAME
</code></pre>
      </li>
      <li>
        <p>Ensure the <code>DaemonSet</code> and pods have been created:</p>
        <pre><code>kubectl get daemonsets,pods
</code></pre>
        <div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
          <p>You may need to wait for a few seconds.</p>
        </div>
        <p>Make sure you see a <code>DaemonSet</code>, and one pod per node.</p>
      </li>
    </ol>
  </div>
</div>
<h2>Helm configuration options [#config-options]</h2>
<p>When you install or upgrade the Kubernetes integration with Helm using the command line, you can pass your configuration variables with the <code>--set</code> flag.</p>
<pre><code>helm install newrelic/newrelic-infrastructure \
    --set licenseKey=YOUR_NEW_RELIC_LICENSE_KEY \
    --set cluster=YOUR_CLUSTER_NAME
</code></pre>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiY29uZmlnLXBhcmFtZXRlcnMifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IkhlbG0gY29uZmlndXJhdGlvbiBwYXJhbWV0ZXJzIn1d">
    <div data-prop-text="title">Helm configuration parameters</div>
    <div data-component="Table" data-prop="W10=">
      <div>
        <div>
          <div>
            <p>Parameter</p>
          </div>
          <div>
            <p>Description</p>
          </div>
          <div>
            <p>Default</p>
          </div>
        </div>
      </div>
      <div>
        <div>
          <div>
            <p><code>global.cluster</code> - <code>cluster</code></p>
          </div>
          <div>
            <p>The cluster name for the Kubernetes cluster.</p>
          </div>
          <div></div>
        </div>
        <div>
          <div>
            <p><code>global.licenseKey</code> - <code>licenseKey</code></p>
          </div>
          <div>
            <p>The <a href="https://docs.newrelic.com/docs/accounts/install-new-relic/account-setup/license-key">license key</a> for your New Relic Account. This will be the preferred configuration option if you're using both <code>licenseKey</code> and <code>customSecret</code>.</p>
          </div>
          <div></div>
        </div>
        <div>
          <div>
            <p><code>global.customSecretName</code> - <code>customSecretName</code></p>
          </div>
          <div>
            <p>The name of the Secret object where the license key is stored.</p>
          </div>
          <div></div>
        </div>
        <div>
          <div>
            <p><code>global.customSecretLicenseKey</code> - <code>customSecretLicenseKey</code></p>
          </div>
          <div>
            <p>The key in the Secret object where the license key is stored.</p>
          </div>
          <div></div>
        </div>
        <div>
          <div>
            <p><code>config</code></p>
          </div>
          <div>
            <p>A <code>newrelic.yml</code> file, if you're using one.</p>
          </div>
          <div></div>
        </div>
        <div>
          <div>
            <p><code>enableLinux</code></p>
          </div>
          <div>
            <p>Deploys the <code>DaemonSet</code> on all your Linux nodes.</p>
          </div>
          <div>
            <p><code>true</code></p>
          </div>
        </div>
        <div>
          <div>
            <p><code>enableWindows</code></p>
          </div>
          <div>
            <p>Deploys the <code>DaemonSet</code> on all your Windows nodes. For more information, see <a href="#running-on-windows">Running on Windows</a>).</p>
          </div>
          <div>
            <p><code>false</code></p>
          </div>
        </div>
        <div>
          <div>
            <p><code>integrations_config</code></p>
          </div>
          <div>
            <p>The list of integrations configured to monitor services running on Kubernetes. For more information, see <a href="https://docs.newrelic.com/docs/integrations/kubernetes-integration/link-apps-services/monitor-services-running-kubernetes">Monitor services running on Kubernetes</a>.</p>
          </div>
          <div></div>
        </div>
        <div>
          <div>
            <p><code>disableKubeStateMetrics</code></p>
          </div>
          <div>
            <p>Disables <code>kube-state-metrics</code> data parsing if the value is <code>true</code>.</p>
          </div>
          <div>
            <p><code>false</code></p>
          </div>
        </div>
        <div>
          <div>
            <p><code>kubeStateMetricsUrl</code></p>
          </div>
          <div>
            <p>If provided, the discovery process for the <code>kube-state-metrics</code> endpoint won't be triggered. For example: <code>http://172.17.0.3:8080</code></p>
          </div>
          <div></div>
        </div>
        <div>
          <div>
            <p><code>kubeStateMetricsPodLabel</code></p>
          </div>
          <div>
            <p>If provided, we'll use this label to discover the <code>kube-state-metrics</code> pod. Set this to <code>true</code> on the target pod.</p>
          </div>
          <div></div>
        </div>
        <div>
          <div>
            <p><code>kubeStateMetricsTimeout</code></p>
          </div>
          <div>
            <p>The timeout for accessing <code>kube-state-metrics</code> in milliseconds. If it's not set, the default is <code>5000</code>.</p>
          </div>
          <div></div>
        </div>
        <div>
          <div>
            <p><code>kubeStateMetricsScheme</code></p>
          </div>
          <div>
            <p>If <code>kubeStateMetricsPodLabel</code> is present, it changes the scheme used to send a request to the pod.</p>
          </div>
          <div>
            <p><code>http</code></p>
          </div>
        </div>
        <div>
          <div>
            <p><code>kubeStateMetricsPort</code></p>
          </div>
          <div>
            <p>If <code>kubeStateMetricsPodLabel</code> is present, it changes the port queried in the pod.</p>
          </div>
          <div>
            <p>8080</p>
          </div>
        </div>
        <div>
          <div>
            <p><code>rbac.create</code></p>
          </div>
          <div>
            <p>Enable Role-based authentication.</p>
          </div>
          <div>
            <p><code>true</code></p>
          </div>
        </div>
        <div>
          <div>
            <p><code>rbac.pspEnabled</code></p>
          </div>
          <div>
            <p>Enable pod security policy support.</p>
          </div>
          <div>
            <p><code>false</code></p>
          </div>
        </div>
        <div>
          <div>
            <p><code>privileged</code></p>
          </div>
          <div>
            <p>Enable privileged mode.</p>
          </div>
          <div>
            <p><code>true</code></p>
          </div>
        </div>
        <div>
          <div>
            <p><code>image.repository</code></p>
          </div>
          <div>
            <p>The container to pull.</p>
          </div>
          <div>
            <p><code>newrelic/infrastructure-k8s</code></p>
          </div>
        </div>
        <div>
          <div>
            <p><code>image.pullPolicy</code></p>
          </div>
          <div>
            <p>The pull policy.</p>
          </div>
          <div>
            <p><code>IfNotPresent</code></p>
          </div>
        </div>
        <div>
          <div>
            <p><code>image.pullSecrets</code></p>
          </div>
          <div>
            <p>The image pull secrets.</p>
          </div>
          <div>
            <p><code>nil</code></p>
          </div>
        </div>
        <div>
          <div>
            <p><code>image.tag</code></p>
          </div>
          <div>
            <p>The version of the container to pull.</p>
          </div>
          <div>
            <p><code>1.26.5</code></p>
          </div>
        </div>
        <div>
          <div>
            <p><code>image.windowsTag</code></p>
          </div>
          <div>
            <p>The version of the Windows container to pull.</p>
          </div>
          <div>
            <p><code>1.21.0-windows-1809-alpha</code></p>
          </div>
        </div>
        <div>
          <div>
            <p><code>resources</code></p>
          </div>
          <div>
            <p>Any resources you wish to assign to the pod.</p>
          </div>
          <div>
            <p>See <a href="https://github.com/newrelic/helm-charts/tree/master/charts/newrelic-infrastructure#resources">Resources</a>.</p>
          </div>
        </div>
        <div>
          <div>
            <p><code>verboseLog</code></p>
          </div>
          <div>
            <p>Should the agent use a verbose log? (Boolean)</p>
          </div>
          <div>
            <p><code>false</code></p>
          </div>
        </div>
        <div>
          <div>
            <p><code>priorityClassName</code></p>
          </div>
          <div>
            <p>The scheduling priority of the pod.</p>
          </div>
          <div>
            <p><code>nil</code></p>
          </div>
        </div>
        <div>
          <div>
            <p><code>nodeSelector</code></p>
          </div>
          <div>
            <p>The node label to use for scheduling.</p>
          </div>
          <div>
            <p><code>nil</code></p>
          </div>
        </div>
        <div>
          <div>
            <p><code>windowsNodeSelector</code></p>
          </div>
          <div>
            <p>The Node label to use for scheduling on Windows nodes.</p>
          </div>
          <div>
            <p><code>{ kubernetes.io/os: windows }</code></p>
          </div>
        </div>
        <div>
          <div>
            <p><code>tolerations</code></p>
          </div>
          <div>
            <p>The list of node taints to tolerate (requires Kubernetes >= 1.6).</p>
          </div>
          <div>
            <p>See <a href="https://github.com/newrelic/helm-charts/tree/master/charts/newrelic-infrastructure#tolerations">Tolerations</a>.</p>
          </div>
        </div>
        <div>
          <div>
            <p><code>updateStrategy</code></p>
          </div>
          <div>
            <p>The strategy for DaemonSet updates (requires Kubernetes >= 1.6)</p>
          </div>
          <div>
            <p><code>RollingUpdate</code></p>
          </div>
        </div>
        <div>
          <div>
            <p><code>serviveAccount.create</code></p>
          </div>
          <div>
            <p>If true, a service account is created and assigned to the deployment.</p>
          </div>
          <div>
            <p>true</p>
          </div>
        </div>
        <div>
          <div>
            <p><code>serviveAccount.name</code></p>
          </div>
          <div>
            <p>The service account to assign to the deployment. If <code>serviveAccount.create</code> is true then this name will be used when creating the service account.</p>
          </div>
          <div></div>
        </div>
        <div>
          <div>
            <p><code>serviveAccount.annotations</code></p>
          </div>
          <div>
            <p>The annotations to add to the service account if <code>serviveAccount.create</code> is set to true.</p>
          </div>
          <div></div>
        </div>
        <div>
          <div>
            <p><code>etcdTlsSecretName</code></p>
          </div>
          <div>
            <p>The name of the secret containing the cacert, cert, and key used for setting the mTLS config for retrieving metrics from ETCD.</p>
          </div>
          <div></div>
        </div>
        <div>
          <div>
            <p><code>etcdTlsSecretNamespace</code></p>
          </div>
          <div>
            <p>The namespace where the secret specified in <code>etcdTlsSecretName</code> was created.</p>
          </div>
          <div>
            <p><code>default</code></p>
          </div>
        </div>
        <div>
          <div>
            <p><code>etcdEndpointUrl</code></p>
          </div>
          <div>
            <p>Explicitly sets the etcd component url.</p>
          </div>
          <div></div>
        </div>
        <div>
          <div>
            <p><code>apiServerSecurePort</code></p>
          </div>
          <div>
            <p>Set to query the API Server over a secure port.</p>
          </div>
          <div></div>
        </div>
        <div>
          <div>
            <p><code>apiServerEndpointUrl</code></p>
          </div>
          <div>
            <p>Explicitly sets the api server component url.</p>
          </div>
          <div></div>
        </div>
        <div>
          <div>
            <p><code>schedulerEndpointUrl</code></p>
          </div>
          <div>
            <p>Explicitly sets the scheduler component url.</p>
          </div>
          <div></div>
        </div>
        <div>
          <div>
            <p><code>controllerManagerEndpointUrl</code></p>
          </div>
          <div>
            <p>Explicitly sets the controller manager component url.</p>
          </div>
          <div></div>
        </div>
        <div>
          <div>
            <p><code>eventQueueDepth</code></p>
          </div>
          <div>
            <p>Increases the in-memory cache of the agent to accommodate for more samples at a time.</p>
          </div>
          <div></div>
        </div>
        <div>
          <div>
            <p><code>enableProcessMetrics</code></p>
          </div>
          <div>
            <p>Enables the sending of process metrics to New Relic.</p>
          </div>
          <div>
            <p><code>false</code></p>
          </div>
        </div>
        <div>
          <div>
            <p><code>global.nrStaging</code> - <code>nrStaging</code></p>
          </div>
          <div>
            <p>Send data to staging (requires a staging license key).</p>
          </div>
          <div>
            <p><code>false</code></p>
          </div>
        </div>
        <div>
          <div>
            <p><code>discoveryCacheTTL</code></p>
          </div>
          <div>
            <p>Duration since the discovered endpoints are stored in the cache until they expire. Valid time units: 'ns', 'us', 'ms', 's', 'm', 'h'</p>
          </div>
          <div>
            <p><code>1h</code></p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<h2>Update via Helm [#upgrade]</h2>
<p>To update your Kubernetes integration installed via Helm, follow these steps:</p>
<ol>
  <li>
    <p>Update the local chart repository</p>
    <pre><code>helm repo update
</code></pre>
  </li>
  <li>
    <p>Get the release name of the <code>newrelic-infrastructure</code> chart:</p>
    <pre><code>helm list
</code></pre>
  </li>
  <li>
    <p>Update the release:</p>
    <pre><code>helm upgrade RELEASE_NAME newrelic/newrelic-infrastructure \ 
    --set licenseKey=YOUR_NEW_RELIC_LICENSE_KEY \ 
    --set cluster=K8S_CLUSTER_NAME \         
    --set config.custom_attributes.cluster=K8S_CLUSTER_NAME
</code></pre>
  </li>
</ol>
