
<p>Avoid sending Prometheus OpenMetrics integration data that is not relevant to your monitoring needs. Instead, use filters to ignore or include specific metrics. This will help you control the amount and types of data you send to New Relic. This will also help you avoid additional billing charges, as explained in this document.</p>
<h2>Prevent billing increases [#rate-limits]</h2>
<p>We use the Prometheus <code>discovery</code> and <code>scrape</code> annotations. If you set the Prometheus OpenMetrics integration to scrape <strong>all</strong> the available targets and to send all the data that's exposed from those targets, you may exceed New Relic's platform limits and increase your billing charges. To help prevent this from happening, use the integration's filtering capabilities.</p>
<p>For more information, see the Prometheus OpenMetrics integration requirements for <a href="https://docs.newrelic.com/docs/integrations/prometheus-integrations/get-started/monitor-prometheus-new-relic#OpenMetrics">Docker</a> and <a href="https://docs.newrelic.com/docs/integrations/prometheus-integrations/get-started/monitor-prometheus-new-relic#OpenMetrics">Kubernetes</a>. Also see the <a href="https://docs.newrelic.com/docs/integrations/prometheus-integrations/troubleshooting/rate-limit-errors-prometheus-integration">troubleshooting procedures for <code>NrIntegrationError</code> events</a>.</p>
<h2>Identify metrics to ignore or include [#ignore-metrics]</h2>
<p>To decide what data to include or exclude, use New Relic's <a href="https://docs.newrelic.com/docs/data-ingest-apis/get-data-new-relic/metric-api/view-query-you-metric-data#explore-metric-data">Metric API</a> to explore your metric data. Then, refine your filters to scrape only relevant targets and send useful metrics.</p>
<ul>
  <li>To filter out unwanted metrics from a target, use the <code>ignore_metrics</code> configuration option.</li>
  <li>To filter out targets instead of the metrics, use the <code>scrape_enabled_label</code> configuration option.</li>
</ul>
<p>The <a href="https://download.newrelic.com/infrastructure_agent/integrations/kubernetes/nri-prometheus-latest.yaml"><code>nri-prometheus-latest.yaml</code></a> manifest file includes the <code>nri-prometheus-cfg</code> config map showing an <a href="https://docs.newrelic.com/docs/integrations/prometheus-integrations/configure/configure-prometheus-openmetrics-integration">example configuration</a>. The integration will ignore or include metrics before executing the other functions to <a href="https://docs.newrelic.com/docs/integrations/prometheus-integrations/view-query-data/add-rename-copy-prometheus-attributes">add, rename, or copy attributes</a>.</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZXhhbXBsZS1pZ25vcmUifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IkZpbHRlciBvdXQgdW53YW50ZWQgbWV0cmljcyAoaWdub3JlKSJ9XQ==">
    <div data-prop-text="title">Filter out unwanted metrics (ignore)</div>
    <p>To ignore unwanted metrics, use the following transformation.</p>
    <p><strong>Example: Configuration</strong></p>
    <p>To drop all metrics that start with <code>go_</code> or <code>process_</code>:</p>
    <pre><code>transformations:
  - description: "General processing rules"
    ignore_metrics:
      - prefixes:
        - "go_"
        - "process_"

</code></pre>
    <pre><code>
mysql_global_status_commands_total{command="ha_close"} 0 
mysql_global_status_commands_total{command="ha_open"} 0

</code></pre>This is taken from the MySQL exporter. Besides the MySQL metrics, it also exposes metrics about the exporter that may not be of interest to you.
    **Example: Output**
    <pre><code>
go_goroutines 13
process_virtual_memory_bytes 2.062336e+07
mysql_global_status_commands_total{command="ha_close"} 0
mysql_global_status_commands_total{command="ha_open"} 0

</code></pre>**Example: Input**
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiaW5jbHVkZS1tZXRyaWNzIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJJbmNsdWRlIG9ubHkgc3BlY2lmaWMgbWV0cmljcyAoZXhjZXB0KSJ9XQ==">
    <div data-prop-text="title">Include only specific metrics (except)</div>
    <p>If you only want to include specific metrics, you can use the <code>except</code> list under the <code>ignore_metrics</code> section. As the name implies, this will ignore all the metrics except the ones that contain the with the given prefixes.</p>
    <p><strong>Example: Configuration</strong></p>
    <p>To drop all metrics except <code>kube_hpa_</code>:</p>
    <pre><code>transformations:
  - description: "General processing rules"
    ignore_metrics:
      - except:
        - kube_hpa_

</code></pre>
  </div>
</div>
