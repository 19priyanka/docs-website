
<p>New Relic's .NET agent includes an <a href="/docs/agents/net-agent/net-agent-api">API</a> that allows you to extend the agent's standard functionality. For example, you can use the .NET agent API for:</p>
<ul>
  <li>Customizing your app name</li>
  <li>Creating custom transaction parameters</li>
  <li>Reporting custom errors and metrics</li>
</ul>
<p>You can also customize some of the .NET agent's default behavior by adjusting <a href="/docs/agents/net-agent/configuration/net-agent-configuration">configuration settings</a> or using <a href="/docs/agents/net-agent/custom-instrumentation/introduction-net-custom-instrumentation">custom instrumentation</a>.</p>
<h2>Requirements</h2>
<p>To use the .NET agent API:</p>
<ol>
  <li>
    <p>Make sure you have the <a href="/docs/release-notes/agent-release-notes/net-release-notes">latest .NET agent release</a>.</p>
  </li>
  <li>
    <p>Add a reference to the agent in your project:</p>
    <ul>
      <li>
        <p>Add a reference to <code>NewRelic.Api.Agent.dll</code> to your project.</p>
        <p>OR</p>
      </li>
      <li>
        <p>View and download the API package from the <a href="https://www.nuget.org/packages/NewRelic.Agent.Api/">NuGet Package Library</a>.</p>
      </li>
    </ul>
  </li>
</ol>
<h2>Instrument missing sections of your code with transactions [#creating-transactions]</h2>
<p>To instrument your app, New Relic separates each path through your code into its own <a href="/docs/accounts-partnerships/education/getting-started-new-relic/glossary#transaction">transaction</a>. New Relic times (or "instruments") the parent method in these transactions to measure your app's overall performance, and collects <a href="/docs/apm/transactions/transaction-traces/introduction-transaction-traces">transaction traces</a> from long-running transactions for additional detail.</p>
<p>Use these methods when New Relic is not instrumenting a particular part of your code at all:</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>If you want to...</p>
      </div>
      <div>
        <p>Do this...</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p>Prevent a transaction from reporting to New Relic</p>
      </div>
      <div>
        <p>Use <a href="/docs/agents/net-agent/net-agent-api/ignore-transaction"><code>IgnoreTransaction()</code></a> or <a href="/docs/agents/net-agent/custom-instrumentation/add-detail-transactions-xml-net#blocking-instrumentation">an XML file</a> to ignore the transaction.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Create a transaction where none exists</p>
      </div>
      <div>
        <p>Use <a href="/docs/agents/net-agent/api-guides/custom-instrumentation-attributes-net">attributes</a> or <a href="/docs/agents/net-agent/instrumentation/net-custom-transactions">an XML file</a> to create a new transaction.</p>
      </div>
    </div>
  </div>
</div>
<h2>Time specific methods using segments [#segments]</h2>
<p>If a transaction is already visible in the New Relic UI, but you don't have enough data about a particular method that was called during that transaction, you can create segments to time those individual methods in greater detail. For example, you might want to time a particularly critical method with complex logic.</p>
<p>When you want to instrument a method within an existing transaction, see <a href="/docs/agents/net-agent/api-guides/custom-instrumentation-attributes-net">Custom instrumentation via attributes</a> or <a href="/docs/agents/net-agent/custom-instrumentation/add-detail-transactions-xml-net">Add detail to transactions via XML</a>.</p>
<h2>Enhance the metadata of a transaction [#metadata]</h2>
<p>Sometimes the code you are targeting is visible in the New Relic UI, but some details of the method are not useful. For example:</p>
<ul>
  <li>The default name might not be helpful. (Perhaps it is causing a <a href="/docs/agents/manage-apm-agents/troubleshooting/metric-grouping-issues#video">metric grouping issue</a>.)</li>
  <li>You want to add <a href="/docs/agents/manage-apm-agents/agent-data/collect-custom-attributes">custom attributes</a> to your transactions so you can filter them in dashboards.</li>
</ul>
<p>Use these methods when you want to change how New Relic instruments a transaction that's already visible in the New Relic UI:</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>If you want to...</p>
      </div>
      <div>
        <p>Do this...</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p>Change the name of a transaction</p>
      </div>
      <div>
        <p>Use <a href="/docs/agents/net-agent/net-agent-api/set-transaction-name"><code>SetTransactionName()</code></a> or <a href="/docs/agents/net-agent/custom-instrumentation/add-detail-transactions-xml-net#name-transactions">an XML file</a>.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Prevent a transaction from affecting your <a href="/docs/accounts-partnerships/education/getting-started-new-relic/glossary#apdex">Apdex</a> score</p>
      </div>
      <div>
        <p>Use <a href="/docs/agents/net-agent/net-agent-api/ignore-apdex"><code>IgnoreApdex()</code></a>.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Add metadata (such as your customer's account name or subscription level) to your transactions</p>
      </div>
      <div>
        <p>Use <a href="/docs/agents/manage-apm-agents/agent-data/collect-custom-attributes">custom attributes</a>. See <a href="/docs/agents/net-agent/net-agent-api/itransaction#addcustomattribute"><code>AddCustomAttribute()</code></a>.</p>
      </div>
    </div>
  </div>
</div>
<h2>Instrument asynchronous work [#async]</h2>
<p>For supported frameworks, the .NET agent usually detects async work and instruments it correctly. However, if your app uses another framework, or the <a href="/docs/agents/net-agent/features/async-support-net">default async instrumentation</a> is inaccurate, you can explicitly connect async work.</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>If you want to...</p>
      </div>
      <div>
        <p>Do this...</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p>Trace an async method that New Relic is already instrumenting</p>
      </div>
      <div>
        <p>Use <a href="/docs/agents/net-agent/custom-instrumentation/add-detail-transactions-xml-net#example-custom-txn-async">an XML file</a> to instrument async methods in IIS apps. Also see the New Relic's troubleshooting tips for <a href="/docs/agents/net-agent/troubleshooting/missing-async-metrics">missing async metrics</a>.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Trace an async method that New Relic is not instrumenting</p>
      </div>
      <div>
        <p>Use <a href="/docs/agents/net-agent/custom-instrumentation/add-detail-transactions-xml-net#example-custom-txn-async">an XML file</a> to instrument async methods in IIS apps. Also see the New Relic's troubleshooting tips for <a href="/docs/agents/net-agent/troubleshooting/missing-async-metrics">missing async metrics</a>.</p>
      </div>
    </div>
  </div>
</div>
<h2>View calls to external services [#externals]</h2>
<p>For .NET agent version 8.9 or higher, you can use the following <a href="/docs/apm/distributed-tracing/enable-configure/enable-distributed-tracing#agent-apis">distributed tracing payload APIs</a> to manually pass distributed tracing context between New Relic-monitored services that don't automatically connect to one another in a <a href="/docs/apm/distributed-tracing/getting-started/introduction-distributed-tracing">distributed trace</a>.</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>If you want to...</p>
      </div>
      <div>
        <p>Do this...</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p>Instrument an outgoing request to an external application or database</p>
      </div>
      <div>
        <p>Create a distributed trace payload to attach to an outgoing request using <a href="/docs/agents/net-agent/net-agent-api/itransaction#createdistributedtracepayload"><code>CreateDistributedTracePayload()</code></a>.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Connect incoming requests with the originator of the request to complete a <a href="/docs/accounts-partnerships/education/getting-started-new-relic/glossary#span">span</a> of the trace</p>
      </div>
      <div>
        <p>Receive a payload on an incoming request using <a href="/docs/agents/net-agent/net-agent-api/itransaction#acceptdistributedtracepayload"><code>AcceptDistributedTracePayload()</code></a>.</p>
      </div>
    </div>
  </div>
</div>
<p>For .NET agent versions lower than 8.9, use <a href="/docs/apm/transactions/cross-application-traces/introduction-cross-application-traces">cross application tracing</a>.</p>
<h2>Collect or ignore errors [#errors]</h2>
<p>Usually the .NET agent detects errors automatically. However, you can manually mark an error with the agent. You can also <a href="/docs/apm/applications-menu/error-analytics/ignoring-errors-new-relic-apm">ignore errors</a> .</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>If you want to...</p>
      </div>
      <div>
        <p>Do this...</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p>Report an error the .NET agent does not report automatically</p>
      </div>
      <div>
        <p>Use <a href="/docs/agents/net-agent/net-agent-api/notice-error"><code>NoticeError()</code></a>.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Capture errors or prevent the .NET agent from reporting an error at all</p>
      </div>
      <div>
        <p>Use your <a href="/docs/agents/net-agent/configuration/net-agent-configuration#error_collector">.NET agent configuration file</a>.</p>
      </div>
    </div>
  </div>
</div>
<h2>Send custom event and metric data from your app [#custom-data]</h2>
<p>APM includes a number of ways to record arbitrary custom data. For an explanation of New Relic data types, see <a href="/docs/data-analysis/metrics/analyze-your-metrics/data-collection-metric-timeslice-event-data">Data collection</a>.</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>If you want to...</p>
      </div>
      <div>
        <p>Do this...</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p>Send data about an event so you can analyze it in dashboards</p>
      </div>
      <div>
        <p>Create a <a href="/docs/insights/insights-data-sources/custom-data/insert-custom-events-new-relic-apm-agents#net-att">custom event</a>. See <a href="/docs/agents/net-agent/net-agent-api/record-custom-event"><code>RecordCustomEvent()</code></a>.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Tag your events with metadata to filter and facet them in dashboards or error analytics</p>
      </div>
      <div>
        <p>Add <a href="/docs/agents/manage-apm-agents/agent-data/collect-custom-attributes">custom attributes</a>. See .NET agent attributes and <a href="/docs/agents/net-agent/attributes/enable-disable-attributes-net">Enable and disable attributes</a>.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Report custom performance data</p>
      </div>
      <div>
        <p>Use <a href="/docs/agents/net-agent/net-agent-api/record-metric"><code>RecordMetric()</code></a> to create a <a href="/docs/agents/manage-apm-agents/agent-data/collect-custom-metrics">custom metric</a>. To view the data, use the <a href="/docs/query-your-data/explore-query-data/query-builder/use-advanced-nrql-mode-specify-data">query builder</a>.</p>
      </div>
    </div>
  </div>
</div>
<h2>Control the Browser monitoring agent [#browser]</h2>
<p>Usually the Browser agent is added automatically to your pages or deployed by copy/pasting the JavaScript snippet. For more information about these recommended methods, see <a href="/docs/browser/new-relic-browser/installation-configuration/add-apps-new-relic-browser">Add apps to Browser monitoring</a>.</p>
<p>However, you can also control the Browser agent via APM agent API calls. For more information, see <a href="/docs/agents/net-agent/instrumentation-features/new-relic-browser-net-agent">Browser monitoring and the .NET agent</a>.</p>
