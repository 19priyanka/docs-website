
<h2>Problem</h2>
<p>The Ruby agent is not properly starting or is not reporting data to New Relic.</p>
<h2>Solution</h2>
<p>To solve this problem:</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoidmVyc2lvbi0zLTYtMS1vci1sYXRlciJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiQ2hlY2sgeW91ciBSdWJ5IGFnZW50IHZlcnNpb24uIn1d">
    <div data-prop-text="title">Check your Ruby agent version.</div>
    <p>Check your <a href="/docs/release-notes/agent-release-notes/ruby-release-notes">Ruby agent version</a>, and update if necessary.</p>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZW52aXJvbm1lbnQifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IkNoZWNrIHRoZSBhcHAgZW52aXJvbm1lbnQgdXNlZC4ifV0=">
    <div data-prop-text="title">Check the app environment used.</div>
    <p>When the <code>newrelic_rpm</code> Ruby gem is required in your application environment, it will attempt to determine whether to start monitoring automatically and begin transmitting metrics to New Relic, or to remain disabled.</p>
    <ul>
      <li>
        <p>Production and staging: The agent typically is configured to monitor automatically in these environments.</p>
      </li>
      <li>
        <p>Test and development: The agent typically remains disabled in these environments.</p>
        <p>To control this logic, set the <code>monitor_mode</code> configuration key to <code>true</code> or <code>false</code> in each environment section of <code>newrelic.yml</code>.</p>
      </li>
    </ul>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZm9yY2luZy1zdGFydCJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiRm9yY2UgdGhlIGFnZW50IHRvIHN0YXJ0LiJ9XQ==">
    <div data-prop-text="title">Force the agent to start.</div>
    <p>To override the agent's auto-start logic, the easiest mechanism is to set a <code>NEW_RELIC_AGENT_ENABLED=true</code> environment variable; for example:</p>
    <pre><code>NEW_RELIC_AGENT_ENABLED=true rake assets:precompile

</code></pre>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiYXV0b3N0YXJ0LWNvbmZpZyJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiQ3VzdG9taXplIHRoZSBhdXRvLXN0YXJ0IGNvbmZpZ3VyYXRpb24gdmFyaWFibGVzLiJ9XQ==">
    <div data-prop-text="title">Customize the auto-start configuration variables.</div>
    <p>If you are running Ruby agent version 3.6.1 or higher, there are a few reasons the agent will refuse to start:</p>
    <ul>
      <li>
        <p>The agent detects it is in an interactive session; for example, a <code>rails console</code> or <code>irb</code> session.</p>
      </li>
      <li>
        <p>The agent detects it is in one of Rails' built-in rake tasks; for example, <code>assets:precompile</code> or <code>db:migrate</code>.</p>
        <p>You can use configuration variables in your Ruby agent <code>newrelic.yml</code> file to customize auto-start behavior for constants, script names, and rake tasks.</p>
        <div data-component="Table" data-prop="W10=">
          <div>
            <div>
              <div>
                <p><strong>Variable</strong></p>
              </div>
              <div>
                <p><strong>Description</strong></p>
              </div>
            </div>
          </div>
          <div>
            <div>
              <div>
                <p>Constants</p>
              </div>
              <div>
                <pre><code>autostart.denylisted_constants

</code></pre>* Ruby constants that should prevent the agent from starting. Accepts a comma separated list.
                * Defaults to `"Rails::Console"`.
                * Set to `""` to tell the agent to start when `Rails::Console` is in the environment.
              </div>
            </div>
            <div>
              <div>
                <p>Rake tasks</p>
              </div>
              <div>
                <pre><code>autostart.denylisted_rake_tasks

</code></pre>* Rake tasks you do not want the agent to monitor; for example, `assets:precompile`. Accepts a comma-separated list.
                * We do not disable the Ruby agent in all rake tasks, because tasks like `resque:work` generally are monitored.
              </div>
            </div>
            <div>
              <div>
                <p>Executables</p>
              </div>
              <div>
                <pre><code>autostart.denylisted_executables

</code></pre>* A list of script names, such as `irb`, that will prevent the agent from starting automatically. Accepts a comma-separated list.
                * Set this to `"rake"` to prevent the agent from starting in rake tasks, or `"rake,my_ruby_script.rb"` to prevent it from starting in rake and a custom script.
              </div>
            </div>
          </div>
        </div>
      </li>
    </ul>
  </div>
</div>
