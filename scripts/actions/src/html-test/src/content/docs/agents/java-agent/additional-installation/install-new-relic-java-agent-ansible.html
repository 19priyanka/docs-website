
<p><a href="/docs/agents/java-agent/getting-started/introduction-new-relic-java">APM for Java</a> allows you to use an Ansible role for installation and configuration.</p>
<h2>Compatibility and requirements [#compatibility]</h2>
<p><a href="https://github.com/newrelic/newrelic-java-agent-ansible-role">New Relic's Ansible role for the Java agent</a> is open source and community-supported. It supports setting up our Java agent to instrument applications running under Tomcat, Jetty, and Wildfly (formerly JBoss) on Linux servers. The most common agent parameters can be configured through Ansible variables.</p>
<p>You'll need to <a href="https://docs.ansible.com/ansible/latest/installation_guide/intro_installation.html">install Ansible</a> to run this role. Ansible is run from a central server to configure target hosts; these hosts must be running Linux and have <code>unzip</code> installed. The role should be compatible with most popular Linux distributions.</p>
<h2>Overview of process [#overview]</h2>
<p>There are several steps that may be involved for installation and configuration:</p>
<ul>
  <li><a href="#install">Install the role</a></li>
  <li><a href="#incorporate">Incorporate role in your playbook</a></li>
  <li><a href="#role-configuration">Configure the role</a></li>
  <li><a href="#agent-configuration">Configure the agent</a></li>
  <li><a href="#custom-instrumentation">Enable custom instrumentation</a> (optional)</li>
</ul>
<h2>Step 1. Install the role [#install]</h2>
<p>To install this role, use the <code>ansible-galaxy</code> command on the system where you run Ansible:</p>
<pre><code>$ ansible-galaxy install newrelic.newrelic_java_agent
</code></pre>
<p>This will download the role from <a href="https://galaxy.ansible.com/newrelic/newrelic_java_agent">Ansible Galaxy</a> and make it available for use in Ansible playbooks.</p>
<h2>Step 2. Incorporate the role into playbook [#incorporate]</h2>
<p>You'll need to call the role from your playbook using the <code>include_role</code> module. The role's GitHub repository contains <a href="https://github.com/newrelic/newrelic-java-agent-ansible-role/blob/master/examples/agent_install.yml">an example playbook</a> for you to start from, which looks like this:</p>
<pre><code>- hosts: YOUR_HOST_GROUP
  vars:
    nr_java_agent_config:
      license_key: YOUR_LICENSE_KEY
      app_name: YOUR_APP_NAME
      log_file_path: /tmp/newrelic

    server_type: tomcat
    server_root: /var/lib/tomcat8
    jvm_conf_file: /usr/share/tomcat8/bin/setenv.sh
    server_user: tomcat8
    server_group: tomcat8
    service_name: tomcat8
    restart_web_server: true

  tasks:
   - include_role:
       name: newrelic.newrelic_java_agent
</code></pre>
<p>The <code>vars</code> section contains a dictionary called <code>nr_java_agent_config</code>, which holds settings for the agent itself, and a number of variables for configuring the role's installation process. See the sections on <a href="#agent-configuration">agent configuration</a> and <a href="#role-configuration">role configuration</a> for details.</p>
<h2>Step 3. Configure the role [#role-configuration]</h2>
<p>These variables are used to configure the install process. Most are required. For more information, see the <a href="https://github.com/newrelic/newrelic-java-agent-ansible-role/tree/master/examples">examples on GitHub</a>.</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>Variable</p>
      </div>
      <div>
        <p>Description</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p><code>server_type</code></p>
      </div>
      <div>
        <p><strong>Required</strong>. Web server used by your application. Possible values are: <code>tomcat</code>, <code>jetty</code>, and <code>wildfly</code> (standalone mode only).</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>server_root</code></p>
      </div>
      <div>
        <p><strong>Required</strong>. Location of the web server on the host. The agent's JAR, configuration, and (by default) log files will live in a subdirectory of this directory.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>jvm_conf_file</code></p>
      </div>
      <div>
        <p><strong>Required</strong>. Path to the web server configuration file to reference the New Relic Java agent. For Tomcat, for instance, it's typically the <code>setenv.sh</code> file. If the file doesn't exist, it may be created, depending on the <code>server_type.</code></p>
      </div>
    </div>
    <div>
      <div>
        <p><code>server_user</code></p>
        <p><code>server_group</code></p>
      </div>
      <div>
        <p><strong>Required</strong>. User and group under which the web server runs. Used to set the ownership of the <code>newrelic.jar</code> and <code>newrelic.yml</code> files.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>restart_web_server</code></p>
      </div>
      <div>
        <p><strong>Optional</strong>. Default: <code>true</code>. If set to <code>false</code>, the role does not restart the web server after installing the agent. Note that the agent is not activated until the web server is restarted.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>service_name</code></p>
      </div>
      <div>
        <p><strong>Required</strong> (unless <code>restart_web_server</code> is set to <code>false</code>). Service name under which the web server runs. Used by Ansible to restart the web server after the agent is installed.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>nr_java_agent_version</code></p>
      </div>
      <div>
        <p><strong>Optional</strong>; default: <code>current</code>Specifies the version of the Java agent to install. <code>current</code> will install the latest version. You can also install a specific version, like <code>5.9.0</code>. For available versions, see <a href="https://download.newrelic.com/newrelic/java-agent/newrelic-agent/">Java agent downloads directory</a>.</p>
      </div>
    </div>
  </div>
</div>
<h2>Step 4. Configure the agent [#agent-configuration]</h2>
<p>The following variables are used to configure the Java agent itself. These are just a few of the available options. For a full list of supported variables, see the <a href="https://github.com/newrelic/newrelic-java-agent-ansible-role#agent-configuration-variables">README file on GitHub</a>. For more about how to configure the agent, see <a href="https://docs.newrelic.com/docs/agents/java-agent/configuration/java-agent-configuration-config-file">Java agent configuration</a>.</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>Variable</p>
      </div>
      <div>
        <p>Description</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p><code>license_key</code></p>
      </div>
      <div>
        <p><strong>Required</strong>. Your <a href="https://docs.newrelic.com/docs/accounts/install-new-relic/account-setup/license-key">New Relic license key</a>.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>app_name</code></p>
      </div>
      <div>
        <p><strong>Required</strong>. Name of the application being instrumented. For more details, see <a href="https://docs.newrelic.com/docs/agents/manage-apm-agents/app-naming/name-your-application">App naming</a>.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>proxy_host</code></p>
        <p><code>proxy_port</code></p>
        <p><code>proxy_user</code></p>
        <p><code>proxy_password</code></p>
        <p><code>proxy_scheme</code></p>
      </div>
      <div>
        <p><strong>Optional</strong>. If you connect to the New Relic collector via a proxy, you can configure your proxy settings with these values.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>labels</code></p>
      </div>
      <div>
        <p><strong>Optional</strong>. User-configurable custom labels for the agent. Labels are name-value pairs. Names and values are limited to 255 characters and cannot contain colons (:) nor semicolons (;). Value should be a semicolon-separated list of key-value pairs, for example <code>Server:One;Data Center:Primary</code>.</p>
      </div>
    </div>
  </div>
</div>
<h2>Step 5. Enable custom instrumentation (optional) [#custom-instrumentation]</h2>
<p>If you want to enable <a href="https://docs.newrelic.com/docs/agents/java-agent/custom-instrumentation/java-instrumentation-xml">custom instrumentation</a>, you can provide a list of XML files using the <code>custom_instrumentation_files</code> variable. For instance, you can specify that all Java agents being installed should use a file called <code>my_instrumentation.xml</code> by adding something like the following to your playbook:</p>
<pre><code>vars:
  custom_instrumentation_files:
    - /path/to/my_instrumentation.xml
</code></pre>
<p>See the <a href="https://github.com/newrelic/newrelic-java-agent-ansible-role">README</a> and <a href="https://github.com/newrelic/newrelic-java-agent-ansible-role/tree/master/examples">examples</a> on GitHub for more information.</p>
<h2>For more help</h2>
<p>If you need additional help, <a href="https://github.com/newrelic/newrelic-java-agent-ansible-role/issues">file an issue at newrelic/newrelic-java-agent-ansible-role on GitHub</a>.</p>
