
<p><a href="https://devcenter.heroku.com/articles/newrelic">Heroku</a> is a Platform as a Service (PaaS) solution for hosting web applications in various agent languages, including Ruby. With New Relic, you can extend Heroku using <a href="/docs/apm/new-relic-apm">APM</a> and <a href="/docs/browser/new-relic-browser">Browser</a> metrics. This page describes special considerations for using Heroku as a hosting service with New Relic's Ruby agent.</p>
<h2>Install the New Relic agent add-on [#installing]</h2>
<p>After deploying your Ruby app on Heroku, install the New Relic agent:</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoidmlhX2hlcm9rdSJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiVmlhIHRoZSBIZXJva3Ugd2Vic2l0ZSJ9XQ==">
    <div data-prop-text="title">Via the Heroku website</div>
    <p>To install the New Relic add-on through the Heroku website, you must be logged in to Heroku:</p>
    <ol>
      <li>
        <p>From <a href="https://addons.heroku.com/newrelic">Heroku's Add-on page for New Relic</a>, select a subscription plan.</p>
      </li>
      <li>
        <p>From <strong>Select an app</strong>, select your New Relic app.</p>
      </li>
      <li>
        <p>Give your application a <a href="/docs/apm/new-relic-apm/installation-configuration/name-your-application">descriptive name</a> with this Heroku toolbelt command:</p>
        <pre><code>heroku config:set NEW_RELIC_APP_NAME='Your Application Name'
</code></pre>
      </li>
      <li>
        <p>Add the New Relic gem to your Gemfile. The New Relic Ruby agent's gem is available from <a href="https://rubygems.org/" title="Link opens in a new window.">rubygems.org</a> as <code>newrelic_rpm</code>.</p>
        <p>If your app uses Bundler, add this gem to the Gemfile:</p>
        <pre><code>gem 'newrelic_rpm'
</code></pre>
      </li>
      <li>
        <p>Restart your dyno.</p>
      </li>
      <li>
        <p>Generate some traffic to your app.</p>
      </li>
    </ol>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoidmlhX3Rvb2xiZWx0In0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJWaWEgSGVyb2t1IHRvb2xiZWx0In1d">
    <div data-prop-text="title">Via Heroku toolbelt</div>
    <p>To install the New Relic add-on with the Heroku toolbelt:</p>
    <ol>
      <li>
        <p>Run the following toolbelt command, where <code>$planlevel</code> is the <a href="https://addons.heroku.com/newrelic#plan_selector">appropriate subscription plan</a>:</p>
        <pre><code>heroku addons:create newrelic:$planlevel
</code></pre>
      </li>
      <li>
        <p>Give your application a <a href="/docs/apm/new-relic-apm/installation-configuration/name-your-application">descriptive name</a> with this toolbelt command:</p>
        <pre><code>heroku config:set NEW_RELIC_APP_NAME='Your Application Name'
</code></pre>
      </li>
      <li>
        <p>Add the New Relic gem to your Gemfile. The New Relic Ruby agent's gem is available from <a href="https://rubygems.org/" title="Link opens in a new window.">rubygems.org</a> as <code>newrelic_rpm</code>.</p>
        <p>If your app uses Bundler, add this gem to the Gemfile:</p>
        <pre><code>gem 'newrelic_rpm'
</code></pre>
      </li>
      <li>
        <p>Restart your dyno.</p>
      </li>
      <li>
        <p>Generate some traffic to your app.</p>
      </li>
    </ol>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiaGVyb2t1LW5vbi1yYWlscyJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiTm9uLVJhaWxzIGFwcGxpY2F0aW9ucyJ9XQ==">
    <div data-prop-text="title">Non-Rails applications</div>
    <p>If you are using New Relic's Ruby agent with a non-Rails application, Heroku users need to install the plugin in your repository manually. For example, in a Sinatra app, add the <code>newrelic_rpm</code> gem to your <strong>Gemfile</strong>, and then add the following code to your app:</p>
    <pre><code>configure :production do
 require 'newrelic_rpm'
 end

</code></pre>
  </div>
</div>
<p>Installing the add-on automatically creates a private New Relic account and configures access for Heroku servers. New Relic will begin monitoring application performance, end user experience, and app server performance collected after the add-on is installed. Within a few minutes, data should start appearing in your <a href="/docs/apm/applications-menu/monitoring/apm-overview-page">APM summary page</a>.</p>
<h2>Troubleshooting your installation [#troubleshooting]</h2>
<p>Within a few minutes of installing and configuring New Relic, data should start appearing in your app's <a href="/docs/apm/applications-menu/monitoring/apm-overview-page">APM summary page</a>. If no data appears, follow the <a href="/docs/agents/ruby-agent/troubleshooting/no-data-appears-ruby">Ruby agent troubleshooting procedures</a>.</p>
<h2>Upgrade from an existing New Relic installation [#upgrading]</h2>
<p>If New Relic is already installed, reinstall the add-on using the Heroku toolbelt command.</p>
<pre><code>heroku config:set NEW_RELIC_APP_NAME='Your Application Name'
</code></pre>
<h2>Configure the Ruby agent on Heroku [#configuring]</h2>
<p>You can configure New Relic in your <code>newrelic.yml</code> file, or you can use <a href="/docs/agents/ruby-agent/installation-configuration/ruby-agent-configuration">environment variables</a> to take precedence over the values in your config file. Use <code>heroku config:set</code> to modify the agent's settings for your Heroku appication.</p>
<p>For example, to set the <a href="/docs/agents/ruby-agent/installation-configuration/ruby-agent-configuration#analytics_events"><code>analytics_events.max_samples_stored</code></a> setting to 500:</p>
<pre><code>heroku config:set NEW_RELIC_ANALYTICS_EVENTS_MAX_SAMPLES_STORED=500
</code></pre>
<h2>Hostnames on Heroku [#hostnames]</h2>
<p>Knowing which data came from which host allows you to filter the metrics displayed in the UI to a specific host. On Heroku, hostnames within dynos are dynamically generated and not generally meaningful to you as an application developer.</p>
<p>Starting in version 3.9.5, the Ruby agent reports the Heroku dyno name as the hostname (for example, <code>web.1</code>). This allows you to view your data scoped to a particular dyno name. You can disable this behavior by setting the <code>heroku.use_dyno_names</code> setting to <code>false</code>. The agent will then use a single aggregated placeholder name called <code>Dynamic Hostname</code>.</p>
<h2>Dyno hostname aggregation [#dyno-hostnames]</h2>
<p>Some dynos have names that are dynamically generated, and these may take on many unique values over time. Examples include <code>scheduler</code> dynos created by the Scheduler add-on, and <code>run</code> dynos created by invoking <code>heroku run</code> on the command line. In order to keep the number of unique hostnames reasonable, the Ruby agent will automatically aggregate data from <code>scheduler</code> and <code>run</code> dynos into hostnames called <code>scheduler.*</code> and <code>run.*</code>.</p>
<p>If you have other dyno types that are dynamically created, use the <a href="/docs/agents/ruby-agent/installation-configuration/ruby-agent-configuration#heroku"><code>heroku.dyno_name_prefixes_to_shorten</code></a> configuration setting to apply the same aggregation to these other dyno types.</p>
<h2>Logging for Heroku [#logging]</h2>
<p>On Heroku, the Ruby agent logs to standard output, mixing agent logs with your normal application logs. Log entries generated by the Ruby agent include a <code>[NewRelic]</code> tag as a prefix.</p>
<p>To retrieve logs on Heroku:</p>
<ol>
  <li>
    <p>Verify that your <code>NEW_RELIC_LOG</code> environment variable is set to <code>stdout</code> with this Heroku toolbelt command:</p>
    <pre><code>heroku config
</code></pre>
  </li>
  <li>
    <p>To reset the environment variable if necessary, run:</p>
    <pre><code>heroku config:set NEW_RELIC_LOG="stdout"
</code></pre>
  </li>
  <li>
    <p>Open your <code>newrelic.yml</code> file in an editor.</p>
  </li>
  <li>
    <p>Change the <a href="/docs/agents/ruby-agent/installation-configuration/ruby-agent-configuration#log_level"><code>log_level</code></a> to <code>debug</code> and save the file. Be sure you do not modify the indentation.</p>
  </li>
  <li>
    <p>Restart your web app.</p>
  </li>
  <li>
    <p>Generate some traffic to your app and run it for about five minutes.</p>
  </li>
  <li>
    <p>Run the following Heroku toolbelt command to view logs only from the New Relic agent:</p>
    <pre><code>heroku logs -n 1500 | grep -i relic
</code></pre>
  </li>
  <li>
    <p>If sending your log file to New Relic Support, attach the log file to your support ticket, along with <code>newrelic.yml</code>, your <code>Gemfile</code>, and <code>Gemfile.lock</code>.</p>
  </li>
  <li>
    <p>Edit <code>newrelic.yml</code> again, and change the <a href="/docs/agents/ruby-agent/installation-configuration/ruby-agent-configuration#log_level"><code>log_level</code></a> to the previous setting. Save the file.</p>
  </li>
</ol>
<h2>For more help [#more_help]</h2>
<p>Additional documentation resources include:</p>
<ul>
  <li><a href="/docs/accounts-partnerships/partnerships/heroku-new-relic">Heroku and New Relic</a> (additional topics for Heroku users)</li>
  <li><a href="https://devcenter.heroku.com/articles/newrelic">Heroku Dev Center</a> (information on the Heroku site on installing New Relic)</li>
</ul>
