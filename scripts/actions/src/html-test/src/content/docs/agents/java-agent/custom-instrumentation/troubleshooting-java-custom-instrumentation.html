
<p>Here are some troubleshooting tips for <a href="/docs/agents/java-agent/custom-instrumentation/java-custom-instrumentation">custom instrumentation with New Relic's Java agent</a>.</p>
<h2>UI options</h2>
<p>You can use New Relic's UI to <a href="/docs/agents/java-agent/custom-instrumentation/custom-instrumentation-editor-quickly-customize-your-java-instrumentation">define instrumentation rules</a> with the Custom Instrumentation Editor, or edit your XML file via your Java app's <strong>Settings</strong>.</p>
<p><strong>Java apps only:</strong> To edit your XML file directly from the New Relic UI: Go to <strong><a href="https://one.newrelic.com">one.newrelic.com</a> > APM > (select a Java app) > Settings > Live Instrumentation</strong>. From here you can:</p>
<ul>
  <li>Download a sample XML file.</li>
  <li>Select an edit existing XML file.</li>
  <li>Search the instrumentation history.</li>
</ul>
<h2>Nested transactions in thread profiler [#thread-profiler]</h2>
<p>Custom instrumentation is useful for nested transactions. For example, in the thread profiler, methods marked
  <div data-component="Icon" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJzdHlsZSIsInZhbHVlIjp7InR5cGUiOiJtZHhWYWx1ZUV4cHJlc3Npb24iLCJ2YWx1ZSI6Intjb2xvcjogJyNBMEEwQTAnfSIsInBvc2l0aW9uIjp7InN0YXJ0Ijp7ImxpbmUiOjI1LCJjb2x1bW4iOjEyMywib2Zmc2V0IjoxMTI0fSwiZW5kIjp7ImxpbmUiOjI1LCJjb2x1bW4iOjE0Mywib2Zmc2V0IjoxMTQ0fX19fSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoibmFtZSIsInZhbHVlIjoiZmUtY2lyY2xlIn1d"></div><strong>Instrumentation not allowed</strong> cannot be instrumented because this can result in unacceptable overhead. However, children of those methods usually can be instrumented.
</p>
<p>
  <img src="./images/crop-java-custom-inst-colors.png" alt="Thread profiler: Nested transactions colors" title="Thread profiler: Nested transactions colors">
</p>
<p><strong><a href="https://one.newrelic.com">one.newrelic.com</a> > APM > (select an app) > Events > Thread profiler:</strong> If a method is marked gray (<strong>Instrumentation not allowed</strong>), try expanding the thread profile tree to find a nested transaction that you can instrument (white).</p>
<p>To identify methods you can instrument, expand the thread profile tree until you find a suitable method:</p>
<ol>
  <li>Go to <strong><a href="https://one.newrelic.com">one.newrelic.com</a> > APM > (select an app) > Events > Thread profiler</strong>.</li>
  <li>Expand the thread profile tree until you find a suitable method.</li>
  <li>Follow <a href="/docs/agents/java-agent/custom-instrumentation/custom-instrumentation-editor-quickly-customize-your-java-instrumentation">standard procedures</a> to define and deploy custom instrumentation.</li>
</ol>
<h2>Classes and methods [#classes-methods]</h2>
<p>When troubleshooting custom instrumentation for your Java agent, compare the <code>pointcut</code> information in your <code>newrelic.yml</code> config file with confirmation messages in your <a href="/docs/agents/java-agent/troubleshooting/generating-logs-troubleshooting-java">log file</a>. Verify that the classes and methods match.</p>
<p>Here is an example:</p>
<pre><code># This is a pointcut example in your newrelic.yml config file:
&#x3C;pointcut transactionStartPoint="true">
    &#x3C;className>com.example.class.name&#x3C;/className>
    &#x3C;method>
        &#x3C;name>exampleMethod&#x3C;/name>
    &#x3C;/method>
&#x3C;/pointcut>
</code></pre>
<p>If this is being instrumented properly, you may see a message similar to this in the log file:</p>
<pre><code># This is a confirmation example in your log file:
Oct 1, 2015 10:58:52 -0700 [9805 1] com.newrelic FINER: Instrumenting com/example/class/name
</code></pre>
<p>If the log file class and method do not match your custom instrumentation values, review and adjust as needed. (You may not always see a confirmation in your log file about whether the custom instrumentation load succeeded or failed.)</p>
<h2>Separate transaction in XML [#separate-transaction]</h2>
<p>Here is an example of a pointcut with several <code>method</code> values. The <code>nameTransaction</code> has been added to the XML to break out the method as a separate transaction rather than as a segment in the APM <a href="/docs/apm/applications-menu/monitoring/transactions-page"><strong>Transactions</strong> breakdown table</a>.</p>
<pre><code># This is a pointcut example to identify a specific transaction with XML custom instrumentation:
&#x3C;pointcut>
  &#x3C;nameTransaction/>
  &#x3C;className>com.examplename.client.actionflow.impl.exampleActionFlow&#x3C;/className>
  &#x3C;method>
    &#x3C;name>requestNAME&#x3C;/name>
    &#x3C;parameters>
      &#x3C;type>boolean&#x3C;/type>
    &#x3C;/parameters>
  &#x3C;/method>
&#x3C;/pointcut>
</code></pre>
<h2>Asynchronous transactions [#async]</h2>
<p>If your application makes use of asynchronous processes, it may be possible to connect the async worker activity to the parent transaction using the Java API. By default these transactions are not linked. For more information, see <a href="/docs/agents/java-agent/async-instrumentation/introduction-java-async-instrumentation">Java asynchronous instrumentation</a>.</p>
<h2>For more help [#more_help]</h2>
<p>Additional documentation resources include:</p>
<ul>
  <li><a href="/docs/agents/java-agent/custom-instrumentation/custom-instrumentation-editor-quickly-customize-your-java-instrumentation">Custom instrumentation editor</a> (how to use New Relic's UI tool to quickly customize your Java instrumentation)</li>
  <li>New Relic Java agent's <a href="/docs/agents/java-agent/troubleshooting">Troubleshooting section</a> (individual troubleshooting tips and procedures)</li>
</ul>
