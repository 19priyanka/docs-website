
<h2>Problem</h2>
<p>New Relic's .NET agent reports successfully, then stops after a short period of time or a maintenance event such as an IIS reset or system reboot. If these symptoms occur and you are using Microsoft's System Center Operations Manager (SCOM), you are experiencing a SCOM profiler conflict.</p>
<h2>Solution</h2>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
  <p>Do not keep the Application Performance Monitoring (<code>APM</code>) portion of SCOM installed but disabled. This is not enough to prevent interference. You must flag it to <strong>not</strong> be installed.</p>
</div>
<p>To resolve SCOM profiler conflicts:</p>
<ol>
  <li>
    <p>Remove the SCOM profiler: Uninstall SCOM, or re-install SCOM and disable the <code>APM</code> portion in the install wizard.</p>
  </li>
  <li>
    <p>To resolve the SCOM conflict, restore the registry settings using PowerShell:</p>
    <pre><code>$HKLM = 2147483650 #HKEY_LOCAL_MACHINE
$reg = [wmiclass]"\\.\root\default:StdRegprov"
$key = "SYSTEM\CurrentControlSet\Services\W3SVC"
$name = "Environment"
$value = "COR_ENABLE_PROFILING=1","COR_PROFILER={71DA0A04-7777-4EC6-9643-7D28B46A8A41}","NEWRELIC_INSTALL_PATH=C:\Program Files\New Relic\.NET Agent\"
$reg.SetMultiStringValue($HKLM, $key, $name, $value)
$key = "SYSTEM\CurrentControlSet\Services\WAS"
$name = "Environment"
$value = "COR_ENABLE_PROFILING=1","COR_PROFILER={71DA0A04-7777-4EC6-9643-7D28B46A8A41}","NEWRELIC_INSTALL_PATH=C:\Program Files\New Relic\.NET Agent\"
$reg.SetMultiStringValue($HKLM, $key, $name, $value)
iisreset
</code></pre>
  </li>
  <li>
    <p>Run these commands <strong>each</strong> time you restart your server, or create a startup script to restore these settings.</p>
  </li>
  <li>
    <p>Recycle your app pool, or from a command prompt, run <strong>IISRESET</strong>.</p>
  </li>
</ol>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
  <p>You must repair your installation each time you restart your server.</p>
</div>
<h2>Cause</h2>
<p>Microsoft's System Center Operations Manager (SCOM) includes an Application Performance Monitoring (<code>APM</code>) feature which conflicts with New Relic's .NET agent. Both employ the .NET Profiler interface, and only one profiler can be used at a time.</p>
<p>If you have both SCOM and the New RelicÂ .NET agent installed on the same Windows server, disabling or turning off <code>APM</code> in SCOM will remove some Windows registry settings that are necessary for the .NET agent to work. The .NET agent will not be able to monitor web applications on that server.</p>
