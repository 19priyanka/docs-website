
<p>New Relic's PHP agent provides an <a href="/docs/agents/php-agent/php-agent-api">API</a> for customizing agent behavior. The agent automatically instruments many <a href="/docs/agents/php-agent/getting-started/php-agent-compatibility-requirements#frameworks">popular PHP frameworks</a>, but you can use the PHP API to instrument activity that the agent doesn't already instrument by default.</p>
<p>This guide describes PHP API calls for several common tasks; for example:</p>
<ul>
  <li>Notice or ignore specific <a href="#errors">errors</a>.</li>
  <li>Name a <a href="#metadata">transaction</a>.</li>
  <li>Rename the <a href="#name-app">application</a> reporting the data.</li>
</ul>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJ0aXAifV0=">
  <p>You can also set many of these options <a href="/docs/agents/php-agent/configuration/php-directory-ini-settings">per directory</a> or in <a href="/docs/agents/php-agent/configuration/php-agent-configuration#inivar-background"><code>newrelic.ini</code></a>. If setting via API, the <a href="/docs/agents/php-agent/configuration/php-agent-configuration#config-options-precedence">API takes precedence over the other methods</a>.</p>
</div>
<h2>Notice or ignore errors [#errors]</h2>
<p>Usually, the agent detects errors automatically. However, you can <a href="/docs/apm/applications-menu/error-analytics/ignoring-errors-new-relic-apm">manually mark an error</a> with the agent.</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>If you want to...</p>
      </div>
      <div>
        <p>Do this...</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p>Report an error the agent does not report automatically</p>
      </div>
      <div>
        <p>See <a href="/docs/agents/php-agent/php-agent-api/newrelic_notice_error"><code>newrelic_notice_error()</code></a>.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Ignore an error</p>
      </div>
      <div>
        <p>Edit <a href="/docs/agents/php-agent/configuration/php-agent-configuration#inivar-err-ignore-exceptions"><code>error_collector.ignore_exceptions</code></a> or <a href="/docs/agents/php-agent/configuration/php-agent-configuration#inivar-err-ignore-errors"><code>error_collector.ignore_errors</code></a> in the<code>newrelic.ini</code> file.</p>
      </div>
    </div>
  </div>
</div>
<h2>Enhance the metadata of a transaction [#metadata]</h2>
<p>Sometimes the code you target is visible in New Relic, but some details of the method are not useful. For example:</p>
<ul>
  <li>The default name is not helpful, or it is causing a <a href="/docs/agents/manage-apm-agents/troubleshooting/metric-grouping-issues">metric grouping issue</a>.</li>
  <li>You want to add <a href="/docs/agents/manage-apm-agents/agent-data/collect-custom-attributes">custom attributes</a> to your transactions or spans so you can filter them with NRQL queries.</li>
</ul>
<p>Use these methods when you want to change how New Relic instruments a transaction that's already visible in New Relic:</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>If you want to...</p>
      </div>
      <div>
        <p>Do this...</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p>Change the name of a transaction</p>
      </div>
      <div>
        <p>See <a href="/docs/agents/php-agent/php-agent-api/newrelic_name_transaction"><code>newrelic_name_transaction()</code></a>.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Add metadata (such as your customer's account name or subscription level) to your transactions or spans</p>
      </div>
      <div>
        <p>Use <a href="/docs/agents/manage-apm-agents/agent-data/collect-custom-attributes">custom attributes</a>.</p>
        <p>For custom attributes which will be added to transactions and spans (if enabled), see <a href="/docs/agents/php-agent/php-agent-api/newrelic_add_custom_parameter"><code>newrelic_add_custom_parameter()</code></a>.</p>
        <p>For custom attributes which will be added only to spans, see <a href="/docs/agents/php-agent/php-agent-api/newrelic_add_custom_span_parameter"><code>newrelic_add_custom_span_parameter()</code></a>.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Mark a transaction as a background job</p>
      </div>
      <div>
        <p>See <a href="/docs/agents/php-agent/php-agent-api/newrelic_background_job"><code>newrelic_background_job()</code></a>.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Prevent a transaction from affecting your <a href="/docs/apm/new-relic-apm/apdex/apdex-measuring-user-satisfaction">Apdex score</a></p>
      </div>
      <div>
        <p>See <a href="/docs/agents/php-agent/php-agent-api/newrelic_ignore_apdex"><code>newrelic_ignore_apdex()</code></a>.</p>
      </div>
    </div>
  </div>
</div>
<h2>Name reporting app [#name-app]</h2>
<p>The New Relic UI organizes data by how you <a href="/docs/agents/manage-apm-agents/app-naming/name-your-application">name your application</a>. Each name appears as a different app. You can rename the reporting app for any part of your code to better help you:</p>
<ul>
  <li>Organize and analyze your data on New Relic UI pages (for example, APM's <a href="/docs/apm/applications-menu/monitoring/view-your-applications-index"><strong>Applications index</strong> page</a>, the <a href="/docs/apm/applications-menu/monitoring/apm-overview-page"><strong>Summary</strong> page</a>, the <a href="/docs/apm/applications-menu/monitoring/transactions-page"><strong>Transactions</strong> page</a>, etc.).</li>
  <li><a href="/docs/insights/nrql-new-relic-query-language/using-nrql/introduction-nrql">Query</a> your data.</li>
  <li>Create <a href="/docs/alerts/new-relic-alerts/getting-started/introduction-new-relic-alerts">alert policies</a>.</li>
</ul>
<p>This is especially useful if you have a multi-site application or distinct sets of application code using the same PHP installation.</p>
<p>Alternatively, you can set the app name at a higher level instead via the <a href="/docs/agents/php-agent/configuration/php-agent-configuration#inivar-appname"><code>newrelic.appname</code></a> config value, via <a href="/docs/agents/php-agent/configuration/php-directory-ini-settings#perdir-apache">Apache</a>, or via <a href="/docs/agents/php-agent/configuration/php-directory-ini-settings#php-fpm_per-dir">PHP-FPM</a>.</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>If you want to...</p>
      </div>
      <div>
        <p>Do this...</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p>Rename the reporting app for a specific part of your code</p>
      </div>
      <div>
        <p>Set the app name. See <a href="/docs/agents/php-agent/php-agent-api/newrelic_set_appname"><code>newrelic_set_appname()</code></a>.</p>
      </div>
    </div>
  </div>
</div>
<h2>Instrument missing sections of your code with transactions [#creating-transactions]</h2>
<p>To instrument your app, New Relic separates each path through your code into its own transaction. New Relic times (or "instruments") the parent method in these transactions to measure your app's overall performance, and collects transaction traces from long-running transactions for additional detail. For more information about transactions, see <a href="/docs/accounts-partnerships/education/getting-started-new-relic/glossary#transaction">transaction</a> and <a href="/docs/apm/transactions/transaction-traces/introduction-transaction-traces">transaction trace</a>.</p>
<p>Use these methods when New Relic is not instrumenting a particular part of your code at all:</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>If you want to...</p>
      </div>
      <div>
        <p>Do this...</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p>Start timing a method New Relic is not instrumenting automatically</p>
      </div>
      <div>
        <p>Start a transaction. See <a href="/docs/agents/php-agent/php-agent-api/newrelic_start_transaction"><code>newrelic_start_transaction()</code></a>.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Stop timing a method after its work is completed</p>
      </div>
      <div>
        <p>Stop a transaction. See <a href="/docs/agents/php-agent/php-agent-api/newrelic_end_transaction"><code>newrelic_end_transaction()</code></a>.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Prevent a transaction from reporting to New Relic</p>
      </div>
      <div>
        <p>Ignore the transaction. See <a href="/docs/agents/php-agent/php-agent-api/newrelic_ignore_transaction"><code>newrelic_ignore_transaction()</code></a>.</p>
      </div>
    </div>
  </div>
</div>
<h2>Time specific methods using segments [#segments]</h2>
<p>If a transaction is already visible in the New Relic UI, but you don't have enough data about a particular method that was called during that transaction, you can create segments to time those individual methods in greater detail. For example, you might want to time a particularly critical method with complex logic.</p>
<p>Use this methods when you want to instrument a method within an existing transaction:</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>If you want to...</p>
      </div>
      <div>
        <p>Do this...</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p>Time a particular method</p>
      </div>
      <div>
        <p>See <a href="/docs/agents/php-agent/php-agent-api/newrelic_add_custom_tracer"><code>newrelic_add_custom_tracer()</code></a>.</p>
      </div>
    </div>
  </div>
</div>
<h2>Instrument asynchronous work [#async]</h2>
<p>The only async work the PHP agent instruments is Guzzle, which is <a href="/docs/agents/php-agent/frameworks-libraries/guzzle">instrumented by default</a>.</p>
<h2>Send custom event and metric data from your app [#custom-data]</h2>
<p>New Relic includes a number of ways to record arbitrary custom data. For an explanation of New Relic data types, see <a href="/docs/data-analysis/metrics/analyze-your-metrics/data-collection-metric-timeslice-event-data">Data collection</a>.</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>If you want to...</p>
      </div>
      <div>
        <p>Do this...</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p>Send data about an event so you can analyze it in New Relic</p>
      </div>
      <div>
        <p>Create a <a href="/docs/insights/insights-data-sources/custom-events">custom event</a>. See <a href="/docs/insights/insights-data-sources/custom-data/insert-custom-events-new-relic-apm-agents#php-att">Insert custom events via APM agent (PHP)</a>.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Tag your events with metadata to filter and facet them</p>
      </div>
      <div>
        <p>Add <a href="/docs/agents/manage-apm-agents/agent-data/collect-custom-attributes">custom attributes</a>. See <a href="/docs/agents/php-agent/php-agent-api/newrelic_add_custom_parameter"><code>newrelic_add_custom_parameter()</code></a>.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Report custom performance data</p>
      </div>
      <div>
        <p>Create a <a href="/docs/agents/manage-apm-agents/agent-data/custom-metrics">custom metric</a>. See <a href="/docs/agents/php-agent/php-agent-api/newreliccustommetric-php-agent-api"><code>newrelic_custom_metric()</code></a>.</p>
      </div>
    </div>
  </div>
</div>
<h2>Instrument calls to external services [#datastore]</h2>
<p>Use these methods to collect data about your app's connections to other apps or datastores:</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>If you want to...</p>
      </div>
      <div>
        <p>Do this...</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p>Time a call to a datastore not instrumented by default</p>
      </div>
      <div>
        <p>See <a href="/docs/agents/php-agent/php-agent-api/newrelic_record_datastore_segment"><code>newrelic_record_datastore_segment()</code></a>.</p>
      </div>
    </div>
    <div>
      <div>
        <p>See the path that a request takes as it travels through a distributed system</p>
      </div>
      <div>
        <p>For PHP agent versions lower than 9.8, see these API calls:</p>
        <ul>
          <li>
            <p><a href="https://docs.newrelic.com/docs/agents/php-agent/php-agent-api/newreliccreatedistributedtracepayload-php-agent-api"><code>newrelic_create_distributed_trace_payload()</code></a></p>
          </li>
          <li>
            <p><a href="https://docs.newrelic.com/docs/agents/php-agent/php-agent-api/newrelicacceptdistributedtracepayload-php-agent-api"><code>newrelic_accept_distributed_trace_payload()</code></a></p>
          </li>
          <li>
            <p><a href="https://docs.newrelic.com/docs/agents/php-agent/php-agent-api/newrelicacceptdistributedtracepayloadhttpsafe-php-agent-api"><code>newrelic_accept_distributed_trace_payload_httpsafe()</code></a></p>
            <p>For PHP agent versions 9.8 or higher, see these API calls:</p>
          </li>
          <li>
            <p><code>newrelic_insert_distributed_trace_headers()</code></p>
          </li>
          <li>
            <p><code>newrelic_accept_distributed_trace_headers()</code></p>
            <p>For examples, see the documentation to <a href="https://docs.newrelic.com/docs/agents/php-agent/features/distributed-tracing#manual">manually instrument distributed tracing</a>.</p>
          </li>
        </ul>
      </div>
    </div>
    <div>
      <div></div>
      <div></div>
    </div>
  </div>
</div>
<h2>Monitor specific browser pages [#browser]</h2>
<p>You can <a href="/docs/browser/new-relic-browser/installation/install-new-relic-browser-agent">install the browser agent</a> by automatically adding it to your pages or by deploying it on specific pages by copying and pasting our JavaScript snippet. You can also control the browser agent by using APM agent API calls. For more information, see <a href="/docs/agents/php-agent/features/new-relic-browser-php-agent">Browser monitoring and the PHP agent</a>.</p>
