
<h2>Syntax</h2>
<pre><code>newrelic.agent.data_source_generator(name=None, **properties)
</code></pre>
<p>Wraps a metric-data-generating data source.</p>
<h2>Description</h2>
<p>The data source APIs provide a way to generate metrics using a <a href="/docs/agents/python-agent/supported-features/python-custom-metrics#push-versus-pull-interfaces">pull-style API</a> rather than the push-style API implemented by <a href="/docs/agents/python-agent/python-agent-api/record_custom_metric">record_custom_metric</a>. For more about why and how to use data sources for custom metrics, see <a href="/docs/agents/python-agent/supported-features/python-custom-metrics#custom-metric-data-sources">Custom metric data sources</a>.</p>
<p>The <code>data_source_generator</code> decorator is used to wrap a simple metric-data-generating data source that directly returns an iterable/generator with the metrics for each sample. The function the decorator is applied to must take no arguments. This would be used where there is no need to retain state information between calls to generate any metrics, and where the one instance of the data source can be used against multiple applications.</p>
<h2>Parameters</h2>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>Parameter</p>
      </div>
      <div>
        <p>Description</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p><code>name</code></p>
        <p><em>string</em></p>
      </div>
      <div>
        <p>Optional. The name of the data source. This is used only for logging purposes. If not provided, it defaults to the callable name derived from the decorated function.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>properties</code></p>
        <p><em>dictionary</em></p>
      </div>
      <div>
        <p>Optional. Any additional properties to pass to the data source factory.</p>
        <p>The possible fields for a dictionary are:</p>
        <ul>
          <li>
            <p><code>count</code></p>
          </li>
          <li>
            <p><code>total</code></p>
          </li>
          <li>
            <p><code>min</code></p>
          </li>
          <li>
            <p><code>max</code></p>
          </li>
          <li>
            <p><code>sum_of_squares</code></p>
            <p>For explanations of these fields and some general usage tips, see the <a href="https://docs.newrelic.com/docs/plugins/plugin-developer-resources/developer-reference/metric-value-reference">documentation for our Plugins custom metrics API</a>.</p>
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>
<h2>Return values</h2>
<p>Returns a function.</p>
<h2>Examples</h2>
<h3>Data source generator example [#example]</h3>
<p>An example of using <code>data_source_generator</code> to wrap a function that returns metric values:</p>
<pre><code>import psutil
import os
 
@newrelic.agent.data_source_generator(name='Memory Usage')
def memory_metrics():
    pid = os.getpid()
    p = psutil.Process(os.getpid())
    m = p.get_memory_info()
    yield ('Custom/Memory/Physical', float(m.rss)/(1024*1024))
    yield ('Custom/Memory/Virtual', float(m.vms)/(1024*1024))
</code></pre>
