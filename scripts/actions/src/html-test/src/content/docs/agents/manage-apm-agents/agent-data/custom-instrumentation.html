
<p>New Relic collects and reports information on <a href="/docs/apm/transactions/intro-transactions/transactions-new-relic-apm">web transactions</a> and <a href="/docs/apm/transactions/intro-transactions/monitor-background-processes-other-non-web-transactions">non-web transactions</a>, such as background tasks. New Relic normally produces complete information automatically, without any need to modify your application code. However, if you are not using a <a href="/docs/agents/manage-apm-agents/installation/compatibility-requirements">supported framework</a>, you may need to add custom instrumentation.</p>
<p>Custom instrumentation is also useful to:</p>
<ul>
  <li>Add detail to your <a href="/docs/apm/transactions/transaction-traces/introduction-transaction-traces#find-view">transaction traces</a>.</li>
  <li>Block instrumentation on selected transactions you do not want instrumented.</li>
  <li>Instrument a part of your code that New Relic simply is not picking up.</li>
</ul>
<p>Custom instrumentation that creates a new transaction collects both <a href="/docs/data-analysis/metrics/analyze-your-metrics/data-collection-metric-timeslice-event-data#timeslice-data">metric timeslice</a> and <a href="/docs/data-analysis/metrics/analyze-your-metrics/data-collection-metric-timeslice-event-data#event-data">event</a> data. Custom instrumentation for already instrumented transactions collects only metric timeslice data.</p>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
  <p>Do not use brackets <code>[suffix]</code> at the end of your transaction name. New Relic automatically strips brackets from the name. Instead, use parentheses <code>(suffix)</code> or other symbols if needed.</p>
</div>
<h2>When to use custom instrumentation [#choosing]</h2>
<p>Custom instrumentation allows you to track interactions that are not captured by New Relic's automatic instrumentation. Custom instrumentation can also add detail to your <a href="/docs/traces/transaction-traces">transaction traces</a>, to help you identify key issues.</p>
<p>New Relic collects data from many frameworks automatically. If you are using a <a href="/docs/agents/manage-apm-agents/installation/compatibility-requirements">supported framework</a>, you should not need custom instrumentation to collect metric timeslices, events, and traces.</p>
<p>However, if you encounter any of these situations, you may need custom instrumentation:</p>
<ul>
  <li>Transactions do not appear in the UI.</li>
  <li>Transaction traces include large blocks of application code time without full detail.</li>
</ul>
<p>If you are using a <a href="/docs/agents/manage-apm-agents/installation/compatibility-requirements">supported framework</a>, but are not seeing transaction on the New Relic APM <a href="/docs/applications-menu/transactions-dashboard"><strong>Transactions</strong> page</a>, get support at <a href="https://support.newrelic.com">support.newrelic.com</a> to ensure the framework instrumentation is working.</p>
<h2>Implement custom instrumentation [#implementing]</h2>
<p>Each agent implements custom instrumentation differently:</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiYy1zZGsifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IkMgU0RLIGN1c3RvbSBpbnN0cnVtZW50YXRpb24ifV0=">
    <div data-prop-text="title">C SDK custom instrumentation</div>
    <p>For applications monitored by the C SDK, you must manually instrument transactions, segments, and errors. For more information, see the <a href="/docs/agents/c-sdk/instrumentation/instrument-your-app-c-sdk">C SDK instrumentation procedures</a>.</p>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZ28ifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IkdvIGN1c3RvbSBpbnN0cnVtZW50YXRpb24ifV0=">
    <div data-prop-text="title">Go custom instrumentation</div>
    <p>Because Golang apps run from a compiled, native binary file, all New Relic instrumentation must be done manually. See <a href="/docs/agents/go-agent/get-started/instrument-go-transactions">Instrument Go transactions</a> and <a href="/docs/agents/go-agent/get-started/instrument-go-transactions">Instrument Go segments</a> for how to set up instrumentation in your Go app.</p>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiamF2YSJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiSmF2YSBjdXN0b20gaW5zdHJ1bWVudGF0aW9uIn1d">
    <div data-prop-text="title">Java custom instrumentation</div>
    <p>New Relic's Java agent supports two methods of custom instrumentation:</p>
    <ul>
      <li>
        <p><a href="/docs/java/custom-instrumentation-by-annotation">Annotation</a>: Add <strong>@Trace</strong> annotations to your code to ensure New Relic instruments specific methods. Annotation is easy to implement, if you are instrumenting only a few methods. For more complex instrumentation, or if you are unable to modify your code, use XML.</p>
      </li>
      <li>
        <p><a href="/docs/java/custom-instrumentation-by-xml">XML</a>: Define the methods you want New Relic to monitor in an XML file. XML instrumentation is flexible and doesn't require editing your code, but is more difficult to troubleshoot than annotation.</p>
        <p>For more information, see <a href="/docs/java/custom-instrumentation-for-java">Java custom instrumentation</a>.</p>
      </li>
    </ul>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZG90bmV0In0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiIuTkVUIGN1c3RvbSBpbnN0cnVtZW50YXRpb24ifV0=">
    <div data-prop-text="title">.NET custom instrumentation</div>
    <p>New Relic's .NET agent supports two methods of custom instrumentation:</p>
    <ul>
      <li>
        <p>Attributes: Annotate your code with agent API calls to instrument specific methods. Annotation is easy to implement, but requires editing your source code.</p>
      </li>
      <li>
        <p>XML: Define the methods you want New Relic to instrument in an XML file. XML instrumentation does not require modifying your source code, but is more complicated to create and keep updated than attribute instrumentation.</p>
        <p>For more information, see <a href="/docs/agents/net-agent/custom-instrumentation/introduction-net-custom-instrumentation">Introduction to .NET custom instrumentation</a>.</p>
      </li>
    </ul>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoibm9kZWpzIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJOb2RlLmpzIGN1c3RvbSBpbnN0cnVtZW50YXRpb24ifV0=">
    <div data-prop-text="title">Node.js custom instrumentation</div>
    <p>New Relic's Node.js agent uses API calls for custom instrumentation. For more information, see <a href="/docs/agents/nodejs-agent/supported-features/nodejs-custom-instrumentation">Node.js custom instrumentation</a>.</p>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoicGhwIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJQSFAgY3VzdG9tIGluc3RydW1lbnRhdGlvbiJ9XQ==">
    <div data-prop-text="title">PHP custom instrumentation</div>
    <p>New Relic's PHP agent uses API calls for custom instrumentation. For more information, see <a href="/docs/php/php-custom-instrumentation">PHP custom instrumentation</a>.</p>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoicHl0aG9uIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJQeXRob24gY3VzdG9tIGluc3RydW1lbnRhdGlvbiJ9XQ==">
    <div data-prop-text="title">Python custom instrumentation</div>
    <p>New Relic's Python agent supports two methods of custom instrumentation:</p>
    <ul>
      <li>
        <p><a href="/docs/python/python-instrumentation-by-config-file">Configuration file</a>: Use the agent configuration file to specify the functions and methods you want instrumented. The agent configuration file is easy to set up, and it does not require you to modify your code. However, it is less flexible than API calls.</p>
      </li>
      <li>
        <p><a href="/docs/python/python-instrumentation-by-api">API calls</a>: Edit your code to call the New Relic Python API. The API is more flexible than instrumentation via the configuration file, but it requires you to modify your code.</p>
        <p>For more information, see <a href="/docs/python/python-custom-instrumentation">Python custom instrumentation</a>.</p>
      </li>
    </ul>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoicnVieSJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiUnVieSBjdXN0b20gaW5zdHJ1bWVudGF0aW9uIn1d">
    <div data-prop-text="title">Ruby custom instrumentation</div>
    <p>New Relic's Ruby agent uses API calls to define target methods and add transaction tracers to them. For more information, see <a href="/docs/ruby/ruby-custom-instrumentation">Ruby custom instrumentation</a>.</p>
  </div>
</div>
<h2>Grouping issues [#mgi]</h2>
<p>A <a href="/docs/agents/manage-apm-agents/troubleshooting/metric-grouping-issues">metric grouping issue</a> occurs when an account sends too many differently-named metric timeslices to New Relic, and those individual web transactions are not properly aggregated. For example, rather than a single <code>/user/controlpanel/</code> metric name, you might see <code>/user/controlpanel/alice</code>, <code>/user/controlpanel/bob</code>, and <code>/user/controlpanel/carol</code>.</p>
<p>Custom instrumentation can cause metric grouping issues if you introduce too many uniquely-named metric timeslices that New Relic cannot effectively group. If you send thousands of metrics, New Relic may apply rules to reduce the number of transactions.</p>
