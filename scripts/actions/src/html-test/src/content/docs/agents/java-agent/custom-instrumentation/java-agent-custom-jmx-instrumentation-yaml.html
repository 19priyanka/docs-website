
<p>The Java SE Platform includes Java Management Extensions (JMX). JMX is a way to monitor and manage applications, devices, and services. Generally, application servers have built-in JMX metrics that you can monitor.</p>
<p>New Relic's Java agent offers the ability to monitor specific metrics from MBeans and attributes in your application without modifying code by using a <a href="/docs/java/custom-jmx-yaml-examples">custom instrumentation YAML file</a>. The Java agent will read the YAML file on startup and record the specific metrics.</p>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJ0aXAifV0=">
  <p>You can also monitor JMX with the <a href="/docs/integrations/host-integrations/host-integrations-list/jmx-monitoring-integration">Infrastructure JMX integration</a>.</p>
</div>
<h2>Requirements and access [#requirements]</h2>
<p>The Java agent only sees metrics from MBeans in your current JVM. If the MBeans are being accessed remotely, or exist in a separate JVM, they will not be available to the New Relic Java agent.</p>
<p>Custom JMX data won't be displayed in our APM charts, but you can <a href="#display_metrics">query the data</a> and create custom charts with it.</p>
<p>This integration reports only simple numeric values. If you want to report other types of values, you may want to use the <a href="/docs/integrations/host-integrations/host-integrations-list/jmx-monitoring-integration">Infrastructure JMX integration</a>.</p>
<h2>File structure rules [#file_structure]</h2>
<p>The custom instrumentation file must be in the <a href="https://en.wikipedia.org/wiki/YAML">YAML format</a>. Use a YAML validator to ensure the syntax is accurate before using the file with New Relic's Java agent, and follow these rules:</p>
<ul>
  <li>YAML files are case sensitive.</li>
  <li>All indentations are in increments of two characters. Data in the same stanza of the file must use the same level of indentation. Indent any sub-stanzas by an additional two spaces.</li>
  <li>You must restart your JVM host process for changes to take effect.</li>
</ul>
<h2>Available properties [#properties]</h2>
<p>Here is a summary of each property in the JMX file. For more information, see <a href="/docs/java/custom-jmx-yaml-examples">Custom JMX YAML examples</a>.</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p><strong>Value</strong></p>
      </div>
      <div>
        <p><strong>Definition</strong></p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p><code>name</code></p>
      </div>
      <div>
        <p>The primary descriptive name identifying your YAML custom instrumentation file. Include one space before the <code>name</code> property.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>version</code></p>
      </div>
      <div>
        <p>The version of the extension file. If two extensions have the same name, only the extension with the highest version will be used. Be sure the version property is on a separate line from <code>name</code>. Include one space before the version property.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>enabled</code></p>
      </div>
      <div>
        <p>If <code>true</code>, the Java agent will read the extension. If <code>false</code>, the Java agent will ignore the extension. Include one space before the <code>enabled</code> property.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>jmx</code></p>
      </div>
      <div>
        <p>No value follows the property <code>jmx</code>. Use zero spaces before the property.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>object_name</code></p>
      </div>
      <div>
        <p>Matches the specific MBean's object. If you are using JDK version 1.6 or higher, the <code>object_name</code> can include asterisks (*). Include two spaces before the dash and one space between the dash and <code>object_name</code>.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>root_metric_name</code></p>
      </div>
      <div>
        <p>Available with New Relic's Java agent version 3.7.0 or higher. An optional property that provides the ability to name the metric used in New Relic. To use <code>object_name</code> property values, specify the property key in brackets(<code>{}</code>). New Relic will automatically prefix the <code>root_metric_name</code> specified with JMX and append the attribute name to the end of the metric. Include four spaces before <code>root_metric_name</code>.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>metrics</code></p>
      </div>
      <div>
        <p>There is no value on the metrics line. Include four spaces before metrics.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>attributes</code></p>
      </div>
      <div>
        <p>A comma-separated list of the MBean's attributes. The attribute name must match exactly. Include 6 spaces before the dash and one space between the dash and <code>attributes</code> keyword.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>type</code></p>
      </div>
      <div>
        <ul>
          <li>If <code>simple</code>, each value will be reported to the New Relic collector.</li>
          <li>If <code>monotonically_increasing</code> (default), the positive difference will be reported to the New Relic collector.</li>
        </ul>
      </div>
    </div>
  </div>
</div>
<h2>YAML file location [#file_location]</h2>
<p>The Java agent reads the YAML file on process startup. There are two ways to specify the YAML file location:</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiY3JlYXRlLWV4dGVuc2lvbnMtZGlyIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJDcmVhdGUgYW4gZXh0ZW5zaW9ucyBkaXJlY3RvcnkifV0=">
    <div data-prop-text="title">Create an extensions directory</div>
    <ol>
      <li>In the directory where the <code>newrelic.jar</code> and <code>newrelic.yml</code> are located, create a directory named <code>extensions</code>.</li>
      <li>Put the YAML file in this directory with a <code>.yml</code> extension.</li>
      <li>In <code>newrelic.yml</code>, check that the property <code>extensions.dir</code> is not set.</li>
    </ol>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoic3BlY2lmeS1leGlzdGluZy1kaXJlY3Rpb24ifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IlNwZWNpZnkgYW4gZXhpc3RpbmcgZXh0ZW5zaW9ucyBkaXJlY3RvcnkifV0=">
    <div data-prop-text="title">Specify an existing extensions directory</div>
    <ol>
      <li>In the <code>newrelic.yml</code> configuration file under the common section, use the property <code>extensions.dir</code> to specify the directory where the YAML file is located.</li>
      <li>Make sure the file is in the specified directory and that the file has a <code>.yml</code> extension.</li>
    </ol>
  </div>
</div>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJjYXV0aW9uIn1d">
  <p>The custom metric will not work if there is more than one YAML file in the same folder as the agent. Move backups and copies to another folder when customizing.</p>
</div>
<h2>Verify the file was read [#verify_read]</h2>
<p>To verify the YAML file was read by the agent:</p>
<ol>
  <li>
    <p>Open the <code>newrelic.yml</code> configuration file.</p>
  </li>
  <li>
    <p>Change the log level property to <code>log_level: finer</code>.</p>
  </li>
  <li>
    <p>Start up the application.</p>
  </li>
  <li>
    <p>Verify that the <code>logs/newrelic_agent.log</code> file includes a statement indicating that the file was read in:</p>
    <pre><code>Reading custom extension file /path/to/file/file.yml
</code></pre>
  </li>
  <li>
    <p>If you cannot find this statement, check the location of the YAML file. Also make sure the process has read access to the file.</p>
  </li>
  <li>
    <p>Verify that the file includes this statement:</p>
    <pre><code>Adding extension with name NAME_FROM_YAML and version VERSION_FROM_YAML
</code></pre>
  </li>
  <li>
    <p>If you cannot find this statement, verify that the document was parsed correctly. Also verify if there is another extension file with the same name and a higher version number.</p>
  </li>
</ol>
<h2>Query and chart JMX data [#display_metrics]</h2>
<p>You can run queries of your JMX data and use it to create custom charts. To learn more about querying this kind of data, see <a href="/docs/query-your-data/nrql-new-relic-query-language/nrql-query-tutorials/query-apm-metric-timeslice-data-nrql">Query APM metrics</a>.</p>
<p>Here's how to search for <strong>JMX</strong> or for the direct path to the counter as set in your YAML file.</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJTZWFyY2ggZm9yIHRoZSBkaXJlY3QgcGF0aCB0byB5b3VyIGNvdW50ZXJzIn1d">
    <div data-prop-text="title">Search for the direct path to your counters</div>
    <p>Example YAML file</p>
    <pre><code>name: TomcatCustom
      version: 1.0
      enabled: true
      jmx:
        - object_name: java.nio:type=BufferPool,name=*
          metrics:
            - attributes: Count
              type: monotonically_increasing

</code></pre>
    <pre><code>
JMX/java.nio/BufferPool/direct/Count
      JMX/java.nio/BufferPool/mapped/Count

</code></pre>You can find counters from the object in the example YAML file by searching in the [Metric Explorer](https://docs.newrelic.com/docs/insights/use-insights-ui/explore-data/metric-explorer-search-chart-metrics-sent-new-relic-agents) for the following:
  </div>
</div>
<p>For more information about how metrics are named and stored, see <a href="https://docs.newrelic.com/docs/agents/java-agent/custom-instrumentation/custom-jmx-yaml-examples#metric_names">Custom JMX YAML examples</a>.</p>
