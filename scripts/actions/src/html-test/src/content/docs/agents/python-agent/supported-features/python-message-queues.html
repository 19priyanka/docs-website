
<p>The Python agent supports the <a href="https://pypi.python.org/pypi/pika">Pika RabbitMQ client library</a>, giving you visibility into the performance of your message processing, for both incoming and outgoing messages.</p>
<p>The New Relic UI will show transactions initiated via RabbitMQ message receipt (subscribe/consume messages) as <strong>Message</strong> background tasks. Message creation via RabbitMQ also appears in transaction traces.</p>
<h2>Requirements</h2>
<p>Requires <a href="/docs/release-notes/agent-release-notes/python-release-notes">Python agent version 2.88.0.72 or higher</a>.</p>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJjYXV0aW9uIn1d">
  <p>Message tasks are not started for consumers using <a href="https://pika.readthedocs.io/en/latest/modules/adapters/tornado.html#pika.adapters.tornado_connection.TornadoConnection">TornadoConnection</a>.</p>
</div>
<h2>Performance improvements with background tasks [#background]</h2>
<p>One way to increase responsiveness of web applications is to delegate work to background processes. Message queues are commonly used for this inter-process communication.</p>
<p>In the context of message queuing systems, applications typically interact with message brokers to send and receive messages. The RabbitMQ Pika client library allows Python applications to interface with message brokers that implement the Advanced Message Queueing Protocol (AMQP) 0.9 or higher.</p>
<p>The Python agent shows messages sent and received using the RabbitMQ client library. With this visibility, you can see details including:</p>
<ul>
  <li>Number of messages produced by your app</li>
  <li>Time your app spends publishing messages</li>
  <li>Time your app spends processing "consumed" messages</li>
</ul>
<p><a href="#view-queue">APM</a> conveniently groups and reports operations that interact with queues. By analyzing this information, you can more easily identify bottlenecks and areas for performance improvement in your message passing architecture.</p>
<h2>Queue operations [#queue-ops]</h2>
<p>Supported entry points for queue operations appear as <code>Put</code> (publish a message) or <code>Take</code> (receive a message) in APM's user interface.</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p><strong>Queue operations</strong></p>
      </div>
      <div>
        <p><strong>Publish a message (<code>Put</code> in UI)</strong></p>
      </div>
      <div>
        <p><strong>Receive a message (<code>Take</code> in UI)</strong></p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p>RabbitMQ</p>
      </div>
      <div>
        <p><code>basic_publish</code></p>
      </div>
      <div>
        <p><code>basic_get</code></p>
        <p><code>basic_consume (callback)</code></p>
      </div>
    </div>
  </div>
</div>
<h2>View in New Relic UI [#view-queue]</h2>
<p>Queue operations appear on APM's <a href="/docs/apm/applications-menu/monitoring/transactions-dashboard"><strong>Transactions</strong> page</a> for the selected app. The <code>Put</code> and <code>Take</code> metrics appear in the <strong>Breakdown table</strong> and are categorized as <code>MessageBroker</code> metrics. Here is an example:</p>
<p>
  <img src="./images/rabbitmq-transaction-task.png" alt="New Relic for Python rabbitmq task" title="screen-rabbitmq-transaction.png">
</p>
<p><strong><a href="https://one.newrelic.com/">one.newrelic.com</a> > APM > (select an app) > Monitoring > Transactions > (select a transaction):</strong> The transactionâ€™s <strong>Breakdown table</strong> categorizes queue operations as <code>MessageBroker</code> metrics and labels them as <code>Put</code> (publish a message) or <code>Take</code> (receive a message).</p>
<p><a href="/docs/apm/transactions/transaction-traces/transaction-traces">Transaction traces</a> also provide additional details for messages.</p>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJ0aXAifV0=">
  <p>You can <a href="/docs/apm/transactions/transaction-traces/viewing-transaction-traces">select transaction traces</a> from the app's <strong>Summary</strong> or <strong>Transactions</strong> pages in APM.</p>
</div>
<p>The <a href="/docs/apm/transactions/transaction-traces/transaction-trace-summary"><strong>Transaction trace summary</strong> page</a> may show <code>Put</code> and <code>Take</code> operations in the <strong>Slowest components</strong> section. For example:</p>
<p>
  <img src="./images/rabbitmq-transaction-trace-summary_0.png" alt="New Relic for Python rabbitmq transaction trace summary" title="screen-rabbitmq-trace-slowest.png">
</p>
<p><strong><a href="https://one.newrelic.com/">one.newrelic.com</a> > APM > (select an app) > (select a transaction trace):</strong> In this example, the selected transaction trace's <strong>Summary</strong> shows RabbitMQ operations in the colored bar chart. The <strong>Slowest components</strong> section also lists the RabbitMQ <code>Put</code> and <code>Take</code> results.</p>
<p>The <strong>Transaction trace</strong> page includes a dedicated <strong>Messages</strong> tab that shows a summary of the message activity that occurred as part of the transaction. Here is an example:</p>
<p>
  <img src="./images/rabbitmq-transaction-trace.png" alt="New Relic for Python rabbitmq trace Messages" title="screen-rabbitmq-messages.png">
</p>
<p><strong><a href="https://one.newrelic.com/">one.newrelic.com</a> > APM > (select an app) > (select a transaction trace):</strong> In this example, the selected transaction trace's <strong>Messages</strong> tab lists the RabbitMQ message details.</p>
