
<p>This document explains how to install APM's .NET Framework agent and .NET Core agent on Azure Service Fabric. This is not the same as installing the <a href="/docs/integrations/microsoft-azure-integrations/getting-started/introduction-azure-monitoring-integrations">Infrastructure integrations for Microsoft Azure</a>.</p>
<h2>Install .NET agent on Azure Service Fabric [#install]</h2>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
  <p>In most cases, installing the .NET agent in an Azure Service Fabric environment can be performed using the standard install procedures for either <a href="/docs/agents/net-agent/installation/install-net-framework-agent">Windows</a> or <a href="/docs/agents/net-agent/installation/install-net-core-agent">Linux</a>. This document highlights some alternate ways you can install the agent.</p>
  <p>You will need to ensure the agent gets installed on all nodes in your cluster. To monitor multiple nodes, you may want to integrate the install into your deployment process.</p>
</div>
<p>If you are using containers in your Service Fabric environment you should read <a href="/docs/agents/net-agent/installation/install-docker-container">Install for Docker</a>.</p>
<p>You can also install the agent in a Service Fabric environment using NuGet. NuGet is often a good option for developers because the agent gets deployed along with your application. Though, using NuGet requires some manual installation procedures. See <a href="#install-nuget">Install with NuGet</a>.</p>
<h2>Install using NuGet [#install-nuget]</h2>
<p>To install the .NET agent using NuGet:</p>
<ol>
  <li>
    <p>Follow the standard <a href="/docs/agents/net-agent/installation/install-net-agent-using-nuget">NuGet install</a> procedures.</p>
  </li>
  <li>
    <p>When using NuGet, you must set some environment variables. This can be done in your application's <code>ServiceManifest.xml</code> file. See the relevant instructions below:</p>
    <div data-component="CollapserGroup" data-prop="W10=">
      <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoibmV0LWZyYW1ld29yayJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiLk5FVCBGcmFtZXdvcmsifV0=">
        <div data-prop-text="title">.NET Framework</div>
        <p>In the <code>ServiceManifest.xml</code> file in your project, include the following under the <code>CodePackage</code> node:</p>
        <pre><code>&#x3C;CodePackage Name="Code" Version="1.0.0">  &#x3C;/CodePackage>
&#x3C;CodePackage>
  ...
  &#x3C;EntryPoint>
    &#x3C;ExeHost>
      ...
      &#x3C;!-- It is important for the WorkingFolder to be set to CodePackage -->
      &#x3C;!-- This is because the environment variables set below rely on this being the working folder for the agent to work -->
      &#x3C;WorkingFolder>CodePackage&#x3C;/WorkingFolder>
      ...
    &#x3C;/ExeHost>
  &#x3C;/EntryPoint>
  ...
  &#x3C;EnvironmentVariables>
    ...
    &#x3C;EnvironmentVariable Name="COR_ENABLE_PROFILING" Value="1" />
    &#x3C;EnvironmentVariable Name="COR_PROFILER" Value="{71DA0A04-7777-4EC6-9643-7D28B46A8A41}" />
    &#x3C;EnvironmentVariable Name="COR_PROFILER_PATH" Value=".\newrelic\NewRelic.Profiler.dll" />
    &#x3C;EnvironmentVariable Name="NEWRELIC_HOME" Value=".\newrelic" />
    &#x3C;EnvironmentVariable Name="NEW_RELIC_LICENSE_KEY" Value="YOUR_LICENSE_KEY" />
    &#x3C;EnvironmentVariable Name="NEW_RELIC_APP_NAME" Value="YOUR_APP_NAME" />
    ...
  &#x3C;/EnvironmentVariables>
  ...
&#x3C;/CodePackage>

</code></pre>
      </div>
      <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoibmV0LWNvcmUtd2luZG93cyJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiLk5FVCBDb3JlIGZvciBXaW5kb3dzIn1d">
        <div data-prop-text="title">.NET Core for Windows</div>
        <p>In the <code>ServiceManifest.xml</code> file in your project, include the following under the <code>CodePackage</code> node:</p>
        <pre><code>&#x3C;CodePackage>
  ...
  &#x3C;EntryPoint>
    &#x3C;ExeHost>
      ...
      &#x3C;!-- It is important for the WorkingFolder to be set to CodePackage -->
      &#x3C;!-- This is because the environment variables set below rely on this being the working folder for the agent to work -->
      &#x3C;WorkingFolder>CodePackage&#x3C;/WorkingFolder>
      ...
    &#x3C;/ExeHost>
  &#x3C;/EntryPoint>
  ...
  &#x3C;EnvironmentVariables>
    ...
    &#x3C;EnvironmentVariable Name="CORECLR_ENABLE_PROFILING" Value="1" />
    &#x3C;EnvironmentVariable Name="CORECLR_PROFILER" Value="{36032161-FFC0-4B61-B559-F6C5D41BAE5A}" />
    &#x3C;EnvironmentVariable Name="CORECLR_PROFILER_PATH" Value=".\newrelic\NewRelic.Profiler.dll" />
    &#x3C;EnvironmentVariable Name="CORECLR_NEWRELIC_HOME" Value=".\newrelic" />
    &#x3C;EnvironmentVariable Name="NEW_RELIC_LICENSE_KEY" Value="YOUR_LICENSE_KEY" />
    &#x3C;EnvironmentVariable Name="NEW_RELIC_APP_NAME" Value="YOUR_APP_NAME" />
    ...
  &#x3C;/EnvironmentVariables>
  ...
&#x3C;/CodePackage>

</code></pre>
      </div>
      <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoibmV0LWNvcmUtbGludXgifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6Ii5ORVQgQ29yZSBmb3IgTGludXgifV0=">
        <div data-prop-text="title">.NET Core for Linux</div>
        <p>In the <code>ServiceManifest.xml</code> file in your project, include the following under the <code>CodePackage</code> node:</p>
        <pre><code>&#x3C;CodePackage>
  ...
  &#x3C;EntryPoint>
    &#x3C;ExeHost>
      ...
      &#x3C;!-- It is important for the WorkingFolder to be set to CodePackage -->
      &#x3C;!-- This is because the environment variables set below rely on this being the working folder for the agent to work -->
      &#x3C;WorkingFolder>CodePackage&#x3C;/WorkingFolder>
      ...
    &#x3C;/ExeHost>
  &#x3C;/EntryPoint>
  ...
  &#x3C;EnvironmentVariables>
    ...
    &#x3C;EnvironmentVariable Name="CORECLR_ENABLE_PROFILING" Value="1" />
    &#x3C;EnvironmentVariable Name="CORECLR_PROFILER" Value="{36032161-FFC0-4B61-B559-F6C5D41BAE5A}" />
    &#x3C;EnvironmentVariable Name="CORECLR_PROFILER_PATH" Value="./newrelic/libNewRelicProfiler.so" />
    &#x3C;EnvironmentVariable Name="CORECLR_NEWRELIC_HOME" Value="./newrelic" />
    &#x3C;EnvironmentVariable Name="NEW_RELIC_LICENSE_KEY" Value="YOUR_LICENSE_KEY" />
    &#x3C;EnvironmentVariable Name="NEW_RELIC_APP_NAME" Value="YOUR_APP_NAME" />
    ...
  &#x3C;/EnvironmentVariables>
  ...
&#x3C;/CodePackage>

</code></pre>
      </div>
    </div>
  </li>
  <li>
    <p><strong>For the .NET Framework only</strong>: Edit your <code>app.config</code> file and add the <code>NewRelic.AgentEnabled</code> app setting:</p>
    <pre><code>&#x3C;appSettings>
  ...
  &#x3C;add key="NewRelic.AgentEnabled" value="true" />
  ...
&#x3C;/appSettings>
</code></pre>
  </li>
</ol>
<p>If your application is generating traffic, data should appear in your APM account in several minutes. If data does not appear, try these troubleshooting steps:</p>
<ul>
  <li>Make sure that all files in the <code>newrelic</code> directory at the root of your app was published to Azure.</li>
  <li>Make sure the environment variables are set correctly.</li>
  <li>See the general <a href="/docs/agents/net-agent/troubleshooting/no-data-appears-net">troubleshooting documentation</a> to check for common errors.</li>
</ul>
