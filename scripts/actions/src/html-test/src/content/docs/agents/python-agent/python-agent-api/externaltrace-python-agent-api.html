
<h2>Syntax</h2>
<pre><code>newrelic.agent.external_trace(library, url, method=None)
</code></pre>
<p>Report calls to external services as transaction trace segments.</p>
<h2>Description</h2>
<p><code>external_trace</code> is used to add more detail to your <a href="/docs/accounts-partnerships/education/getting-started-new-relic/glossary#transaction-trace">transaction traces</a> in the form of additional segments. Any calls reported with <code>external_trace</code> will appear on the externals tab in APM. <code>external_trace</code> returns a <a href="https://docs.python.org/3.6/library/functools.html#functools.partial">partial</a> of <code>ExternalTraceWrapper</code> that can be used as a decorator for a function that calls an external service.</p>
<p>The <code>external_trace</code> decorator can be used on generators and coroutines with agent version 2.102.0.85 or higher. Timing of these objects begins when consumption starts, and ends when the object is exhausted or goes out of scope. This is a change from earlier versions where the metric represented the time taken to create the generator or coroutine object itself.</p>
<p>If you cannot use the decorator in your application, you can use one of these other call formats:</p>
<ul>
  <li><strong>The context manager</strong>: The context manager form is <code>ExternalTrace</code>.</li>
  <li><strong>The wrapper</strong>: The wrapper form is <code>ExternalTraceWrapper</code>. It can be used to return a wrapped function without the use of a decorator.</li>
  <li><strong>The path-based wrapper</strong>: The path-based wrapper form is <code>wrap_external_trace</code>. This applies the <code>ExternalTraceWrapper</code> to a given object through monkey patching. This takes the same parameters as the decorator plus an additional <code>module</code> and <code>object_path</code> parameter.</li>
</ul>
<p>For an explanation of the uses of these different call formats, see <a href="/docs/python-agent-api-different-call-forms">Different call formats</a>. See <a href="#examples">Examples</a> for call examples.</p>
<h2>Parameters</h2>
<h3>Parameters for external_trace [#main-parameters]</h3>
<pre><code>newrelic.agent.external_trace(library, url, method=None)
</code></pre>
<p>The <code>external_trace</code> decorator uses these parameters:</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>Parameter</p>
      </div>
      <div>
        <p>Description</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p><code>library</code></p>
        <p><em>string</em> or <em>function</em></p>
      </div>
      <div>
        <p>Required. The name (or type) of the external library in use. Pass either a string that defines it or a function that returns it.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>url</code></p>
        <p><em>string</em> or <em>function</em></p>
      </div>
      <div>
        <p>Required. The URL that has been requested by the library call. Pass either a string that defines it or a function that returns it.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>method</code></p>
        <p><em>string</em> or <em>function</em></p>
      </div>
      <div>
        <p>Optional. The method defining the type of call being made. These are typically <code>get</code>, <code>post</code>, <code>put</code>, or <code>delete</code>.</p>
      </div>
    </div>
  </div>
</div>
<h3>Parameters for ExternalTrace [#context-mgr-parameters]</h3>
<pre><code>newrelic.agent.ExternalTrace(library, url, method=None)
</code></pre>
<p>The <code>ExternalTrace</code> context manager takes all of the <a href="#main-parameters">parameters</a> taken by <code>external_trace</code>.</p>
<h3>Parameters for ExternalTraceWrapper [#wrapper-parameters]</h3>
<pre><code>newrelic.agent.ExternalTraceWrapper(wrapped, library, url, method=None)
</code></pre>
<p>The <code>ExternalTraceWrapper</code> takes all of the same parameters as the <a href="#main-parameters">decorator</a> in addition to an initial <code>wrapped</code> parameter:</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>Parameter</p>
      </div>
      <div>
        <p>Description</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p><code>wrapped</code></p>
        <p><em>function</em></p>
      </div>
      <div>
        <p>Required. The external call function to attribute to the external time.</p>
      </div>
    </div>
  </div>
</div>
<h3>Parameters for wrap_external_trace [#path-based-parameters]</h3>
<pre><code>newrelic.agent.wrap_external_trace(module, object_path, library, url, method=None)
</code></pre>
<p>The <code>wrap_external_trace</code> takes all of the parameters that the <a href="#main-parameters">decorator</a> does in addition to a <code>module</code> parameter and an <code>object_path</code> parameter:</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>Parameter</p>
      </div>
      <div>
        <p>Description</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p><code>module</code></p>
        <p><em>object</em></p>
      </div>
      <div>
        <p>Required. The module containing the object to be wrapped.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>object_path</code></p>
        <p><em>string</em></p>
      </div>
      <div>
        <p>Required. The path to the object to be wrapped.</p>
      </div>
    </div>
  </div>
</div>
<h2>Return values</h2>
<p><code>external_trace</code> returns a <code>ExternalTraceWrapper()</code> partial.</p>
<h2>Examples</h2>
<h3>external_trace example [#decorator-example]</h3>
<p>An example of using <code>external_trace</code>:</p>
<pre><code>@external_trace('library', 'http://example.com', 'get')
def foo():
    pass
</code></pre>
<p>An example of using <code>external_trace</code> on a native coroutine:</p>
<pre><code>@external_trace('library', 'http://example.com', 'get')
async def foo():
    pass
</code></pre>
<h3>ExternalTrace example [#context-mgr-example]</h3>
<p>An example of using the <code>ExternalTrace</code> context manager:</p>
<pre><code>def fetch_example_dot_com():
    with ExternalTrace('library', 'http://example.com', 'get'):
        pass
</code></pre>
<h3>ExternalTraceWrapper example [#wrapper-example]</h3>
<p>An example of using the <code>ExternalTraceWrapper</code>:</p>
<pre><code>wrapped_fetch_example_dot_com = newrelic.agent.ExternalTraceWrapper(fetch_example_dot_com, 'library', 'http://example.com', 'get')

response = wrapped_fetch_example_dot_com()
</code></pre>
<h3>wrap_external_trace example [#path-based-example]</h3>
<p>An example of using the <code>wrap_external_trace</code> path-based wrapper:</p>
<pre><code>wrap_external_trace('module', 'Foo.bar', 'library', 'http://example.com', 'get')
</code></pre>
