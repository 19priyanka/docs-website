
<p>With the Node.js agent, you can add <a href="/docs/browser/new-relic-browser/getting-started/introduction-new-relic-browser">browser instrumentation</a> to your web pages. To use browser monitoring with your Node.js agent, ensure you have the <a href="/docs/agents/nodejs-agent/installation-configuration/installing-maintaining-nodejs#upgrading">latest release</a> of the Node.js agent.</p>
<p>To enable browser monitoring in the user interface, follow the procedures to <a href="/docs/browser/new-relic-browser/installation/install-new-relic-browser-agent">install the browser agent</a>. Then follow the procedures in this section to set up the Node.js agent.</p>
<h2>Insert the JavaScript header [#procedures]</h2>
<p>Instrumentation for the Node.js agent can continue beyond your application into end users' browsers. The <code>newrelic</code> module can generate <code>script</code> headers which, when inserted into your HTML templates, will capture the end users' page load times. The headers must be manually injected, but no extra configuration is necessary.</p>
<ol>
  <li>
    <p>At the beginning of your html page's <code>head</code> tag, insert the results of <code>newrelic.getBrowserTimingHeader()</code> after any <code>CHARSET</code> meta tags.</p>
    <p><strong>Exception:</strong> For maximum Internet Explorer compatibility, insert the results of <code>newrelic.getBrowserTimingHeader()</code> <strong>after</strong> any <code>X-UA-COMPATIBLE HTTP-EQUIV</code> meta tags.</p>
  </li>
  <li>
    <p>Call the header once for every request. Do not cache the header.</p>
  </li>
</ol>
<p>Generating headers is fast, and it does not require your application to make extra requests to New Relic.</p>
<h2>Framework examples [#variables]</h2>
<p>Here are some examples of how to set up browser monitoring with different frameworks and templates.</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZXhhbXBsZS1leHByZXNzIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJFeHByZXNzIGFuZCBqYWRlIn1d">
    <div data-prop-text="title">Express and jade</div>
    <p>This example uses <a href="http://expressjs.com">Express</a>, a web application framework, and <a href="http://jade-lang.com">jade</a>, a template module. Although the specifics are different with other frameworks, this general approach should work in most cases.</p>
    <p>The simplest way to insert browser timing headings is to pass the <code>newrelic</code> module into your template, and then call <code>newrelic.getBrowsertimingHeader()</code> from within the template.</p>
    <p>In your <code>app.js</code>:</p>
    <pre><code>var newrelic = require('newrelic');
var app = require('express')();
// in express, this lets you call newrelic from within a template
app.locals.newrelic = newrelic;

app.get('/user/:id', function (req, res) {
  res.render('user');
});
app.listen(process.env.PORT);

</code></pre>
    <pre><code>
doctype html
html
head
  != newrelic.getBrowserTimingHeader()
  title= title
  link(rel='stylesheet', href='stylesheets/style.css')
body
  block content

</code></pre>In your **layout.jade**:
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZXhhbXBsZS1leHByZXNzLXN3aWcifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IkV4cHJlc3MgYW5kIFN3aWcifV0=">
    <div data-prop-text="title">Express and Swig</div>
    <p>This example uses Express with <a href="https://github.com/paularmstrong/swig" title="Link opens in a new window">Swig</a>.</p>
    <p>In your <code>app.js</code>:</p>
    <pre><code>var newrelic = require('newrelic');

var http = require('http')
var path = require('path')
var swig = require('swig')

var app = require('express')();

app.locals.newrelic = newrelic;

//taken from http://paularmstrong.github.io/swig/docs/#express
app.engine('html', swig.renderFile);
app.set('view engine', 'html');
app.set('views', __dirname + '/views');

app.get('/user/:id', function (req, res) {
    res.render('user');
});

app.listen(process.env.PORT);

</code></pre>
    <pre><code>
&#x3C;!DOCTYPE html>
&#x3C;html>
    &#x3C;head>
        {{ newrelic.getBrowserTimingHeader() }}
        &#x3C;title>Hello&#x3C;/title>
    &#x3C;/head>
    &#x3C;body>
        &#x3C;h1>Hello World&#x3C;/h1>
    &#x3C;/body>
&#x3C;/html>

</code></pre>In your `views/user.html`:
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZXhhbXBsZS1oYXBpanMifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IkhhcGkuanMgYW5kIGhhbmRsZWJhcnMifV0=">
    <div data-prop-text="title">Hapi.js and handlebars</div>
    <p>This example uses <a href="http://hapijs.com/">hapi.js</a> and <a href="http://handlebarsjs.com">handlebars</a>. Other similar templating languages typically require triple brackets; for example, using <a href="https://mustache.github.io/mustache.5.html">mustache</a> with <a href="https://github.com/vol4ok/hogan-express">hogan-express</a>. This helps prevent escaping of the script content.</p>
    <p>Using <strong>hapi</strong>, in your <code>app.js</code>:</p>
    <pre><code>var newrelic = require('newrelic');
var Hapi = require('hapi');
var server = new Hapi.Server(parseInt(PORT), '0.0.0.0', {
    views: {
    engines : {html: 'handlebars' },
    path : __dirname + '/templates'
    }
});

function homepage(request, reply) {
    var context = {

    // pass in the header each request
    nreum : newrelic.getBrowserTimingHeader(),
    content : ...
};

reply.view('homepage', context);
};

server.route({
    method : 'GET',
    path : '/',
    handler : homepage
});

server.start();

</code></pre>
    <pre><code>
&#x3C;!DOCTYPE html>
&#x3C;html>
    &#x3C;head>
        {{{ nreum }}}
        &#x3C;title>Hello&#x3C;/title>
    &#x3C;/head>
    &#x3C;body>
        {{ content }}
    &#x3C;/body>
&#x3C;/html>

</code></pre>In your `templates/homepage.html`:
  </div>
</div>
<h2>Disable header generation [#disabling]</h2>
<p>By default, calls to <code>newrelic.getBrowserTimingHeader()</code> should return valid headers. To disable header generation without removing your template code: In your <code>newrelic.js</code> file, add:</p>
<pre><code>browser_monitoring : {
    enable : false
}
</code></pre>
<p>You can also set the environment variable <code>NEW_RELIC_BROWSER_MONITOR_ENABLE=false</code>.</p>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJjYXV0aW9uIn1d">
  <p>Always leave <code>ssl</code> between the agent and the New Relic collector when using browser monitoring.</p>
</div>
<p>You can safely leave the API calls in place even if you are not using browser monitoring or the <code>newrelic</code> module.</p>
<ul>
  <li>If browser monitoring is disabled, or if there is an error so that working headers cannot be generated, the <code>newrelic</code> module generates an innocuous HTML comment.</li>
  <li>If you disable the <code>newrelic</code> module completely, no content will be generated.</li>
</ul>
