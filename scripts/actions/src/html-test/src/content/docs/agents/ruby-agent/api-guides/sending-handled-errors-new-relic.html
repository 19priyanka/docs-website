
<p>To send error data that you are handling in your own code to New Relic, use the Ruby agent API <a href="http://www.rubydoc.info/github/newrelic/newrelic-ruby-agent/NewRelic/Agent#notice_error-instance_method"><code>NewRelic::Agent.notice_error</code></a> call within your error handler.</p>
<h2>Notify the New Relic Ruby agent of an error [#solution]</h2>
<p>This API call takes the exception and an optional options hash. Use this format:</p>
<pre><code>notice_error(exception, options = { }) â‡’ Object
</code></pre>
<p>This function records the given error and passes it through the normal error filtering process, including <a href="/docs/agents/ruby-agent/installation-configuration/ruby-agent-configuration#error_collector.ignore_errors">configuration-based ignoring of errors</a> and the global <code>#ignore_error_filter</code> method if defined.</p>
<p>The <code>exception</code> is the exception to be recorded, or an error message. If needed, you can also include <code>options = { }</code>. The following parameters will receive special treatment, and any other parameters you supply will be treated as custom parameters.</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p><strong>options = { }</strong></p>
      </div>
      <div>
        <p><strong>Comments</strong></p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p><code>:expected</code></p>
      </div>
      <div>
        <p><a href="/docs/agents/manage-apm-agents/agent-data/manage-errors-apm-collect-ignore-mark-expected#expected-links">Only records the error trace</a>. This does not affect the error rate or Apdex status. For information on expected errors in the UI, see <a href="/docs/agents/manage-apm-agents/agent-data/manage-errors-apm-collect-ignore-or-mark-expected#expected">View expected errors</a>.</p>
        <p>Replaces the <code>:trace_only</code> option, which was deprecated in version <a href="/docs/release-notes/agent-release-notes/ruby-release-notes/ruby-agent-430335">4.3.x</a> of the Ruby agent.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>:custom_params</code></p>
      </div>
      <div>
        <p>Custom parameters.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>:uri</code></p>
      </div>
      <div>
        <p>The request path, minus any request parameters or query string.</p>
        <p>Usually not needed. Include this only if you are calling <code>notice_error</code> outside a transaction.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>:metric</code></p>
      </div>
      <div>
        <p>The metric name associated with the transaction.</p>
        <p>Usually not needed. Include this only if you are calling <code>notice_error</code> outside a transaction.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>:request_params</code> (deprecated)</p>
      </div>
      <div>
        <p>Older Ruby agent versions allowed passing a <code>:request_params</code> option, but those are now ignored. If you need to record the request parameters, call this method inside a transaction, or pass the information in <code>:custom_params</code>.</p>
      </div>
    </div>
  </div>
</div>
