
<p>For security auditing purposes, the Ruby agent records all data sent to the New Relic collector to a log file in a human readable format. This feature is available with Ruby agent version 3.5.5 and higher.</p>
<h2>Configure the audit log [#configure]</h2>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJjYXV0aW9uIn1d">
  <p>Enable this feature only if you need detailed information on what is being transmitted for debugging or auditing purposes. Enabling this feature for an extended period of time may overload the audit log file.</p>
</div>
<p>The audit log is disabled by default, and it must be enabled manually. To enable, add the following to your <strong>newrelic.yml</strong> file: <code>audit_log.enabled: true</code>.</p>
<p>By default, the New Relic Ruby agent writes the audit log to a file next to the main New Relic agent log at <strong>log/newrelic_audit.log</strong>. To control the location of the audit log file, set the <code>audit_log.path</code> configuration parameter to the full path where you want the audit log.</p>
<h2>Audit log content [#content]</h2>
<p>The audit log file does not need special tools in order to be read. It contains two lines for each request that the New Relic agent makes to the New Relic collector:</p>
<ul>
  <li>The first line lists the host and URI path that the request was made against.</li>
  <li>The second line includes the full request body contents in a human-readable format.</li>
</ul>
<p>Request bodies in the audit log do not represent the exact byte-sequences sent to the New Relic collector, as they may have several layers of encoding applied before transmission to the New Relic collector. However, when they are dumped to the audit log, no other information is added to outgoing requests.</p>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJ0aXAifV0=">
  <p>To capture the raw request bodies in their encoded form, use a packet-capture tool such as <strong>tcpdump</strong>.</p>
</div>
<h2>Request body format [#format]</h2>
<p>The format of the request body depends on the communication format used by the agent:</p>
<ul>
  <li>Newer Ruby versions use JSON for data serialization, so the audit log will contain JSON representations of request bodies.</li>
  <li>Older Ruby versions use Ruby's native Marshal format to serialize request bodies. Because this is an opaque format, the audit log contains the result of calling <code>Object#inspect</code>. This produces a human-readable representation of the request object graph immediately before serialization.</li>
</ul>
