
<p>The New Relic Ruby agent supports the <a href="https://rubygems.org/gems/bunny">Bunny RabbitMQ client library</a>, giving you insight into the performance of your message processing, for both incoming and outgoing messages.</p>
<p>The APM UI shows transactions initiated via RabbitMQ message receipt (subscribe/consume messages) as <strong>Message</strong> background tasks. Message creation via RabbitMQ also appears in transaction traces.</p>
<h2>Requirements</h2>
<p>Requires New Relic <a href="/docs/release-notes/agent-release-notes/ruby-release-notes">Ruby agent version 4.3.0 or higher</a>. Instrumentation is automatic for <a href="/docs/agents/ruby-agent/getting-started/ruby-agent-requirements-supported-frameworks#other">supported versions of Bunny AMQP</a>, and requires no additional configuration.</p>
<h2>Performance improvements with background tasks [#background]</h2>
<p>One way to increase responsiveness of web applications is to delegate work to background processes. Message queues are commonly used for this inter-process communication.</p>
<p>In the context of message queuing systems, applications typically interact with message brokers to send and receive messages. The RabbitMQ Bunny client library allows Ruby applications to interface with message brokers that implement the Advanced Message Queuing Protocol (AMQP).</p>
<p>New Relic's Ruby agent shows messages sent and received using the RabbitMQ client library. With this visibility, you can see details including:</p>
<ul>
  <li>Number of messages produced by your app</li>
  <li>Time your app spends publishing messages</li>
  <li>Time your app spends processing "consumed" messages</li>
</ul>
<p><a href="#view-queue">APM</a> conveniently groups and reports operations that interact with queues. By analyzing this information, you can more easily identify bottlenecks and areas for performance improvement in your message passing architecture.</p>
<h2>Queue operations [#queue-ops]</h2>
<p>Supported entry points for queue operations appear as <code>Put</code> (publish a message) or <code>Take</code> (receive a message) in APM's user interface.</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p><strong>Queue operations</strong></p>
      </div>
      <div>
        <p><strong>Publish a message (<code>Put</code> in UI)</strong></p>
      </div>
      <div>
        <p><strong>Receive a message (<code>Take</code> in UI)</strong></p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p>RabbitMQ</p>
      </div>
      <div>
        <p><code>publish</code></p>
      </div>
      <div>
        <p><code>pop</code></p>
        <p><code>subscribe (with block)</code></p>
      </div>
    </div>
  </div>
</div>
<h2>View in New Relic UI [#view-queue]</h2>
<p>Message queue operations are visible in several places in the APM UI:</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoidmlldy1pbi10eG4tcGFnZSJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiVHJhbnNhY3Rpb25zIHBhZ2UifV0=">
    <div data-prop-text="title">Transactions page</div>
    <p>Queue operations appear on APM's <a href="/docs/apm/applications-menu/monitoring/transactions-dashboard"><strong>Transactions</strong> page</a> for the selected app. The <code>Put</code> and <code>Take</code> metrics appear in the <strong>Breakdown table</strong> and are categorized as <code>MessageBroker</code> metrics. Here is an example:</p>
    <p>
      <img src="./images/breakdown_table_0.png" alt="breakdown_table.png" title="breakdown_table.png">
    </p>
    <p><a href="/docs/apm/transactions/transaction-traces/transaction-traces">Transaction traces</a> also provide additional details for messages.</p>
    <div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJ0aXAifV0=">
      <p>You can <a href="/docs/apm/transactions/transaction-traces/viewing-transaction-traces">select transaction traces</a> from the app's <strong>Summary</strong> or <strong>Transactions</strong> pages in APM.</p>
    </div>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoidmlldy1pbi10eG4tdHJhY2Utc3VtbWFyeSJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiVHJhbnNhY3Rpb24gdHJhY2Ugc3VtbWFyeSBwYWdlIn1d">
    <div data-prop-text="title">Transaction trace summary page</div>
    <p>The <a href="/docs/apm/transactions/transaction-traces/transaction-trace-summary"><strong>Transaction trace summary</strong> page</a> may show <code>Put</code> and <code>Take</code> operations in the <strong>Slowest components</strong> section. For example:</p>
    <p>
      <img src="./images/transaction_trace_1_0.png" alt="transaction_trace.png" title="transaction_trace.png">
    </p>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoidmlldy1pbi10eG4tdHJhY2UtcGFnZSJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiVHJhbnNhY3Rpb24gdHJhY2UgbWVzc2FnZXMgdGFiIn1d">
    <div data-prop-text="title">Transaction trace messages tab</div>
    <p>The <strong>Transaction trace</strong> page includes a dedicated <strong>Messages</strong> tab that shows a summary of the message activity that occurred as part of the transaction. Here is an example:</p>
    <p>
      <img src="./images/messages_tab_0.png" alt="messages_tab.png" title="messages_tab.png">
    </p>
  </div>
</div>
