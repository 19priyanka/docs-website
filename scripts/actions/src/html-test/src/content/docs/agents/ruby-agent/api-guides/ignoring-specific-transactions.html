
<p>New Relic for Ruby allows you to selectively disable instrumentation for particular requests within your Rails or Sinatra application.</p>
<h2>Blocking all instrumentation [#ignore]</h2>
<p>Call <code>newrelic_ignore</code> with no arguments from within a Rails controller or Sinatra application to prevent instrumentation of all requests serviced by that controller or application:</p>
<pre><code>newrelic_ignore
</code></pre>
<p>Using <code>newrelic_ignore</code> prevents the agent from recording any performance data (metrics, transaction traces, events, traced errors, and so on) for the targeted transactions, and will also prevent the transactions from contributing to your overall Apdex score.</p>
<h2>Ignoring specific actions with Rails [#ignore-rails]</h2>
<p>If you want to ignore only specific actions with a Rails controller, you can use the <code>:only</code> or <code>:except</code> options with <code>newrelic_ignore</code>.</p>
<p>For example, to ignore only the <code>index</code> and <code>show</code> actions on the controller, use:</p>
<pre><code>newrelic_ignore :only => [:index, :show]
</code></pre>
<p>To ignore all actions on the controller <strong>except</strong> <code>index</code>:</p>
<pre><code>newrelic_ignore :except => [:index]
</code></pre>
<h2>Ignoring specific routes with Sinatra [#ignore-sinatra]</h2>
<p>If you want to ignore only specific routes within your Sinatra application, you can pass a Sinatra-style route definition to <code>newrelic_ignore</code> from within your Sinatra application. For more information, see <a href="/docs/agents/ruby-agent/frameworks/sinatra-support#ignoring-routes">Sinatra: Ignoring routes</a>.</p>
<h2>Ignoring Apdex contributions [#apdex]</h2>
<p>If you want to prevent all actions in a controller from contributing to your Apdex score, but still want other performance data, use <code>newrelic_ignore_apdex</code>:</p>
<pre><code>newrelic_ignore_apdex
</code></pre>
<p>In a Rails application, <code>newrelic_ignore_apdex</code> supports the same <a href="#ignore-rails"><code>:only</code> and <code>:except</code> options</a> as <code>newrelic_ignore</code>. In a Sinatra application, it will accept the <a href="#ignore-sinatra">same Sinatra-style route</a> for targeting specific transactions.</p>
<h2>Blocking Browser instrumentation [#page-load-timing-rum]</h2>
<p>Using <code>newrelic_ignore_enduser</code> prevents the agent from automatically inserting the JavaScript used to capture <a href="/docs/agents/ruby-agent/features/page-load-timing-ruby">browser monitoring</a> data. Server-side instrumentation will be unaffected.</p>
<p>To prevent Browser agent injection for all actions in a controller, add a call like this to the controller class:</p>
<pre><code>newrelic_ignore_enduser
</code></pre>
<p>In a Rails application, <code>newrelic_ignore_enduser</code> supports the same <a href="#ignore-rails"><code>:only</code> and <code>:except</code> options</a> as <code>newrelic_ignore</code>. In a Sinatra application, it will accept the <a href="#ignore-sinatra">same Sinatra-style route</a> for targeting specific transactions.</p>
<h2>Ignoring transactions dynamically [#dynamic-ignoring]</h2>
<p>In some cases, you may want to base the decision to ignore a specific transaction on criteria only known at runtime, during the request. For scenarios like this, the declarative mechanisms explained above aren't a good fit. Starting in Ruby agent version 3.9.2, you can instead use the following family of API calls from any point within your transaction:</p>
<pre><code>NewRelic::Agent.ignore_transaction
NewRelic::Agent.ignore_apdex
NewRelic::Agent.ignore_enduser
</code></pre>
<p>These methods will have a similar results to the <code>newrelic_ignore</code>, <code>newrelic_ignore_apdex</code>, and <code>newrelic_ignore_enduser</code> calls, but can be called during a request instead of during the class definition.</p>
<h2>Ignoring transactions by URL with configuration [#config-ignoring]</h2>
<p>You can ignore transactions by URL using the <code>rules.ignore_url_regexes</code> configuration setting:</p>
<pre><code>rules:
  ignore_url_regexes: ["secret", "^/admin"]
</code></pre>
<p>Note that regexes do not include any type of anchoring by default. The /secret/ regex will match 'newrelic.com/secret/login' and it will also match 'newrelic.com/users/secretpanda'. The anchored admin regex will match 'newrelic.com/admin/praetorians' but it will not match 'newrelic.com/users/totally-real-admin'.</p>
<p>If necessary you may also provide a list of regexes in a comma-separated string, allowing you to set ignore regexes with an environment variable:</p>
<pre><code>NEW_RELIC_RULES_IGNORE_URL_REGEXES="secret,^/admin"
</code></pre>
<p>As always configuration from environment variables will override configuration in newrelic.yml.</p>
<h2>Troubleshooting</h2>
<p>The <code>newrelic_ignore*</code> family of methods will only work from within Rails controller classes, or Sinatra applications (subclasses of <code>Sinatra::Base</code>). Other applications should use the <code>NewRelic::Agent.ignore_*</code> family of calls from within each request that you would like to ignore, which will work in any context.</p>
<p>If you get a <code>NoMethodError</code> when trying to use <code>newrelic_ignore</code> from within a Rails controller or Sinatra application, make sure that <code>newrelic_rpm</code> has been required before you try to call <code>newrelic_ignore</code> inside of your class definition.</p>
<h2>For more help [#more_help]</h2>
<p>Additional documentation resources include <a href="/docs/apm/new-relic-apm/apdex/apdex-measuring-user-satisfaction">Apdex: Measuring user satisfaction</a> (how Apdex is calculated).</p>
