
<p>Unless instructed otherwise, the standard installation for the PHP agent will automatically start the daemon if it detects that it is not running. The license key is configured for the agent in a PHP INI file, and it can be modified on a per-directory or per-virtual host basis. The daemon also is configured via the agent configuration (INI) file.</p>
<h2>Automatically starting newrelic-daemon (Agent mode) [#daemon-autostart]</h2>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJ0aXAifV0=">
  <p>Unless you have specific reasons to use the external startup mode, use this automatic configuration process. Most users find this to be the easiest and least error-prone, because configuration takes place in a single file, and you do not need to start up the daemon.</p>
</div>
<p>This mode uses settings in your INI file to configure the daemon. It also automatically starts the daemon if the agent detects the daemon is not already running. This is sometimes referred to as "agent mode."</p>
<p>In automatic startup mode:</p>
<ul>
  <li>Daemon configuration and all other global settings are in your global PHP ini file.</li>
  <li>The agent automatically starts the daemon each time it starts up (each time Apache/PHP-FPM restarts or when you start the agent on the command line).</li>
  <li>Write access permissions in the daemon log file control who may start the daemon.</li>
  <li>The startup header in the <code>php-agent.log</code> file includes "agent" to indicate automatic startup mode.</li>
</ul>
<p>To use the agent startup mode:</p>
<ol>
  <li>Ensure the daemon isn't running by executing <code>/etc/init.d/newrelic-daemon stop</code>.</li>
  <li>Ensure that <code>/etc/newrelic/newrelic.cfg</code> does <strong>not</strong> exist. If it does, move it elsewhere or remove it.</li>
  <li>Edit your INI file and set the <a href="/docs/agents/php-agent/configuration/php-agent-newrelicini-settings#inivar-daemon-settings">daemon-related options</a>. These options are also documented in the INI template file located at <code>/usr/lib/newrelic-php5/scripts/newrelic.ini.template</code>.</li>
  <li>Restart your web server or PHP process manager to pick up the new settings.</li>
</ol>
<h2>Selecting manual (External) mode [#selecting-external]</h2>
<p>In manual mode, you must start the daemon and the web server in order to start the agent. This is also referred to as "external" mode. Here are examples of why you may want to use manual mode instead of automatic startup mode:</p>
<ul>
  <li>You run a multi-tenant site where each customer has control over their own web service. You would not want all tenants to be running their own private copy of the daemon, so providing one that is started at system boot time and shared across all tenants better utilizes your system resources. Each customer can provide their own private license key in their INI files (or you provide the license keys on a virtual host basis).</li>
  <li>You want to retain the ability to shut the daemon down without affecting your web server uptime. This mode ensures that if you need to shut the daemon down, it will stay shut down until you reboot the system or explicitly start it again.</li>
  <li>You want the daemon to run as root (or some other user with appropriate permissions) so that the log file need not be exposed to anyone except root or a special user. The daemon log file has the <em>potential</em>, albeit a low one, to contain sensitive data.</li>
  <li>You are more comfortable with service daemons being started by traditional init scripts.</li>
</ul>
<h2>Manually starting <code>newrelic-daemon</code> (External mode) [#daemon-external]</h2>
<p>In manual (or external) startup mode:</p>
<ul>
  <li>Daemon configuration is in <code>newrelic.cfg</code>.</li>
  <li>The daemon starts up either at system boot time or by running its startup script.</li>
  <li>The log file and config file permissions control which users may start and stop the daemon.</li>
  <li>The startup header in the <code>php-agent.log</code> file includes <code>init</code> to indicate manual startup mode.</li>
</ul>
<p>If your daemon configuration file is located at <code>/etc/newrelic/newrelic.cfg</code>, the agent does not attempt to automatically start the daemon. If you have moved this file and still want to use this startup method, add the following to your global INI file: <code>newrelic.daemon.dont_launch = 3</code>.</p>
<p>If you want to use this external startup method:</p>
<ol>
  <li>
    <p>Go to:</p>
    <pre><code>cp /etc/newrelic/newrelic.cfg.template /etc/newrelic/newrelic.cfg
</code></pre>
  </li>
  <li>
    <p>Edit <code>/etc/newrelic/newrelic.cfg</code> and adjust any required values.</p>
  </li>
  <li>
    <p>Execute <code>/etc/init.d/newrelic-daemon restart</code>.</p>
  </li>
  <li>
    <p>Restart your web server or PHP process manager in order to pick up the new settings.</p>
  </li>
</ol>
