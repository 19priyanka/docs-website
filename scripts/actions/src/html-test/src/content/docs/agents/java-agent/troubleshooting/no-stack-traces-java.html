
<h2>Problem</h2>
<p>Depending on the situation, you may find <a href="/docs/apm/applications-menu/error-analytics/error-analytics-manage-error-traces">error traces</a> in the APM UI that do not include stack traces for your Java app.</p>
<h2>Solution</h2>
<p>Depending on the situation, follow these troubleshooting procedures.</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoicmVwZWF0ZWQtZXJyb3JzIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJObyBzdGFjayB0cmFjZXMgZm9yIHJhcGlkbHkgcmVwZWF0ZWQgZXJyb3JzIn1d">
    <div data-prop-text="title">No stack traces for rapidly repeated errors</div>
    <p>When an error is thrown in a rapidly repeated sequence, the Java compiler may optimize the stack trace away to help performance. To disable this optimization: In your JVM flags, include:</p>
    <pre><code>-XX:-OmitStackTraceInFastThrow

</code></pre>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiNTAwLWVycm9ycyJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiTm8gc3RhY2sgdHJhY2VzIGZvciA1MDAgZXJyb3JzIn1d">
    <div data-prop-text="title">No stack traces for 500 errors</div>
    <p>This is <a href="#cause">normal behavior</a> for how the Java agent handles 500 errors. To force stack traces to be reported, call the New Relic Java API from your own code. Running the <code>NewRelic.noticeError (Throwable t)</code> method will cause an error to be reported along with the stack backtrace represented by the <code>Throwable</code>. For more information about this method and its overloads, see New Relic's <a href="https://newrelic.github.io/java-agent-api/javadoc/com/newrelic/api/agent/NewRelic.html#noticeError-java.lang.Throwable-">Java agent API on GitHub.</a></p>
  </div>
</div>
<h2>Cause</h2>
<p>Returning a <code>500</code> error means that the application server itself detected an error and set the HTTPS <code>500</code> status code.</p>
<ul>
  <li>If the error condition was detected and handled by application logic, there was no exception object and thus, no stack.</li>
  <li>If there was an exception object at some point, but it was handled internally by the application code that set the <code>500</code> status on the response, then the exception never became visible to the Java agent. There is no stack available for the Java agent to report.</li>
</ul>
<p>When stack traces are reported, the error results from an exception that was not caught and handled within the application server logic. The Java agent sees the unhandled exception during a monitored transaction, so it reports the stack trace.</p>
<p>However, no stack traces appear for the <code>500</code> errors because the application server is handling the errors and then setting the status code. The application code itself does not retain any stack traces.</p>
