
<p>In New Relic's APM, the <strong>Node VMs</strong> page provides useful runtime data for troubleshooting performance issues and monitoring the health of your application.</p>
<h2>What you need [#requirements]</h2>
<p>Some of the charts on the <strong>Node VMs</strong> page require you to install the <a href="https://www.npmjs.com/package/@newrelic/native-metrics">New Relic Native Metrics Module</a> in addition to the Node.js agent. For installation instructions, see <a href="/docs/agents/nodejs-agent/supported-features/node-vm-measurements">Node VM Measurements</a>.</p>
<h2>View Node VM statistics [#view-data]</h2>
<p>
  <img src="./images/vm-dashboard.png" alt="New Relic APM - Node VMs page 1.png" title="New Relic APM - Node VMs page 1.png">
</p>
<p><strong><a href="http://one.newrelic.com">one.newrelic.com</a> > APM > (select an app) > Node VMs</strong>: When multiple servers are reporting to the same application, the page breaks charts down by server. You can view data for an individual server and obtain additional details by selecting a server from the <strong>Servers</strong> filter at the top of the page.</p>
<p>To correlate spikes or upward trends in any of these measurements with specific transactions:</p>
<ol>
  <li>Go to <strong><a href="http://one.newrelic.com">one.newrelic.com</a></strong> <strong>> APM > (select an app) > Node VMs</strong>.</li>
  <li>Select the time period by clicking and dragging within any of the charts.</li>
  <li>Navigate to the <a href="/docs/apm/applications-menu/monitoring/transactions-page">Transactions page</a> or any other page.</li>
</ol>
<p>As you go to other pages, the <a href="/docs/data-analysis/user-interface-functions/view-your-data/time-picker-setting-time-periods-view-data">time picker</a> selection will remain the same.</p>
<h2>Analyze performance issues [#node-vm-charts]</h2>
<p>Here is a summary of the data available on individual <strong>Node VM</strong> charts. By using all of the charts together, you can troubleshoot performance issues. For example:</p>
<ul>
  <li>When the application starts using more objects, memory usage will increase, and garbage collection (GC) will run more frequently. CPU utilization will increase due to time spent in GC.</li>
  <li>Abnormally long synchronous code execution can increase CPU utilization. This will show spikes in the <strong>Event loop max CPU time per tick</strong> chart.</li>
</ul>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoidGltZS1pbi1nYXJiYWdlLWNvbGxlY3Rpb24ifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IkdDIHBhdXNlIHRpbWUifV0=">
    <div data-prop-text="title">GC pause time</div>
    <p>The amount of time spent in garbage collection. For a single server, the chart shows average, max, and total time per minute. For multiple servers, the chart shows total time grouped by server.</p>
    <p>Typically, spikes in GC time or frequency indicate a potential issue.</p>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZ2MtcGF1c2UtZnJlcXVlbmN5In0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJHQyBwYXVzZSBmcmVxdWVuY3kifV0=">
    <div data-prop-text="title">GC pause frequency</div>
    <p>The number of times GC runs were executed per minute. For a single server, the chart is broken down by the type of GC. For multiple servers, the chart shows total number of GC calls (all types combined) grouped by server.</p>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZ2MtcGF1c2UtdGltZS1ieS10eXBlIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJHQyBwYXVzZSB0aW1lIGJ5IHR5cGUifV0=">
    <div data-prop-text="title">GC pause time by type</div>
    <p>This chart shows the total time spent in garbage collection per minute, broken down by GC type. It is only shown when viewing a single server. You might see the following types depending on your version of Node.js and app activity:</p>
    <div data-component="Table" data-prop="W10=">
      <div>
        <div>
          <div>
            <p><strong>Value</strong></p>
          </div>
          <div>
            <p><strong>Description</strong></p>
          </div>
        </div>
      </div>
      <div>
        <div>
          <div>
            <p><code>Scavenge</code></p>
          </div>
          <div>
            <p>The most common garbage collection method. Node.js will typically trigger one of these every time the VM is idle.</p>
          </div>
        </div>
        <div>
          <div>
            <p><code>MarkSweepCompact</code></p>
          </div>
          <div>
            <p>The heaviest type of garbage collection V8 may do. If you see many of these happening you will need to either keep fewer objects around in your process or increase V8's heap limit.</p>
          </div>
        </div>
        <div>
          <div>
            <p><code>IncrementalMarking</code></p>
          </div>
          <div>
            <p>A phased garbage collection that interleaves collection with application logic to reduce the amount of time the application is paused. Only in Node.js v6 or higher.</p>
          </div>
        </div>
        <div>
          <div>
            <p><code>ProcessWeakCallbacks</code></p>
          </div>
          <div>
            <p>After a garbage collection occurs, V8 will call any weak reference callbacks registered for objects that have been freed. This measurement is from the start of the first weak callback to the end of the last for a given garbage collection. Only in Node.js v6 or higher.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoibWVtb3J5In0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJNZW1vcnkgdXNhZ2UifV0=">
    <div data-prop-text="title">Memory usage</div>
    <p>This chart shows the amount of memory consumed by the Node.js process. For multiple servers, the chart shows total memory grouped by server. For a single server, the chart is segmented by the following types of memory:</p>
    <div data-component="Table" data-prop="W10=">
      <div>
        <div>
          <div>
            <p><strong>Value</strong></p>
          </div>
          <div>
            <p><strong>Description</strong></p>
          </div>
        </div>
      </div>
      <div>
        <div>
          <div>
            <p>Non-heap</p>
          </div>
          <div>
            <p>The memory allocated to data outside V8's heap (for example, buffers, sockets).</p>
          </div>
        </div>
        <div>
          <div>
            <p>V8 heap (used)</p>
          </div>
          <div>
            <p>The amount of memory being used by V8 (for example, JavaScript objects).</p>
          </div>
        </div>
        <div>
          <div>
            <p>V8 heap (free)</p>
          </div>
          <div>
            <p>The amount of memory set aside by V8 for memory pooling. This memory isn't being actively used, but is set aside for V8 to freely allocate more as needed.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiY3B1In0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJDUFUgdXRpbGl6YXRpb24ifV0=">
    <div data-prop-text="title">CPU utilization</div>
    <p>This chart shows the CPU utilization of the Node process.</p>
    <p>For multiple servers, the chart shows total CPU utilization grouped by server. For a single server, the chart is segmented by the following:</p>
    <div data-component="Table" data-prop="W10=">
      <div>
        <div>
          <div>
            <p><strong>Value</strong></p>
          </div>
          <div>
            <p><strong>Description</strong></p>
          </div>
        </div>
      </div>
      <div>
        <div>
          <div>
            <p>User</p>
          </div>
          <div>
            <p>The time spent executing the user code, divided by wall-clock time.</p>
          </div>
        </div>
        <div>
          <div>
            <p>System</p>
          </div>
          <div>
            <p>The time spent in the system kernel on behalf of the Node process, divided by wall-clock time.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZXZlbnQtbG9vcCJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiRXZlbnQgbG9vcCDigJQgdGlja3MgcGVyIG1pbnV0ZSJ9XQ==">
    <div data-prop-text="title">Event loop — ticks per minute</div>
    <p>This chart shows the number of event loop ticks per minute. A tick is a single turn of the event loop, in which functions that are ready to be executed are run.</p>
    <p>As a part of each event loop turn, Node waits for pending I/O to complete. Once any I/O events are received, the event loop executes callbacks associated with it. Therefore, the number of ticks per minute corresponds to how frequently I/O events occur.</p>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZXZlbnQtbG9vcC1jcHUifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IkV2ZW50IGxvb3Ag4oCUIG1heCBDUFUgdGltZSBwZXIgdGljayJ9XQ==">
    <div data-prop-text="title">Event loop — max CPU time per tick</div>
    <p>This chart shows the maximum time spent in a single tick per minute. This is useful with detecting an abnormally long event loop tick, which indicates long synchronous code execution.</p>
  </div>
</div>
<h2>View clusters of multiple processes [#clustering]</h2>
<p>When multiple Node.js processes on the same server report to the same New Relic application, these charts will show aggregated data. This is because each worker process in a cluster has its own separate Node.js runtime and collects separate data.</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p><strong>Clusters</strong></p>
      </div>
      <div>
        <p><strong>Comments</strong></p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p>Sum across all workers</p>
      </div>
      <div>
        <p>The following charts show a sum across all workers:</p>
        <ul>
          <li>GC pause time - Total time per minute</li>
          <li>GC pause frequency</li>
          <li>GC pause time by type</li>
          <li>CPU utilization</li>
          <li>Event loop ticks per minute</li>
        </ul>
      </div>
    </div>
    <div>
      <div>
        <p>Average from all workers</p>
      </div>
      <div>
        <p>The following charts show an average from all workers:</p>
        <ul>
          <li>Memory usage</li>
          <li>GC pause time — average</li>
        </ul>
      </div>
    </div>
    <div>
      <div>
        <p>Max across all workers</p>
      </div>
      <div>
        <p>The following charts show max across all workers:</p>
        <ul>
          <li>GC pause time — max</li>
          <li>Event loop — max CPU time per tick</li>
        </ul>
      </div>
    </div>
  </div>
</div>
