
<p>With our <a href="/docs/agents/go-agent/get-started/introduction-new-relic-go">Go agent</a>, you can monitor applications that reside in the <a href="https://cloud.google.com/appengine/docs/flexible/go/">Google App Engine (GAE) flexible environment</a>. Adding New Relic to your GAE flex app gives you insight into the health and performance of your app and extends GAE with metrics you can view in <a href="/docs/apm/new-relic-apm/getting-started/introduction-new-relic-apm">APM</a> and <a href="/docs/browser/new-relic-browser/getting-started/introduction-new-relic-browser">browser monitoring</a>.</p>
<p>Here we explain how to add New Relic to your GAE flex app by configuring a <a href="https://cloud.google.com/appengine/docs/flexible/custom-runtimes/about-custom-runtimes">custom runtime</a>, and give an example of deploying a Go app with Docker.</p>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
  <p>The Go agent can run in a GAE flexible environment using a custom runtime. Due to limitations of other environments, do not use the GAE standard environment or Google App Engine's <a href="/docs/accounts-partnerships/partnerships/google-cloud-platform-gcp/google-app-engine-environment#native-mode">"native mode"</a> installation.</p>
</div>
<h2>Build a custom runtime using Docker [#build-runtime]</h2>
<p>See <a href="https://cloud.google.com/appengine/docs/flexible/custom-runtimes/build">Google's documentation for building custom runtimes</a>. This example describes how to add New Relic to your GAE flex app by installing the Go agent, building a custom Go runtime for Docker, and deploying a golang application.</p>
<p>For more information about deploying and configuring your Go app in the GAE flexible environment, see:</p>
<ul>
  <li><a href="https://cloud.google.com/appengine/docs/flexible/go/">Google App Engine's documentation</a> for Go</li>
  <li><a href="https://cloud.google.com/appengine/docs/flexible/go/tutorials">Google App Engine's tutorials</a> to deploy a Go app</li>
</ul>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoic2V0dXAtZ2FlIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiIxLiBTZXQgdXAgdGhlIEdBRSBwcm9qZWN0IGFuZCBpbnN0YWxsIGRlcGVuZGVuY2llcyJ9XQ==">
    <div data-prop-text="title">1. Set up the GAE project and install dependencies</div>
    <ol>
      <li>
        <p>Follow standard procedures to <a href="/docs/agents/go-agent/get-started/get-new-relic-go">install the Go agent</a> for your specific app server, including your <a href="/docs/accounts-partnerships/accounts/account-setup/license-key">license key</a>.</p>
      </li>
      <li>
        <p>Follow <a href="https://cloud.google.com/appengine/docs/flexible/go/quickstart">Google App Engine procedures for Go</a> to create a new Cloud Platform project, create an App Engine application, download and install <a href="https://git-scm.com">git</a>, and complete other prerequisites for the <a href="https://cloud.google.com/sdk/docs/">Google Cloud SDK</a>.</p>
        <p>The Google Cloud SDK provides the <code>gcloud</code> command line tool to manage and deploy GAE apps.</p>
      </li>
    </ol>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiY29uZmlndXJlLWFwcC15YW1sIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiIyLiBDb25maWd1cmUgeW91ciBhcHAueWFtbCJ9XQ==">
    <div data-prop-text="title">2. Configure your app.yaml</div>
    <p>The <code>app.yaml</code> configuration file is required for a GAE flexible environment app with a custom runtime. At a minimum, make sure it contains:</p>
    <pre><code>runtime: custom
env: flex

</code></pre>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiY29uZmlndXJlLWRvY2tlcmZpbGUifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IjMuIENvbmZpZ3VyZSBhIERvY2tlcmZpbGUifV0=">
    <div data-prop-text="title">3. Configure a Dockerfile</div>
    <p>The <a href="http://docs.docker.com/engine/reference/builder/">Dockerfile</a> defines the Docker image to be built and is required for a GAE flexible environment app. The following Dockerfile example code defines the golang version used.</p>
    <pre><code>FROM golang:1.8-onbuild
CMD go run main.go

</code></pre>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiYnVpbGQtZG9ja2VyLWltYWdlIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiI0LiBCdWlsZCBhIERvY2tlciBpbWFnZSJ9XQ==">
    <div data-prop-text="title">4. Build a Docker image</div>
    <p>To build the Docker image, run the following command. Be sure to include the period at the end of the code, to indicate the current directory contains the build files.</p>
    <pre><code>docker build --rm -t Docker-image-name .

</code></pre>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZGVwbG95LWRvY2tlci1pbWFnZS10by1nYWUifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IjUuIERlcGxveSBEb2NrZXIgaW1hZ2UgdG8gaW5pdGlhbGl6ZWQgR0FFIGZsZXhpYmxlIGVudmlyb25tZW50In1d">
    <div data-prop-text="title">5. Deploy Docker image to initialized GAE flexible environment</div>
    <ol>
      <li>
        <p>To deploy your Docker image to your <a href="https://cloud.google.com/sdk/docs/initializing">initialized GAE flexible environment</a>, run the following command:</p>
        <pre><code>gcloud --project go-app-name app deploy
</code></pre>
      </li>
      <li>
        <p>Wait until the deployment completes.</p>
      </li>
      <li>
        <p>To view your GAE flex app data in New Relic, go to the <a href="/docs/apm/applications-menu/monitoring/apm-overview-page">APM <strong>Summary</strong> page</a>.</p>
      </li>
    </ol>
  </div>
</div>
<h2>Recommendation: Disable health checks [#health-checks]</h2>
<p>Google App Engine sends <a href="https://cloud.google.com/appengine/docs/flexible/go/configuring-your-app-with-app-yaml#health_checks">periodic health check requests</a> to confirm that an instance has been successfully deployed, and to check that a running instance maintains a healthy status. A health check is an HTTP request to the URL <code>/_ah/health</code>.</p>
<p>If you create a custom runtime, your app must be able to handle a large number of health check requests. Otherwise, your app data may not display correctly in APM.</p>
<p><strong>Recommendation:</strong> Configure your <code>app.yaml</code> to disable health checks by adding:</p>
<pre><code>health_check:
  enable_health_check: False
</code></pre>
<h2>Get agent troubleshooting logs from GAE [#agent-logs]</h2>
<p>Use these resources to troubleshoot your GAE flex environment app:</p>
<ul>
  <li>
    <p>To connect to the GAE instance and start a shell in the Docker container running your code, see <a href="https://cloud.google.com/appengine/docs/flexible/go/debugging-an-instance">GAE's documentation for debugging an instance</a>.</p>
  </li>
  <li>
    <p>To redirect New Relic Go agent logs to <a href="http://cloud.google.com/logging/docs/view/logs_viewer_v2">Stackdriver</a> in the <a href="https://cloud.google.com/compute/docs/console">Cloud Platform Console</a>, change the <code>newrelic.yml</code> file to:</p>
    <pre><code>log_file_name: STDOUT
</code></pre>
  </li>
</ul>
