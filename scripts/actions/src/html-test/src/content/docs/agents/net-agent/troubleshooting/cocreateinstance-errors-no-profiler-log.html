
<h2>Problem</h2>
<p>After you generate traffic and wait a few minutes, your .NET application does not report data to New Relic. In addition, there is no New Relic profiler log for your .NET app.</p>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
  <p>If you are an Azure Websites user experiencing <code>CoCreateInstance</code> errors, get support at <a href="https://support.newrelic.com">support.newrelic.com</a>.</p>
</div>
<h2>Solution</h2>
<p>To verify whether New Relic has the necessary permissions and resolve the problem, follow these troubleshooting steps.</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiY2xzaWQtZXJyb3JzIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJDaGVjayBmb3IgcHJvZmlsZXIgQ0xTSUQgZXJyb3JzLiJ9XQ==">
    <div data-prop-text="title">Check for profiler CLSID errors.</div>
    <p>To verify whether the permissions error is due to profiler errors:</p>
    <ol>
      <li>
        <p>Check your application event log for errors like this:</p>
        <pre><code>NET Runtime version 4.0.30319.296 - Loading profiler failed during CoCreateInstance. Profiler CLSID: '{FF68FEB9-E58A-4B75-A2B8-90CE7D915A26}'
</code></pre>
      </li>
      <li>
        <p>Compare the CLSID in the error to New Relic's CLSIDs:</p>
        <pre><code>71DA0A04-7777-4EC6-9643-7D28B46A8A41
FF68FEB9-E58A-4B75-A2B8-90CE7D915A26
</code></pre>
      </li>
      <li>
        <p>Do one of the following:</p>
        <ul>
          <li>If the CLSID does not match, <a href="/docs/agents/net-agent/troubleshooting/cocreate-errors-no-event-log">uninstall the other profiler</a>.</li>
          <li>If the CLSID does match, continue with this procedure to check the profiler logs for <code>CoCreateInstance</code> permissions errors.</li>
        </ul>
      </li>
    </ol>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoibXNjb3JsaWIifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IlZlcmlmeSB0aGUgTmV3IFJlbGljIGFzc2VtYmxpZXMuIn1d">
    <div data-prop-text="title">Verify the New Relic assemblies.</div>
    <p>To verify that the New Relic assemblies are attached to the <code>w3wp.exe</code> process:</p>
    <ol>
      <li>
        <p>On the server where your app is installed, <a href="https://technet.microsoft.com/en-us/sysinternals/bb896653.aspx">download the Microsoft Windows <strong>Sysinternals Process Explorer</strong></a>.</p>
      </li>
      <li>
        <p>Unzip the file and run <code>procexp.exe</code> as an Administrator.</p>
      </li>
      <li>
        <p>Select <strong>View > Show Lower Pane</strong>, then select <strong>View > Lower Pane View > DLLs</strong>.</p>
      </li>
      <li>
        <p>Generate some traffic to your app.</p>
      </li>
      <li>
        <p>To update the process list, select <strong>View > Refresh Now</strong>.</p>
      </li>
      <li>
        <p>In the top pane, select your service or <code>w3wp</code> instance (typically nested under a <code>svchost.exe</code> process).</p>
      </li>
      <li>
        <p>In the bottom pane, look for assemblies whose names begin with <code>NewRelic</code>, including:</p>
        <pre><code>NewRelic.Agent.Core.dll
NewRelic.Profiler.dll
NewRelic.Agent.IL.dll
NewRelic.ICSharpCode.SharpZipLib.dll
NewRelic.Json.dll
NewRelic.Log.dll
</code></pre>
      </li>
      <li>
        <p>If you do not find any assemblies, get support at <a href="https://support.newrelic.com">support.newrelic.com</a></p>
      </li>
    </ol>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoidzN3cCJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiVmVyaWZ5IHRoZSB3M3dwLmV4ZSBlbnZpcm9ubWVudCBkZXRhaWxzLiJ9XQ==">
    <div data-prop-text="title">Verify the w3wp.exe environment details.</div>
    <p>Verify that the <code>w3wp.exe</code> environment details are this:</p>
    <pre><code>COR_ENABLE_PROFILING=1
COR_PROFILER={71DA0A04-7777-4EC6-9643-7D28B46A8A41}
NEWRELIC_INSTALL_PATH=C:\Program Files\New Relic\.NET Agent\

</code></pre>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiYWxsdXNlcnNwcm9maWxlIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJDaGVjayBmb3IgcHJvZmlsZXIgbG9ncy4ifV0=">
    <div data-prop-text="title">Check for profiler logs.</div>
    <p>Check for profiler logs in <code>%ALLUSERSPROFILE%\New Relic\.NET Agent\Logs</code>.</p>
    <ul>
      <li>Make sure there are <strong>no</strong> profiler logs for the web app you are troubleshooting.</li>
      <li>If you have a simple or default site installation, ignore any profiler logs for other web apps.</li>
    </ul>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZXZlcnlvbmUtZ3JvdXAifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IlJlc29sdmUgdGhlIHBlcm1pc3Npb25zIGVycm9yLiJ9XQ==">
    <div data-prop-text="title">Resolve the permissions error.</div>
    <p>If all the above conditions are present, you have a permissions error. Use any of these options to resolve the permissions error as applicable:</p>
    <div data-component="Table" data-prop="W10=">
      <div>
        <div>
          <div>
            <p><strong>Available options</strong></p>
          </div>
          <div>
            <p><strong>Resolve permissions errors</strong></p>
          </div>
        </div>
      </div>
      <div>
        <div>
          <div>
            <p>Set permissions for the <strong>Everyone</strong> group.</p>
          </div>
          <div>
            <p>Adjust permissions in the following folders for the <strong>Everyone</strong> group to give the group all permissions <strong>except</strong> <code>Full Control</code>:</p>
            <pre><code>C:\Program Files\New Relic\.NET Agent\

</code></pre>
            <pre><code>
C:\Program Files (x86)\New Relic\.NET Agent\

</code></pre>
          </div>
        </div>
        <div>
          <div>
            <p>Set permissions for individual users.</p>
          </div>
          <div>
            <p>If your security policies do not allow adjusting permissions for the <strong>Everyone</strong> group, then adjust permissions for individual users. Record the users under which your application runs, then adjust permissions for each of those users.</p>
          </div>
        </div>
        <div>
          <div>
            <p>Set permissions using the PowerShell script.</p>
          </div>
          <div>
            <p>To add permissions to <code>HKLM\SOFTWARE\New Relic</code> by using the PowerShell script:</p>
            <pre><code>$key = "HKLM:\SOFTWARE\New Relic"
$acl = Get-Acl $key
$AddACL = New-Object System.Security.AccessControl.RegistryAccessRule ("Everyone","FullControl","ObjectInherit,ContainerInherit","None","Allow")
$acl.SetAccessRule($AddACL)
$acl |Set-Acl -Path $key

</code></pre>For 32-bit apps, the path would be `HKLM:\SOFTWARE\Wow6432Node\New Relic`
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
