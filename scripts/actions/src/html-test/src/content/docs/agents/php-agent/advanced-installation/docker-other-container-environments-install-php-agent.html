
<p>You can install the <a href="/docs/agents/php-agent/getting-started/introduction-new-relic-php">PHP agent</a> on a Docker container (or other container) to monitor one or more of your PHP applications. This is supported only for containers that meet <a href="/docs/agents/php-agent/getting-started/php-agent-compatibility-requirements">PHP agent requirements</a>.</p>
<h2>Container options [#overview]</h2>
<p>The PHP agent requires two components to work: the PHP agent (one for each application) and a <a href="/docs/agents/php-agent/getting-started/new-relic-daemon-processes">daemon</a>, which aggregates data sent from one or more agents and sends it to New Relic. For this reason, there are two options for enabling the PHP agent for container environments:</p>
<ul>
  <li><a href="#install-diff-containers">Install agent and daemon on different containers.</a> This is the recommended setup.</li>
  <li><a href="#install-same-container">Install agent and daemon on the same container.</a> This may be useful if you want to reduce your number of containers.</li>
</ul>
<h2>Install agent and daemon in different containers [#install-diff-containers]</h2>
<p>Requirements:</p>
<ul>
  <li>Meet <a href="/docs/agents/php-agent/getting-started/php-agent-compatibility-requirements">PHP agent requirements</a></li>
  <li>PHP agent version 9.2 or higher</li>
</ul>
<h3>Set up the daemon container: [#daemon-container]</h3>
<p>If you use Docker, you can pull our daemon image from <a href="https://hub.docker.com/r/newrelic/php-daemon">Docker Hub</a>:</p>
<ol>
  <li>Run this command: <code>docker pull newrelic/php-daemon</code></li>
  <li>To customize the image, follow the steps on <a href="https://hub.docker.com/r/newrelic/php-daemon">Docker Hub</a>.</li>
</ol>
<p>You can also build your own daemon image:</p>
<ol>
  <li>To install the daemon, download the PHP agent package from New Relic's <a href="/docs/agents/php-agent/installation/php-agent-installation-tar-file">tar file download site</a> and run the <code>newrelic-install</code> script with the <code>install_daemon</code> argument.</li>
  <li>Start the daemon using <code>--address</code> and <code>--watchdog-foreground</code> arguments. The <code>--address</code> argument is used to set a port the daemon is accepting connections on. The <code>--watchdog-foreground</code> argument ensures that the daemon runs in the foreground.</li>
</ol>
<h3>Set up the PHP agent container: [#agent-container]</h3>
<ol>
  <li>Make sure a PHP installation is available in the container. For example: you might use a published Docker image like <code>php:7.1</code>.</li>
  <li>To install the agent, download the PHP agent package from New Relic's <a href="/docs/agents/php-agent/installation/php-agent-installation-tar-file">tar file download site</a> and run the <code>newrelic-install</code> script with the <code>install</code> argument.</li>
  <li>Set the application name and <a href="/docs/accounts/install-new-relic/account-setup/license-key">license key</a> via the <code>newrelic.license</code> and <code>newrelic.appname</code> entries in the <code>newrelic.ini</code> file.</li>
  <li>Point the agent to the daemon by setting the <code>newrelic.daemon.address</code> option in the <code>newrelic.ini</code> file. The value for this option needs to be <code>HOST:PORT</code>, where <code>HOST</code> is the name or IP address of the host the daemon is running on, <code>PORT</code> is the port number the daemon is listening on.</li>
</ol>
<p>An example application can be found at <a href="https://discuss.newrelic.com/t/relic-solution-php-agent-and-daemon-containers/84841">New Relic's Explorers Hub</a>.</p>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJjYXV0aW9uIn1d">
  <p>Data transmitted from the agent to the daemon is <strong>not</strong> encrypted. The only exception to this is the <a href="https://docs.newrelic.com/docs/agents/php-agent/configuration/php-agent-configuration#inivar-tt-sql">SQL obfuscation</a> that happens before sending data to the daemon. We recommend only using a private network connection between the agent and daemon (this only applies when the agent and daemon are running on different hosts).</p>
</div>
<h2>Install agent and daemon in the same container [#install-same-container]</h2>
<ol>
  <li>Make sure a PHP installation is available in the container. For example: you might use a published Docker image like <code>php:7.1</code>.</li>
  <li>To install the agent, download the PHP agent package from New Relic's <a href="/docs/agents/php-agent/installation/php-agent-installation-tar-file">tar file download site</a> and run the <code>newrelic-install</code> script with the <code>install</code> argument.</li>
  <li>Set the application name and <a href="/docs/accounts/install-new-relic/account-setup/license-key">license key</a> via the <code>newrelic.license</code> and <code>newrelic.appname</code> entries in the <code>newrelic.ini</code> file.</li>
  <li>By default, the first transaction causes the agent to trigger a daemon start and an application connection initialization. However, for performance reasons, the agent does not wait for those operations to complete before it initializes the connection, which can result in the loss of the first few transactions after a container starts. To prevent this, set both <code>newrelic.daemon.start_timeout</code> and <code>newrelic.daemon.app_connect_timeout</code> entries in the <code>newrelic.ini</code> file to recommended values.</li>
</ol>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZG9ja2VyZmlsZS1leGFtcGxlIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJEb2NrZXJmaWxlIGV4YW1wbGUifV0=">
    <div data-prop-text="title">Dockerfile example</div>
    <pre><code>FROM php:7.1

RUN \
  curl -L PHP_AGENT_URL | tar -C /tmp -zx &#x26;&#x26; \
  export NR_INSTALL_USE_CP_NOT_LN=1 &#x26;&#x26; \
  export NR_INSTALL_SILENT=1 &#x26;&#x26; \
  /tmp/newrelic-php5-*/newrelic-install install &#x26;&#x26; \
  rm -rf /tmp/newrelic-php5-* /tmp/nrinstall* &#x26;&#x26; \
  sed -i \
      -e 's/"REPLACE_WITH_REAL_KEY"/"YOUR_LICENSE_KEY"/' \
      -e 's/newrelic.appname = "PHP Application"/newrelic.appname = "YOUR_APPLICATION_NAME"/' \
      -e 's/;newrelic.daemon.app_connect_timeout =.*/newrelic.daemon.app_connect_timeout=15s/' \
      -e 's/;newrelic.daemon.start_timeout =.*/newrelic.daemon.start_timeout=5s/' \
      /usr/local/etc/php/conf.d/newrelic.ini

</code></pre>There are three parts that you must edit this example Dockerfile:
    * `PHP_AGENT_URL`: The download URL for the desired PHP agent version. Find the most recent version of the agent here: [https://download.newrelic.com/php_agent/release/](https://download.newrelic.com/php_agent/release/ "Link opens in a new window.")
    * `YOUR_LICENSE_KEY`: Replace this with your [New Relic license key](https://docs.newrelic.com/docs/accounts/install-new-relic/account-setup/license-key). Note that `"REPLACE_WITH_REAL_KEY"` is an actual string in the default **newrelic.ini** file for the PHP agent. Don't edit that string. The sed command replaces that default string with the actual 40-character key, in quotes.
    * `YOUR_APPLICATION_NAME`: Replace with the your application name, in quotes.
  </div>
</div>
