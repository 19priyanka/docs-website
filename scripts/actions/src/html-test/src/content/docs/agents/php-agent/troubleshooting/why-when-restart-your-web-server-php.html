
<h2>Problem</h2>
<p>You are unsure why or when you must restart your web server (Apache, PHP-FPM, Nginx, etc.) after:</p>
<ul>
  <li><a href="/docs/agents/php-agent/installation/php-agent-installation-overview">Installing</a> or <a href="/docs/agents/php-agent/installation/upgrading-php-agent">upgrading</a> the PHP agent</li>
  <li><a href="/docs/agents/php-agent/troubleshooting/agent-stops-working-after-updating-php">Updating PHP</a> to a major release version</li>
  <li>Changing any agent <a href="/docs/agents/php-agent/configuration/php-agent-configuration">configuration settings</a> in the <code>newrelic.ini</code> or <code>newrelic.cfg</code> files</li>
  <li>Utilizing <a href="/docs/agents/php-agent/advanced-installation/starting-php-daemon-advanced#selecting-external">external startup mode</a> for the daemon</li>
</ul>
<h2>Cause</h2>
<p>The PHP agent is a PHP extension. When your web server starts up and loads PHP, it also loads the PHP agent and parses its <code>newrelic.ini</code> configuration file. The web server uses that configuration until told to re-load and parse configuration files again. Restarting prompts the web server to do that.</p>
<p>You must restart your web server when:</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiY29uZmlnIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJZb3UgbW9kaWZ5IHlvdXIgY29uZmlndXJhdGlvbiBmaWxlLiJ9XQ==">
    <div data-prop-text="title">You modify your configuration file.</div>
    <p>Configuration changes in <code>newrelic.ini</code> or <strong><code>newrelic.cfg</code></strong> files <a href="/docs/agents/php-agent/troubleshooting/ini-settings-not-taking-effect-immediately">do not take effect</a> (for example, naming your app, generating logs, changing your license key) until you restart the web server.</p>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoicGFja2FnZS1tYW5hZ2VyLWF1dG8tdXBkYXRlIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJZb3VyIHBhY2thZ2UgbWFuYWdlciBhdXRvLXVwZGF0ZXMgdGhlIGFnZW50IHdpdGhvdXQgcmVzdGFydGluZyB0aGUgd2ViIHNlcnZlci4ifV0=">
    <div data-prop-text="title">Your package manager auto-updates the agent without restarting the web server.</div>
    <div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJ0aXAifV0=">
      <p>To avoid this situation, set an exclude for <code>newrelic-php5*</code> in your package manager.</p>
    </div>
    <p>If your package manager automatically <a href="/docs/agents/php-agent/installation/upgrading-php-agent">updates the agent</a>, you must restart your web server. Updating the agent without restarting can cause the agent to stop reporting.</p>
    <p>This issue occurs when auto-update is enabled and the daemon updates to a new version. The new daemon is then unable to communicate with the agent, which is still running the old version.</p>
    <p>To avoid this, the new agent must be started after the update. This process is complicated, because a full agent restart also requires you to restart your web server software.</p>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZGFlbW9uLWV4dGVybmFsLW1vZGUifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IlRoZSBkYWVtb24gaXMgc2V0IHRvIHN0YXJ0IHVwIGluIGV4dGVybmFsIG1vZGUuIn1d">
    <div data-prop-text="title">The daemon is set to start up in external mode.</div>
    <p>If you have the agent in <a href="/docs/agents/php-agent/advanced-installation/starting-php-daemon-advanced#selecting-external">external startup mode</a>, you must <a href="/docs/agents/php-agent/advanced-installation/starting-php-daemon-advanced#daemon-external">manually start the daemon</a> and restart the agent for the agent to report.</p>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZnVsbC1yZXN0YXJ0In0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOnsidHlwZSI6Im1keFZhbHVlRXhwcmVzc2lvbiIsInZhbHVlIjoiPD5BcGFjaGUgaXNuJ3QgZnVsbHkgcmVzdGFydGluZyB3aXRoIHRoZSA8SW5saW5lQ29kZT5hcGFjaGVjdGwgcmVzdGFydDwvSW5saW5lQ29kZT4gY29tbWFuZC48Lz4iLCJwb3NpdGlvbiI6eyJzdGFydCI6eyJsaW5lIjo2MSwiY29sdW1uIjoxMSwib2Zmc2V0IjozMTU4fSwiZW5kIjp7ImxpbmUiOjYxLCJjb2x1bW4iOjEwOCwib2Zmc2V0IjozMjU1fX19fV0=">
    <div data-prop-text="title">[object Object]</div>
    <p>Using the <code>apachectl restart</code> command does not always fully restart the web server, so it doesn't re-parse the agent's configuration files. New Relic recommends using:</p>
    <pre><code>apachectl stop
apachectl start

</code></pre>
  </div>
</div>
