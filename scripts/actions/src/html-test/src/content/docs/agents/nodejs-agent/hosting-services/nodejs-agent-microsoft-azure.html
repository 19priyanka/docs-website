
<p>Read on to learn about special considerations for using Microsoft Azure Web Apps as a hosting service with New Relic's Node.js agent.</p>
<h2>What you need [#compatibility]</h2>
<p>In addition to the <a href="/docs/agents/nodejs-agent/getting-started/compatibility-requirements-nodejs-agent">Compatibility and requirements for the Node.js agent</a>, this tutorial assumes you have a working installation of Node.js and the Windows Azure SDK for Node.js for your platform:</p>
<ul>
  <li>Install the Azure SDK for Node.js.</li>
  <li>Ensure Git is installed.</li>
</ul>
<h2>Installing the Node.js agent [#install_nodejs]</h2>
<p>To add the New Relic Node.js agent to your Azure application:</p>
<ol>
  <li>
    <p>In your app's root, verify that there is a <code>package.json</code> file. If there is not, create one via the command line:</p>
    <pre><code>touch package.json
</code></pre>
  </li>
  <li>
    <p>Add the following to your <code>package.json</code> file:</p>
    <pre><code>{
  "name": "node",
  "version": "0.0.1",
  "dependencies" : {
    "newrelic" : "*"
  },
  "engine": {
    "node": "10.18"
  }
}
</code></pre>
  </li>
  <li>
    <p>Add <code>require('newrelic');</code> to the top of the <code>server.js</code> file. For example:</p>
    <pre><code>require('newrelic');

var http = require('http')
var port = process.env.PORT || 1337;
http.createServer(function(req, res) {
  res.writeHead(200, { 'Content-Type': 'text/plain' });
  res.end('Hello New Relic Node.js agent!\n');
}).listen(port);
</code></pre>
  </li>
</ol>
<h2>Adding app settings in Azure [#azure_settings]</h2>
<p>After installation, you must configure your app in Azure Web Apps:</p>
<ol>
  <li>
    <p>Sign in to <strong><a href="https://portal.azure.com">portal.azure.com</a></strong>.</p>
  </li>
  <li>
    <p>Select <strong>App Services > (select a Node.js app) > Configure</strong>.</p>
  </li>
  <li>
    <p>Add the following to the <strong>app settings</strong>:</p>
    <ul>
      <li><code>new_relic_app_name</code>: Your Windows Azure website name</li>
      <li><code>new_relic_license_key</code>: Your New Relic <a href="/docs/subscriptions/license-key">license key</a></li>
    </ul>
  </li>
  <li>
    <p>Save your settings.</p>
  </li>
  <li>
    <p>Restart your Node.js app.</p>
  </li>
</ol>
<p>Generate some traffic to your app and wait a few minutes. After waiting, see your data by going to <strong><a href="http://one.newrelic.com">one.newrelic.com</a> > APM > (select your app)</strong>.</p>
<h2>Optional: Adding app settings with the CLI [#app_settings]</h2>
<p>Optional: Here is an example of how to add the app settings by using the CLI (Node SDK):</p>
<pre><code>azure account download "YOUR_SUBSCRIPTION_NAME"
azure account import "PATH_TO_PUBLISH_SETTINGS_FILE"
azure site config add "new_relic_app_name=REPLACE_WITH_YOUR_APP_NAME"
azure site config add "new_relic_license_key=REPLACE_WITH_YOUR_LICENSE_KEY"
azure site restart AZURE_WEB_APP_NAME
</code></pre>
<h2>Using environment variables [#variables]</h2>
<p>If your agent runs in PaaS environments such as Heroku or Azure Web Apps, all of the configuration variables in <code>newrelic.js</code> have counterparts that can be set as environment variables. You can freely mix and match variables in the configuration file. Environment variables <a href="/docs/agents/nodejs-agent/installation-configuration/nodejs-agent-configuration#methods-and-precedence">override your configuration file settings</a>.</p>
<p>For example, as a convenience to Azure users, the agent will use <code>APP_POOL_ID</code> as the application name (<a href="/docs/nodejs/configuring-nodejs-with-environment-variables#app_name"><code>NEW_RELIC_APP_NAME</code></a>) if it's set, so you can use the name you chose without setting it twice. For more information, see <a href="/docs/nodejs/configuring-nodejs-with-environment-variables">Configuring Node.js with environment variables</a>.</p>
<h2>For more help [#more_help]</h2>
<p>Additional documentation resources include:</p>
<ul>
  <li><a href="/docs/nodejs/customizing-your-nodejs-config-file">Node.js agent configuration</a> (changing the default values in your agent configuration file)</li>
</ul>
