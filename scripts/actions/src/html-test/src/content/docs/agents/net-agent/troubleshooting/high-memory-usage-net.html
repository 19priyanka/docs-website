
<h2>Problem</h2>
<p>After installing New Relic's .NET agent, you see an increase in <code>Working Set</code> memory usage in monitoring tools such as the Microsoft Windows <strong>Task Manager</strong>. The increase is usually about 100 MB per monitored application. This can occur on both physical and virtual machines.</p>
<h2>Solution</h2>
<p>This increased <code>Working Set</code> memory usage usually does not affect performance. Windows reserves <code>Working Set</code> memory for a particular app, but it can be released at any time if another app needs the memory. This is normal and expected behavior for any Windows app.</p>
<p>In rare cases, particularly for systems with limited RAM or many app pools, memory usage can impact performance. If your performance is affected, try any of these options:</p>
<ul>
  <li><a href="https://docs.newrelic.com/docs/agents/net-agent/configuration/net-agent-configuration#include_exclude_apps">Enable instrumentation only for specific app pools</a></li>
  <li>Add more RAM to the machine.</li>
  <li>Remove some application pools from the machine.</li>
  <li>Monitor performance to see if the increased memory usage shown in the <strong>Task Manager</strong> is actually impacting performance. If it is, release memory and share with other processes.</li>
</ul>
<h2>Cause</h2>
<p>The underlying cause is the way <a href="https://docs.microsoft.com/en-us/windows/win32/memory/working-set">Windows itself anticipates and allocates memory per process</a>. Windows allocates this memory as <code>Working Set</code> memory, which is memory the operating system reserves for the process. The OS can release the <code>Working Set</code> memory quickly if another process needs it. Because memory allocation is decided by Windows, New Relic cannot reduce the amount of memory shown in use.</p>
<p>Usually this increase is not a problem unless there is a corresponding drop in performance. Performance problems may occur if all of the available memory is occupied as <code>Private Working Set</code> memory. If the server is running low on memory, monitor your response times and transaction times to see if this memory usage is actually impacting performance. If there is no increase for awhile, then the memory usage is not a problem.</p>
<p>Typically the <code>Working Set</code> memory usage only causes issues on systems with limited RAM. For example, New Relic's test systems may show an increase of approximately 100 MB per monitored app or app pool. An 80% increase is notable when it is 80% of 64 GB, but less notable when it is 80% of 4 GB.</p>
<p>Similarly, the number of application pools being monitored affects usage. A single app pool rarely increases usage significantly, but a system with 4 GB of RAM and 30 application pools might have issues.</p>
