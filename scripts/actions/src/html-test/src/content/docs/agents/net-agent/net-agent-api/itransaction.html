
<h2>Syntax</h2>
<pre><code>public interface ITransaction
</code></pre>
<p>Provides access to transaction-specific methods in the New Relic API.</p>
<h2>Description</h2>
<p>Provides access to transaction-specific methods in the New Relic .NET agent API. To obtain a reference to <code>ITransaction</code>, use the current transaction method available on <a href="/docs/agents/net-agent/net-agent-api/iagent"><code>IAgent</code></a>.</p>
<p>This section contains descriptions and parameters of three ITransaction methods:</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>Name</p>
      </div>
      <div>
        <p>Description</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p><a href="#acceptdistributedtraceheaders">AcceptDistributedTraceHeaders</a></p>
      </div>
      <div>
        <p>Accepts incoming trace context headers from another service.</p>
      </div>
    </div>
    <div>
      <div>
        <p><a href="#insertdistributedtraceheaders">InsertDistributedTraceHeaders</a></p>
      </div>
      <div>
        <p>Adds trace context headers to an outgoing request.</p>
      </div>
    </div>
    <div>
      <div>
        <p><a href="#acceptdistributedtracepayload">AcceptDistributedTracePayload (deprecated)</a></p>
      </div>
      <div>
        <p>Accepts an incoming distributed trace payload from another service.</p>
      </div>
    </div>
    <div>
      <div>
        <p><a href="#createdistributedtracepayload">CreateDistributedTracePayload (deprecated)</a></p>
      </div>
      <div>
        <p>Creates a distributed trace payload for inclusion in an outgoing request.</p>
      </div>
    </div>
    <div>
      <div>
        <p><a href="#addcustomattribute">AddCustomAttribute</a></p>
      </div>
      <div>
        <p>Add contextual information from your application to the current transaction in form of attributes.</p>
      </div>
    </div>
    <div>
      <div>
        <p><a href="#currentspan">CurrentSpan</a></p>
      </div>
      <div>
        <p>Provides access to the currently executing <a href="https://docs.newrelic.com/docs/agents/net-agent/net-agent-api/ispan">span</a>, which provides access to span-specific methods in the New Relic API.</p>
      </div>
    </div>
  </div>
</div>
<h2>AcceptDistributedTraceHeaders</h2>
<p><code>ITransaction.AcceptDistributedTraceHeaders</code> is used to instrument the called service for inclusion in a distributed trace. It links the spans in a trace by accepting a payload generated by <a href="https://docs.newrelic.com/docs/agents/nodejs-agent/api-guides/nodejs-agent-api#transaction-handle-insertDistributedTraceHeaders"><code>InsertDistributedTraceHeaders</code></a> or generated by some other W3C Trace Context compliant tracer. This method accepts the headers of an incoming request, looks for W3C Trace Context headers, and if not found, falls back to New Relic distributed trace headers. This method replaces the deprecated <a href="https://docs.newrelic.com/docs/agents/net-agent/net-agent-api/itransaction#acceptdistributedtracepayload"><code>AcceptDistributedTracePayload</code></a> method, which only handles New Relic distributed trace payloads.</p>
<h3>Syntax</h3>
<pre><code>void AcceptDistributedHeaders(carrier, getter, transportType)
</code></pre>
<h3>Parameters</h3>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>Name</p>
      </div>
      <div>
        <p>Description</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p><code>carrier</code></p>
        <p><em>&#x3C;T></em></p>
      </div>
      <div>
        <p>Required. Source of incoming Trace Context headers.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>getter</code></p>
        <p><em>Func&#x3C;T, string, IEnumerable&#x3C;string>></em></p>
      </div>
      <div>
        <p>Required. Caller-defined function to extract header data from the carrier.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>transportType</code></p>
        <p><em>TransportType enum</em></p>
      </div>
      <div>
        <p>Required. Describes the transport of the incoming payload (e.g. TransportType.HTTP).</p>
      </div>
    </div>
  </div>
</div>
<h3>Usage considerations</h3>
<ul>
  <li><a href="https://docs.newrelic.com/docs/agents/net-agent/configuration/net-agent-configuration#distributed_tracing">Distributed tracing must be enabled</a>.</li>
  <li><code>AcceptDistributedTraceHeaders</code> will be ignored if <code>InsertDistributedTraceHeaders</code> or <code>AcceptDistributedTraceHeaders</code> has already been called for this transaction.</li>
</ul>
<h3>Example</h3>
<pre><code>HttpContext httpContext = HttpContext.Current;IAgent agent = GetAgent();ITransaction currentTransaction = _agent.CurrentTransaction;currentTransaction.AcceptDistributedTraceHeaders(httpContext, Getter, TransportType.HTTP);IEnumerable&#x3C;string> Getter(HttpContext carrier, string key) {   string value = carrier.Request.Headers[key];   return value == null ? null : new string[] { value }; }
</code></pre>
<h2>InsertDistributedTraceHeaders</h2>
<p><code>ITransaction.InsertDistributedTraceHeaders</code> is used to implement distributed tracing. It modifies the carrier object that is passed in by adding W3C Trace Context headers and New Relic Distributed Trace headers. The New Relic headers can be disabled with &#x3C;<code>distributedTracing excludeNewrelicHeader="true" /></code> in the config. This method replaces the deprecated <a href="https://docs.newrelic.com/docs/agents/net-agent/net-agent-api/itransaction#createdistributedtracepayload"><code>CreateDistributedTracePayload</code></a> method, which only creates New Relic Distributed Trace payloads.</p>
<h3>Syntax</h3>
<pre><code>void InsertDistributedTraceHeaders(carrier, setter)
</code></pre>
<h3>Parameters</h3>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>Name</p>
      </div>
      <div>
        <p>Description</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p><code>carrier</code></p>
        <p><em>&#x3C;T></em></p>
      </div>
      <div>
        <p>Required. Container where Trace Context headers are inserted..</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>setter</code></p>
        <p><em>Action&#x3C;T, string, string></em></p>
      </div>
      <div>
        <p>Required. Caller-defined Action to insert header data into the carrier.</p>
      </div>
    </div>
  </div>
</div>
<h3>Usage considerations</h3>
<ul>
  <li><a href="https://docs.newrelic.com/docs/agents/net-agent/configuration/net-agent-configuration#distributed_tracing">Distributed tracing must be enabled</a>.</li>
</ul>
<h3>Example</h3>
<pre><code>HttpRequestMessage requestMessage = new HttpRequestMessage(HttpMethod.Get, "https://remote-address");IAgent agent = GetAgent();ITransaction currentTransaction = _agent.CurrentTransaction;var setter = new Action&#x3C;System.Net.HttpWebRequest, string, string>((carrier, key, value) =>  {    carrier.Headers?.Set(key, value);  });currentTransaction.InsertDistributedTraceHeaders(requestMessage, setter);
</code></pre>
<h2>AcceptDistributedTracePayload (deprecated) [#acceptdistributedtracepayload]</h2>
<p>Accepts an incoming distributed trace payload from an upstream service. Calling this method links the transaction from the upstream service to this transaction.</p>
<h3>Syntax</h3>
<pre><code>void AcceptDistributedPayload(payload, transportType)
</code></pre>
<h3>Parameters</h3>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>Name</p>
      </div>
      <div>
        <p>Description</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p><code>payload</code></p>
        <p><em>string</em></p>
      </div>
      <div>
        <p>Required. A string representation of the incoming distributed trace payload.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>transportType</code></p>
        <p><em>TransportType</em><br><em>enum</em></p>
      </div>
      <div>
        <p>Recommended. Describes the transport of the incoming payload (e.g. http).</p>
        <p>Default <code>TransportType.Unknown</code>.</p>
      </div>
    </div>
  </div>
</div>
<h3>Usage considerations</h3>
<ul>
  <li><a href="https://docs.newrelic.com/docs/agents/net-agent/configuration/net-agent-configuration#distributed_tracing">Distributed tracing must be enabled</a>.</li>
  <li>The payload can be a Base64-encoded or plain text string.</li>
  <li><code>AcceptDistributedTracePayload</code> will be ignored if <code>CreateDistributedTracePayload</code> has already been called for this transaction.</li>
</ul>
<h3>Example</h3>
<pre><code>//Obtain the information from the request object from the upstream caller.//The method by which this information is obtain is specific to the transport //type being used.  For example, in an HttpRequest, this information is//contained in the header.KeyValuePair&#x3C;string, string> metadata = GetMetaDataFromRequest("requestPayload");IAgent agent = NewRelic.Api.Agent.NewRelic.GetAgent(); ITransaction transaction = agent.CurrentTransaction; transaction.AcceptDistributedTracePayload(metadata.Value, TransportType.Queue);
</code></pre>
<h2>CreateDistributedTracePayload (deprecated) [#createdistributedtracepayload]</h2>
<p>Creates a distributed trace payload for inclusion in an outgoing request to a downstream system.</p>
<h3>Syntax</h3>
<pre><code>IDistributedTracePayload CreateDistributedTracePayload()
</code></pre>
<h3>Returns</h3>
<p>An object that implements <code>IDistributedTracePayload</code> which provides access to the distributed trace payload that was created.</p>
<h3>Usage considerations</h3>
<ul>
  <li><a href="https://docs.newrelic.com/docs/agents/net-agent/configuration/net-agent-configuration#distributed_tracing">Distributed tracing must be enabled</a>.</li>
  <li><code>CreateDistributedTracePayload</code> will be ignored if <code>AcceptDistributedTracePayload</code> has already been called for this transaction.</li>
</ul>
<h3>Example</h3>
<pre><code>IAgent agent = NewRelic.Api.Agent.NewRelic.GetAgent(); ITransaction transaction = agent.CurrentTransaction; IDistributedTracePayload payload = transaction.CreateDistributedTracePayload();
</code></pre>
<h2>AddCustomAttribute</h2>
<p>Adds contextual information about your application to the current transaction in the form of <a href="/docs/using-new-relic/welcome-new-relic/get-started/glossary#attribute">attributes</a>.</p>
<p>This method requires .NET agent version and .NET agent API <a href="/docs/release-notes/agent-release-notes/net-release-notes/net-agent-8242440">version 8.24.244.0</a> or higher. It replaced the deprecated <a href="/docs/agents/net-agent/net-agent-api/add-custom-parameter"><code>AddCustomParameter</code></a>.</p>
<h3>Syntax</h3>
<pre><code>ITransaction AddCustomAttribute(string key, object value)
</code></pre>
<h3>Parameters</h3>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>Parameter</p>
      </div>
      <div>
        <p>Description</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p><code>key</code></p>
        <p><em>string</em></p>
      </div>
      <div>
        <p>Identifies the information being reported. Also known as the name.</p>
        <ul>
          <li>Empty keys are not supported.</li>
          <li>Keys are limited to 255-bytes. Attributes with keys larger than 255-bytes will be ignored.</li>
        </ul>
      </div>
    </div>
    <div>
      <div>
        <p><code>value</code></p>
        <p><em>object</em></p>
      </div>
      <div>
        <p>The value being reported.</p>
      </div>
    </div>
  </div>
</div>
<h3>Returns</h3>
<p>A reference to the current transaction.</p>
<h3>Usage considerations</h3>
<p>For details about supported data types, see the <a href="/docs/agents/net-agent/attributes/custom-attributes">Custom Attributes Guide</a>.</p>
<h3>Example</h3>
<pre><code>IAgent agent = NewRelic.Api.Agent.NewRelic.GetAgent(); ITransaction transaction = agent.CurrentTransaction; transaction    .AddCustomAttribute("customerName","Bob Smith")    .AddCustomAttribute("currentAge",31)    .AddCustomAttribute("birthday", new DateTime(2000, 02, 14))    .AddCustomAttribute("waitTime", TimeSpan.FromMilliseconds(93842));
</code></pre>
<h2>CurrentSpan</h2>
<p>Provides access to the currently executing <a href="http://docs.newrelic.com/docs/agents/net-agent/net-agent-api/ispan">span</a>, making <a href="http://docs.newrelic.com/docs/agents/net-agent/net-agent-api/ispan">span-specific methods</a> available within the New Relic API.</p>
<h3>Example</h3>
<pre><code>IAgent agent = NewRelic.Api.Agent.NewRelic.GetAgent(); ITransaction transaction = agent.CurrentTransaction; ISpan = currentSpan = transaction.CurrentSpan;
</code></pre>
<h2>Examples</h2>
<p>See <a href="#parameters">Parameters section</a>.</p>
