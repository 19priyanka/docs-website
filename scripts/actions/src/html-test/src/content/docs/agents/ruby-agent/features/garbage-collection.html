
<p>Garbage collection (GC) finds unused data objects and reclaims that memory space for use by another process. The New Relic Ruby agent can collect information about how much time is spent in garbage collection for applications running on MRI 1.9.2 or higher or Ruby Enterprise Edition, but you must explicitly enable this feature in your application.</p>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
  <p>Avoid using garbage collection in production for long periods of time, as it increases overhead.</p>
</div>
<h2>Enable garbage collection instrumentation [#gc_setup]</h2>
<p>To activate the feature, add the appropriate call in your application initialization.</p>
<ul>
  <li>MRI 1.9.2 or higher: <code>GC::Profiler.enable</code></li>
  <li>Ruby Enterprise Edition: <code>GC.enable_stats</code></li>
</ul>
<p>For Rails applications, you can either add this call to an initializer in <code>config/initializers</code>, or add it directly to your <code>config/application.rb</code> file.</p>
<h2>View app-wide GC statistics [#gc_view]</h2>
<p>To view overall garbage collection statistics:</p>
<ol>
  <li><a href="https://one.newrelic.com/">Log into New Relic</a>, select a Ruby app, and go to <strong>Summary</strong>.</li>
  <li>From the APM <strong>Summary</strong> page, look for <strong>GC Execution</strong> statistics on the <strong>Web transactions time</strong> chart.</li>
</ol>
<p>
  <img src="./images/screen-Dev-app-GC091412_0.png" alt="screen-overview-with-garbage-collection" title="screen-overview-with-garbage-collection">
</p>
<p><strong><a href="https://one.newrelic.com">one.newrelic.com</a> > APM > (select a Ruby app) > Summary</strong>: On the Web transactions time chart, garbage collection statistics are labeled <strong>GC Execution</strong>.</p>
<h2>View detailed GC metrics [#detailed]</h2>
<p>To view garbage collection metrics on a per-transaction basis, go to <strong><a href="https://one.newrelic.com">one.newrelic.com</a> > APM > (select a Ruby app) > Transactions > (select a transaction)</strong>. You can then view the amount of time spent in GC, and the average number of times GC is called for each transaction.</p>
<p>
  <img src="./images/screen-ruby-gc-select-transaction.png" alt="screen ruby gc select transaction.png" title="screen ruby gc select transaction.png">
</p>
<p><strong><a href="https://one.newrelic.com">one.newrelic.com</a> > APM > (select a Ruby app) > Transactions > (select a transaction)</strong>: Select an individual transaction to view detailed GC metrics, including average time and average number of calls.</p>
<p>Detailed information includes:</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p><strong>Garbage collection details</strong></p>
      </div>
      <div>
        <p><strong>Comments</strong></p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p>Trend of garbage collection time</p>
      </div>
      <div>
        <p>Garbage collection usually takes a small amount of time, and therefore the trend line may not be visible in your charts. To view the trend in garbage collection time, navigate to the <a href="#gc_view">overview chart</a> or to <a href="#detailed">detailed transaction metrics</a>. Then, hide every chart label except <strong>GC Execution</strong> by selecting each label.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Average number of calls</p>
      </div>
      <div>
        <p>To view the average number of garbage collection calls for each controller action: From your <a href="/docs/apm/applications-menu/monitoring/applications-overview-dashboard">APM <strong>Summary</strong></a> <a href="/docs/apm/applications-menu/monitoring/applications-overview-dashboard">page</a>, select <strong>Transaction</strong>. Then select a controller action and view the <strong>App Server Breakdown</strong>.</p>
      </div>
    </div>
  </div>
</div>
<h2>For more help [#more_help]</h2>
<p>Additional documentation resources include:</p>
<ul>
  <li><a href="http://blog.newrelic.com/?p=11795">"Eating the 1.9 elephant" blog post</a> (what New Relic discovered when we used garbage collection to fine-tune our own website)</li>
  <li><a href="/docs/applications-menu/applications-overview">APM <strong>Summary</strong> page</a> (features and drill-down details when using the APM <strong>Summary</strong> page)</li>
  <li><a href="/docs/applications-menu/transactions-dashboard"><strong>Transactions</strong> page</a> (features and drill-down details for transactions)</li>
  <li><a href="/docs/ruby/ruby-agent-configuration">Ruby agent configuration</a> (update procedures and configuration file values, including general, proxy, transaction traces, and error collector)</li>
</ul>
