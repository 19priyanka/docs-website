
<p>To take full advantage of New Relic's latest features, enhancements, and important security patches, we recommend you update your Node.js agent to the latest version. For additional information about specific agent updates, refer to the <a href="/docs/release-notes/agent-release-notes/nodejs-release-notes">Node.js agent release notes</a>. The release notes include a download link when applicable, plus instructions to download and <a href="/docs/agents/nodejs-agent/installation-configuration/install-nodejs-agent">install</a> the latest version.</p>
<ul>
  <li>If the <code>newrelic</code> module is listed in your <code>package.json</code>, run <code>npm install</code>.</li>
  <li>If you want to target just the <code>newrelic</code> module, run <code>npm update newrelic</code>.</li>
</ul>
<p><strong>Recommendation:</strong> Test your updated version before moving it into production. If you have problems, follow the Node.js agent <a href="/docs/agents/nodejs-agent/troubleshooting/troubleshooting-your-nodejs-installation">troubleshooting procedures</a>.</p>
<h2>Upgrade to Node.js agent version 6 [#node-agent-v5]</h2>
<p>Before upgrading to Node.js version 6, review this information for major changes.</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p><strong>Major changes with Node.js agent v6</strong></p>
      </div>
      <div>
        <p><strong>Comments</strong></p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p>Upgraded official Koa framework instrumentation module to v3.0.0</p>
      </div>
      <div>
        <ul>
          <li><strong>v6:</strong> Added support for @koa/router up to v8.0.2. @koa/router v8.0.3 and greater are currently unsupported.</li>
          <li><strong>v6:</strong> Added support for Node v12 and removed support for Node v6, 7, and 9. The minimum supported version is Node v8.</li>
          <li>Also see New Relic's <a href="https://github.com/newrelic/node-newrelic-koa/blob/master/NEWS.md">Koa Release Notes on Github.</a>.</li>
        </ul>
      </div>
    </div>
    <div>
      <div>
        <p>Removed deprecated <code>max_samples_per_minute</code> configuration parameter, which is replaced by <code>max_samples_stored</code> behavior</p>
      </div>
      <div>
        <ul>
          <li><strong>v1 - v5:</strong> <code>max_samples_per_minute</code> defined the maximum number of events the agent collects per minute. If your application previously used <code>max_samples_per_minute</code> as an upper bound, you may need to lower the threshold to a valid maximum to avoid data being dropped on the server. We recommend less than 10k.</li>
          <li><strong>v5:</strong> In agent v5 and lower, <code>max_samples_stored</code> defined the maximum number of events the agent stores if it's unable to communicate with the <a href="https://docs.newrelic.com/docs/accounts-partnerships/education/getting-started-new-relic/glossary#collector">New Relic collector</a>.</li>
          <li><strong>v6:</strong> The new behavior of <code>max_samples_stored</code> defines the maximum number of events the agent collects per minute. If there are more than this number, the agent collects a statistical sampling. This usage of the configuration is consistent with the other APM agents.</li>
          <li><strong>Troubleshooting tips:</strong> If you're missing event data, increase the value of <code>max_samples_stored</code> or revert to the default value. The value of <code>max_samples_stored</code> should not be over 10,000.</li>
        </ul>
      </div>
    </div>
  </div>
</div>
<h2>Node version support [#node-support]</h2>
<p>Node 8 is the earliest version supported by the New Relic Node.js v6 agent. Node 6, 7 and 9 are not supported by v6. Customers running Node 6, 7 and 9 have two options:</p>
<ul>
  <li>Upgrade to a supported version of Node and take advantage of the New Relic Node.js v6 agent's new features.</li>
  <li>Remain on New Relic Node.js v5 agent without the ability to use new features only available with update agent versions.</li>
</ul>
<p><a href="https://github.com/nodejs/Release/tree/cecdcf#end-of-life-releases">Node 8 no longer receive updates</a>, but New Relic will continue to support these versions of Node for the time being.</p>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJ0aXAifV0=">
  <p>Upgrade to a newer version of Node as soon as possible. The next major version of the New Relic Node.js agent will likely remove support for Node 8.</p>
</div>
<h2>Upgrade to Node.js agent version 5 [#node-agent-v5]</h2>
<p>Before upgrading to Node.js v5, review this information for major changes. Also see New Relic's <a href="https://github.com/newrelic/node-newrelic/blob/819db2f3f9051960e034f36540817450f663241f/Migration%20Guide.md">Node.js v5 migration guide on GitHub</a>.</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p><strong>Major changes with Node.js v5 agent</strong></p>
      </div>
      <div>
        <p><strong>Comments</strong></p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p>Removed deprecated <code>addCustomParameter</code> methods.</p>
      </div>
      <div>
        <ul>
          <li><strong>v2 - v4:</strong> Starting in agent v2.7.0, these methods were marked as deprecated but left in to give a transition period for the new methods.</li>
          <li><strong>v5:</strong> Applications must use the API methods <a href="/docs/agents/nodejs-agent/api-guides/nodejs-agent-api#add-custom-attribute"><code>newrelic.addCustomAttribute()</code></a> and <a href="/docs/agents/nodejs-agent/api-guides/nodejs-agent-api#add-custom-attributes"><code>newrelic.addCustomAttributes()</code></a>. These are drop-in replacements for the old methods.</li>
        </ul>
      </div>
    </div>
    <div>
      <div>
        <p>Removed deprecated <code>create*Transaction</code> methods.</p>
      </div>
      <div>
        <ul>
          <li><strong>v2 - v4:</strong> Starting in agent v2.0.2, these methods were marked as deprecated but left in to give a transition period to the new methods.</li>
          <li><strong>v5:</strong> Applications must update to the API methods <a href="/docs/agents/nodejs-agent/api-guides/nodejs-agent-api#startWebTransaction"><code>newrelic.startWebTransaction()</code></a> and <a href="/docs/agents/nodejs-agent/api-guides/nodejs-agent-api#startBackgroundTransaction"><code>newrelic.startBackgroundTransaction()</code></a>.</li>
          <li><strong>Troubleshooting tips:</strong> These new methods are <strong>not</strong> drop-in replacements for the old ones. Before moving to these new methods, review our <a href="https://docs.newrelic.com/docs/agents/nodejs-agent/supported-features/nodejs-custom-instrumentation#web-txn">custom instrumentation guide</a>.</li>
        </ul>
      </div>
    </div>
    <div>
      <div>
        <p>Removed deprecated <code>createTracer</code> method.</p>
      </div>
      <div>
        <ul>
          <li><strong>v3 - v4:</strong> Starting in agent v3.3.0, this method was marked as deprecated in favor of <code>newrelic.startSegment()</code>.</li>
          <li><strong>v5:</strong> Applications must update to <a href="https://docs.newrelic.com/docs/agents/nodejs-agent/api-guides/nodejs-agent-api#startSegment"><code>newrelic.startSegment()</code></a>.</li>
        </ul>
      </div>
    </div>
    <div>
      <div>
        <p>Removed <code>node-cassandra-cql</code> instrumentation.</p>
      </div>
      <div>
        <ul>
          <li><strong>v4:</strong> Applications using the npm package <a href="https://www.npmjs.com/package/node-cassandra-cql"><code>node-cassandra-cql</code></a> would get datastore metrics for Cassandra.</li>
          <li><strong>v5:</strong> Applications must migrate to the <a href="https://www.npmjs.com/package/cassandra-driver"><code>cassandra-driver</code></a> package to get Cassandra datastore metrics. This module is actively maintained by the same developers. The <code>node-cassandra-cql</code> package was abandoned in February of 2014 in favor of the <code>cassandra-driver</code> package.</li>
        </ul>
      </div>
    </div>
    <div>
      <div>
        <p>Removed deprecated <code>capture_params</code> and <code>ignored_params</code> configurations.</p>
      </div>
      <div>
        <ul>
          <li><strong>v2 - v4:</strong> Starting in agent v2.7.0, these configuration parameters caused a warning to be logged, and the values were automatically upgraded to the new attributes configurations.</li>
          <li><strong>v5:</strong> A warning will still be logged but the configuration is ignored, and no automatic upgrading happens any more.</li>
          <li><strong>Troubleshooting tips:</strong> If your application had parameters listed in the <code>ignored_params</code> configuration, you will need to move them to <a href="/docs/agents/nodejs-agent/installation-configuration/nodejs-agent-configuration#attributes_exclude"><code>attributes.exclude</code></a>.</li>
        </ul>
      </div>
    </div>
  </div>
</div>
<h2>Node version support [#node-support]</h2>
<p>Node 6 is the earliest version supported by the New Relic Node.js v5 agent. Node 4 and 5 are not supported by v5. Customers running Node 4 or 5 have two options:</p>
<ul>
  <li>Upgrade to a supported version of Node and take advantage of the New Relic Node.js v5 agent's new features.</li>
  <li>Remain on New Relic Node.js v4 agent without the ability to use new features only available with update agent versions.</li>
</ul>
<p><a href="https://github.com/nodejs/Release/tree/cecdcf#end-of-life-releases">Node 7 and 9 no longer receive updates</a>, but New Relic will continue to support these versions of Node for the time being.</p>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJ0aXAifV0=">
  <p>Upgrade to a newer version of Node as soon as possible. The next major version of the New Relic Node.js agent will likely remove support for Node 6 and 7.</p>
</div>
<h2>Feature flags as of v5 [#v5-feature-flags]</h2>
<p>As of New Relic for Node.js v5:</p>
<ul>
  <li><code>custom_instrumentation</code>: This feature is no longer configurable.</li>
  <li><code>custom_metrics</code>: This feature is no longer configurable.</li>
  <li><code>synthetics</code>: This feature is no longer configurable.</li>
  <li><code>native_metrics</code>: This feature is now controlled by the <code>plugins.native_metrics.enabled</code> configuration value.</li>
</ul>
<h2>Upgrade to Node.js agent version 4 [#node-agent-v4]</h2>
<p>Before upgrading to Node.js v4, review this information for major changes. Also see New Relic's <a href="https://github.com/newrelic/node-newrelic/blob/819db2f3f9051960e034f36540817450f663241f/Migration%20Guide.md#upgrading-to-agent-v4">Node.js v4 migration guide on GitHub</a>.</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiaHR0cHMtcHJveHktYWdlbnQifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IlVwZ3JhZGUgaHR0cHMtcHJveHktYWdlbnQgZnJvbSB2MCB0byB2MiJ9XQ==">
    <div data-prop-text="title">Upgrade https-proxy-agent from v0 to v2</div>
    <p>Major changes with Node.js v4 agent include an upgrade of the <code>https-proxy-agent</code> from v0 to v2. This dependency has been updated due to a <a href="/docs/using-new-relic/new-relic-security/security-bulletins/security-bulletin-nr18-08">security issue</a> in the <code>https-proxy-agent</code> that the New Relic Node.js agent used. Because <code>https-proxy</code> v2 is incompatible with node v0.10 and v0.12, New Relic has deprecated those agent versions. There is no required action to migrate from v3 to v4 of New Relic's Node.js agent.</p>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoidjQtbm9kZS12ZXJzaW9uIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJOb2RlIHZlcnNpb24gc3VwcG9ydCJ9XQ==">
    <div data-prop-text="title">Node version support</div>
    <p>Node 4 is the earliest version supported by the New Relic Node.js v4 agent. Node 0.10 and 0.12 are not supported by v4. Customers running Node 0.10 or 0.12 have two options:</p>
    <ul>
      <li>
        <p>Upgrade to a supported version of Node and take advantage of the New Relic Node.js v4 agent's new features.</p>
      </li>
      <li>
        <p>Remain on the New Relic Node.js v3 agent without the ability to use new features only available with updated agent versions.</p>
        <p><a href="https://github.com/nodejs/Release/tree/1d8fca#end-of-life-releases">Node 4, 5, and 7 also no longer receive updates</a>, but New Relic will continue to support these versions of Node for the time being.</p>
        <div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJ0aXAifV0=">
          <p>Upgrade to a newer version of Node as soon as possible. The next major version of the New Relic Node.js agent will likely remove support for Node 4 and 5.</p>
        </div>
      </li>
    </ul>
  </div>
</div>
<h2>Upgrade to Node.js agent version 3 [#node-agent-v3]</h2>
<p>Before upgrading to Node.js v3, review this information for major changes. Also see New Relic's <a href="https://github.com/newrelic/node-newrelic/blob/819db2f3f9051960e034f36540817450f663241f/Migration%20Guide.md#upgrading-to-agent-v3">Node.js v3 migration guide on GitHub</a>.</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiY2hhbmdlcy12MyJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiTWFqb3IgY2hhbmdlcyB3aXRoIE5vZGUuanMgdjMgYWdlbnQifV0=">
    <div data-prop-text="title">Major changes with Node.js v3 agent</div>
    <div data-component="Table" data-prop="W10=">
      <div>
        <div>
          <div>
            <p><strong>Major changes with Node.js v3 agent</strong></p>
          </div>
          <div>
            <p><strong>Comments</strong></p>
          </div>
        </div>
      </div>
      <div>
        <div>
          <div>
            <p>Removed SSL configuration</p>
          </div>
          <div>
            <ul>
              <li><strong>v2:</strong> With the v2 agent, it was possible to configure the agent to connect to New Relic without encryption.</li>
              <li><strong>v3:</strong> Node.js agent v3 always connects to New Relic servers using TLS encryption to protect communications. If the agent is configured to disable this, a warning is logged and the setting is ignored.</li>
            </ul>
          </div>
        </div>
        <div>
          <div>
            <p>Request parameters now prefixed with <code>request.parameters.</code></p>
          </div>
          <div>
            <ul>
              <li><strong>v2:</strong> The v2 agent collects request parameters, such as route parameters (<code>/users/:userId</code>) and query parameters (<code>/users?userId=123</code>), as the parameter name (<code>userId</code>).</li>
              <li><strong>v3:</strong> The v3 agent prefixes all request parameters with the string <code>request.parameters.</code>. For example,<code>userId</code> appears as <code>request.parameters.userId</code>.</li>
              <li><strong>Troubleshooting tips:</strong> If you have dashboards, alert policies, or other NRQL queries based on request parameters, update them with the new parameter names.</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoidjMtZmVhdHVyZS1mbGFncyJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiRmVhdHVyZSBmbGFncyBhcyBvZiB2MyJ9XQ==">
    <div data-prop-text="title">Feature flags as of v3</div>
    <p>As of New Relic Node.js agent v3, the <code>send_request_uri_attribute</code> feature is no longer configurable.</p>
  </div>
</div>
<h2>Upgrade to Node.js agent version 2 [#node-agent-v2]</h2>
<p>Before upgrading to Node.js v2, review this information for major changes. Also see New Relic's <a href="https://github.com/newrelic/node-newrelic/blob/819db2f3f9051960e034f36540817450f663241f/Migration%20Guide.md#upgrading-to-agent-v2">Node.js v2 migration guide on GitHub</a>.</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiY2hhbmdlcy12MiJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiTWFqb3IgY2hhbmdlcyB3aXRoIE5vZGUuanMgdjIgYWdlbnQifV0=">
    <div data-prop-text="title">Major changes with Node.js v2 agent</div>
    <div data-component="Table" data-prop="W10=">
      <div>
        <div>
          <div>
            <p><strong>Major changes with Node.js v2 agent</strong></p>
          </div>
          <div>
            <p><strong>Comments</strong></p>
          </div>
        </div>
      </div>
      <div>
        <div>
          <div>
            <p>Reversed naming and ignore rules</p>
          </div>
          <div>
            <ul>
              <li><strong>v1:</strong> With the v1 agent, rules defined in the config properties <code>rules.name</code> and <code>rules.ignore</code> were applied in reverse order; the first rule in the list was applied last.</li>
              <li><strong>v2:</strong> Node.js agent v2 applies rules in the order they are defined, so the first rule in the list is applied first.</li>
              <li><strong>Troubleshooting tips:</strong> If you used naming rules in the v1 agent and notice problems, reverse the order of your rules in your configuration.</li>
            </ul>
          </div>
        </div>
        <div>
          <div>
            <p>De-duplicated HTTP request transactions</p>
          </div>
          <div>
            <ul>
              <li><strong>v1:</strong> The v1 agent started a new transaction for each listener on an HTTP server's <code>request</code> event. In applications with multiple listeners on the <code>request</code> event, this resulted in extraneous transactions being created that almost always did not get named correctly.</li>
              <li><strong>v2:</strong> The v2 agent only creates a single transaction for each <code>request</code> event emitted.</li>
              <li><strong>Troubleshooting tips:</strong> If you used multiple <code>request</code> event listeners and added a call to <code>newrelic.ignoreTransaction()</code> to remove the extra transactions, remove those calls.</li>
            </ul>
          </div>
        </div>
        <div>
          <div>
            <p>Stopped swallowing outbound request errors</p>
          </div>
          <div>
            <ul>
              <li><strong>v1:</strong> The v1 agent swallowed unhandled <code>error</code> events emitted by outbound HTTP request objects.</li>
              <li><strong>v2:</strong> The v2 agent removes this behavior. Instead, the v2 agent does not change normal Node execution. This means the <code>error</code> event will always be emitted.</li>
              <li><strong>Troubleshooting tips:</strong> If you are making outbound requests and currently do not listen for the <code>error</code> event, add a listener and handle the error as appropriate for your application.</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiY29uZmlnLW9wdGlvbnMifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IlVwZGF0ZWQgY29uZmlndXJhdGlvbiBvcHRpb25zIGFzIG9mIHYyIn1d">
    <div data-prop-text="title">Updated configuration options as of v2</div>
    <p>In <code>newrelic.js</code>, edit the <a href="/docs/agents/nodejs-agent/installation-configuration/nodejs-agent-configuration">Node.js agent configuration</a> properties you use for compatiblity with the latest versions:</p>
    <div data-component="Table" data-prop="W10=">
      <div>
        <div>
          <div>
            <p><strong>Deprecated property</strong></p>
          </div>
          <div>
            <p><strong>New property</strong></p>
          </div>
        </div>
      </div>
      <div>
        <div>
          <div>
            <p><code>capture_params</code></p>
          </div>
          <div>
            <p><code>attributes.enabled: false</code></p>
            <p>By default, request attributes are not sent to New Relic. Set <code>attributes.enabled: true</code> to include agent-defined or custom attributes in traces. The <code>capture_params</code> property has been deprecated.</p>
          </div>
        </div>
        <div>
          <div>
            <p><code>ignored_params</code></p>
          </div>
          <div>
            <p><code>attributes.exclude: []</code></p>
            <p>Add any request attribute keys to the <code>attributes.exclude</code> list. Now, instead of having to be an exact match, wildcards (<code>*</code>) may be appended to each item for broader filtering. The <code>ignored_params</code> property has been deprecated.</p>
          </div>
        </div>
      </div>
    </div>
    <p>These <a href="/docs/agents/nodejs-agent/installation-configuration/nodejs-agent-configuration">Node.js agent configuration</a> properties also have overrides for specific destinations, including:</p>
    <ul>
      <li>
        <p><code>transaction_tracer</code></p>
      </li>
      <li>
        <p><code>transaction_events</code></p>
      </li>
      <li>
        <p><code>error_collector</code></p>
      </li>
      <li>
        <p><code>browser_monitoring</code></p>
        <p>For example, if the root <code>attributes.enabled</code> is <code>true</code> and you set <code>transaction_tracer.attributes.enabled: false</code>, this will restrict attributes from being collected in transaction traces, while still allowing them for all others.</p>
      </li>
    </ul>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZGVwcmVjYXRlZC1hcGlzIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJEZXByZWNhdGVkIEFQSSBtZXRob2RzIGFzIG9mIHYyIn1d">
    <div data-prop-text="title">Deprecated API methods as of v2</div>
    <p>The following methods from the Node.js agent have been deprecated, and New Relic has deleted them in v5 of the agent. Each has an easy replacement that accomplishes the same task in a more flexible and reliable way.</p>
    <div data-component="CollapserGroup" data-prop="W10=">
      <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoibmV3cmVsaWNfY3JlYXRlV2ViVHJhbnNhY3Rpb24ifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6eyJ0eXBlIjoibWR4VmFsdWVFeHByZXNzaW9uIiwidmFsdWUiOiI8SW5saW5lQ29kZT5uZXdyZWxpYy5jcmVhdGVXZWJUcmFuc2FjdGlvbigpPC9JbmxpbmVDb2RlPiIsInBvc2l0aW9uIjp7InN0YXJ0Ijp7ImxpbmUiOjM5MiwiY29sdW1uIjoxNSwib2Zmc2V0IjoxODI0N30sImVuZCI6eyJsaW5lIjozOTIsImNvbHVtbiI6NzMsIm9mZnNldCI6MTgzMDV9fX19XQ==">
        <div data-prop-text="title">[object Object]</div>
        <p>Replace with <a href="#newrelic_start_transaction"><code>newrelic.startWebTransaction()</code></a> and <a href="#newrelic_getTransaction"><code>newrelic.getTransaction()</code></a>.</p>
      </div>
      <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoibmV3cmVsaWNfY3JlYXRlQmFja2dyb3VuZFRyYW5zYWN0aW9uIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOnsidHlwZSI6Im1keFZhbHVlRXhwcmVzc2lvbiIsInZhbHVlIjoiPElubGluZUNvZGU+bmV3cmVsaWMuY3JlYXRlQmFja2dyb3VuZFRyYW5zYWN0aW9uKCk8L0lubGluZUNvZGU+IiwicG9zaXRpb24iOnsic3RhcnQiOnsibGluZSI6Mzk5LCJjb2x1bW4iOjE1LCJvZmZzZXQiOjE4NTYxfSwiZW5kIjp7ImxpbmUiOjM5OSwiY29sdW1uIjo4MCwib2Zmc2V0IjoxODYyNn19fX1d">
        <div data-prop-text="title">[object Object]</div>
        <p>Replace with <a href="#newrelic_start_transaction"><code>newrelic.startBackgroundTransaction()</code></a> and <a href="#newrelic_getTransaction"><code>newrelic.getTransaction()</code></a>.</p>
      </div>
      <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoibmV3cmVsaWNfYWRkQ3VzdG9tUGFyYW1ldGVyIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOnsidHlwZSI6Im1keFZhbHVlRXhwcmVzc2lvbiIsInZhbHVlIjoiPElubGluZUNvZGU+bmV3cmVsaWMuYWRkQ3VzdG9tUGFyYW1ldGVyKCk8L0lubGluZUNvZGU+IiwicG9zaXRpb24iOnsic3RhcnQiOnsibGluZSI6NDA2LCJjb2x1bW4iOjE1LCJvZmZzZXQiOjE4ODgwfSwiZW5kIjp7ImxpbmUiOjQwNiwiY29sdW1uIjo3MSwib2Zmc2V0IjoxODkzNn19fX1d">
        <div data-prop-text="title">[object Object]</div>
        <p>Replace with <a href="#newrelic_add_custom_attribute"><code>newrelic.addCustomAttribute()</code></a>.</p>
      </div>
      <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoibmV3cmVsaWNfYWRkQ3VzdG9tUGFyYW1ldGVyIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOnsidHlwZSI6Im1keFZhbHVlRXhwcmVzc2lvbiIsInZhbHVlIjoiPElubGluZUNvZGU+bmV3cmVsaWMuYWRkQ3VzdG9tUGFyYW1ldGVycygpPC9JbmxpbmVDb2RlPiIsInBvc2l0aW9uIjp7InN0YXJ0Ijp7ImxpbmUiOjQxMywiY29sdW1uIjoxNSwib2Zmc2V0IjoxOTEyNX0sImVuZCI6eyJsaW5lIjo0MTMsImNvbHVtbiI6NzIsIm9mZnNldCI6MTkxODJ9fX19XQ==">
        <div data-prop-text="title">[object Object]</div>
        <p>Replace with <a href="#newrelic_add_custom_attributes"><code>newrelic.addCustomAttributes()</code></a>.</p>
      </div>
    </div>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiYXBpLW1ldGhvZHMifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6Ik5ldyB2MiBhZ2VudCBBUEkgbWV0aG9kcyJ9XQ==">
    <div data-prop-text="title">New v2 agent API methods</div>
    <p>The following API methods are new with the New Relic Node.js v2 agent.</p>
    <div data-component="CollapserGroup" data-prop="W10=">
      <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoibmV3cmVsaWNfZ2V0VHJhbnNhY3Rpb24ifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6eyJ0eXBlIjoibWR4VmFsdWVFeHByZXNzaW9uIiwidmFsdWUiOiI8SW5saW5lQ29kZT5uZXdyZWxpYy5nZXRUcmFuc2FjdGlvbigpPC9JbmxpbmVDb2RlPiIsInBvc2l0aW9uIjp7InN0YXJ0Ijp7ImxpbmUiOjQyOSwiY29sdW1uIjoxNSwib2Zmc2V0IjoxOTU3OH0sImVuZCI6eyJsaW5lIjo0MjksImNvbHVtbiI6NjcsIm9mZnNldCI6MTk2MzB9fX19XQ==">
        <div data-prop-text="title">[object Object]</div>
        <p>This method gets a reference to the currently running transaction. Use in conjunction with:</p>
        <ul>
          <li><code>newrelic.startWebTransaction</code></li>
          <li><code>newrelic.startBackgroundTransaction</code></li>
          <li>Callback-based message consumer services for <a href="/docs/agents/nodejs-agent/troubleshooting/troubleshoot-message-consumers">troubleshooting message consumers</a></li>
        </ul>
      </div>
      <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoibmV3cmVsaWNfc3RhcnRfdHJhbnNhY3Rpb24ifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6eyJ0eXBlIjoibWR4VmFsdWVFeHByZXNzaW9uIiwidmFsdWUiOiI8PjxJbmxpbmVDb2RlPm5ld3JlbGljLnN0YXJ0V2ViVHJhbnNhY3Rpb24oKTwvSW5saW5lQ29kZT48SW5saW5lQ29kZT5uZXdyZWxpYy5zdGFydEJhY2tncm91bmRUcmFuc2FjdGlvbigpPC9JbmxpbmVDb2RlPjwvPiIsInBvc2l0aW9uIjp7InN0YXJ0Ijp7ImxpbmUiOjQ0MCwiY29sdW1uIjoxNSwib2Zmc2V0IjoyMDA4NX0sImVuZCI6eyJsaW5lIjo0NDAsImNvbHVtbiI6MTM5LCJvZmZzZXQiOjIwMjA5fX19fV0=">
        <div data-prop-text="title">[object Object]</div>
        <p>These new API methods replace the older <code>create*Transaction</code> methods. They are easier to use and seamlessly work with promises. Unlike the v1 method, the provided callback is invoked immediately.</p>
      </div>
      <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoibmV3cmVsaWNfaW5zdHJ1bWVudCJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjp7InR5cGUiOiJtZHhWYWx1ZUV4cHJlc3Npb24iLCJ2YWx1ZSI6Ijw+PElubGluZUNvZGU+bmV3cmVsaWMuaW5zdHJ1bWVudCgpPC9JbmxpbmVDb2RlPjxJbmxpbmVDb2RlPm5ld3JlbGljLmluc3RydW1lbnREYXRhc3RvcmUoKTwvSW5saW5lQ29kZT48SW5saW5lQ29kZT5uZXdyZWxpYy5pbnN0cnVtZW50V2ViZnJhbWV3b3JrKCk8L0lubGluZUNvZGU+PElubGluZUNvZGU+bmV3cmVsaWMuaW5zdHJ1bWVudE1lc3NhZ2VzKCk8L0lubGluZUNvZGU+PC8+IiwicG9zaXRpb24iOnsic3RhcnQiOnsibGluZSI6NDQ3LCJjb2x1bW4iOjE1LCJvZmZzZXQiOjIwNTA2fSwiZW5kIjp7ImxpbmUiOjQ0NywiY29sdW1uIjoyMzUsIm9mZnNldCI6MjA3MjZ9fX19XQ==">
        <div data-prop-text="title">[object Object]</div>
        <p>Use these methods to add custom instrumentation for third party modules, including those already instrumented by the New Relic Node.js agent. For more information, see New Relic's <a href="https://newrelic.github.io/node-newrelic/docs/tutorial-Instrumentation-Basics.html">Node.js instrumentation tutorials on GitHub</a>.</p>
      </div>
      <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoibmV3cmVsaWNfYWRkX2N1c3RvbV9hdHRyaWJ1dGUifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6eyJ0eXBlIjoibWR4VmFsdWVFeHByZXNzaW9uIiwidmFsdWUiOiI8SW5saW5lQ29kZT5uZXdyZWxpYy5hZGRDdXN0b21BdHRyaWJ1dGUoKTwvSW5saW5lQ29kZT4iLCJwb3NpdGlvbiI6eyJzdGFydCI6eyJsaW5lIjo0NTQsImNvbHVtbiI6MTUsIm9mZnNldCI6MjExNDh9LCJlbmQiOnsibGluZSI6NDU0LCJjb2x1bW4iOjcxLCJvZmZzZXQiOjIxMjA0fX19fV0=">
        <div data-prop-text="title">[object Object]</div>
        <p>Use this method to add a custom trace attribute.</p>
      </div>
      <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoibmV3cmVsaWNfYWRkX2N1c3RvbV9hdHRyaWJ1dGVzIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOnsidHlwZSI6Im1keFZhbHVlRXhwcmVzc2lvbiIsInZhbHVlIjoiPElubGluZUNvZGU+bmV3cmVsaWMuYWRkQ3VzdG9tQXR0cmlidXRlcygpPC9JbmxpbmVDb2RlPiIsInBvc2l0aW9uIjp7InN0YXJ0Ijp7ImxpbmUiOjQ2MSwiY29sdW1uIjoxNSwib2Zmc2V0IjoyMTM2NX0sImVuZCI6eyJsaW5lIjo0NjEsImNvbHVtbiI6NzIsIm9mZnNldCI6MjE0MjJ9fX19XQ==">
        <div data-prop-text="title">[object Object]</div>
        <p>Use this method to add multiple custom trace attributes.</p>
      </div>
    </div>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoibm9kZS1zdXBwb3J0In0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJOb2RlIHZlcnNpb24gc3VwcG9ydCBmb3IgdjIifV0=">
    <div data-prop-text="title">Node version support for v2</div>
    <p>The earliest version of Node supported by the New Relic Node.js v2 agent is 0.10. Node 0.8, which has not been updated since July of 2014, is not supported by v2. Customers running Node 0.8 have two options:</p>
    <ul>
      <li>
        <p>Upgrade to a supported version of Node and take advantage of the New Relic Node.js v2 agent's new features.</p>
      </li>
      <li>
        <p>Remain on New Relic Node.js v1 agent without the ability to use new features only available with updated agent versions.</p>
        <p><a href="https://github.com/nodejs/LTS/tree/2b4253#lts-schedule1">Node 0.10 also no longer receives updates</a>, but New Relic will continue to support this version of Node for the time being.</p>
        <p><strong>Recommendation:</strong> Upgrade to a newer version of Node as soon as possible.</p>
      </li>
    </ul>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoibnBtLXZlcnNpb25zIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJucG0gdmVyc2lvbiBzdXBwb3J0IGFzIG9mIHYyIn1d">
    <div data-prop-text="title">npm version support as of v2</div>
    <p>The New Relic Node.js agent now requires npm version 2.0.0 or higher. This version of npm comes packaged with Node 0.10.44 or higher.</p>
    <p>If you are using an earlier version of Node 0.10 you will need to first install npm 2.0.0 or higher, or upgrade to a newer version of Node. To install npm version 2:</p>
    <pre><code>$ npm install --global npm@2

</code></pre>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoidjItZmVhdHVyZS1mbGFncyJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiRmVhdHVyZSBmbGFncyBhcyBvZiB2MiJ9XQ==">
    <div data-prop-text="title">Feature flags as of v2</div>
    <p>As of New Relic Node.js agent v2:</p>
    <ul>
      <li><code>express_segments</code>: This feature is no longer configurable.</li>
      <li><code>cat</code>: This feature is now controlled by the <code>cross_application_tracer.enabled</code> configuration value.</li>
    </ul>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZnJhbWV3b3JrLW1pbmltdW0ifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IkZyYW1ld29yayBtaW5pbXVtIHZlcnNpb25zIGFzIG9mIHYyIn1d">
    <div data-prop-text="title">Framework minimum versions as of v2</div>
    <p>As of New Relic Node.js agent v2:</p>
    <div data-component="Table" data-prop="W10=">
      <div>
        <div>
          <div>
            <p><strong>Module</strong></p>
          </div>
          <div>
            <p><strong>V2 minimum</strong></p>
          </div>
          <div>
            <p><strong>Minimum before v2</strong></p>
          </div>
        </div>
      </div>
      <div>
        <div>
          <div>
            <p>express</p>
          </div>
          <div>
            <p>4.6.0</p>
          </div>
          <div>
            <p>2.0.0</p>
          </div>
        </div>
        <div>
          <div>
            <p>mysql</p>
          </div>
          <div>
            <p>2.0.0</p>
          </div>
          <div>
            <p>0.9.0</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
