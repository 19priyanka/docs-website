
<h2>Problem</h2>
<p>You are using a Ruby gem that is incompatible with the New Relic Ruby agent.</p>
<h2>Solution</h2>
<p>While New Relic strives to be compatible with all gems, there are some that will not work properly with the Ruby agent. This details incompatible gems and known workarounds.</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZGItY2hhcm1lciJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiZGItY2hhcm1lciJ9XQ==">
    <div data-prop-text="title">db-charmer</div>
    <p><strong>Problem</strong>: The <a href="http://rubygems.org/gems/db-charmer">db-charmer</a> gem has incompatibilities in how it patches Rails controllers.</p>
    <p><strong>Solution</strong>: Force New Relic to load and start before <code>DbCharmer.enable_controller_magic!</code> is called. For example, add the following to your <strong>config/application.rb</strong>:</p>
    <pre><code>require 'newrelic_rpm' 
NewRelic::Agent.manual_start 
DbCharmer.enable_controller_magic!

</code></pre>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZXNjYXBlX3V0aWxzIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJlc2NhcGVfdXRpbHMifV0=">
    <div data-prop-text="title">escape_utils</div>
    <p><strong>Problem:</strong> Use The <a href="https://github.com/brianmario/escape_utils">escape_utils</a> gem is incompatible with automatic instrumentation for New Relic's page load timing feature (sometimes referred to as real user monitoring or RUM). Due to the way escape_utils monkey-patches Rack, your whole HTML response may be escaped.</p>
    <p><strong>Solution:</strong> If you see HTML source instead of the rendered page, use either of these options:</p>
    <ul>
      <li>Remove the escape_utils gems.</li>
      <li>Use <a href="/docs/agents/ruby-agent/features/page-load-timing-ruby#manual_instrumentation">manual instrumentation</a> for page load timing.</li>
    </ul>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoicmlnaHRfaHR0cF9jb25uZWN0aW9uIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJyaWdodF9odHRwX2Nvbm5lY3Rpb24ifV0=">
    <div data-prop-text="title">right_http_connection</div>
    <p><strong>Problem:</strong> If the <a href="http://rubygems.org/gems/right_http_connection">right_http_connection</a> gem is loaded after <code>newrelic_rpm</code>, it patches <code>Net::HTTP</code> class in a way that causes New Relic's Externals instrumentation to be missed.</p>
    <p><strong>Solution:</strong> Ensure that <code>right_http_connection</code> is required before <code>newrelic_rpm</code>.</p>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiYXItb2N0b3B1cyJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiYXItb2N0b3B1cyJ9XQ==">
    <div data-prop-text="title">ar-octopus</div>
    <p><strong>Problem:</strong> The <a href="https://github.com/tchandy/octopus">ar-octopus</a> changes the way that ActiveRecord's connection management works, breaking the Ruby agent's ability to gather instance information, apply vendor-specific obfuscation to queries, and capture explain plans for long-running database queries.</p>
    <p><strong>Solution:</strong> No known workaround - either remove the ar-octopus gem, or continue to use it, in which case no explain plans will be captured.</p>
  </div>
</div>
