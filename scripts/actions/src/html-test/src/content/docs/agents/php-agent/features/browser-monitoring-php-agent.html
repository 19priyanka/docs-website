
<p>With the PHP agent, you can add <a href="/docs/browser/new-relic-browser/getting-started/introduction-new-relic-browser">browser monitoring</a> to your pages either automatically or manually. To enable browser monitoring in the user interface, follow the procedures to <a href="/docs/browser/new-relic-browser/installation/install-new-relic-browser-agent">install the browser agent.</a> Then follow the procedures in this section to set up the PHP agent.</p>
<p>To use browser monitoring with your PHP agent, ensure you have the latest release. For more information, see the <a href="/docs/agents/php-agent/installation/php-agent-installation-overview">agent installation instructions</a>.</p>
<h2>Use auto-instrumentation [#auto_instrumentation]</h2>
<p>To configure the agent to automatically instrument pages with the browser monitoring script, add or edit the <a href="/docs/agents/php-agent/configuration/php-agent-configuration#inivar-autorum">auto-instrumentation flag</a> in your INI file. The PHP agent will automatically inject the browser monitoring's JS snippet into your pages.</p>
<pre><code>newrelic.browser_monitoring.auto_instrument=1
</code></pre>
<p>Auto-instrumentation does not work when the HTTP header field <code>Content-Length</code> is set. To use browser monitoring in this situation, disable auto-instrumentation and <a href="#manual_instrumentation">manually insert</a> the JavaScript header and footer into your templates.</p>
<h2>Manually instrument via agent API [#manual_instrumentation]</h2>
<p>To manually configure browser monitoring, include the appropriate scripts in your pages. The New Relic PHP agent has an API to automatically generate the required JavaScript header and footer in place.</p>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
  <p>Calls to the PHP agent API are conditional on the <code>newrelic</code> extension being loaded so that the PHP agent is running. If the agent is not running, calls to generate the JavaScript header and footer will result in errors, as the functions will not be defined.</p>
</div>
<p>For more information, see:</p>
<ul>
  <li><a href="/docs/agents/php-agent/configuration/php-agent-configuration#inivar-autorum"><code>auto_instrument</code> agent settings</a></li>
  <li><code>newrelic_get_browser_timing_header()</code></li>
  <li><code>newrelic_get_browser_timing_footer()</code></li>
</ul>
<h2>Manually instrument for various frameworks [#manual_generic]</h2>
<p>This document does not provide detailed procedures to manually insert the Browser agent via the agent API. This is because there too many possible ways to construct a framework.</p>
<p>The <a href="#manual_examples">manual instrumentation examples</a> show how to add instrumentation to frameworks that already support auto-instrumentation. If you are using another framework or modified versions of Drupal or WordPress, be sure to call the API functions for instrumentation at the right place.</p>
<ol>
  <li>Insert the return value of <code>newrelic_get_browser_timing_header()</code> as part of the output page's <code>&#x3C;head></code> tag, preferably as the very first thing.</li>
  <li>As the very last thing before the closing <code>&#x3C;/body></code> tag in the document, or as close to it as possible, insert the return value of <code>newrelic_get_browser_timing_footer()</code>.</li>
</ol>
<p>Here are some basic examples.</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoibWFudWFsX3dwIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJXb3JkUHJlc3MifV0=">
    <div data-prop-text="title">WordPress</div>
    <p>This example shows how to call the PHP agent API to generate headers and footers for a WordPress installation using the default <code>twentyten</code> theme.</p>
    <ol>
      <li>
        <p>Insert a call to generate the JavaScript header in <code>website home dir/wordpress/wp-content/themes/twentyten/header.php</code>.</p>
        <pre><code>&#x3C;body &#x3C;?php body_class(); ?>>
&#x3C;div id="wrapper" class="hfeed">
  &#x3C;div id="header">
    &#x3C;?php if( extension_loaded('newrelic') ) { echo newrelic_get_browser_timing_header(); } ?>
    &#x3C;div id="masthead">
    ...
</code></pre>
      </li>
      <li>
        <p>Insert a call to generate the end user monitoring footer in <code>website home dir/wordpress/wp-content/themes/twentyten/footer.php</code>.</p>
        <pre><code>...
    &#x3C;/div>&#x3C;!-- #site-generator -->
  &#x3C;/div>&#x3C;!-- #colophon -->
  &#x3C;?php if( extension_loaded('newrelic') ) { echo newrelic_get_browser_timing_footer(); } ?>
&#x3C;/div>&#x3C;!-- #footer -->
</code></pre>
      </li>
    </ol>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoibWFudWFsX2RydXBhbCJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiRHJ1cGFsIn1d">
    <div data-prop-text="title">Drupal</div>
    <p>This example shows how to call the PHP agent API to generate headers and footers for a Drupal installation using the default <code>garland</code> theme.</p>
    <ol>
      <li>
        <p>Insert a call to generate the JavaScript header right after the opening header tag in <code>website home dir/drupal/themes/garland/page.tpl.php</code>.</p>
        <pre><code>&#x3C;div id="container" class="clear-block">
  &#x3C;div id="header">
    &#x3C;?php if( extension_loaded('newrelic') ) { echo newrelic_get_browser_timing_header(); } ?>
    &#x3C;div id="logo-floater">
    ...
</code></pre>
      </li>
      <li>
        <p>Insert a call to generate the footer right before the last closing layout tag:</p>
        <pre><code>...
&#x3C;/div>
&#x3C;?php if( extension_loaded('newrelic') ) { echo newrelic_get_browser_timing_footer(); } ?>
&#x3C;!-- /layout -->
  &#x3C;?php print $closure ?>
  &#x3C;/body>
&#x3C;/html>
</code></pre>
        <div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
          <p>In Drupal 7.15, <strong>Compress cached pages</strong> is turned on by default. If you also select <strong>Cache pages for anonymous users</strong>, the JavaScript (newrelic.js) is not inserted into the served pages for anonymous users. This is because Drupal's pages are compressed directly from the database before they are stored in the cache (with gzip), so New Relic's PHP agent does not have a chance to parse any HTML. In this situation, manual instrumentation provides a better opportunity to capture data for anonymous users.</p>
        </div>
      </li>
    </ol>
  </div>
</div>
<h2>View Browser data [#viewing]</h2>
<p>Once you enable browser monitoring and generate traffic for your app, data will appear in your app's <a href="/docs/browser/new-relic-browser/getting-started/browser-overview-page-website-performance-summary">Browser <strong>Summary</strong> page</a>. There is a short delay the first time you start the daemon (or when the PHP agent encounters a new application) while the daemon verifies the settings. After that, the New Relic JavaScript snippet is available.</p>
<h2>Disable auto-instrumentation [#disable]</h2>
<p>For how to disable browser monitoring with the PHP agent config, see <a href="/docs/agents/php-agent/configuration/php-agent-configuration#inivar-autorum">Browser monitoring config option</a>.</p>
<p>For how to use the API to disable browser monitoring, see <a href="/docs/agents/php-agent/php-agent-api/newrelic_disable_autorum"><code>newrelic_disable_autorum()</code></a>.</p>
