
<p>This document explains how to install and enable the <a href="/docs/agents/net-agent">APM .NET agent</a> on a Windows system.</p>
<h2>Install overview [#getting-started]</h2>
<p>The install instructions in this document are for a standard .NET agent installation on Windows. However, some setups have specific caveats and instructions, which you should read first:</p>
<ul>
  <li><a href="/docs/agents/net-agent/other-installation/install-net-agent-aspnet-core">ASP.NET Core</a></li>
  <li><a href="/docs/agents/net-agent/azure-installation">Azure install</a></li>
  <li><a href="/docs/agents/net-agent/install-guides/install-net-agent-using-nuget">NuGet install</a></li>
  <li><a href="/docs/agents/net-agent/installation/install-docker-container">Docker container install</a></li>
  <li><a href="/docs/agents/net-agent/installation/windows-communication-foundation-wcf">Windows Communication Foundation (WCF)</a></li>
  <li><a href="#enabling-the-agent">Apps not hosted in IIS</a></li>
</ul>
<p>The latest version of the .NET agent supports .NET Framework 4.5 and higher. If you have legacy applications you wish to monitor, see <a href="/docs/agents/net-agent/troubleshooting/technical-support-net-frameworks-40-or-earlier">support for earlier .NET Framework versions</a>.</p>
<h2>Download and install the agent [#msi]</h2>
<p>To install the .NET agent:</p>
<ol>
  <li>
    <p>Ensure you have admin rights for your Windows admin group. For more on this, see <a href="/docs/agents/net-agent/getting-started/compatibility-requirements-net-framework-agent#user-rights">permissions documentation</a>.</p>
  </li>
  <li>
    <p>Download the installer that matches your system architecture:</p>
    <ul>
      <li><a href="https://download.newrelic.com/dot_net_agent/latest_release/NewRelicDotNetAgent_x64.msi">64-bit</a></li>
      <li><a href="https://download.newrelic.com/dot_net_agent/latest_release/NewRelicDotNetAgent_x86.msi">32-bit</a></li>
    </ul>
  </li>
  <li>
    <p>Run the install wizard. Tips for using the install wizard:</p>
    <ul>
      <li>When prompted, input your <a href="/docs/accounts-partnerships/accounts/account-setup/license-key">New Relic license key</a>.</li>
      <li>Consider leaving <strong>Instrument all</strong> disabled if you will only be monitoring applications hosted with IIS. Otherwise, enable <strong>Instrument all</strong> and follow additional instructions to <a href="#enabling-the-agent">enable the agent for your application</a>.</li>
      <li>If you are changing an existing installation using the install wizard, select the <strong>Change</strong> option.</li>
      <li><strong>Optional</strong>: you can also <a href="#msi-command-line">run the installer via the command line or from a script</a>. This can be useful for automating your agent install.</li>
    </ul>
  </li>
  <li>
    <p>For each application you wish to monitor, give your application <a href="/docs/agents/net-agent/installation-and-configuration/naming-your-net-application">a meaningful name</a>.</p>
  </li>
  <li>
    <p>If your application is short-lived (existing for less than 60 seconds), it will require <a href="/docs/agents/net-agent/troubleshooting/monitor-short-lived-net-processes">configuration</a> or it won't report data.</p>
  </li>
  <li>
    <p>Restart affected applications. If using IIS, restart IIS.</p>
  </li>
</ol>
<p>If your application is receiving traffic, data should appear within a few minutes. If it doesn't, see <a href="https://docs.newrelic.com/docs/agents/net-agent/troubleshooting/no-data-appears-net">No data appears</a>.</p>
<h2>Run MSI via command line or from a script [#msi-command-line]</h2>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
  <p>This section describes a command-line alternative to the <a href="#msi">standard install procedure</a>.</p>
</div>
<p>Instead of using the MSI install wizard, you can run the MSI from the command line or from a script. This can be useful for automating your agent install.</p>
<p>Here is the command to perform a new agent install using the MSI installer. (For changes to an existing installation, use the <a href="#addlocal"><code>ADDLOCAL</code> command</a>.) Replace the highlighted sections with relevant values.</p>
<pre><code>msiexec.exe /i C:\PATH_TO\newrelic-agent-win-x86-VERSION.msi /qb NR_LICENSE_KEY=YOUR_LICENSE_KEY INSTALLLEVEL=1
</code></pre>
<p>The <code>INSTALLLEVEL</code> can be either <code>1</code> or <code>50</code>:</p>
<ul>
  <li><code>1</code>: Installs .NET agent with default options (described in table below). If your application is not hosted on IIS or uses IIS as a reverse proxy, you should use option <code>50</code>.</li>
  <li><code>50</code>: Installs the agent with InstrumentAllNETFramework enabled (described below).</li>
</ul>
<p>Instead of using the <code>INSTALLLEVEL</code> presets, you can customize which features to install with the <code>ADDLOCAL</code> command shown below. This is also the command you'd use to update an existing installation.</p>
<pre><code>msiexec.exe /i C:\PATH_TO\newrelic-agent-win-x86-VERSION.msi /qb NR_LICENSE_KEY=YOUR_LICENSE_KEY ADDLOCAL=OPTION_1, OPTION_2
</code></pre>
<p>Available options are:</p>
<div data-component="Table" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoibXNpLWNvbW1hbmQtbGluZS1vcHRpb25zIn1d">
  <div>
    <div>
      <div>
        <p><strong>Option</strong></p>
      </div>
      <div>
        <p><strong>Details</strong></p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p><code>NETFrameworkSupport</code></p>
      </div>
      <div>
        <p>Enabled by default. This identifies the registry keys used to attach the .NET profiler to a .NET Framework application. Without this, our .NET agent won't work for an IIS-hosted .NET Framework app.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>NETCoreSupport</code></p>
      </div>
      <div>
        <p>Enabled by default. This identifies the registry keys used to attach the .NET profiler to a .NET Core application. Without this, the .NET agent will not work for an IIS-hosted .NET Core app.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>InstrumentAllNETFramework</code></p>
      </div>
      <div>
        <p>This will result in all .NET Framework applications being instrumented by setting global environment variables. This setting is the equivalent of selecting <strong>Instrument all</strong> in the MSI install wizard.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>StartMenuShortcuts</code></p>
      </div>
      <div>
        <p>Enabled by default. Adds several useful shortcuts to your start menu.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>ASPNETTools</code></p>
      </div>
      <div>
        <p>Enabled by default. Adds the ASP.NET cache flush tool which, when run, clears out some .NET temporary files and restarts IIS.</p>
      </div>
    </div>
  </div>
</div>
<h2>Enable the agent for apps not in IIS [#enabling-the-agent]</h2>
<p>If the application you want to monitor is not hosted in IIS, you will follow the <a href="#msi">standard install procedure</a> but in addition you must explicitly enable the agent for that application. Enabling the agent differs for .NET Framework and .NET Core applications.</p>
<p>When following the <a href="#msi">standard install procedure</a>, we recommend that you enable <strong>Instrument all</strong>.</p>
<h3>Enable for .NET Framework [#enable-net-framework]</h3>
<p>Enable the agent for your application with one of the following methods:</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiYXBwLWNvbmZpZyJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiRW5hYmxlIHZpYSBhcHBsaWNhdGlvbiBjb25maWcgZmlsZSJ9XQ==">
    <div data-prop-text="title">Enable via application config file</div>
    <p>In the application's config file, add a new <code>appSetting</code> with a key named <code>NewRelic.AgentEnabled</code> and a value of <code>true</code>. For example, if the application name is <code>DataServices.exe</code>, edit <code>DataServices.exe.config</code> to:</p>
    <pre><code class="language-yaml">&#x3C;?xml version="1.0" encoding="utf-8"?>
&#x3C;configuration>
  &#x3C;appSettings>
    &#x3C;add key="NewRelic.AgentEnabled" value="true" />
    &#x3C;add key="NewRelic.AppName" value="DataServices" />
  &#x3C;/appSettings>

</code></pre>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoibmV3cmVsaWMtY29uZmlnIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJFbmFibGUgYnkgYXBwIG5hbWUgdmlhIG5ld3JlbGljLmNvbmZpZyAoZ2xvYmFsIG9yIGxvY2FsKSJ9XQ==">
    <div data-prop-text="title">Enable by app name via newrelic.config (global or local)</div>
    <p>You can use the <a href="/docs/agents/net-agent/configuration/net-agent-configuration"><code>newrelic.config</code> file</a> (either global or local), to choose what applications to monitor. In the configuration file, add an <code>instrumentation</code> element with a child <code>application</code> element for each application. In the instrumentation element, provide the base file name, with extension, you want to instrument (for example, <code>&#x3C;application name="DataServices.exe" /></code>).</p>
    <p>For example:</p>
    <pre><code class="language-yaml">&#x3C;instrumentation>
    &#x3C;applications>
      &#x3C;application name="BusinessLogicServices.exe" />
      &#x3C;application name="DataServices.exe" />
    &#x3C;/applications>
&#x3C;/instrumentation>

</code></pre>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoibmV3cmVsaWMtY29uZmlnLWxvY2FsIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJFbmFibGUgdmlhIHBsYWNlbWVudCBvZiBsb2NhbCBuZXdyZWxpYy5jb25maWcgZmlsZSJ9XQ==">
    <div data-prop-text="title">Enable via placement of local newrelic.config file</div>
    <p>You can use a <a href="/docs/agents/net-agent/configuration/net-agent-configuration#local">local <code>newrelic.config</code> file</a> to monitor an application:</p>
    <ul>
      <li>
        <p>Place the <code>newrelic.config</code> file in the directory containing the application's executable file.</p>
      </li>
      <li>
        <p>Set the <code>agentEnabled</code> attribute to true.</p>
        <p>For example:</p>
        <pre><code>&#x3C;configuration xmlns="urn:newrelic-config"
  agentEnabled="true">
</code></pre>
      </li>
    </ul>
  </div>
</div>
<h3>Enable for .NET Core [#enable-net-core]</h3>
<p>For .NET Core, you must configure your application to be monitored by setting the following environment variable:</p>
<p>We recommend setting the environment variables <strong>for each application</strong> you want to instrument. If you set them globally, you might instrument .NET processes other than your apps.</p>
<pre><code>CORECLR_ENABLE_PROFILING=1
</code></pre>
