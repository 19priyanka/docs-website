
<p>This document explains how to install APM's .NET Agent for an Azure Web App. This is not the same as installing the <a href="/docs/integrations/microsoft-azure-integrations/getting-started/introduction-azure-monitoring-integrations">Infrastructure integrations for Microsoft Azure</a>.</p>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
  <p>Before following these instructions, read the <a href="/docs/agents/net-agent/installation/new-relic-net-agent-install-introduction">.NET agent install overview</a>.</p>
</div>
<p>Use any of the following methods to add the New Relic .NET Agent to your Azure-deployed web app. The best option depends on your role, environment, deployments, etc. For example:</p>
<ul>
  <li>For operations teams that need to monitor the app, best practice may be to:
    <ul>
      <li><a href="#site-extention-install">Install using the Azure Site Extension</a></li>
    </ul>
  </li>
  <li>For developer teams, best practice may be to use NuGet:
    <ul>
      <li><a href="#nuget-install-net-framework">Install using NuGet (.NET Framework)</a></li>
      <li><a href="#nuget-install-net-core">Install using NuGet (.NET Core)</a></li>
    </ul>
  </li>
</ul>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
  <p>In order to monitor non-web apps (including WebJobs), or ASP.NET Core apps targeting .NET Framework, you will need to explicitly enable the agent for that application's .exe process via one of these two methods:</p>
  <ul>
    <li>
      <p><a href="https://docs.newrelic.com/docs/agents/net-agent/installation/install-net-agent-windows#newrelic-config-local">Enable via placement of local newrelic.config file</a></p>
    </li>
    <li>
      <p><a href="https://docs.newrelic.com/docs/agents/net-agent/installation/install-net-agent-windows#app-config">Enable via application config file</a></p>
      <p>In addition, WebJobs may need <a href="https://docs.newrelic.com/docs/agents/net-agent/custom-instrumentation/introduction-net-custom-instrumentation">custom instrumentation</a> for transactions to appear in APM, and <a href="https://docs.newrelic.com/docs/agents/net-agent/configuration/net-agent-configuration#service-sendDataOnExit">additional configuration</a> if they run for less than one minute.</p>
    </li>
  </ul>
</div>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
  <p><strong>Disable Application Insights</strong><br>Because the .NET Agent and Application Insights both rely on the CLR Profiler, only one may be active at a time. Application Insights must be disabled in order for the .NET Agent to function properly. For more information, see <a href="/docs/agents/net-agent/azure-troubleshooting/net-profiler-conflict-microsoft-application-insights">Application Insights troubleshooting procedures</a>.</p>
</div>
<h2>Install using the New Relic Azure Site Extension [#site-extention-install]</h2>
<p>To install the .NET agent for an Azure Web App using the <a href="https://www.nuget.org/packages/NewRelic.Azure.WebSites.Extension">New Relic Azure Site Extension</a>:</p>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
  <p>We recommend that you shut down your web application prior to installing the New Relic Azure Site Extension.</p>
</div>
<ol>
  <li>Add the site extension: Navigate to <code>http://[yoursitename].scm.azurewebsites.net</code>, then select <strong>Site extensions > Gallery</strong>.</li>
  <li>Select the plus
    <div data-component="Icon" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJuYW1lIiwidmFsdWUiOiJmZS1wbHVzIn1d"></div>icon next to the New Relic site extension.
  </li>
  <li>In the Azure portal, add New Relic <a href="#web-app-agent-settings">app settings</a> to your Azure App Service.</li>
  <li>Restart your web app to use the new version of the agent.</li>
</ol>
<h2>Install using NuGet (.NET Framework) [#nuget-install-net-framework]</h2>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
  <p>The NuGet packages in this procedure support only the old <code>packages.config</code>. They do not support the new <code>PackageReference</code> format. For more information, see <a href="https://docs.microsoft.com/en-us/nuget/consume-packages/package-references-in-project-files">Microsoft's package reference documentation</a>.</p>
</div>
<p>For multi-project solutions, make sure you have selected the correct project (for example, a specific web app project) before installing the NuGet package.</p>
<p>If you are upgrading the .NET Framework agent using NuGet, any changes you made in the <code>newrelic.config</code> will be overwritten. To preserve any changes, save your <code>newrelic.config</code> outside of your project, then restore it after upgrading.</p>
<p>To install the .NET agent on an Azure Web App using NuGet:</p>
<ol>
  <li>
    <p>In the Azure portal, verify your Azure Platform (32-bit or 64-bit): From the Azure sidebar menu, select <strong>App Services > Your Application > Settings > Configuration > General settings</strong>.</p>
  </li>
  <li>
    <p>Open your application in Visual Studio, and install the New Relic NuGet package by running the appropriate command from the <a href="http://docs.nuget.org/docs/start-here/using-the-package-manager-console"><strong>Package manager</strong> console</a>:</p>
    <ul>
      <li><strong>32-bit</strong>: <code>Install-Package NewRelic.Azure.WebSites</code></li>
      <li><strong>64-bit</strong>: <code>Install-Package NewRelic.Azure.WebSites.x64</code></li>
    </ul>
  </li>
  <li>
    <p>Publish your application.</p>
  </li>
  <li>
    <p>In the Azure portal, open the web app you want to monitor, then select <strong>Settings > Configuration</strong>.</p>
  </li>
  <li>
    <p>From <strong>Configuration</strong>, select <strong>+</strong> <strong>New application setting</strong> and add these key/value pairs:</p>
    <div data-component="Table" data-prop="W10=">
      <div>
        <div>
          <div>
            <p>Key</p>
          </div>
          <div>
            <p>Value</p>
          </div>
        </div>
      </div>
      <div>
        <div>
          <div>
            <p><code>COR_ENABLE_PROFILING</code></p>
          </div>
          <div>
            <p><code>1</code></p>
          </div>
        </div>
        <div>
          <div>
            <p><code>COR_PROFILER</code></p>
          </div>
          <div>
            <p><code>{71DA0A04-7777-4EC6-9643-7D28B46A8A41}</code></p>
          </div>
        </div>
        <div>
          <div>
            <p><code>COR_PROFILER_PATH</code></p>
          </div>
          <div>
            <p><code>D:\Home\site\wwwroot\newrelic\NewRelic.Profiler.dll</code></p>
          </div>
        </div>
        <div>
          <div>
            <p><code>NEWRELIC_HOME</code></p>
          </div>
          <div>
            <p><code>D:\Home\site\wwwroot\newrelic</code></p>
          </div>
        </div>
      </div>
    </div>
  </li>
  <li>
    <p>In the Azure portal, add New Relic <a href="#web-app-agent-settings">app settings</a> to your Azure App Service.</p>
  </li>
  <li>
    <p>Restart your web app.</p>
  </li>
</ol>
<h2>Install using NuGet (.NET Core) [#nuget-install-net-core]</h2>
<p>New Relic .NET Core agent supports Linux and Windows applications on Azure App Services. The installation process for Azure App Services differs from the .NET Core agent installation procedures for <a href="/docs/agents/net-agent/installation/install-net-core-agent-linux">Linux</a> and <a href="/docs/agents/net-agent/installation/install-net-agent-windows#installing_core">Windows</a>.</p>
<p>To install the .NET agent on an Azure Web App using NuGet:</p>
<ol>
  <li>
    <p>Install the <code>NewRelic.Agent</code> NuGet package.</p>
  </li>
  <li>
    <p>Modify the <strong>log</strong> node by adding a directory attribute to your <code>newrelic.config</code> file:</p>
    <div data-component="CollapserGroup" data-prop="W10=">
      <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoibG9nLXdpbmRvd3MifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IkxvZyBmaWxlIGNvbmZpZ3VyYXRpb24gZm9yIFdpbmRvd3MifV0=">
        <div data-prop-text="title">Log file configuration for Windows</div>
        <pre><code>log directory="D:\Home\LogFiles\NewRelic" level="info"/log

</code></pre>
      </div>
      <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoibG9nLWxpbnV4In0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJMb2cgZmlsZSBjb25maWd1cmF0aW9uIGZvciBMaW51eCJ9XQ==">
        <div data-prop-text="title">Log file configuration for Linux</div>
        <pre><code>log directory="/home/LogFiles/NewRelic" level="info"/log

</code></pre>
      </div>
    </div>
  </li>
  <li>
    <p>Publish your application.</p>
  </li>
  <li>
    <p>In the Azure portal, open the web app you want to monitor, then select <strong>Settings > Configuration</strong>.</p>
  </li>
  <li>
    <p>From <strong>Configuration</strong>, select <strong>+</strong> <strong>New application setting</strong> and add these key/value pairs:</p>
    <div data-component="CollapserGroup" data-prop="W10=">
      <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoibnVnZXQtd2luZG93cyJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiRW52aXJvbm1lbnQgdmFyaWFibGVzIGZvciBXaW5kb3dzIn1d">
        <div data-prop-text="title">Environment variables for Windows</div>
        <div data-component="Table" data-prop="W10=">
          <div>
            <div>
              <div>
                <p>Key</p>
              </div>
              <div>
                <p>Value</p>
              </div>
            </div>
          </div>
          <div>
            <div>
              <div>
                <p><code>CORECLR_ENABLE_PROFILING</code></p>
              </div>
              <div>
                <p><code>1</code></p>
              </div>
            </div>
            <div>
              <div>
                <p><code>CORECLR_PROFILER</code></p>
              </div>
              <div>
                <p><code>{36032161-FFC0-4B61-B559-F6C5D41BAE5A}</code></p>
              </div>
            </div>
            <div>
              <div>
                <p><code>CORECLR_PROFILER_PATH_32</code></p>
              </div>
              <div>
                <p><code>D:\Home\site\wwwroot\newrelic\x86\NewRelic.Profiler.dll</code></p>
              </div>
            </div>
            <div>
              <div>
                <p><code>CORECLR_PROFILER_PATH_64</code></p>
              </div>
              <div>
                <p><code>D:\Home\site\wwwroot\newrelic\NewRelic.Profiler.dll</code></p>
              </div>
            </div>
            <div>
              <div>
                <p><code>CORECLR_NEWRELIC_HOME</code></p>
              </div>
              <div>
                <p><code>D:\Home\site\wwwroot\newrelic</code></p>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoibnVnZXQtbGludXgifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IkVudmlyb25tZW50IHZhcmlhYmxlcyBmb3IgTGludXgifV0=">
        <div data-prop-text="title">Environment variables for Linux</div>
        <div data-component="Table" data-prop="W10=">
          <div>
            <div>
              <div>
                <p>Key</p>
              </div>
              <div>
                <p>Value</p>
              </div>
            </div>
          </div>
          <div>
            <div>
              <div>
                <p><code>CORECLR_ENABLE_PROFILING</code></p>
              </div>
              <div>
                <p><code>1</code></p>
              </div>
            </div>
            <div>
              <div>
                <p><code>CORECLR_PROFILER</code></p>
              </div>
              <div>
                <p><code>{36032161-FFC0-4B61-B559-F6C5D41BAE5A}</code></p>
              </div>
            </div>
            <div>
              <div>
                <p><code>CORECLR_PROFILER_PATH</code></p>
              </div>
              <div>
                <p><code>/home/site/wwwroot/newrelic/libNewRelicProfiler.so</code></p>
              </div>
            </div>
            <div>
              <div>
                <p><code>CORECLR_NEWRELIC_HOME</code></p>
              </div>
              <div>
                <p><code>/home/site/wwwroot/newrelic</code></p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </li>
  <li>
    <p>In the Azure portal, add New Relic <a href="#web-app-agent-settings">app settings</a> to your Azure App Service.</p>
  </li>
  <li>
    <p>Restart your web app.</p>
  </li>
</ol>
<h2>Add New Relic app settings to Azure App Services [#web-app-agent-settings]</h2>
<p>To add your app settings:</p>
<ol>
  <li>
    <p>Make sure you have your <a href="/docs/accounts-partnerships/accounts/account-setup/license-key">license key</a> before adding the New Relic .NET agent's app settings.</p>
  </li>
  <li>
    <p>In the Azure portal, open the web app you want to monitor, then select <strong>Configuration > Application settings</strong>.</p>
  </li>
  <li>
    <p>From <strong>Application settings</strong>, select <strong>+</strong> <strong>New application setting</strong> and add these key/value pairs:</p>
    <div data-component="Table" data-prop="W10=">
      <div>
        <div>
          <div>
            <p>Key</p>
          </div>
          <div>
            <p>Value</p>
          </div>
        </div>
      </div>
      <div>
        <div>
          <div>
            <p><code>NEW_RELIC_LICENSE_KEY</code></p>
          </div>
          <div>
            <p><code>YOUR_LICENSE_KEY</code></p>
          </div>
        </div>
        <div>
          <div>
            <p><code>NEW_RELIC_APP_NAME</code></p>
          </div>
          <div>
            <p><code>YOUR_APP_NAME</code></p>
          </div>
        </div>
      </div>
    </div>
  </li>
  <li>
    <p>Save and restart your web app.</p>
  </li>
</ol>
<p>Setting the license key and app name with the App settings will override the <code>newrelic.config</code>.</p>
<p>To verify your app's environment variables in your app's Kudu diagnostic console, go to <strong>Environment > Environment variables</strong>.</p>
<p>For example:</p>
<pre><code>https://myappname.scm.azurewebsites.net/Env.cshtml#envVariables
</code></pre>
<h2>View your app's performance [#checking-application-performance]</h2>
<p>Your application must receive traffic in order for you to view its performance in New Relic. You may need to wait a few minutes for data to start appearing. If no data appears, see the <a href="/docs/agents/net-agent/azure-troubleshooting/azure-web-apps-using-always-on-and-no-data-appears">troubleshooting procedures</a> for Azure Web Apps.</p>
<p>To view your app's performance in APM: Go to <strong><a href="https://one.newrelic.com">one.newrelic.com</a> > APM > (select an app)</strong>. The <a href="/docs/apm/applications-menu/monitoring/apm-overview-page">APM <strong>Summary</strong> page</a> automatically appears. You can also view detailed information about <a href="/docs/apm/applications-menu/error-analytics/introduction-error-analytics">errors</a>, <a href="/docs/apm/applications-menu/features/analyze-database-instance-level-performance-issues">database and instance performance issues</a>, and <a href="/docs/apm/new-relic-apm/getting-started/introduction-new-relic-apm">more</a>.</p>
<p>If you created your New Relic app prior to October 2017, you can use the Azure portal to select the New Relic account blade. You will be automatically logged in with <a href="/docs/accounts-partnerships/accounts/saml-single-sign/new-relic-partners-saml-sso">SAML Single Sign-on (SSO)</a> to APM. You can also view your application's error rate and throughput data in the Azure portal by going to <strong>New Relic Accounts > (select your app)</strong>.</p>
<h2>Troubleshooting</h2>
<p>If no data appears after installing the agent, generating traffic for your app, and waiting a few minutes, try these troubleshooting tips:</p>
<ul>
  <li>Make sure that all files in the <code>newrelic</code> directory at the root of your app got published to Azure.</li>
  <li>Make sure the environment variables are set correctly.</li>
  <li>Make sure Application Insights isn't installed and configured on the application. For more information, see the <a href="/docs/agents/net-agent/azure-troubleshooting/net-profiler-conflict-microsoft-application-insights">Application Insights troubleshooting procedures</a>.</li>
  <li>Refer to additional <a href="/docs/agents/net-agent/azure-troubleshooting/">Azure troubleshooting procedures</a> as applicable.</li>
</ul>
