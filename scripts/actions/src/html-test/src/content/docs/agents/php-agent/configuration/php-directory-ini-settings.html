
<p>Most <a href="/docs/php/php-agent-phpini-settings">PHP agent configuration variables</a> can be set on a per-directory basis. This option is often used when there is a single web server serving multiple applications, and you want to adjust settings (for example, the app name) on an application-by-application basis.</p>
<p>The process for setting per-directory values depends on the environment. This document describes the three most common environments:</p>
<ul>
  <li><a href="#perdir-apache">Apache</a></li>
  <li><a href="#php-fpm_per-dir">PHP-FPM</a></li>
  <li><a href="#PHP-FPM_nginix">NGINX</a></li>
</ul>
<p>For other app naming options, see <a href="/docs/agents/php-agent/configuration/name-your-php-application">Name your PHP application</a>.</p>
<h2>Another option: API calls [#api-calls]</h2>
<p>If you are trying to change the name the application reports as, you can use the <a href="/docs/agents/php-agent/php-agent-api/newrelic_set_appname"><code>newrelic_set_appname()</code></a> API call instead of per-directory settings. For other settings that you can modify with the API, see <a href="/docs/php/the-php-api">PHP agent API</a>.</p>
<p>If you do not have access to the code for your application, or if you need to isolate your applications to their own virtual hosts for other reasons, then use the following per-directory settings to override any <a href="/docs/agents/php-agent/configuration/php-agent-configuration">configuration file settings</a>.</p>
<h2>Apache per-directory settings for PHP [#perdir-apache]</h2>
<p>When using the PHP module, Apache provides two mechanisms for setting PHP variables outside the INI file:</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiaW5pLWFwYWNoZSJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjp7InR5cGUiOiJtZHhWYWx1ZUV4cHJlc3Npb24iLCJ2YWx1ZSI6Ijw+RWRpdCB0aGUgPElubGluZUNvZGU+aHR0cGQuY29uZjwvSW5saW5lQ29kZT4gZmlsZSBvciBvbmUgb2YgdGhlIGZpbGVzIGl0IGluY2x1ZGVzLjwvPiIsInBvc2l0aW9uIjp7InN0YXJ0Ijp7ImxpbmUiOjM2LCJjb2x1bW4iOjExLCJvZmZzZXQiOjE3MjF9LCJlbmQiOnsibGluZSI6MzYsImNvbHVtbiI6MTAwLCJvZmZzZXQiOjE4MTB9fX19XQ==">
    <div data-prop-text="title">[object Object]</div>
    <p>Use the syntax from the INI file examples when your web server serves up multiple domains. To view each of these domains separately in New Relic:</p>
    <ol>
      <li>
        <p>For your main domain, set <code>newrelic.appname = "My Main Domain"</code> in your global INI file.</p>
      </li>
      <li>
        <p>Override the value for each of the virtual hosts by adding <code>php_value</code> entries as part of your virtual host configuration.</p>
        <div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
          <p>Ensure you use the proper module name for your PHP install. Replace <code>PHP_MODULE</code> in the examples below with the name of the installed PHP5 module. This name depends on the Linux and/or PHP distribution being used. For example, common names include <code>php5_module</code>, <code>mod_php5</code>, <code>php_module</code>, etc. Capitalization may vary.</p>
        </div>
        <p>For Apache servers, you can find the module names in one of the following ways. Each will generate a list of installed modules.</p>
      </li>
    </ol>
    <ul>
      <li>
        <p>From the command line, run:</p>
        <pre><code>apachectl -t -D DUMP_MODULES
</code></pre>
        <p><strong>OR</strong></p>
      </li>
      <li>
        <p>From within a webpage, use:</p>
        <pre><code>&#x3C;?php
print_r(apache_get_modules());
?>
</code></pre>
        <div data-component="CollapserGroup" data-prop="W10=">
          <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoic2VwYXJhdGluZy1kb21haW5zIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJTZXR0aW5nIGFwcG5hbWUgYnkgZG9tYWluIn1d">
            <div data-prop-text="title">Setting appname by domain</div>
            <p>Here is an example of separating domains, where PHP_MODULE is the name of your PHP5 module.</p>
            <pre><code>&#x3C;VirtualHost 192.168.42.43>
  ServerName www.myvhost1.com
  DocumentRoot "/path/to/vhost1/"
  ...
  &#x3C;IfModule PHP_MODULE>
    php_value newrelic.appname "Virtual Host 1"
  &#x3C;/IfModule>
&#x3C;/VirtualHost>

&#x3C;VirtualHost 192.168.123.45>
  ServerName www.myvhost2.com
  DocumentRoot "/path/to/vhost2/"
  ...
  &#x3C;IfModule PHP_MODULE>
    php_value newrelic.appname "Virtual Host 2"
  &#x3C;/IfModule>
&#x3C;/VirtualHost>

</code></pre>In the above example, `newrelic.appname` is set to a different value for each virtual host.
          </div>
        </div>
        <p>For string and number values, use <code>php_value name VALUE</code>, where:</p>
      </li>
      <li>
        <p><code>name</code> is the name of the INI setting to modify as listed in the <a href="/docs/php/php-agent-phpini-settings">PHP INI settings</a>.</p>
      </li>
      <li>
        <p><code>VALUE</code> is the value you want to set to for that particular virtual host.</p>
        <p>Be sure to surround string values in quotes marks <code>"</code>.</p>
        <p>If you want to change a boolean setting, use the syntax <code>php_flag name VALUE</code>, where <code>name</code> is the variable name as listed in the <a href="/docs/php/php-agent-phpini-settings">PHP INI settings</a>, and <code>VALUE</code> is either <code>on</code> or <code>off</code>.</p>
        <p>To disable the New Relic agent completely for a virtual host, use a boolean flag:</p>
        <pre><code>&#x3C;VirtualHost 192.168.56.78>
  ServerName www.myvhost3.com
  DocumentRoot "/path/to/vhost3/"
  ...
  &#x3C;IfModule PHP_MODULE>
    php_flag newrelic.enabled off
  &#x3C;/IfModule>
&#x3C;/VirtualHost>
</code></pre>
      </li>
    </ul>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiaHRhY2Nlc3MtYXBhY2hlIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOnsidHlwZSI6Im1keFZhbHVlRXhwcmVzc2lvbiIsInZhbHVlIjoiPD5FZGl0IHRoZSA8SW5saW5lQ29kZT4uaHRhY2Nlc3M8L0lubGluZUNvZGU+IGZpbGUuPC8+IiwicG9zaXRpb24iOnsic3RhcnQiOnsibGluZSI6MTIwLCJjb2x1bW4iOjExLCJvZmZzZXQiOjQ3ODd9LCJlbmQiOnsibGluZSI6MTIwLCJjb2x1bW4iOjY3LCJvZmZzZXQiOjQ4NDN9fX19XQ==">
    <div data-prop-text="title">[object Object]</div>
    <p>Use the syntax from the INI file examples inside an <code>.htaccess</code> file. For example:</p>
    <pre><code>php_value newrelic.appname "My Blog App"

</code></pre>This allows you to control settings on a per-directory basis from within the directories.
    In this example, your web server has its document root at `/data/webroot`. You also have two sub-directories for specialized applications:
    * Your **`/data/webroot/blo`g** contains a blog application.
    * Your `/data/webroot/shop` contains a shopping cart application.
    To have all three portions of your site reported as distinct applications in the New Relic UI:
    1. Set the name of your main application in your INI file.
    2. Override that name using an `.htaccess` file in each of the specialized directories.
    Any part of your web server (for example, `/data/webroot/something`) that does not have a specific `.htaccess` file will use the global application name defined in the INI file.
    &#x3C;Callout variant="important">
    The `.htaccess` file must be in the top-level directory for that application. Objects in that directory, or its subdirectories, will use the value specified in the `.htaccess` file.
    &#x3C;/Callout>
    For more information about using and securing **`.htaccess`** files, see the [Apache HTTP server tutorial](http://httpd.apache.org/docs/2.2/howto/htaccess.html "Link opens in a new window").
  </div>
</div>
<h2>PHP-FPM per-directory settings [#php-fpm_per-dir]</h2>
<p>The FastCGI Process Manager (<strong>PHP-FPM</strong>) is dedicated to PHP. It spawns a number of worker processes that wait for requests. It increases performance by not re-initializing the PHP engine on each invocation, allowing each process to deal with a number of requests before it recycles.</p>
<p>For more information on PHP-FPM, see <a href="http://php-fpm.org/about/" title="Link opens in a new window">PHP-FPM's about page</a> and <a href="http://www.php.net/manual/en/install.fpm.php" title="Link opens in a new window">FastCGI Process Manager</a> on <a href="http://www.php.net/" title="Link opens in a new window">php.net</a>.</p>
<p>When using PHP-FPM, there are two mechanisms for setting PHP variables outside the INI file and one special technique for <strong>NGINX</strong>:</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoicGVyZGlyLWZwbSJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjp7InR5cGUiOiJtZHhWYWx1ZUV4cHJlc3Npb24iLCJ2YWx1ZSI6Ijw+RWRpdCB0aGUgPHN0cm9uZz5QSFAtRlBNIHBvb2w8L3N0cm9uZz4gcGVyLWRpcmVjdG9yeSBzZXR0aW5nczwvPiIsInBvc2l0aW9uIjp7InN0YXJ0Ijp7ImxpbmUiOjE2MSwiY29sdW1uIjoxMSwib2Zmc2V0Ijo3MDk5fSwiZW5kIjp7ImxpbmUiOjE2MSwiY29sdW1uIjo3OSwib2Zmc2V0Ijo3MTY3fX19fV0=">
    <div data-prop-text="title">[object Object]</div>
    <div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
      <p>Changing variables on a per-directory basis can be more difficult if you use <strong>PHP-FPM</strong>. You must use multiple PHP-FPM pools, one for each virtual host or unique application.</p>
    </div>
    <p>A <strong>pool</strong> is a dedicated set of worker children that will only serve requests for that pool. Because it requires dedicated worker children, PHP-FPM scales poorly if you have a large number of virtual hosts or applications for which you want to set individual options.</p>
    <p>To configure PHP-FPM on a per-directory basis:</p>
    <ol>
      <li>
        <p>Set the main application name in the INI file.</p>
      </li>
      <li>
        <p>Set up two pools for the two additional applications.</p>
      </li>
      <li>
        <p>Override the application name setting in those pools.</p>
        <p>Each pool has to have a unique connection mechanism (so you can identify which pool to use in your web server configuration file). Here is an example of <code>php-fpm.conf</code>:</p>
        <pre><code>[app1]
listen=/tmp/pool-app1.sock
php_value[newrelic.appname] = "My App 1"

[app2]
listen=/tmp/pool-app2.sock
php_value[newrelic.appname] = "My App 2"

[app3]
listen=/tmp/pool-app3.sock
php_flag[newrelic.enabled] = off
</code></pre>
        <p>The general format of the per-pool variable settings is <code>php_value[name] = VALUE</code> for string or numeric variables, or <code>php_flag[name] = VALUE</code> for boolean values. Always surround string values with quote marks <code>"</code>. Boolean values must be either <code>on</code> or <code>off</code>.</p>
        <p>Once the configuration file is set up, the web server must be instructed to use the different pools for different parts of the website. For more information, refer to the documentation for your web server.</p>
      </li>
    </ol>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiUEhQLUZQbV91c2VyX2luaSJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjp7InR5cGUiOiJtZHhWYWx1ZUV4cHJlc3Npb24iLCJ2YWx1ZSI6Ijw+Q3JlYXRlIGEgPElubGluZUNvZGU+LnVzZXIuaW5pPC9JbmxpbmVDb2RlPiBmaWxlLjwvPiIsInBvc2l0aW9uIjp7InN0YXJ0Ijp7ImxpbmUiOjE5OCwiY29sdW1uIjoxMSwib2Zmc2V0Ijo4ODkzfSwiZW5kIjp7ImxpbmUiOjE5OCwiY29sdW1uIjo2Nywib2Zmc2V0Ijo4OTQ5fX19fV0=">
    <div data-prop-text="title">[object Object]</div>
    <p>You can use the syntax from the INI file example for CGI/FastCGI in a <code>.user.ini</code> file. This is similar to a <code>.htaccess</code> file for Apache but is unique to PHP-FPM. The directory that PHP is executed in is scanned for a <code>.user.ini</code> file. More information about this feature is available in the <a href="http://php.net/manual/en/configuration.file.per-user.php">PHP <code>user.ini</code> files documentation</a>.</p>
    <p>Change the name of the app using the following steps In the root directory of the web page.</p>
    <ol>
      <li>
        <p>Create the <code>.user.ini</code> file</p>
      </li>
      <li>
        <p>Add the setting you wish to change<br><code>newrelic.appname = "New Appname"</code></p>
      </li>
      <li>
        <p>Save the file.</p>
        <p>By default, the <strong><code>.user.ini</code> file</strong> is read every five minutes so no restart is necessary</p>
        <p>This is useful in the following scenarios:</p>
      </li>
      <li>
        <p>The server config doesn't work. In NGINX/PHP-FPM setup, there can be a lack of communication between FastCGI and PHP and the information from<br><code>fastcgi_param PHP_VALUE newrelic.appname="Appname"</code><br>never reaches PHP.</p>
      </li>
      <li>
        <p>The <code>.htaccess</code> doesn't work, such as where PHP is implemented with suPHP</p>
      </li>
    </ol>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiUEhQLUZQTV9uZ2luaXgifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6eyJ0eXBlIjoibWR4VmFsdWVFeHByZXNzaW9uIiwidmFsdWUiOiI8PkVkaXQgdGhlIDxzdHJvbmc+TkdJTlggY29uZmlnIGZpbGU8L3N0cm9uZz4uPC8+IiwicG9zaXRpb24iOnsic3RhcnQiOnsibGluZSI6MjIxLCJjb2x1bW4iOjExLCJvZmZzZXQiOjEwMTE1fSwiZW5kIjp7ImxpbmUiOjIyMSwiY29sdW1uIjo2Miwib2Zmc2V0IjoxMDE2Nn19fX1d">
    <div data-prop-text="title">[object Object]</div>
    <div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
      <p>This section applies only to PHP 5.3.3 or higher.</p>
    </div>
    <p>Here is a small fragment of an NGINX config file showing the general procedure to pass values to your FastCGI manager based on an NGINX location.</p>
    <pre><code>location /blog {
  fastcgi_param PHP_VALUE "newrelic.appname=My Blog";
  ...
}

location /shop {
  fastcgi_param PHP_VALUE "newrelic.appname=Shopping Cart";
  ...
}

location /admin{
  fastcgi_param PHP_VALUE "newrelic.enabled=false";
  ...
}

</code></pre>
    <pre><code>
if (extension_loaded ('newrelic')) {
    newrelic_set_appname ("My App 1");
  }

</code></pre>&#x3C;Callout variant="tip">
    A better approach for NGINX may be to use API calls. The following code snippet (for PHP agent 2.7 or higher) is an example.
    &#x3C;/Callout>
  </div>
</div>
<h2>Roll-up application names [#perdir-rollup]</h2>
<p>If you want to have an overall view of how the server is performing across all virtual hosts or all applications, it is convenient to be able to report to more than one application at a time. For example, report to a virtual host specific application as well as a roll-up application.</p>
<p>To do this, set more than one application name for the <a href="/docs/php/php-agent-phpini-settings#inivar-appname"><code>newrelic.appname</code></a> parameter by separating each application name with a semicolon. The primary application name is first, and the secondary application names next. You can define up to two extra application names.</p>
<p>For example:</p>
<pre><code>newrelic.appname="Virtual Host 1;All Virtual Hosts"
</code></pre>
<p>This will report to two New Relic applications: "Virtual Host 1" and "All Virtual Hosts".</p>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
  <p>This feature is only available in versions 2.4 or higher of the PHP agent.</p>
</div>
