
<p>New Relic supports versions 3, 4, 5, and 6 of the <strong>Guzzle HTTP client library</strong> with <a href="/docs/release-notes/agent-release-notes/php-release-notes">New Relic PHP agent version 5.4</a> or higher.</p>
<p>The Guzzle library allows both sequential and parallel requests. This page describes how each type of request will appear in the <a href="https://docs.newrelic.com/docs/apm/applications-menu/monitoring/apm-overview-page"><strong>Summary</strong> page</a> in the New Relic UI. To discover which call was the slowest, view the <a href="https://docs.newrelic.com/docs/apm/applications-menu/monitoring/external-services-page">External Services page</a> which displays timing for individual external calls.</p>
<h2>Sequential requests [#more_help]</h2>
<p>This PHP code makes multiple sequential requests with Guzzle:</p>
<pre><code>$client = new \GuzzleHttp\Client;
$response = $client->get('http://YOUR_SITE.com/api/foo');
$client->delete('http://YOUR_SITE.com/api/foo/'.$response->getBody());
</code></pre>
<p>This code would appear in the New Relic UI as:</p>
<p>
  <img src="./images/guzzle_sequential.png" alt="guzzle_sequential.png" title="Sequential requests with Guzzle">
</p>
<p><a href="http://one.newrelic.com/"><strong>one.newrelic.com</strong></a> <strong>> APM > (selected app) > Overview > Web transactions time</strong>: Sequential requests with Guzzle in the New Relic UI.</p>
<p><a href="/docs/data-analysis/user-interface-functions/response-time">Response time</a> is shown as the dark blue line. The green <strong>web external time</strong> represents time spent in the Guzzle library. Because the requests were made sequentially, the response time is <strong>equal</strong> to the <a href="/docs/data-analysis/user-interface-functions/response-time#response-time-total-time">total time</a> spent in PHP, MySQL, and web external activities.</p>
<h2>Parallel requests [#more_help]</h2>
<p>This PHP code makes multiple requests in parallel by unwrapping an array of promises:</p>
<pre><code>$client = new \GuzzleHttp\Client;

$promises = [
  $client->getAsync('http://YOUR_SITE.com/api/foo'),
  $client->getAsync('http://YOUR_SITE.com/api/bar'),
  $client->getAsync('http://YOUR_SITE.com/api/quux'),
];

\GuzzleHttp\Promise\unwrap($promises);
</code></pre>
<p>This code would appear in the New Relic UI as:</p>
<p>
  <img src="./images/guzzle_parallel.png" alt="Parallel requests with Guzzle" title="Parallel requests with Guzzle">
</p>
<p><a href="http://one.newrelic.com/"><strong>one.newrelic.com</strong></a> <strong>> APM > (selected app) > Summary > Web transactions time</strong>: Parallel requests with Guzzle in the New Relic UI</p>
<p>The green <strong>web external time</strong> represents time spent in the Guzzle library. Because the requests were performed asynchronously, the <a href="/docs/data-analysis/user-interface-functions/response-time#response-time-total-time">total time</a> spent in PHP, MySQL, and web external is <strong>greater</strong> than the response time.</p>
<h2>Timing with Guzzle 6 [#timing]</h2>
<p>Unlike previous versions, Guzzle 6 does not generate an event when a request is sent. Instead, the agent begins timing a request when the request object is created. If a request object is created and additional work is done before sending, New Relic may report that the request took longer than it actually did.</p>
<h2>Disable Guzzle support</h2>
<p>To disable Guzzle support:</p>
<ol>
  <li>Add <code>newrelic.guzzle.enabled = false</code> to your <code>newrelic.ini</code> file.</li>
  <li><a href="https://docs.newrelic.com/docs/agents/php-agent/troubleshooting/why-when-restart-your-web-server-php">Restart your web server</a> (Apache, Nginx, PHP-FPM, etc.).</li>
</ol>
