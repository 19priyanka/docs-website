
<p><a href="http://www.activestate.com/cloud">Stackato</a> is a private PaaS solution developed by ActiveState. The Python agent can be used in conjunction with Stackato by following the steps outlined below.</p>
<p>The instructions here require you to use version 0.6 or higher of the Stackato VM image. If you use an older version of the Stackato VM image you will need to upgrade.</p>
<h2>Contents [#qiklinks]</h2>
<h2>Package installation</h2>
<p>ActiveState <a href="http://code.activestate.com/pypm/newrelic/">hosts a copy</a> of the Python agent package in their <a href="http://code.activestate.com/pypm">PyPM</a> package repository. To install the Python package for the agent, add <code>newrelic</code> into the <strong>requirements.txt</strong> file on a line by itself:</p>
<pre><code>newrelic
</code></pre>
<p>You would then perform the <code>update</code> command using the Stackato client.</p>
<p>The PyPM package repository updates daily. If you need to use a newer version of the Python agent than is available from the PyPM package repository, you will instead need to fallback to using <a href="http://www.pip-installer.org/en/latest/">pip</a> and source packages from <a href="http://pypi.python.org">PyPI</a>.</p>
<p>In this case you will need to create in addition to the <strong>requirements.txt</strong> file used by PyPM, a <strong>requirements.pip</strong> file as input for pip. In the <strong>requirements.pip</strong> file you should list the <code>newrelic</code> package.</p>
<h2>Agent configuration file</h2>
<p>You will need to generate the Python agent configuration on your local system as described in <a href="/docs/agents/python-agent/installation-and-configuration/python-agent-installation">Python agent installation</a> and add that to the directory you push to your Stackato instance.</p>
<p>The option in the agent configuration file for specifying where the agent log file output should go, should be set to:</p>
<pre><code>log_file = stderr
</code></pre>
<h2>Python agent initialization [#python-agent-intialization]</h2>
<p>Although you can manually include code for initializing the Python agent into the Python module containing your WSGI application entry point, as per instructions for <a href="/docs/agents/python-agent/installation-and-configuration/python-agent-integration">integration with your Python application</a>, a simplified startup method is also available by using the <strong>newrelic-admin</strong> script.</p>
<p>In the case where you do it manually, such changes would typically be made to the <strong>wsgi.py</strong> file which includes your Python web application. Since the agent configuration file would be in the same directory, the change to the <strong>wsgi.py</strong> file would be to add:</p>
<pre><code>import newrelic.agent
config_file = os.path.join(os.path.dirname(__file__), 'newrelic.ini')
newrelic.agent.initialize(config_file)
</code></pre>
<p>Because the directory in the filesystem where the application is installed can change, the location of the agent configuration is calculated relative to the location of the <strong>wsgi.py</strong> file automatically.</p>
<p>The alternative to adding code to perform initialization of the agent manually is to use the <strong>newrelic-admin</strong> script.</p>
<p>If you are explicitly defining in the <strong>stackato.yml</strong> file how to startup your web application by setting the <code>web</code> entry in the <code>processes</code> section:</p>
<pre><code>processes:
    web: python app.py
</code></pre>
<p>You would replace <code>web</code> so it reads:</p>
<pre><code>processes:
    web: newrelic-admin run-program python app.py
</code></pre>
<p>In other words, you are prefixing the existing command with <code>newrelic-admin run-program</code>.</p>
<p>At the same time, you should also add an <code>env</code> section to the <strong>stackato.yml</strong> file with:</p>
<pre><code>env:
    NEW_RELIC_CONFIG_FILE: newrelic.ini
</code></pre>
<p>If you aren't overriding the <code>web</code> entry already and instead are relying on the default of the Stackato stack running uWSGI for you the process is a bit different. In this case you will need to add a <code>web</code> entry to <strong>stackato.yml</strong> as:</p>
<pre><code>processes:
    web: newrelic-admin run-program $PROCESSES_WEB
</code></pre>
<p>The <code>env</code> section is also again required.</p>
<p>If <code>PROCESSES_WEB</code> is not defined and this does not work it indicates you are using an older VM image and should upgrade.</p>
<p>Whether the manual or more automated method is used, if necessary for the Python web framework being used, the WSGI application entry point object will also need to be wrapped appropriately.</p>
