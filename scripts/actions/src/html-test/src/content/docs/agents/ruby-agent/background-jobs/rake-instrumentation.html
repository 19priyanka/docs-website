
<p>The New Relic Ruby agent has opt-in support for instrumenting Rake tasks. This requires:</p>
<ul>
  <li>Rake version 10.0.0 or higher</li>
  <li>Ruby agent version 3.13.0 or higher</li>
</ul>
<p>To instrument Rake tasks, <a href="#enabling-rake-support">specify the tasks by name</a> in your <code>newrelic.yml</code> file.</p>
<h2>Enable Rake support [#enabling-rake-support]</h2>
<p>To instrument your app's Rake tasks, add the names of the target tasks to the <code>rake.tasks</code> element in your <code>newrelic.yml</code> file. The Ruby agent matches these names against your active tasks using string regex.</p>
<p><strong>Example: Instrumenting two Rake tasks</strong></p>
<p>For example, to instrument the Rake tasks <code>deploy</code> and <code>deploy:all</code>, add the following to your <code>newrelic.yml</code> file:</p>
<pre><code>rake:
  tasks: ["deploy", "deploy:all"]
</code></pre>
<p>Since task name matching is with regex, you can instrument all of your app's Rake tasks by using a wildcard regex like <code>[".+"]</code>. However, this will not include Rake tasks that are in your deny list by default from the <a href="/docs/agents/ruby-agent/configuration/ruby-agent-configuration#autostart-blacklisted_rake_tasks"><code>autostart.blacklisted_rake_tasks</code></a> configuration setting, such as <code>db:migrate</code>.</p>
<ul>
  <li>To include any Rake tasks that are in your deny list by default, include them in your customized deny list.</li>
  <li>To ensure the tasks are instrumented before they run if you are using Rails but your Rake task does not require the Rails environment, add <code>require 'tasks/newrelic'</code> to the top of the Rake tasks.</li>
</ul>
<h2>Remove newrelic-rake when appropriate [#interaction-newrelic-rake]</h2>
<p>The <code>newrelic-rake</code> third-party gem provides Rake instrumentation support as an add-on to the Ruby agent. If the agent detects <code>newrelic-rake</code>, it will not install the built-in Rake instrumentation, but it will record a log message like this at startup:</p>
<pre><code>INFO : Not installing New Relic supported Rake instrumentation because the third party newrelic-rake gem is present
</code></pre>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJjYXV0aW9uIn1d">
  <p>Removing the <code>newrelic-rake</code> gem in favor of the built-in instrumentation will change your transaction names. To preserve your existing transaction names, ignore the log message and do not uninstall the gem.</p>
</div>
<p>To switch to New Relic's built-in Rake instrumentation and change your transaction names:</p>
<ol>
  <li>Remove the <code>newrelic-rake</code> gem.</li>
  <li><a href="#enabling-rake-support">Specify the tasks you want to instrument in your config file</a>.</li>
</ol>
<h2>Capture Rake job arguments [#capture-rake-arguments]</h2>
<p>By default Rake job arguments are not captured. To capture Rake job arguments, use:</p>
<pre><code>attributes.include: job.rake.*
</code></pre>
