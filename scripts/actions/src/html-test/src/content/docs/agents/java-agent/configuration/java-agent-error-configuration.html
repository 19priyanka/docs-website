
<p>APM's Java agent reports detailed information about errors that occur within your application. This gives you insight into problematic areas that may be affecting your application’s performance or the end user’s experience.</p>
<p>With Java agent <a href="/docs/release-notes/agent-release-notes/java-release-notes">versions 3.40.0 or higher</a>, there are several configuration options that let you control how errors are reported, including:</p>
<ul>
  <li>Configuring expected errors so that they won't affect error rate or Apdex</li>
  <li>Ignoring errors</li>
  <li>Reporting errors that are not reported automatically</li>
</ul>
<p>For more information on viewing your error data, see <a href="https://docs.newrelic.com/docs/apm/applications-menu/error-analytics/introduction-error-analytics">Error analytics</a>. For an overview of error data in all agents, see <a href="/docs/agents/manage-apm-agents/agent-data/manage-errors-apm-collect-ignore-mark-expected">Manage errors in APM</a>.</p>
<h2>Common reported error examples [#examples]</h2>
<p>The Java agent reports errors in the following scenarios:</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>Error reporting</p>
      </div>
      <div>
        <p><strong>Comments</strong></p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p>Unhandled errors (includes stack trace)</p>
      </div>
      <div>
        <p>If an unhandled error occurs within a transaction that the Java agent was tracing, the error will be reported with the full stack trace.</p>
      </div>
    </div>
    <div>
      <div>
        <p>HTTP status codes (no stack trace)</p>
      </div>
      <div>
        <p>If a transaction results in an HTTP status code, the error will be reported without the stack trace. This is because:</p>
        <ul>
          <li>
            <p>The application server detected an error condition and explicitly set the status code.</p>
            <p>OR</p>
          </li>
          <li>
            <p>The error condition was detected by program logic, and thus there was no exception object or stack.</p>
            <p>In order to include the stack trace with these types of transactions, you must use a <code>noticeError(...)</code> API call.</p>
          </li>
        </ul>
      </div>
    </div>
    <div>
      <div>
        <p><code>noticeError(...)</code> API calls</p>
      </div>
      <div>
        <p>If the Java agent makes an explicit call using the <code>noticeError(...)</code> API call, the error will be reported regardless of whether or not it occurs within a transaction. The reported information depends on the parameters used in the <code>noticeError(...)</code> API call, as described in the <a href="https://newrelic.github.io/java-agent-api/javadoc/com/newrelic/api/agent/NewRelic.html">Javadocs</a>.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Unscoped errors reporting over 100%</p>
      </div>
      <div>
        <p>The Java agent can report unscoped errors, which are errors that are not tied to any transaction. Because of this, it is possible to have one transaction in a timeslice and multiple errors in the same timeslice. In this situation, New Relic would then show an error rate <strong>over 100%</strong>.</p>
      </div>
    </div>
  </div>
</div>
<h2>Configure error reporting [#error-configuration]</h2>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
  <p>In order to use this feature, <a href="/docs/agents/java-agent/installation/upgrade-java-agent">upgrade</a> to the <a href="/docs/release-notes/agent-release-notes/java-release-notes">latest release</a> (Java agent 3.40.0 or higher).</p>
</div>
<p>The Java agent provides several flexible configuration options to control how errors are reported.</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p><strong>Config options</strong></p>
      </div>
      <div>
        <p><strong>Details</strong></p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p>Configure errors via the UI.</p>
      </div>
      <div>
        <p>You can ignore errors or mark them as expected via <a href="#server-side-config">server-side config</a>.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Configure as expected errors via <code>newrelic.yml</code>.</p>
      </div>
      <div>
        <p>Errors reported by these versions of <code>noticeError</code> can be configured as <a href="/docs/agents/java-agent/configuration/java-agent-error-configuration#expected-errors">expected errors</a> in the <code>newrelic.yml</code>. Calls to this API will be overridden if the error is configured as <a href="https://docs.newrelic.com/docs/agents/java-agent/configuration/java-agent-error-configuration#ignore-errors">ignored</a> in <code>newrelic.yml</code>. For details, see <a href="https://docs.newrelic.com/docs/agents/java-agent/configuration/java-agent-error-configuration#error-config-precedence">Error configuration precedence</a>.</p>
        <p>Use these <code>noticeError()</code> API calls to report errors that are not reported automatically and configure them as <a href="/docs/agents/java-agent/configuration/java-agent-error-configuration#enable-error-collector">expected errors</a> in <code>newrelic.yml</code>:</p>
        <ul>
          <li>
            <pre><code>noticeError(String message)
</code></pre>
          </li>
          <li>
            <pre><code>noticeError(String message, Map&#x3C;String, String> params)
</code></pre>
          </li>
          <li>
            <pre><code>noticeError(Throwable throwable)
</code></pre>
          </li>
          <li>
            <pre><code>noticeError(Throwable throwable, Map&#x3C;String, String> params)
</code></pre>
          </li>
        </ul>
      </div>
    </div>
    <div>
      <div>
        <p>Override expected errors via <code>newrelic.yml</code>.</p>
      </div>
      <div>
        <p>Errors reported by these versions of <code>noticeError</code> will override the <code>newrelic.yml</code> <a href="/docs/agents/java-agent/configuration/java-agent-error-configuration#expected-errors">expected error</a> configuration. Calls to this API will be overridden if the error is configured as <a href="/docs/agents/java-agent/configuration/java-agent-error-configuration#ignore-errors">ignored</a> in the yml. For details, see <a href="/docs/agents/java-agent/configuration/java-agent-error-configuration#error-config-precedence">Error configuration precedence</a>.</p>
        <p>Use these <code>noticeError(...)</code> API calls to report errors that are not reported automatically and configure them as <a href="/docs/agents/java-agent/configuration/java-agent-error-configuration#enable-error-collector">expected errors</a> with the API (overrides yml expected error configuration):</p>
        <ul>
          <li>
            <pre><code>noticeError(String message, boolean expected)
</code></pre>
          </li>
          <li>
            <pre><code>noticeError(String message, Map&#x3C;String, String> params, boolean expected)
</code></pre>
          </li>
          <li>
            <pre><code>noticeError(Throwable throwable, boolean expected)
</code></pre>
          </li>
          <li>
            <pre><code>noticeError(Throwable throwable, Map&#x3C;String, String> params, boolean expected)
</code></pre>
          </li>
        </ul>
      </div>
    </div>
    <div>
      <div>
        <p>Ignore or expect errors via config file.</p>
      </div>
      <div>
        <p>In versions 3.40.0 or higher, you can control how errors are reported by using the <a href="/docs/agents/java-agent/configuration/java-agent-configuration-config-file#Error_Collector">YAML-based configuration</a>. This allows you to ignore errors or expect errors based on HTTP status codes <strong>or</strong> based on a list of exception class names plus an optional error message.</p>
        <ul>
          <li>
            <p><strong>Ignoring errors</strong> prevents the specified exception classes or codes from being reported to APM at all.</p>
          </li>
          <li>
            <p><strong>Expecting errors</strong> prevents the specified exception classes or codes from affecting your application's <a href="/docs/apis/rest-api-v2/application-examples-v2/application-error-rate-example-v2">error rate</a> and <a href="/docs/apm/new-relic-apm/apdex/apdex-measuring-user-satisfaction">Apdex score</a>. This allows you to retain the error information for troubleshooting purposes while avoiding alerts based on error rate or Apdex score.</p>
            <p>These settings are dynamic, so running agents will notice changes to <strong>newrelic.yml</strong> without a JVM restart. For more information and examples, see the <a href="/docs/agents/java-agent/configuration/java-agent-configuration-config-file">Java agent config file</a>.</p>
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>
<h2>YAML-based configuration for error collection [#yml-config]</h2>
<p>YAML-based configuration for error collection allows you to entirely ignore specific errors or exempt expected errors from affecting your application’s error rate and Apdex score. You can mark errors as ignored or expected based on the following criteria:</p>
<ul>
  <li>A given range of HTTP status codes, presented as a comma-separated list or dashed range</li>
  <li>A comma-separated list using the fully qualified name of a package/class <strong>and</strong> an optionally provided error message string</li>
</ul>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZW5hYmxlLWVycm9yLWNvbGxlY3RvciJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiRW5hYmxpbmcgZXJyb3IgY29sbGVjdGlvbiJ9XQ==">
    <div data-prop-text="title">Enabling error collection</div>
    <p>By default, the Java agent includes an <code>error_collector</code> stanza under which all <a href="/docs/agents/java-agent/configuration/java-agent-configuration-config-file#Error_Collector">YAML-based error configuration</a> options will be found. Error collection can be enabled or disabled as follows:</p>
    <pre><code>error_collector:
  enabled: true

</code></pre>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiaWdub3JlLWVycm9ycyJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiSWdub3Jpbmcgc3BlY2lmaWMgZXJyb3JzIn1d">
    <div data-prop-text="title">Ignoring specific errors</div>
    <p>Errors that are not of any particular interest can be ignored entirely. By identifying errors to ignore:</p>
    <ul>
      <li>
        <p>They will not be reported to APM.</p>
      </li>
      <li>
        <p>They will not affect your application's error rate or Apdex score</p>
        <p>Here is an example showing the <a href="/docs/agents/java-agent/configuration/java-agent-configuration-config-file#Error_Collector">YAML-based configuration</a> options for ignoring errors:</p>
        <pre><code>error_collector:
    enabled: true

    ignore_classes:
      - "com.example.ErrorClassToIgnore"

    ignore_messages:
      com.example.OtherErrorClassToIgnore:
        - "some error message to ignore"

    ignore_status_codes: 404,507-511
</code></pre>
      </li>
    </ul>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZXhwZWN0ZWQtZXJyb3JzIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJQcmV2ZW50aW5nIGV4cGVjdGVkIGVycm9ycyBmcm9tIGFmZmVjdGluZyBlcnJvciByYXRlIGFuZCBBcGRleCJ9XQ==">
    <div data-prop-text="title">Preventing expected errors from affecting error rate and Apdex</div>
    <p>Errors that are <strong>expected</strong> as part of an application's business logic can be prevented from affecting error rate or Apdex score yet still be reported to APM. This allows you to retain the error information in the UI for troubleshooting purposes while avoiding alerts (based on error rate and Apdex score) caused by these errors.</p>
    <p>Here is an example showing the <a href="https://docs.newrelic.com/docs/agents/java-agent/configuration/java-agent-configuration-config-file#Error_Collector">YAML-based configuration</a> options for expected errors:</p>
    <pre><code>error_collector:
    enabled: true

    expected_classes:
      - "com.example.ExpectedErrorClass"

    expected_messages:
      com.example.OtherExpectedErrorClass:
        - some expected error message"

    expected_status_codes: 406,500-504

</code></pre>
  </div>
</div>
<h2>Error configuration precedence [#error-config-precedence]</h2>
<p>The priority for errors configuration is:</p>
<ol>
  <li><a href="#server-side-config">Server-side configuration</a> (overlays values onto YAML file)</li>
  <li><code>ignore_*</code> config in the YAML</li>
  <li><code>expected</code> parameter in the <code>noticeError(..)</code> API call</li>
  <li><code>expected_*</code> config in the YAML</li>
</ol>
<p>Here are examples of the results when combining various API calls and YAML configurations.</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiaWdub3JlLWNsYXNzZXMifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6Iklnbm9yZSBlcnJvciBjbGFzc2VzIChZQU1MIG92ZXJyaWRlcyBBUEkpIn1d">
    <div data-prop-text="title">Ignore error classes (YAML overrides API)</div>
    <p>YAML configuration:</p>
    <pre><code>error_collector:
  ignore_classes:
    - "com.example.ErrorClass"

</code></pre>Result:
    The YAML `ignore_classes` overrides the `noticeError` API call, and the error is ignored.
    <pre><code>
noticeError(com.newrelic.Exception)

</code></pre>AND
    API call:
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZXhwZWN0ZWQtY2xhc3NlcyJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiUmVwb3J0IGV4cGVjdGVkIGVycm9ycyAoWUFNTCBhbmQgQVBJKSJ9XQ==">
    <div data-prop-text="title">Report expected errors (YAML and API)</div>
    <p>YAML configuration:</p>
    <pre><code>error_collector:
  expected_classes:
    - "com.example.ErrorClass"

</code></pre>Result:
    The `expected` parameter in the `noticeError` API call is true by default, and the YAML `expected_classes` configuration contains an error class. Therefore, the error is reported and marked as `expected`.
    <pre><code>
noticeError(com.newrelic.Exception)

</code></pre>AND
    API call:
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZXhwZWN0ZWQtbm8teWFtbCJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiUmVwb3J0IGV4cGVjdGVkIGVycm9ycyAobm8gWUFNTCkifV0=">
    <div data-prop-text="title">Report expected errors (no YAML)</div>
    <p>No YAML configuration</p>
    <p>AND</p>
    <p>API call:</p>
    <pre><code>noticeError(com.newrelic.Exception, expected = true)

</code></pre>Result:
    The error is reported and marked as expected.
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiaWdub3JlLWVycm9yIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJZQU1MIGlnbm9yZV9jbGFzc2VzIG92ZXJyaWRlcyBBUEkgZXhwZWN0ZWQgcGFyYW1ldGVyIn1d">
    <div data-prop-text="title">YAML ignore_classes overrides API expected parameter</div>
    <p>YAML configuration:</p>
    <pre><code>error_collector:
  ignore_classes:
    - "com.example.ErrorClass"

</code></pre>Result:
    The YAML `ignore_classes`overrides the `expected` parameter in the `noticeError` API call, so the error is ignored.
    <pre><code>
noticeError(com.newrelic.Exception, expected = true)

</code></pre>AND
    API call:
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZXhwZWN0ZWQtZmFsc2UifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IkFQSSBleHBlY3RlZCBwYXJhbWV0ZXIgb3ZlcnJpZGVzIFlBTUwgZXhwZWN0ZWRfY2xhc3NlcyJ9XQ==">
    <div data-prop-text="title">API expected parameter overrides YAML expected_classes</div>
    <p>YAML configuration:</p>
    <pre><code>error_collector:
  expected_classes:
    - "com.example.ErrorClass"

</code></pre>Result:
    The `expected` parameter in the `noticeError` API call overrides `expected_classes` in the YAML. Therefore, the error is reported as normal (not marked as `expected`).
    <pre><code>
noticeError(com.newrelic.Exception, expected = false)

</code></pre>AND
    API call:
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiaWdub3JlLWV4cGVjdGVkIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJJZ25vcmUgb3ZlcnJpZGVzIGV4cGVjdGVkIGluIFlBTUwifV0=">
    <div data-prop-text="title">Ignore overrides expected in YAML</div>
    <p>YAML configuration:</p>
    <pre><code>error_collector:
  ignore_classes:
    - "com.example.ErrorClass"

</code></pre>Result:
    The YAML `ignore_classes/ignore_messages` overrides the YAML `expected_classes/expected_messages`, so the error is ignored. This same principle applies to `ignore_status_codes` and `expected_status_codes`.
    <pre><code>
error_collector:
  expected_classes:
    - "com.example.ErrorClass"

</code></pre>AND
    Additional YAML configuration:
  </div>
</div>
<h2>Configure ignored and expected errors via UI [#server-side-config]</h2>
<p>To configure <a href="/docs/agents/manage-apm-agents/agent-data/manage-errors-apm-collect-ignore-or-mark-expected#expected">expected errors</a> via the APM UI:</p>
<ol>
  <li>If it is not already enabled, <a href="/docs/agents/manage-apm-agents/configuration/server-side-agent-configuration#enable-ssc">enable server-side configuration</a>.</li>
  <li><a href="/docs/agents/manage-apm-agents/configuration/server-side-agent-configuration#customize-ssc">Go to the server-side configuration menu</a> for the application with errors you want to mark as expected.</li>
  <li>Under <strong>Error collection</strong>, for either <strong>Ignore</strong> or <strong>Exclude expected errors</strong>, enter the HTTP code or the error class for errors you want to configure.</li>
  <li>Select <strong>Save</strong>.</li>
</ol>
<p>For information on how to view expected errors in the UI, see <a href="/docs/agents/manage-apm-agents/agent-data/manage-errors-apm-collect-ignore-or-mark-expected#expected">View expected errors</a>.</p>
