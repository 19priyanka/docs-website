
<p>Our <a href="/docs/agents/nodejs-agent/installation-configuration/install-nodejs-agent">Node.js agent</a> API allows you to extend the agent's standard functionality. You can use this API to:</p>
<ul>
  <li>Create custom transaction parameters</li>
  <li>Report custom errors and metrics</li>
</ul>
<p>You can also use the API for <a href="/docs/agents/nodejs-agent/supported-features/nodejs-custom-instrumentation">custom instrumentation</a>. For <a href="/docs/agents/nodejs-agent/getting-started/compatibility-requirements-nodejs-agent">supported frameworks</a>, the agent instruments most activity automatically. Custom instrumentation lets you extend that monitoring to frameworks without default instrumentation.</p>
<p>Other resources:</p>
<ul>
  <li>The <a href="http://newrelic.github.io/node-newrelic/docs/">Node.js agent API documentation on GitHub</a> has more detail and practical tutorials.</li>
  <li>You can also adjust the Node.js agent's default behavior with <a href="/docs/agents/nodejs-agent/installation-configuration/nodejs-agent-configuration">configuration settings</a>.</li>
  <li>To see all available New Relic APIs, see <a href="/docs/apis/getting-started/introduction-new-relic-apis">Intro to APIs</a>.</li>
</ul>
<h2>Requirements</h2>
<p>To use the Node.js agent API, make sure you have the <a href="/docs/release-notes/agent-release-notes/nodejs-release-notes">latest Node.js agent release</a>. In addition, see:</p>
<ul>
  <li><a href="/docs/agents/nodejs-agent/supported-features/nodejs-agent-api">Node.js agent API requirements</a></li>
  <li><a href="http://newrelic.github.io/node-newrelic/docs/index.html#getting-started">Getting started procedures on GitHub</a></li>
</ul>
<h2>Instrument missing sections of your code with transactions [#creating-transactions]</h2>
<p>To instrument your app, New Relic separates each path through your code into its own <a href="/docs/accounts-partnerships/education/getting-started-new-relic/glossary#transaction">transaction</a>. New Relic times (or "instruments") the parent method in these transactions to measure your app's overall performance, and collects <a href="/docs/apm/transactions/transaction-traces/introduction-transaction-traces">transaction traces</a> from long-running transactions for additional detail.</p>
<p>Use these methods when New Relic is not instrumenting a particular part of your code at all:</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>If you want to...</p>
      </div>
      <div>
        <p>Do this...</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p>Start timing a method New Relic is not instrumenting automatically</p>
      </div>
      <div>
        <p>Create a new transaction. See <a href="/docs/agents/nodejs-agent/supported-features/nodejs-agent-api#startWebTransaction"><code>newrelic.startWebTransaction()</code></a>.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Stop timing a method after its work is completed</p>
      </div>
      <div>
        <p>Use either of these options:</p>
        <ul>
          <li>Return a promise from the callback handed to <a href="/docs/agents/nodejs-agent/supported-features/nodejs-agent-api#startWebTransaction"><code>newrelic.startWebTransaction</code></a>.</li>
          <li>Call <code>end</code> on a <a href="http://newrelic.github.io/node-newrelic/docs/API.html#getTransaction">handle</a> returned from <a href="/docs/agents/nodejs-agent/supported-features/nodejs-agent-api#getTransaction"><code>newrelic.getTransaction</code></a>.</li>
        </ul>
      </div>
    </div>
    <div>
      <div>
        <p>Prevent a transaction from reporting to New Relic</p>
      </div>
      <div>
        <p>Ignore the transaction using any of these options:</p>
        <ul>
          <li>See <a href="/docs/agents/nodejs-agent/supported-features/nodejs-agent-api#ignoring">Rules for ignoring requests</a> and <code>newrelic.setIgnoreTransaction().</code></li>
          <li>Call <code>ignore</code> on a <a href="http://newrelic.github.io/node-newrelic/docs/TransactionHandle.html">handle</a> returned from <a href="/docs/agents/nodejs-agent/supported-features/nodejs-agent-api#getTransaction"><code>newrelic.getTransaction</code></a>.</li>
        </ul>
      </div>
    </div>
  </div>
</div>
<h2>Time specific methods using segments [#segments]</h2>
<p>If a transaction is already visible in New Relic, but you don't have enough data about a particular method that was called during that transaction, you can create segments to time those individual methods in greater detail. For example, you might want to time a particularly critical method with complex logic.</p>
<p>Use this method when you want to instrument a method within an existing transaction:</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>If you want to...</p>
      </div>
      <div>
        <p>Do this...</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p>Time a particular method</p>
      </div>
      <div>
        <p>See <a href="/docs/agents/nodejs-agent/supported-features/nodejs-agent-api#startSegment"><code>newrelic.startSegment()</code></a>.</p>
      </div>
    </div>
  </div>
</div>
<p>For more information about timing, see the <a href="http://newrelic.github.io/node-newrelic/docs/tutorial-Instrumentation-Basics.html">instrumentation tutorial on GitHub</a>.</p>
<h2>Enhance the metadata of a transaction [#metadata]</h2>
<p>Sometimes the code you are targeting is visible in New Relic, but some details of the method are not useful. For example:</p>
<ul>
  <li>The default name might not be helpful. (Perhaps it is causing a <a href="/docs/agents/manage-apm-agents/troubleshooting/metric-grouping-issues#video">metric grouping issue</a>.)</li>
  <li>You want to add <a href="/docs/agents/manage-apm-agents/agent-data/collect-custom-attributes">custom attributes</a> to your transactions so you can filter them .</li>
</ul>
<p>Use these methods when you want to change how New Relic instruments a transaction that's already visible in New Relic:</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>If you want to...</p>
      </div>
      <div>
        <p>Do this...</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p>Change the name of a transaction</p>
      </div>
      <div>
        <p>See <a href="/docs/agents/nodejs-agent/supported-features/nodejs-agent-api#transaction"><code>newrelic.setTransactionName</code></a> and <a href="/docs/agents/nodejs-agent/supported-features/nodejs-agent-api#rules-name"><code>rules.name</code></a>.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Add metadata (such as your customerâ€™s account name or subscription level) to your transactions</p>
      </div>
      <div>
        <p>Use <a href="/docs/agents/manage-apm-agents/agent-data/collect-custom-attributes#nodejs-att">custom attributes</a>. (Custom attribute collection is enabled by default in the Node.js agent.) See <a href="/docs/agents/nodejs-agent/supported-features/nodejs-agent-api#add-custom-attribute"><code>newrelic.addCustomAttribute()</code></a> and <a href="/docs/agents/nodejs-agent/supported-features/nodejs-agent-api#add-custom-attributes"><code>newrelic.addCustomAttributes()</code></a>.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Create a new transaction for background work</p>
      </div>
      <div>
        <p>See <a href="/docs/agents/nodejs-agent/supported-features/nodejs-agent-api#startBackgroundTransaction"><code>newrelic.startBackgroundTransaction()</code></a>.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Create a new web transaction</p>
      </div>
      <div>
        <p>Use <code>newrelic.startWebTransaction()</code>.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Prevent a transaction from affecting your <a href="/docs/accounts-partnerships/education/getting-started-new-relic/glossary#apdex">Apdex</a> score</p>
      </div>
      <div>
        <p>See <a href="/docs/agents/nodejs-agent/supported-features/nodejs-agent-api#ignoring">Rules for naming and ignoring requests</a>, including the <a href="/docs/agents/nodejs-agent/supported-features/nodejs-agent-api#example-ignoring-rule">ignoring rules example</a>.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Record other performance data, such as timing or computer resource data</p>
      </div>
      <div>
        <p>Use the <a href="/docs/agents/nodejs-agent/supported-features/nodejs-agent-api#custom-metric-api">custom metrics API</a>.</p>
      </div>
    </div>
  </div>
</div>
<h2>Instrument asynchronous work [#async]</h2>
<p>For <a href="/docs/agents/nodejs-agent/getting-started/compatibility-requirements-nodejs-agent#supported-frameworks">supported frameworks</a> and <a href="/docs/agents/nodejs-agent/getting-started/compatibility-requirements-nodejs-agent#version">supported Node.js versions</a>, New Relic's Node.js agent usually correctly instruments async work. However, if your app uses another framework, or if the default async instrumentation is inaccurate, you can explicitly track async work.</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>If you want to...</p>
      </div>
      <div>
        <p>Do this...</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p>Trace an async method that New Relic is already instrumenting</p>
      </div>
      <div>
        <p>See <a href="/docs/agents/nodejs-agent/supported-features/nodejs-agent-api#startSegment"><code>newrelic.startSegment</code></a>.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Trace an async method that New Relic is not instrumenting</p>
      </div>
      <div>
        <p>See <a href="/docs/agents/nodejs-agent/supported-features/nodejs-agent-api#startSegment"><code>newrelic.startSegment</code></a>.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Trace a transaction that got lost</p>
      </div>
      <div>
        <p>See <a href="/docs/agents/nodejs-agent/supported-features/nodejs-agent-api#startSegment"><code>newrelic.startSegment</code></a>. You can also create your own <a href="/docs/agents/nodejs-agent/supported-features/nodejs-custom-instrumentation">custom instrumentation</a> for libraries that are losing your transactions.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Trace a lost transaction state</p>
      </div>
      <div>
        <p>A common issue is the loss of transaction state while using uninstrumented libraries. For more information, see the <a href="http://newrelic.github.io/node-newrelic/docs/tutorial-Context-Preservation.html">transaction preservation tutorial on GitHub</a>.</p>
      </div>
    </div>
  </div>
</div>
<h2>Instrument calls to external services [#external-services]</h2>
<p>Once the <a href="/docs/agents/nodejs-agent/supported-features/nodejs-agent-api#loading">request naming API</a> loads, New Relic's Node.js agent can automatically identify external service calls. You can also use these methods to collect data about your app's connections to other apps or databases:</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>If you want to...</p>
      </div>
      <div>
        <p>Do this...</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p>Time a call to an external resource (such as an external service, database server, or message queue)</p>
      </div>
      <div>
        <p>Use any of these as appropriate:</p>
        <ul>
          <li>
            <p><a href="/docs/agents/nodejs-agent/supported-features/nodejs-agent-api#custom-instrumentation-api">Custom instrumentation API</a></p>
          </li>
          <li>
            <p><a href="/docs/agents/nodejs-agent/supported-features/message-queues">Message queues</a></p>
            <p>Also see the tutorials on GitHub for <a href="http://newrelic.github.io/node-newrelic/docs/DatastoreShim.html">datastore shims</a> and <a href="http://newrelic.github.io/node-newrelic/docs/MessageShim.html">message shims</a>.</p>
          </li>
        </ul>
      </div>
    </div>
    <div>
      <div>
        <p>Connect activity to another app instrumented by a New Relic agent</p>
      </div>
      <div>
        <p>Use <a href="/docs/apm/transactions/cross-application-traces/introduction-cross-application-traces">cross application tracing</a>.</p>
      </div>
    </div>
  </div>
</div>
<h2>Collect or ignore errors [#errors]</h2>
<p>Usually the agent detects errors automatically. However, you can manually mark an error with the agent. You can also mark errors as <a href="/docs/apm/applications-menu/error-analytics/ignoring-errors-new-relic-apm">ignored</a>.</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>If you want to...</p>
      </div>
      <div>
        <p>Do this...</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p>Report an error the agent does not report automatically</p>
      </div>
      <div>
        <p>See <a href="/docs/agents/nodejs-agent/supported-features/nodejs-agent-api#noticeError"><code>newrelic.noticeError()</code></a>.</p>
      </div>
    </div>
  </div>
</div>
<h2>Send custom event and metric data from your app [#custom-data]</h2>
<p>New Relic includes a number of ways to record arbitrary custom data. For an explanation of New Relic data types, see <a href="/docs/data-analysis/metrics/analyze-your-metrics/data-collection-metric-timeslice-event-data">Data collection</a>.</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>If you want to...</p>
      </div>
      <div>
        <p>Do this...</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p>Send data about an event so you can analyze it in New Relic</p>
      </div>
      <div>
        <p>Create a <a href="/docs/insights/insights-data-sources/custom-data/insert-custom-events-new-relic-apm-agents#node-att">custom event</a>. See <a href="/docs/agents/nodejs-agent/supported-features/nodejs-agent-api#record_custom_event"><code>newrelic.recordCustomEvent()</code></a>.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Tag your events with metadata to filter and facet them</p>
      </div>
      <div>
        <p>Add <a href="/docs/agents/manage-apm-agents/agent-data/collect-custom-attributes#nodejs=att">custom attributes</a> if needed. (Custom attribute collection is enabled by default in the Node.js agent.) See <a href="/docs/agents/nodejs-agent/supported-features/nodejs-agent-api#add-custom-attribute"><code>newrelic.addCustomAttribute()</code></a> and <a href="/docs/agents/nodejs-agent/supported-features/nodejs-agent-api#add-custom-attributes"><code>newrelic.addCustomAttributes()</code></a>.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Report custom performance data</p>
      </div>
      <div>
        <p>Create a <a href="/docs/agents/manage-apm-agents/agent-data/custom-metrics">custom metric</a>. See <a href="/docs/agents/nodejs-agent/supported-features/nodejs-agent-api#record_metric"><code>newrelic.recordMetric()</code></a> and <a href="/docs/agents/nodejs-agent/supported-features/nodejs-agent-api#increment_metric"><code>newrelic.incrementMetric()</code></a>. To view the data, use the <a href="/docs/query-your-data/explore-query-data/data-explorer/introduction-data-explorer"><strong>data explorer</strong></a>.</p>
      </div>
    </div>
  </div>
</div>
<h2>Control the browser agent [#browser]</h2>
<p>Usually the browser agent is added automatically to your pages or deployed by copy/pasting the JavaScript snippet. For more information about these recommended methods, see <a href="/docs/browser/new-relic-browser/installation-configuration/add-apps-new-relic-browser">Add browser apps to New Relic</a>.</p>
<p>You can also control the browser agent via APM agent API calls. For more information, see <a href="/docs/agents/nodejs-agent/supported-features/new-relic-browser-nodejs-agent">Browser monitoring and the Node.js agent</a>.</p>
<h2>Extend custom instrumentation [#custom-instrumentation]</h2>
<p>The <code>newrelic.instrument()</code> provides additional flexibility for custom instrumentation. For more information, including tutorials and examples, see the <a href="http://newrelic.github.io/node-newrelic/docs/Shim.html">shims documentation on GitHub</a>.</p>
