
<h2>Problem</h2>
<p>If you have problems <a href="/docs/agents/python-agent/supported-features/page-load-timing-python">instrumenting</a> Browser with the Python agent, follow the <a href="/docs/browser/new-relic-browser/installation-configuration/troubleshooting-browser-monitoring-installation">standard troubleshooting procedures</a> for browser monitoring. Here are some additional tips for Python.</p>
<h2>Solution</h2>
<p>Follow these recommendations to check content structure and verify that content compression is not interfering.</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoic29sdXRpb24tY29udGVudCJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiQ2hlY2sgY29udGVudCBzdHJ1Y3R1cmUuIn1d">
    <div data-prop-text="title">Check content structure.</div>
    <p>If you are expecting to see the Browser agent added automatically but do not, check whether any of these restrictions might apply.</p>
    <ul>
      <li>
        <p>The <code>Content-Type</code> for the HTML response must be <code>text/html</code>.</p>
      </li>
      <li>
        <p>The <code>Content-Encoding</code> response header cannot be set.</p>
      </li>
      <li>
        <p>The <code>Content-Disposition</code> response header cannot mark the response as an attachment.</p>
      </li>
      <li>
        <p>The <code>Content-Disposition</code> specified in an <code>http-equiv</code> meta tag within the HTML<code>&#x3C;head></code> element cannot mark the response as an attachment.</p>
      </li>
      <li>
        <p>The <code>&#x3C;body></code> element of the HTML response must appear within the first 64 kbytes.</p>
        <p>If you are generating HTML page responses and using the <code>Content-Type</code> of <code>application/xhtml+xml</code>, you can override the allowed content types to list both this content type and <code>text/html</code> in your agent configuration file.</p>
        <pre><code>browser_monitoring.content_type = text/html application/xhtml+xml
</code></pre>
        <p>Make sure the <code>browser_monitoring.content_type</code>is a space-separated list of content types.</p>
        <p>When adding <code>application/xhtml+xml</code> as an allowed content type for automatic instrumentation, be aware that the resulting page will no longer validate correctly as <code>application/xhtml+xml</code>, although the page should still be loaded and rendered correctly by browsers.</p>
        <p>To resolve issues with the other content limitations, use <a href="/docs/agents/python-agent/supported-features/page-load-timing-python#manual_instrumentation">manual instrumentation</a>.</p>
      </li>
    </ul>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoic29sdXRpb24tY29tcHJlc3Npb24ifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IlZlcmlmeSB0aGF0IGNvbnRlbnQgY29tcHJlc3Npb24gaXMgbm90IGludGVyZmVyaW5nLiJ9XQ==">
    <div data-prop-text="title">Verify that content compression is not interfering.</div>
    <p>If you are using a WSGI or web framework middleware or a plugin that encodes the response content, such as when doing response compression, automatic instrumentation may not work. The Python agent provides specific support for Django <code>GZipMiddleware</code> and <code>Flask-Compress</code> with auto-instrumentation. However, currently this is not supported for <code>paste.gzipper</code>, because it contains a bug which makes it unusable in conjunction with the agent's WSGI middleware that adds the browser monitoring instrumentation.</p>
    <p>If you encounter this problem, use <a href="/docs/agents/python-agent/supported-features/page-load-timing-python#manual_instrumentation">manual instrumentation</a>, or switch to using your web server or front-end proxy to compress the response content, rather than performing compression within your web application. The latter solution may also offer performance benefits.</p>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoic29sdXRpb24tY29tcHJlc3Npb24ifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IkNoZWNrIHBhZ2Ugc291cmNlIGZvciBjb25kaXRpb25hbCBibG9ja3MuIn1d">
    <div data-prop-text="title">Check page source for conditional blocks.</div>
    <p>When inspecting your page source, you see the Browser agent inserted incorrectly inside a conditional block.</p>
    <pre><code>&#x3C;!--[if IE]>
    &#x3C;meta http-equiv="X-UA-Compatible" content="IE=edge" />
    &#x3C;script type="text/javascript">/*Browser agent here*/&#x3C;/script>
&#x3C;![endif]-->

</code></pre>This can happen because the Python agent does not check for these conditional blocks when deciding to place the Browser agent. Consider using [manual instrumentation](/docs/agents/python-agent/supported-features/page-load-timing-python#manual_instrumentation) in this case.
  </div>
</div>
