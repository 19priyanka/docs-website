
<p>New Relic APM's configurable security policies gives you granular control over configuration options related to your account's data security. This document explains how to enable account-wide security policies and the options available.</p>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
  <p>APM's configurable security policies is available in limited release for approved New Relic accounts.</p>
</div>
<p>For more information about New Relic's security measures, see our <a href="/docs/using-new-relic/new-relic-security/security/security-matters-data-privacy-new-relic">security and privacy documentation</a>, or visit the <a href="https://newrelic.com/why-new-relic/security">New Relic security website</a>.</p>
<h2>Compatibility and requirements [#compatibility]</h2>
<p>APM agent versions that support this feature include:</p>
<ul>
  <li>C SDK: not available</li>
  <li><a href="/docs/agents/go-agent/installation/install-new-relic-go">Go</a>: 2.1 or higher</li>
  <li><a href="/docs/agents/java-agent/installation/upgrade-java-agent">Java</a>: 4.1 or higher</li>
  <li><a href="/docs/agents/net-agent/installation/update-net-agent">.NET</a>: 8.1 or higher</li>
  <li><a href="/docs/agents/nodejs-agent/installation-configuration/upgrade-nodejs-agent">Node.js</a>: 4.1 or higher</li>
  <li><a href="/docs/agents/php-agent/installation/upgrade-php-agent">PHP</a>: 8.1 or higher</li>
  <li>Python: not available</li>
  <li><a href="/docs/agents/ruby-agent/installation/upgrade-ruby-agent-versions">Ruby</a>: 5.2 or higher</li>
</ul>
<h2>Enable configurable security policies [#activate]</h2>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJjYXV0aW9uIn1d">
  <p>Security policies apply account-wide. Once enabled, they can only be edited or disabled with the help of New Relic support.</p>
  <p>If <a href="/docs/agents/manage-apm-agents/configuration/high-security-mode">high security mode</a> is enabled for the account(s), <strong>do not disable it</strong>. Account-level high security mode differs from your APM agent's high security mode, which is set in the configuration file.</p>
  <p>High security mode and configurable security policies do not apply to Lambda monitoring or use of the New Relic Event API.</p>
</div>
<p>For the limited release, there is no UI component.</p>
<p>If you are participating in the limited release, follow this procedure to set up your accounts:</p>
<ol>
  <li>Choose the accounts or sub-accounts on which to enable configurable security policies.</li>
  <li>Choose the <a href="#options">configurable security policies options</a> that you want for those accounts.</li>
  <li>Inform your New Relic sales rep of the options that you have chosen.</li>
  <li>Ensure your <a href="#compatibility">agent versions support this feature</a>. Update agents if necessary.</li>
  <li>When you receive the security token based on the security policies options that you chose, insert the security token into the agent configuration file(s). See <a href="#sample-file">examples</a>.</li>
  <li>Delete the high security mode enabled flag from your config file(s).</li>
</ol>
<p>High security mode (HSM) at the agent level is different than high security mode at the <a href="#account">account level</a>. Be sure to disable HSM in the agent's config file, as explained in this procedure. Having both the security token and the HSM flag will result in the agent disconnecting.</p>
<h2>Example configuration [#sample-file]</h2>
<p>Here are some example configuration examples for enabling the configurable security policies:</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiamF2YSJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiSmF2YSBhZ2VudDogWUFNTCBleGFtcGxlIn1d">
    <div data-prop-text="title">Java agent: YAML example</div>
    <p>The Java agent uses a <a href="/docs/agents/java-agent/configuration/java-agent-configuration-config-file">YAML file for configuration</a>. Here is an example snippet enabling security policies:</p>
    <pre><code>common: &#x26;default_settings
  license_key: 'YOUR_LICENSE_KEY'
  app_name: 'YOUR_APPLICATION_NAME'
  security_policies_token: 'YOUR_TOKEN'
production:
  &#x3C;&#x3C;: *default_settings
  log_level: info

</code></pre>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZG90LW5ldCJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiLk5FVCBhZ2VudDogWE1MIGV4YW1wbGUifV0=">
    <div data-prop-text="title">.NET agent: XML example</div>
    <p>The .NET agent uses a <a href="/docs/agents/net-agent/configuration/net-agent-configuration">XML file for configuration</a>. Here is an example snippet enabling security policies:</p>
    <pre><code>...
&#x3C;configuration agentenabled="true" xmlns="urn:newrelic-config">
  &#x3C;service licensekey="YOUR_LICENSE_KEY">
  &#x3C;application>
    &#x3C;name>YOUR_APPLICATION_NAME&#x3C;/name>
  &#x3C;/application>
  &#x3C;securityPoliciesToken>YOUR_TOKEN&#x3C;/securityPoliciesToken>
  &#x3C;log level="info">
&#x3C;/log>&#x3C;/service>&#x3C;/configuration>
...

</code></pre>
    <pre><code>
NEW_RELIC_SECURITY_POLICIES_TOKEN=YOUR_TOKEN

</code></pre>If you prefer to use an environment variable, it would look like this:
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoicnVieSJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiUnVieSBhZ2VudDogWUFNTCBleGFtcGxlIn1d">
    <div data-prop-text="title">Ruby agent: YAML example</div>
    <p>The Ruby agent uses a <a href="/docs/agents/ruby-agent/configuration/ruby-agent-configuration">YAML file for configuration</a>. Here is an example snippet enabling security policies:</p>
    <pre><code>common: &#x26;default_settings
  license_key: 'YOUR_LICENSE_KEY'
  app_name: 'YOUR_APPLICATION_NAME'
  security_policies_token: 'YOUR_TOKEN'
production:
  &#x3C;&#x3C;: *default_settings
  log_level: info

</code></pre>
  </div>
</div>
<h2>Available policy options [#options]</h2>
<p>Here are the settings you can choose when creating your policies. Some of these options will not be available for some agents.</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>Setting</p>
      </div>
      <div>
        <p>Effect</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p>Database query collection</p>
      </div>
      <div>
        <p>Options:</p>
        <ul>
          <li>
            <p>Enabled: Collects obfuscated database query data. Obfuscated queries generally appear along with <a href="/docs/apm/applications-menu/monitoring/view-slow-query-details#db_slowsql">slow query details</a> in the APM or New Relic One UI.</p>
          </li>
          <li>
            <p>Disabled: Prevents the collection of obfuscated database query data.</p>
            <p>Raw query data is not collected once configurable security policies is <a href="#sample-file">enabled</a>.</p>
          </li>
        </ul>
      </div>
    </div>
    <div>
      <div>
        <p><code>attributes.include</code> list</p>
        <p>Go, Java, .NET, Node.js, Ruby only</p>
      </div>
      <div>
        <p>Options:</p>
        <ul>
          <li>
            <p>Enabled: <code>attributes.include</code> list functions normally; <a href="/docs/agents/manage-apm-agents/agent-data/agent-attributes">attribute keys</a> found in the <code>attributes.include</code> list are recorded.</p>
          </li>
          <li>
            <p>Disabled: Ignores the list of allowed attributes listed in the <code>attributes.include</code> property in agent configuration; no intrinsic request parameter attributes will be collected.</p>
            <p>Whitelisting attributes at the account level is not supported.</p>
          </li>
        </ul>
      </div>
    </div>
    <div>
      <div>
        <p>Raw exception messages</p>
      </div>
      <div>
        <p>Options:</p>
        <ul>
          <li>Enabled: Allows recording of all raw exception messages.</li>
          <li>Disabled: Prevents recording of all raw exception messages. The messages may be either obfuscated or completely removed, depending on the agent.</li>
        </ul>
      </div>
    </div>
    <div>
      <div>
        <p>Custom events</p>
      </div>
      <div>
        <p>Options:</p>
        <ul>
          <li>Enabled: Allows the recording of <a href="/docs/insights/insights-data-sources/custom-data/insert-custom-events-new-relic-apm-agents">custom events</a> that are created and sent up via an agent API.</li>
          <li>Disabled: Prevents recording of any custom events collect by an agent API.</li>
        </ul>
      </div>
    </div>
    <div>
      <div>
        <p>Custom attributes</p>
      </div>
      <div>
        <p>Options:</p>
        <ul>
          <li>Enabled: Allows for the collection of <a href="/docs/agents/manage-apm-agents/agent-data/collect-custom-attributes">custom attributes</a> passed in by the New Relic agent.</li>
          <li>Disabled: Prevents collection of custom attributes that are collected by the New Relic agent.</li>
        </ul>
      </div>
    </div>
    <div>
      <div>
        <p>Custom instrumentation editor</p>
        <p>Java only</p>
      </div>
      <div>
        <p>Options:</p>
        <ul>
          <li>
            <p>Enabled: Allows custom instrumentation of the agent, using the <a href="/docs/agents/java-agent/custom-instrumentation/custom-instrumentation-editor-instrument-ui">custom instrumentation editor</a>.</p>
          </li>
          <li>
            <p>Disabled: Prevents custom instrumentation of the agent using the custom instrumentation editor. Instrumentation previously done via the editor is also disabled.</p>
            <p>Access to the custom instrumentation editor is only available to New Relic account Owners and Admins.</p>
          </li>
        </ul>
      </div>
    </div>
    <div>
      <div>
        <p>Message parameters</p>
        <p>Java and Ruby only</p>
      </div>
      <div>
        <p>Options:</p>
        <ul>
          <li>Enabled: Allows the collection of message parameters (<code>message.parameters.*</code>).</li>
          <li>Disabled: Prevents collection of message parameters.</li>
        </ul>
      </div>
    </div>
    <div>
      <div>
        <p>Job arguments</p>
        <p>Ruby only</p>
      </div>
      <div>
        <p>Options:</p>
        <ul>
          <li>Enabled: Allows the collection of job arguments (<code>job.(type).args.*</code>).</li>
          <li>Disabled: Prevents the collection of job arguments.</li>
        </ul>
      </div>
    </div>
  </div>
</div>
<h2>For more help [#more_help]</h2>
<p>For more information about configuration file settings, refer to your <a href="https://docs.newrelic.com/docs/agents/manage-apm-agents/configuration">specific agent's documentation</a>.</p>
<p>If you are a New Relic customer and interested in the limited release of configurable security policies, contact your New Relic sales rep.</p>
