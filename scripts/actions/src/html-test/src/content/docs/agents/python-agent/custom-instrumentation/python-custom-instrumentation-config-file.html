
<p>You can extend the Python agent's monitoring to trace time spent in additional functions or methods of classes by modifying your configuration file. This form of <a href="/docs/python/python-custom-instrumentation">custom instrumentation</a> is simpler to implement than API calls, and does not require you to modify your code. However, for more complex needs, you may need to implement <a href="/docs/python/python-instrumentation-by-api">Python instrumentation by API</a>.</p>
<h2>Listing functions in the configuration file [#listing_functions]</h2>
<p>To extend instrumentation to designated functions and class methods, add them to the <code>transaction_tracer.function_trace</code> setting within the <code>newrelic</code> section of the agent configuration file. The identifier for a function should have the form <code>module:function</code> and that of a class method <code>module:class.function</code>.</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZHVtZGJtLWV4YW1wbGUifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IlVzaW5nIGR1bWJkYm0ifV0=">
    <div data-prop-text="title">Using dumbdbm</div>
    <p>In this example, you use the Python <strong>dumbdbm</strong> module and want to instrument the time it took to open a database, and then to write that database back to a file. In this case you would use:</p>
    <pre><code>transaction_tracer.function_trace = dumbdbm:open
                                               dumbdbm:_Database._commit

</code></pre>
  </div>
</div>
<p>To list more than one item, use either of these methods:</p>
<ul>
  <li>One line: Separate each item with a space.</li>
  <li>Multiple lines: Follow the <strong>ini</strong> file convention to indent the subsequent lines.</li>
</ul>
<p>When data is reported for the instrumented function, the metric will have a name in the form <code>Function/module:function</code> or <code>Function/module:class.function</code>. In the performance breakdown for a transaction, the category will show as <code>Function</code> and the segment will be <code>module:function</code> or <code>module:class.function</code>. For slow transaction traces, only the segment name appears. Note that where a function is actually returning a generator, only the time spent in returning the generator will be recorded and not the consumption of the values from the generator.</p>
<h2>Restrictions on wrapping extension APIs [#restrictions_on_wrapping]</h2>
<p>When wrapping functions by listing them in the agent configuration file, you cannot designate class methods this way when the method is a member of a class which is implemented in C code by a C extension module. This is because it is not possible to modify the method table of a type implemented using the Python C API.</p>
<h2>Overriding the reported function name [#overriding_the_name]</h2>
<p>When using the <code>transaction_tracer.function_trace</code> setting in the agent configuration file, the name of the function will be used in the metric name, with it being classified as a <code>Function</code>. If it is necessary to override what function name may be used in the metric name or classify it differently, then an alternate means of defining the function trace in the configuration file can be used. The equivalent for:</p>
<pre><code>transaction_tracer.function_trace = dumbdbm:open
                                               dumbdbm:_Database._commit
</code></pre>
<p>would be to create two new configuration sections in the agent configuration file, one for each function to be traced:</p>
<pre><code>[function-trace:dumbdbm-1]
enabled = true
function = dumbdbm:open
name = dumbdbm:open
group = Function

[function-trace:dumbdbm-2]
enabled = true
function = dumbdbm:_Database._commit
name = dumbdbm:_Database._commit
group = Function
</code></pre>
<p>The ini file section name should start with <code>function-trace:</code>. The name component that follows that prefix can be anything but should be unique across all function trace sections in the configuration file. The <code>group</code> and <code>name</code> settings can be overridden as necessary to arrive at the desired metric name. The <code>enabled</code> setting defaults to <code>false</code> and needs to be set to <code>true</code> to enable the function trace.</p>
<h2>Instrument with the API [#function_decorators]</h2>
<p>For simple custom instrumentation purposes, the config file method works well. For more precise and customized instrumentation and agent behavior adjustments, you will want to use the <a href="/docs/agents/python-agent/api/python-agent-api-guide">Python agent API</a>.</p>
