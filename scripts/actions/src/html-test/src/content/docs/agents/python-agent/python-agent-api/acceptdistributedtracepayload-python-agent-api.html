
<h2>Syntax</h2>
<pre><code>newrelic.agent.accept_distributed_trace_payload(payload, transport_type='HTTP')
</code></pre>
<p>This method is used for accepting the payloads used to connect transactions within a distributed trace.</p>
<h2>Requirements</h2>
<p>Python agent version 4.2.0.100 or higher.</p>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJjYXV0aW9uIn1d">
  <p>This API has been deprecated. Please use newrelic.agent.accept_distributed_trace_headers instead.</p>
</div>
<p>Distributed tracing must be <a href="https://docs.newrelic.com/docs/enable-distributed-tracing#python">enabled</a>.</p>
<h2>Description</h2>
<p>For context on how to use this call, first read its partner API call <a href="/docs/agents/python-agent/python-agent-api/create_distributed_trace_payload"><code>create_distributed_trace_payload</code></a> and <a href="https://docs.newrelic.com/docs/enable-distributed-tracing#agent-apis">Enable distributed tracing with agent APIs</a>.</p>
<p>This call is used to link transactions by parsing the distributed tracing payloads generated by <a href="https://docs.newrelic.com/docs/agents/python-agent/python-agent-api/create_distributed_trace_payload"><code>create_distributed_trace_payload</code></a>.</p>
<h2>Parameters</h2>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>Parameter</p>
      </div>
      <div>
        <p>Description</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p><code>payload</code></p>
        <p><em>dictionary or string</em></p>
      </div>
      <div>
        <p>Required. The payload to be accepted.</p>
      </div>
    </div>
    <div>
      <div>
        <p>transport<em>type<br>_string</em></p>
      </div>
      <div>
        <p>Optional, defaults to <code>HTTP</code>. The type of transport that sent this payload. Must be one of the following: <code>HTTP</code>, <code>HTTPS</code>, <code>Kafka</code>, <code>JMS</code>, <code>IronMQ</code>, <code>AMQP</code>, <code>Queue</code>, or <code>Other</code>.</p>
      </div>
    </div>
  </div>
</div>
<h2>Return values</h2>
<p>When successful, returns <code>True</code>.</p>
<p>When unsuccessful, returns <code>False</code>. Accepting a payload can fail for several reasons:</p>
<ul>
  <li>The current transaction is not enabled.</li>
  <li>Accept was called outside the scope of a transaction.</li>
  <li>The payload is empty.</li>
  <li>Distributed tracing is not <a href="/docs/enable-distributed-tracing">enabled</a>.</li>
  <li><code>accept_distributed_trace_payload</code> was called after <code>create_distributed_trace_payload</code>, and not before.</li>
  <li><code>accept_distributed_trace_payload</code> was called multiple times in a single transaction.</li>
  <li>The payload could not be parsed.</li>
  <li>The payload was sent from an untrusted account.</li>
</ul>
<h2>Examples</h2>
<h3>Accept a distributed trace payload inside a background task [#function-trace-example]</h3>
<p>An example of using <code>accept_distributed_trace_payload</code> in a background task:</p>
<pre><code>@newrelic.agent.background_task()
def handle(request):
    payload = request.headers.get('newrelic')
    if payload:
        newrelic.agent.accept_distributed_trace_payload(payload)

    _do_some_work()
</code></pre>
<h3>Consume from a queue [#function-trace-example]</h3>
<p>An example of using <code>accept_distributed_trace_payload</code> and creating a <a href="/docs/agents/python-agent/supported-features/python-background-tasks">background task</a> for each message:</p>
<pre><code>import newrelic.agent
newrelic.agent.initialize('newrelic.ini')
application = newrelic.agent.register_application(timeout=10.0)

def main(queue):
    for message in queue.consume():
        with newrelic.agent.BackgroundTask(application, 'Queue Consume'):
            payload = message.headers.get('newrelic')
            newrelic.agent.accept_distributed_trace_payload(payload,
                    transport_type='Queue')
            _process_message(message)
</code></pre>
