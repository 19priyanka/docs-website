
<p>With the Ruby agent, you can add <a href="/docs/browser/new-relic-browser/getting-started/introduction-new-relic-browser">New Relic Browser</a> instrumentation to your webpages either automatically or manually. To enable <a href="/docs/browser/new-relic-browser/getting-started/new-relic-browser">Browser</a> in the user interface, follow the procedures to <a href="/docs/browser/new-relic-browser/installation/install-new-relic-browser-agent">install the Browser agent</a>. Then follow the procedures in this section to set up the Ruby agent.</p>
<h2>Requirements</h2>
<p>In order to use New Relic Browser with your Ruby agent, make sure you meet these requirements:</p>
<ul>
  <li>New Relic Ruby agent (<a href="/docs/release-notes/agent-release-notes/ruby-release-notes">version 3.0.1 or higher</a>)</li>
  <li>For automatic instrumentation: Rails 2.3 or higher</li>
  <li>For manual instrumentation: Rails 2.0 to 2.2</li>
</ul>
<h2>Use auto-instrumentation [#auto_instrumentation]</h2>
<p>Automatic instrumentation works with Rack, and requires Rails 2.3 or higher.</p>
<p>Configure the agent to automatically instrument pages with end user monitoring scripts, by adding or editing the following flag in <code>newrelic.yml</code>.</p>
<pre><code>browser_monitoring:
      auto_instrument: true
</code></pre>
<p>This is the simplest way to monitor end users. The Ruby agent examines each page from your application and automatically injects the Browser JavaScript in the header. Auto-instrumentation works for environments that support Rack. For performance reasons the agent scans only the first 50k of your application's response for the header instrumentation point. In cases where a <code>X-UA-Compatible</code> meta tag is present and the <code>&#x3C;head></code> tag is longer than 50k, auto-instrumentation will fail gracefully.</p>
<p>Auto-instrumentation will look for an <code>X-UA-Compatible</code> meta tag and insert the JavaScript directly after it. If the auto-instrumentation cannot find an <code>X-UA-Compatible</code> meta tag, it will insert after the opening head tag, and failing that it will insert after the opening body tag. If any of these tags are wrapped in conditionals or comments, the automatic instrumentation will likely fail.</p>
<p>If auto-instrumentation fails to correctly instrument your applicationâ€™s pages, then you must <a href="#manual_instrumentation">manually instrument</a> via agent API.</p>
<h2>Manually instrument via agent API [#manual_instrumentation]</h2>
<p>If you are using Rails 2.1 to 2.2 or cannot use auto-instrumentation, you can still set up end user monitoring manually by including appropriate scripts in your pages. Use the New Relic Ruby agent's API to generate the script to be inserted into your pages.</p>
<p>For example, to modify your application's template to call the agent, use:</p>
<pre><code>&#x3C;head>
    &#x3C;%= ::NewRelic::Agent.browser_timing_header rescue "" %>
    ... existing template code ...
    &#x3C;/head>
</code></pre>
<h2>Troubleshooting</h2>
<p>If you do not see any Browser data being reported, view the HTML source and confirm two blocks of script similar to this in your HTML head:</p>
<pre><code>&#x3C;script type="text/javascript">window.NREUM||(NREUM={});...&#x3C;/script>
</code></pre>
<p>If these are not present, check the auto-instrumentation settings or the placement of manual instrumentation in your template files.</p>
<p>In versions of the Ruby agent prior to 3.7.0, <code>&#x3C;%=::NewRelic::Agent.browser_timing_footer rescue "" %></code> also needed to be called as close to the bottom of the document as possible. With 3.7.0, all the required script is included by <code>browser_timing_header</code>. <code>browser_timing_footer</code> returns an empty string for compatibility.</p>
<h2>Disable auto-instrumentation [#disable_instrumentation]</h2>
<p>The default value of <a href="/docs/agents/ruby-agent/configuration/ruby-agent-configuration#browser_monitoring"><code>auto-instrument</code></a> is <code>true</code> (even when unspecified). To disable auto-instrumentation, set this flag to <code>false</code>.</p>
<p>To disable auto-instrumentation only for certain controllers or controller actions, use <a href="/docs/agents/ruby-agent/installation-configuration/ignoring-specific-transactions#page-load-timing-rum"><code>newrelic_ignore_enduser</code></a>. Server-side instrumentation will be unaffected by this call.</p>
