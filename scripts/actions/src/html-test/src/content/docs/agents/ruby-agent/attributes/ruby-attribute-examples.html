
<p>Here are some examples of using attributes with the New Relic Ruby agent.</p>
<h2>Contents [#qiklinks]</h2>
<h2>Capture request parameters [#ex_req_params]</h2>
<p>Capturing request parameters is not enabled by default. The following configuration will turn on parameter capture for the default destinations: <code>transaction_tracer</code>, <code>transaction_events</code>, and <code>error_collector</code>. To limit the destinations see the <a href="#ex_select_dest">Selecting specific destinations example</a>.</p>
<p><strong>Configuration:</strong></p>
<pre><code>attributes.include: request.parameters.*
</code></pre>
<p>Request parameters are prefixed with the string <code>request.parameters</code>, and nested parameters have keys to reflect that nesting. For example, a user with a location attribute nested below a profile would have a key of<code>request.parameters.user.profile.location</code>.</p>
<p>Similarly, attributes that are members of collections will have keys with indices that reflect the membership. If a user had multiple phone numbers, keys would appear as follows: <code>request.parameters.phone_numbers.0</code>, <code>request.parameters.phone_numbers.1</code>, etc.</p>
<h2>Exclude sensitive data while capturing request parameters [#ex_req_params_exclude]</h2>
<p>There may be situations where you would like to omit sensitive information from request parameters, such as passwords or credit card numbers. The following configuration will accomplish that:</p>
<p><strong>Configuration</strong>:</p>
<pre><code>attributes.include: request.parameters.*
  attributes.exclude: [request.parameters.password, request.parameters.credit_card_no]
</code></pre>
<h2>Capture only specific request parameters [#ex_req_params_capture_specific]</h2>
<p>To capture only specific request parameters, you can simply pass a list to <code>attributes.include</code>:</p>
<p><strong>Configuration</strong>:</p>
<pre><code>attributes.include: [request.parameters.user_id, request.parameters.shard_id]
</code></pre>
<h2>Capture Resque job arguments [#ex_resque_args]</h2>
<p>By default Resque job arguments are not captured. To enable this functionality use the configuration below.</p>
<pre><code>attributes.include: job.resque.args.*
</code></pre>
<p><strong>Note:</strong></p>
<p>Arguments to Resque jobs are positional and the keys generated reflect this. For example a job that takes two arguments will have keys <code>job.resque.args.0</code> and <code>job.resque.args.1</code></p>
<h2>Capture Sidekiq job arguments [#ex_sidekiq_args]</h2>
<p>By default Sidekiq job arguments are not captured. To enable this functionality use the configuration below.</p>
<pre><code>attributes.include: job.sidekiq.args.*
</code></pre>
<p><strong>Note:</strong></p>
<p>Arguments to Sidekiq jobs are positional and the keys generated reflect this. For example a job that takes two arguments will have keys <code>job.sidekiq.args.0</code> and <code>job.sidekiq.args.1</code></p>
<h2>Disabling all attributes [#ex_disable_all]</h2>
<p>In this example, attributes are disabled, so the include and exclude lists will be ignored and all attributes will be filtered out.</p>
<p><strong>Configuration:</strong></p>
<pre><code>attributes.enabled: false
  attributes.include: request.parameters.*
</code></pre>
<p><strong>Input keys:</strong></p>
<pre><code>foo, bar, request.parameters.foo, request.parameters.bar
</code></pre>
<p><strong>Output for destinations:</strong></p>
<pre><code>transaction_tracer: none
  error_collector: none
  transaction_events: none
  browser_monitoring: none
</code></pre>
<h2>Selecting specific destinations [#ex_select_dest]</h2>
<p>In this example:</p>
<ul>
  <li>Attributes are disabled for transaction traces. The include and exclude lists will be ignored, and all attributes will be filtered out for this destination.</li>
  <li>Attributes are also disabled for browser monitoring by default.</li>
  <li>Request parameters (prefixed with <code>request.parameters.</code>) are off by default for all destinations.</li>
</ul>
<p>As a result, only <code>bar</code> is sent in traced errors and transaction events.</p>
<p><strong>Configuration:</strong></p>
<pre><code>attributes.enabled: true
  transaction_tracer.attributes.enabled: false
  attributes.exclude: foo
</code></pre>
<p><strong>Input keys:</strong></p>
<pre><code>foo, bar, request.parameters.foo, request.parameters.bar
</code></pre>
<p><strong>Output for destinations:</strong></p>
<pre><code>transaction_tracer: none
  error_collector: bar
  transaction_events: bar
  browser_monitoring: none
</code></pre>
<h2>Selecting values and destinations [#example3]</h2>
<p>In this example, specific input keys are selected for certain output destinations and excluded from others.</p>
<ul>
  <li>The <code>lang.oo.python</code> key will be excluded only from transaction traces.</li>
  <li>The <code>lang</code> and <code>lang.functional</code> keys will be excluded from all destinations.</li>
</ul>
<p><strong>Configuration:</strong></p>
<pre><code>browser_monitoring.attributes.enabled: true
  attributes.exclude: lang*
  attributes.include: lang.oo.*
  transaction_tracer.attributes.exclude: lang.oo.python
</code></pre>
<p><strong>Input keys:</strong></p>
<pre><code>lang, lang.functional, lang.oo.ruby, lang.oo.python
</code></pre>
<p><strong>Output for destinations:</strong></p>
<pre><code>transaction_tracer: lang.oo.ruby
  error_collector: lang.oo.ruby, lang.oo.python
  transaction_events: lang.oo.ruby, lang.oo.python
  browser_monitoring: lang.oo.ruby, lang.oo.python
</code></pre>
<h2>For more help [#more_help]</h2>
<p>Additional documentation resources include:</p>
<ul>
  <li><a href="/docs/features/agent-attributes">Agent attributes</a> (types, destinations, and limits for attributes used by New Relic agents)</li>
  <li><a href="/docs/agents/ruby-agent/ruby-agent-attributes">Ruby agent attributes</a> (Ruby-specific attributes available as of version 3.12.0)</li>
  <li><a href="/docs/agents/ruby-agent/enabling-disabling-attributes">Enabling and disabling attributes</a> (properties, rules, and backwards compatibility information for Ruby agent attributes)</li>
  <li><a href="https://docs.newrelic.com/docs/using-new-relic/data/customize-data/collect-custom-attributes">Collect custom attributes</a> (enabling custom attributes by agent)</li>
</ul>
