
<p><a href="/docs/browser/new-relic-browser/getting-started/introduction-new-relic-browser">Browser monitoring</a> gives you visibility into how your users are interacting with your Java application by using a JavaScript snippet (or "agent") to instrument your app's webpages. To enable browser monitoring in our user interface, follow the procedures to <a href="/docs/browser/new-relic-browser/installation/install-new-relic-browser-agent">install the Browser agent</a>. For example, you can:</p>
<ul>
  <li>Enable an APM-monitored app.</li>
  <li>Enable with the copy/paste method.</li>
  <li>Enable by using the REST API.</li>
</ul>
<p>You can also <a href="#manual_instrumentation">manually instrument</a> your webpages by using the Java agent API, as explained in this document.</p>
<h2>Use Java agent API [#manual_instrumentation]</h2>
<p>If your framework does not allow you to enable browser monitoring from our UI, with the copy/paste method, or by using our REST API, you can manually instrument monitoring for your webpages. To do this, use our <a href="/docs/agents/java-agent/api-guides/guide-using-java-agent-api">Java agent API</a>.</p>
<ol>
  <li>
    <p>Make sure you are using the <a href="/docs/release-notes/agent-release-notes/java-release-notes">latest Java agent version</a>.</p>
  </li>
  <li>
    <p>Disable auto-instrumentation.</p>
    <div data-component="CollapserGroup" data-prop="W10=">
      <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZGlzYWJsaW5nLWF1dG8tYWxsIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJEaXNhYmxlIGF1dG8taW5zdHJ1bWVudGF0aW9uIG9uIGFsbCBwYWdlcyJ9XQ==">
        <div data-prop-text="title">Disable auto-instrumentation on all pages</div>
        <ol>
          <li>
            <p>Set the <a href="/docs/agents/java-agent/configuration/java-agent-configuration-config-file#bm-auto_instrument"><code>auto_instrument</code></a> flag under <code>browser_monitoring</code> to <code>false</code> in your <strong>newrelic.yml</strong>.</p>
            <pre><code>browser_monitoring:
  auto_instrument: false
</code></pre>
          </li>
          <li>
            <p>Restart your application.</p>
          </li>
          <li>
            <p>Flush the app server's work cache.</p>
            <p>Flushing the work cache forces the app server to recompile JSPs, which is when auto-instrumentation occurs.</p>
          </li>
        </ol>
      </div>
      <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZGlzYWJsZS1hdXRvLXNwZWNpZmljIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJEaXNhYmxlIGF1dG8taW5zdHJ1bWVudGF0aW9uIG9ubHkgb24gc3BlY2lmaWMgcGFnZXMifV0=">
        <div data-prop-text="title">Disable auto-instrumentation only on specific pages</div>
        <p>Use the <code>disabled_auto_pages</code> flag under the <code>browser_monitoring</code> stanza. For example, to disable auto-instrumentation on <strong>testpage_1.jsp</strong> and <strong>testpage_2.jsp</strong>, use the following:</p>
        <pre><code>browser_monitoring:
   disabled_auto_pages: /WEB-INF/jsp/testpage_1.jsp, /WEB-INF/jsp/testpage_2.jsp

</code></pre>
      </div>
    </div>
  </li>
  <li>
    <p><a href="/docs/agents/java-agent/api-guides/guide-using-java-agent-api#api">Access the Java agent API class</a> by adding <code>newrelic-api.jar</code> to your application class path.</p>
  </li>
  <li>
    <p>Add the appropriate method to start time tracking, for example: <code>com.newrelic.api.agent.NewRelic.getBrowserTimingHeader()</code>.</p>
    <p>Add the appropriate method to stop time tracking, for example: <code>com.newrelic.api.agent.NewRelic.getBrowserTimingFooter()</code>.</p>
    <p>Find the appropriate methods based on the framework you are using:</p>
    <div data-component="CollapserGroup" data-prop="W10=">
      <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoibWFudWFsLWpzcCJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiSlNQIG1hbnVhbCBpbnN0cnVtZW50YXRpb24ifV0=">
        <div data-prop-text="title">JSP manual instrumentation</div>
        <p>Insert the header as close to the top of <code>&#x3C;head></code> tag as possible but after the meta tags. Insert the footer before the <code>&#x3C;/body></code> tag.</p>
        <pre><code>&#x3C;!DOCTYPE html>

&#x3C;html>
&#x3C;head>&#x3C;title>EXAMPLE&#x3C;/title>
&#x3C;meta charset="utf-8">
&#x3C;meta name="description" content="Example header and footer call">;
&#x3C;%= com.newrelic.api.agent.NewRelic.getBrowserTimingHeader() %>
&#x3C;/head>â€‹
&#x3C;body>

&#x3C;%= com.newrelic.api.agent.NewRelic.getBrowserTimingFooter() %>
&#x3C;/body>
&#x3C;/html>

</code></pre>
      </div>
      <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoibWFudWFsLWh0bWwifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IlJhdyBIVE1MIG1hbnVhbCBpbnN0cnVtZW50YXRpb24ifV0=">
        <div data-prop-text="title">Raw HTML manual instrumentation</div>
        <p>To manually instrument using raw HTML, <a href="/docs/agents/java-agent/custom-instrumentation/java-agent-api-example-program#include-browser">include page load timing code in the HTTP response</a>.</p>
      </div>
      <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoibWFudWFsLXRoeW1lbGVhZi0yLTEifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IlRoeW1lbGVhZiAyLjEgb3IgaGlnaGVyIG1hbnVhbCBpbnN0cnVtZW50YXRpb24ifV0=">
        <div data-prop-text="title">Thymeleaf 2.1 or higher manual instrumentation</div>
        <pre><code>&#x3C;head>
...
&#x3C;div th:remove="tag" th:utext="${T(com.newrelic.api.agent.NewRelic).getBrowserTimingHeader()}">&#x3C;/div>
&#x3C;/head>
&#x3C;body>
...
&#x3C;div th:utext="${T(com.newrelic.api.agent.NewRelic).getBrowserTimingFooter()}">&#x3C;/div>
&#x3C;/body>

</code></pre>
      </div>
      <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoibWFudWFsLWNvbGRmdXNpb24tY2ZtbCJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiQ29sZEZ1c2lvbiBDRk1MIHBhZ2UgbWFudWFsIGluc3RydW1lbnRhdGlvbiJ9XQ==">
        <div data-prop-text="title">ColdFusion CFML page manual instrumentation</div>
        <pre><code>&#x3C;cfobject type="Java" class="com.newrelic.api.agent.NewRelic" name="newRelic"/>
&#x3C;cfset header = newRelic.getBrowserTimingHeader() />
&#x3C;cfoutput>#header#&#x3C;/cfoutput>
...
...
&#x3C;cfset footer = newRelic.getBrowserTimingFooter() />
&#x3C;cfoutput>#footer#&#x3C;/cfoutput>

</code></pre>
      </div>
      <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoibWFudWFsLWpzZiJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiSmF2YSBTZXJ2ZXIgRmFjZXMgKEpTRikgZnJhbWV3b3JrcyJ9XQ==">
        <div data-prop-text="title">Java Server Faces (JSF) frameworks</div>
        <p>Manual instrumentation is not available with JSF. To insert the Browser JavaScript snippet into your app's webpages, use the <a href="/docs/browser/new-relic-browser/installation-configuration/add-apps-new-relic-browser#copy-paste-app">copy/paste method</a>.</p>
      </div>
      <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoibWFudWFsLXBsYXktZ3Jvb3Z5In0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJQbGF5IEdyb292eSB0ZW1wbGF0ZSBtYW51YWwgaW5zdHJ1bWVudGF0aW9uIn1d">
        <div data-prop-text="title">Play Groovy template manual instrumentation</div>
        <pre><code>${com.newrelic.api.agent.NewRelic.getBrowserTimingHeader().raw()}
...
...
${com.newrelic.api.agent.NewRelic.getBrowserTimingFooter().raw()}

</code></pre>
      </div>
      <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoibWFudWFsLXBsYXktMi0yIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJQbGF5IDIuMiBvciBoaWdoZXIgU2NhbGEgdGVtcGxhdGUgbWFudWFsIGluc3RydW1lbnRhdGlvbiJ9XQ==">
        <div data-prop-text="title">Play 2.2 or higher Scala template manual instrumentation</div>
        <p>Add the following to <code>build.sbt</code>, substituting the <a href="/docs/release-notes/agent-release-notes/java-release-notes">latest agent version</a> for 3.x.x:</p>
        <pre><code>libraryDependencies += "com.newrelic.agent.java" % "newrelic-api" % "3.x.x"

</code></pre>
        <pre><code>
@Html(com.newrelic.api.agent.NewRelic.getBrowserTimingHeader())
...
...
@Html(com.newrelic.api.agent.NewRelic.getBrowserTimingFooter())

</code></pre>In `main.scala.html`, add the following:
      </div>
      <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoibWFudWFsLXBsYXktMi0xIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJQbGF5IDIuMSBTY2FsYSB0ZW1wbGF0ZSBtYW51YWwgaW5zdHJ1bWVudGF0aW9uIn1d">
        <div data-prop-text="title">Play 2.1 Scala template manual instrumentation</div>
        <p>Add the following to <code>Build.scala</code>, substituting the <a href="/docs/release-notes/agent-release-notes/java-release-notes">lastest agent version</a> for 2.x.x:</p>
        <pre><code>appDependencies += "com.newrelic.agent.java" % "newrelic-api" % "2.x.x"

</code></pre>
        <pre><code>
@Html(com.newrelic.api.agent.NewRelic.getBrowserTimingHeader())
...
...
@Html(com.newrelic.api.agent.NewRelic.getBrowserTimingFooter())**Manual instrumentation with Apache Velocity Template Language (VTL)**

</code></pre>In `main.scala.html`, add the following:
      </div>
      <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoibWFudWFsLXZlbG9jaXR5In0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJBcGFjaGUgVmVsb2NpdHkgVG9vbHMgbWFudWFsIGluc3RydW1lbnRhdGlvbiJ9XQ==">
        <div data-prop-text="title">Apache Velocity Tools manual instrumentation</div>
        <p>If you are using Velocity Tools, define a <code>NewRelic</code> tool in <code>toolbox.xml</code>:</p>
        <pre><code>&#x3C;toolbox>
  &#x3C;tool>
    &#x3C;key>NewRelic&#x3C;/key>
    &#x3C;scope>application&#x3C;/scope>
    &#x3C;class>com.newrelic.api.agent.NewRelic&#x3C;/class>
  &#x3C;/tool>
&#x3C;/toolbox>

</code></pre>
        <pre><code>
$NewRelic.getBrowserTimingHeader()
...
...
$NewRelic.getBrowserTimingFooter()

</code></pre>Call the `NewRelic` API in your velocity template:
      </div>
      <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZW5hYmxlLWFwYWNoZSJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiQXBhY2hlIFZlbG9jaXR5IG1hbnVhbCBpbnN0cnVtZW50YXRpb24ifV0=">
        <div data-prop-text="title">Apache Velocity manual instrumentation</div>
        <ol>
          <li>
            <p>To ensure that all of your Browser page views are not grouped under a single <code>/velocity</code> transaction (and to avoid <a href="/docs/agents/manage-apm-agents/troubleshooting/metric-grouping-issues">metric grouping issues</a>), disable your <code>enable_auto_transaction_naming</code> setting in your <strong>newrelic.yml</strong> file:</p>
            <pre><code>enable_auto_transaction_naming: false
</code></pre>
          </li>
          <li>
            <p>Add <code>newrelic-api.jar</code> to the classpath of Tomcat, typically in <code>.../tomcat/bin/setenv.sh</code>:</p>
            <pre><code>CLASSPATH=$CLASSPATH:/opt/newrelic/newrelic-api.jar
</code></pre>
            <p>OR</p>
            <p>Add the reference to this jar file to the end of an existing <code>CLASSPATH=...</code> line within that file.</p>
          </li>
          <li>
            <p>In each app, find <code>WEB-INF/tools.xml</code> and add the following tag:</p>
            <pre><code>&#x3C;toolbox scope="application"> &#x3C;tool class="com.newrelic.api.agent.NewRelic" key="NewRelic" /> &#x3C;/toolbox>
</code></pre>
            <p>If a <code>&#x3C;toolbox scope="application"></code> tag already exists, put the <code>&#x3C;tool ... /></code> within the tag.</p>
          </li>
          <li>
            <p>In each app, edit the Velocity template that the other pages in the application use. Add this tag within the <code>&#x3C;head></code> stanza before any <code>&#x3C;link></code> and <code>&#x3C;script></code> declarations and after any meta tags:</p>
            <pre><code>$NewRelic.getBrowserTimingHeader()
</code></pre>
          </li>
          <li>
            <p>Add this tag within the <code>&#x3C;body></code> stanza as the line right before the <code>&#x3C;/body></code> tag, at the very bottom of the body:</p>
            <pre><code>$NewRelic.getBrowserTimingFooter()
</code></pre>
          </li>
          <li>
            <p>Restart the Tomcat server:</p>
            <ul>
              <li>
                <p>If you are using <code>Linux/Unix</code>, add the following command line to the <code>Users/Tomcat/bin</code> directory:</p>
                <pre><code>./shutdown.sh
./startup.sh
</code></pre>
              </li>
              <li>
                <p>If you are using <code>Windows</code>, go to your <code>Users/Tomcat/bin</code> directory, and add the following command line:</p>
                <pre><code>% shutdown.bat
% startup.bat
</code></pre>
              </li>
            </ul>
          </li>
        </ol>
      </div>
    </div>
  </li>
  <li>
    <p>Check the log file to verify that the agent is instrumenting correctly. Set the <code>log_level</code> setting in <code>newrelic.yml</code> to <code>log_level: finer</code> and check for the following messages:</p>
    <div data-component="CollapserGroup" data-prop="W10=">
      <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoianNwLWNvbXBpbGUifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IldoZW4gdGhlIEpTUCBlbmdpbmUgY29tcGlsZXMgYSBKU1AifV0=">
        <div data-prop-text="title">When the JSP engine compiles a JSP</div>
        <pre><code>May 17, 2011 9:33:18 AM NewRelic FINE: Compiling JSP: /jsp/header.jsp
May 17, 2011 9:33:18 AM NewRelic FINE: Injecting browser timing header into: /jsp/header.jsp

May 17, 2011 9:33:36 AM NewRelic FINE: Compiling JSP: /jsp/footer.jsp
May 17, 2011 9:33:36 AM NewRelic FINE: Injecting browser timing footer into: /jsp/footer.jsp

</code></pre>
      </div>
      <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiYWdlbnQtY29ubmVjdHMtc2VydmVycyJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiQWZ0ZXIgdGhlIGFnZW50IGNvbm5lY3RzIHRvIHRoZSBzZXJ2ZXIifV0=">
        <div data-prop-text="title">After the agent connects to the server</div>
        <p>The JavaScript snippet is not inserted into the HTML response until after the agent connects to the server.</p>
        <pre><code>May 17, 2011 9:43:21 AM NewRelic INFO: Real user monitoring is enabled with auto instrumentation

</code></pre>
      </div>
      <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoianNwLWludm9rZWQifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IldoZW4gTmV3IFJlbGljIGludm9rZXMgdGhlIEpTUCJ9XQ==">
        <div data-prop-text="title">When New Relic invokes the JSP</div>
        <pre><code>May 17, 2011 9:43:23 AM NewRelic FINER: Injecting browser timing header in a JSP.  Content type is text/html
May 17, 2011 9:43:23 AM NewRelic FINER: Injecting browser timing footer in a JSP.  Content type is text/html

</code></pre>
      </div>
      <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiaGVhZGVyLWZvb3Rlci1jYWxsZWQifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IldoZW4gdGhlIGFnZW50IGNhbGxzIHRoZSBoZWFkZXIgYW5kIGZvb3RlciBBUEkifV0=">
        <div data-prop-text="title">When the agent calls the header and footer API</div>
        <pre><code>May 17, 2011 9:43:23 AM NewRelic FINEST: Got browser timing header in NewRelic API: &#x3C;script>var    NREUMQ=[];NREUMQ.push(["mark","firstbyte",new Date().getTime()]);(function(){var d=document;var e=d.createElement("script");e.type="text/javascript";e.async=true;e.src="https://d7p9czrvs14ne.cloudfront.net/11/eum/rum.js";var s=d.getElementsByTagName("script")[0];s.parentNode.insertBefore(e,s);})();&#x3C;/script>

May 17, 2011 9:43:23 AM NewRelic FINEST: Got browser timing footer in NewRelic API: &#x3C;script type="text/javascript" charset="utf-8">NREUMQ.push(["nrf2","staging-beacon-1.newrelic.com","8512b4d93f",7449,"M1RTYksFDEYDUxdcDgoeZERQSwhGEmQGRhVL",0,413])&#x3C;/script>

</code></pre>
      </div>
    </div>
  </li>
</ol>
