
<p>New Relic's C SDK monitors your applications and microservices to help you identify and solve performance issues. C applications run from a compiled, native binary file. In order to monitor <a href="/docs/apm/transactions/intro-transactions/transactions-new-relic-apm">transactions</a>, you must manually instrument your code by adding New Relic methods to it.</p>
<p>This guide helps you to decide which method to use. The method's code, required parameters, and examples reside in <a href="https://newrelic.github.io/c-sdk/index.html">New Relic's C SDK documentation on GitHub</a>.</p>
<h2>Ensure your customization is thread-safe [#thread-safety]</h2>
<p>The C SDK supports instrumentation of multi-threaded applications, but it must be initialized before instrumenting multiple threads. When calling any of the following functions, ensure that they are <strong>called on the main thread</strong> before any other C SDK functions are called:</p>
<ul>
  <li><a href="https://newrelic.github.io/c-sdk/libnewrelic_8h.html#a8922f48a2b92714fb2fc05ad7bd5c003"><code>newrelic_configure_log</code></a></li>
  <li><a href="https://newrelic.github.io/c-sdk/libnewrelic_8h.html#a03f07e64a51b5f0cd51caa4f28c8b6c1"><code>newrelic_init</code></a></li>
</ul>
<h2>Monitor transactions [#monitor-tx]</h2>
<p>Before you manually instrument your code to monitor transactions:</p>
<ol>
  <li>Check the <a href="https://docs.newrelic.com/docs/c-agent-compatibility-requirements">C SDK compatibility and requirements</a> for your app.</li>
  <li>Make sure you are using the latest version of the C SDK library, and <a href="https://docs.newrelic.com/docs/update-your-c-agent-library">update</a> as needed.</li>
</ol>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>If you want to...</p>
      </div>
      <div>
        <p>Use this method...</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p>Start timing a web transaction</p>
      </div>
      <div>
        <p><a href="https://newrelic.github.io/c-sdk/libnewrelic_8h.html#adbf7c1fa57482f6e0a7f291e0b5ec80f"><code>newrelic_start_web_transaction()</code></a></p>
      </div>
    </div>
    <div>
      <div>
        <p>Start timing a non-web transaction</p>
      </div>
      <div>
        <p><a href="https://newrelic.github.io/c-sdk/libnewrelic_8h.html#a88648cc287f8d7e371139dc3809b7afb"><code>newrelic_start_non_web_transaction()</code></a></p>
      </div>
    </div>
    <div>
      <div>
        <p>Stop timing a transaction</p>
      </div>
      <div>
        <p><code>newrelic_end_transaction()</code></p>
      </div>
    </div>
    <div>
      <div>
        <p>Prevent a transaction from reporting to New Relic</p>
      </div>
      <div>
        <p><a href="https://newrelic.github.io/c-sdk/libnewrelic_8h.html#a7b41f8690c3b2b7e024a16fa4bb59320"><code>newrelic_ignore_transaction()</code></a></p>
      </div>
    </div>
  </div>
</div>
<h2>Time specific methods using segments [#segments]</h2>
<p>If a transaction is already visible in New Relic, but you do not have enough data about a particular method that was called during that transaction, you can <a href="https://docs.newrelic.com/docs/instrument-your-app-c-sdk#segments">instrument segments</a>. For example, if you want to time a method that has complex logic, you can create a segment for each of the methods in the transaction.</p>
<p>To instrument a method within an existing transaction, create segments for any of the following:</p>
<ul>
  <li>External services</li>
  <li>Functions or other arbitrary blocks of code (using custom segments)</li>
  <li>Datastores</li>
  <li>Slow query traces (SQL datastores only)</li>
</ul>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>If you want to...</p>
      </div>
      <div>
        <p>Use this method...</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p>Start timing a segment</p>
      </div>
      <div>
        <p><code>newrelic_start_datastore_segment()newrelic_start_external_segment()newrelic_start_segment()</code></p>
      </div>
    </div>
    <div>
      <div>
        <p>Stop timing a segment</p>
      </div>
      <div>
        <p><code>newrelic_end_segment()</code></p>
      </div>
    </div>
    <div>
      <div>
        <p>Manually parent segments</p>
      </div>
      <div>
        <p><code>newrelic_set_segment_parent()</code> and <code>newrelic_set_segment_parent_root()</code></p>
        <p>This is useful, for example, with an asynchronous process when you want to visualize a segment as a child of the transaction's top-level call. For more information, see the <a href="https://github.com/newrelic/c-sdk/blob/master/GUIDE.md#manual-segment-parenting">manual segment parenting documentation on GitHub</a>.</p>
      </div>
    </div>
  </div>
</div>
<p>Segments are recorded on the active transaction. When adding a segment to an active transaction, you need access to the <code>newrelic_txn_t*</code> or transaction pointer, returned by <code>newrelic_start_web_transaction()</code> or <code>newrelic_start_non_web_transaction()</code>.</p>
<h2>Enhance the metadata of a transaction [#metadata]</h2>
<p>You can manage the metadata that New Relic reports for transactions. This is useful when you want a different level of detail for your transactions. For example:</p>
<ul>
  <li>If you are experiencing a <a href="/docs/agents/manage-apm-agents/troubleshooting/metric-grouping-issues#video">metric grouping issue</a>, you can change the default names for your transactions to make them more identifiable.</li>
  <li>If you want to create dashboards for your transactions, you can add custom attributes.</li>
</ul>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>If you want to...</p>
      </div>
      <div>
        <p>Use this method...</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p>Add metadata (such as your customer's account name or subscription level) to your transaction</p>
      </div>
      <div>
        <p>Add custom attributes to your transaction based on their type:</p>
        <ul>
          <li><a href="https://newrelic.github.io/c-sdk/libnewrelic_8h.html#a1f0fe987526c023a2101111b7ee557b3"><code>newrelic_add_attribute_int()</code></a></li>
          <li><a href="https://newrelic.github.io/c-sdk/libnewrelic_8h.html#a9eac445521cecdd046520d2178f232a0"><code>newrelic_add_attribute_string()</code></a></li>
          <li><a href="https://newrelic.github.io/c-sdk/libnewrelic_8h.html#a2a082a144cff6c805c6373d9d4f1f551"><code>newrelic_add_attribute_long()</code></a></li>
          <li><a href="https://newrelic.github.io/c-sdk/libnewrelic_8h.html#abfe6f64a8eec7d60d8588f8969781d34"><code>newrelic_add_attribute_double()</code></a></li>
        </ul>
      </div>
    </div>
  </div>
</div>
<h2>Instrument calls to external services [#externals]</h2>
<p>Use these methods to collect data about your app's connections to other apps or databases:</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>If you want to...</p>
      </div>
      <div>
        <p>Use this method...</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p>See the path that a request takes as it travels through a distributed system</p>
      </div>
      <div>
        <p>Follow the procedures to enable and instrument <a href="/docs/agents/c-sdk/instrumentation/enable-distributed-tracing-your-c-applications">distributed tracing</a>.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Time a call to an external resource (such as an external service, database server, or message queue)</p>
      </div>
      <div>
        <p>Follow the procedures to <a href="/docs/instrument-your-app-c-sdk#external-segments">Instrument calls to external segments</a>.</p>
      </div>
    </div>
  </div>
</div>
<h2>Collect or log errors [#errors]</h2>
<p>The C SDK detects errors automatically. If you want to change the way it reports errors to New Relic, change the error collector configuration.</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>If you want to...</p>
      </div>
      <div>
        <p>Use this method...</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p>Set logging levels for your app</p>
      </div>
      <div>
        <p>Use <code>newrelic_configure_log()</code> to configure the C SDK logs and command-line flags to configure the C daemon logs. For more information, see the <a href="https://docs.newrelic.com/docs/generate-logs-troubleshooting-c-sdk">C SDK logging documentation</a>.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Report an error</p>
      </div>
      <div>
        <p><a href="https://newrelic.github.io/c-sdk/libnewrelic_8h.html#a02a9a959015a0ca68ce11c750f690475"><code>newrelic_notice_error()</code></a></p>
      </div>
    </div>
  </div>
</div>
<h2>Send custom data from your app [#custom-data]</h2>
<p>To record <a href="/docs/data-analysis/metrics/analyze-your-metrics/data-collection-metric-timeslice-event-data">custom data</a> with the C SDK, you can use any of the following methods:</p>
<ul>
  <li><strong>Custom events:</strong> At New Relic, <a href="/docs/using-new-relic/welcome-new-relic/getting-started/glossary#event">event</a> data is a fundamental data type. Event data represents a record of a single event at a particular moment in time. This is useful to view or query specific details.</li>
  <li><strong>Custom event attributes:</strong> To include additional metadata about the event, you can add key/value pairs (<a href="/docs/using-new-relic/welcome-new-relic/getting-started/glossary#event">custom-attributes</a>) to your custom event.</li>
  <li><strong>Custom metrics:</strong> <a href="/docs/using-new-relic/welcome-new-relic/getting-started/glossary#metric">Metric timeslice data</a> is the statistical measure of data that New Relic aggregates so that you can view it in the UI and chart it. Typically metric data has a longer retention period than event data.</li>
</ul>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiY3VzdG9tLWV2ZW50cyJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiQ3VzdG9tIGV2ZW50cyJ9XQ==">
    <div data-prop-text="title">Custom events</div>
    <p>The C SDK provides a custom events API that allows you to send <a href="/docs/using-new-relic/welcome-new-relic/getting-started/glossary#custom-event">custom events</a> to New Relic. To send an event, start a transaction and use the <code>newrelic_create_custom_event</code> and <code>newrelic_record_custom_event</code> functions. For example:</p>
    <pre><code>// txn is a newrelic_txn_t*, created via newrelic_start_web_transaction
   newrelic_custom_event_t* custom_event=0;
   custom_event = newrelic_create_custom_event("aTypeForYourEvent");
   newrelic_record_custom_event(txn, &#x26;custom_event);

</code></pre>Be sure to review the [custom data requirements and limits](/docs/insights/insights-data-sources/custom-data/insights-custom-data-requirements-limits) for guidance on what values are and are not allowed inside your custom event. For more information, see [Custom events in APM](/docs/insights/insights-data-sources/custom-data/insert-custom-events-new-relic-apm-agents).
    &#x3C;Callout variant="tip">
    If you created a custom event but need to remove it before the transaction has ended, use `newrelic_discard_custom_event(&#x26;custom_event);`.
    &#x3C;/Callout>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiY3VzdG9tLWF0dHJpYnV0ZXMifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IkN1c3RvbSBldmVudCBhdHRyaWJ1dGVzIn1d">
    <div data-prop-text="title">Custom event attributes</div>
    <p>You can also add <code>int</code>, <code>long</code>, <code>double</code>, and <code>char*</code> (string) attributes to your custom event by using the <code>newrelic_custom_event_add_*</code> family of functions. For example:</p>
    <pre><code>// Example custom attributes:
newrelic_custom_event_t* custom_event=0;
custom_event = newrelic_create_custom_event("aTypeForYourEvent");

newrelic_custom_event_add_attribute_int(custom_event, "keya", 42);
newrelic_custom_event_add_attribute_long(custom_event, "keyb", 84);
newrelic_custom_event_add_attribute_double(custom_event, "keyc", 42.42);
newrelic_custom_event_add_attribute_string(custom_event, "keyd", "A string");

newrelic_record_custom_event(txn, &#x26;custom_event);

</code></pre>For more information, see the documentation about [custom attributes](/docs/agents/manage-apm-agents/agent-data/collect-custom-attributes).
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiY3VzdG9tLW1ldHJpY3MifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IkN1c3RvbSBtZXRyaWNzIn1d">
    <div data-prop-text="title">Custom metrics</div>
    <p>The C SDK provides the <a href="https://newrelic.github.io/c-sdk/libnewrelic_8h.html#aee71182588ace508cc816044d2024ff3"><code>newrelic_record_custom_metric()</code></a> function. This allows you to record time-based performance data using an API call, such as:</p>
    <ul>
      <li>
        <p>Transaction timing data</p>
      </li>
      <li>
        <p>Computer resource data</p>
      </li>
      <li>
        <p>Subscription or purchasing data</p>
        <p>To create a custom metric, provide a name or other identifier and an amount of time in milliseconds to the function, along with the active transaction.</p>
        <div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
          <p>Always prefix custom metric names with <code>Custom/</code>.</p>
        </div>
        <p>For example:</p>
        <pre><code>// txn is a newrelic_txn_t*, created via newrelic_start_web_transaction

// Record a metric value of 100ms in the transaction txn
    newrelic_record_custom_metric(txn, "Custom/MyMetric/My_label", 100);
</code></pre>
        <p>For more information, see <a href="/docs/agents/manage-apm-agents/agent-data/collect-custom-metrics">Collect custom metrics</a>.</p>
      </li>
    </ul>
  </div>
</div>
<p>Here are some ways to use your custom data. For code details and examples for these options, see the <a href="https://newrelic.github.io/c-sdk/globals.html">New Relic globals documentation on GitHub</a>.</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>If you want to...</p>
      </div>
      <div>
        <p>Use this method...</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p>Create a custom event to populate with a timestamp and attributes.</p>
      </div>
      <div>
        <p><a href="https://newrelic.github.io/c-sdk/libnewrelic_8h.html#a83b5b78623bcefda6d4e1e6d207f7b7a"><code>newrelic_create_custom_event()</code></a></p>
      </div>
    </div>
    <div>
      <div>
        <p>Timestamp and add the custom event to the current transaction so you can query or visualize it.</p>
      </div>
      <div>
        <p><a href="https://newrelic.github.io/c-sdk/libnewrelic_8h.html#a4af935da4651e398e3773c148e8db814"><code>newrelic_record_custom_event()</code></a></p>
      </div>
    </div>
    <div>
      <div>
        <p>Enhance your custom event with additional metadata.</p>
      </div>
      <div>
        <p>Add custom event attributes to your custom event based on type:</p>
        <ul>
          <li><a href="https://newrelic.github.io/c-sdk/libnewrelic_8h.html#af84bdcea08fbefb2023b47907a304188"><code>newrelic_custom_event_add_attribute_double()</code></a></li>
          <li><a href="https://newrelic.github.io/c-sdk/libnewrelic_8h.html#ade406683e960b53a1b4a2d832872ab1a"><code>newrelic_custom_event_add_attribute_int()</code></a></li>
          <li><a href="https://newrelic.github.io/c-sdk/libnewrelic_8h.html#a0ee8f438644f7699c8427fe231d7ffc1"><code>newrelic_custom_event_add_attribute_long()</code></a></li>
          <li><a href="https://newrelic.github.io/c-sdk/libnewrelic_8h.html#aa59111072aaa6d539adf6745c5dbfaa4"><code>newrelic_custom_event_add_attribute_string()</code></a></li>
        </ul>
      </div>
    </div>
    <div>
      <div>
        <p>Discard a custom event after it was created, but before its transaction has ended, to avoid reporting it to New Relic.</p>
      </div>
      <div>
        <p><a href="https://newrelic.github.io/c-sdk/libnewrelic_8h.html#a15aa71f0d4fac8fec8f4105c2c1d8dde"><code>newrelic_discard_custom_event</code></a></p>
        <p>This is necessary to free the allocated memory for your unwanted custom event in order to avoid leaks in your program.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Report a custom performance duration that you can search or chart.</p>
      </div>
      <div>
        <p><a href="https://newrelic.github.io/c-sdk/libnewrelic_8h.html#aee71182588ace508cc816044d2024ff3"><code>newrelic_record_custom_metric()</code></a></p>
      </div>
    </div>
  </div>
</div>
<h2>Monitor desktop browser performance [#browser]</h2>
<p>To monitor desktop browser performance for your application, install the browser agent using the <a href="/docs/browser/new-relic-browser/installation/install-new-relic-browser-agent#copy-paste-app">copy/paste method</a>.</p>
<h2>Change configuration settings [#configuration]</h2>
<p>Typically the default settings for your application's configuration do not need to be changed. However, when necessary, you can adjust some of the settings. For more information, see the <a href="https://docs.newrelic.com/docs/c-agent-configuration">C SDK configuration documentation</a>.</p>
