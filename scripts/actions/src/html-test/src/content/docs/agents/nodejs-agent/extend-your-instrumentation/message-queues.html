
<p>The New Relic Node.js agent supports the <a href="https://www.npmjs.com/package/amqplib">amqplib RabbitMQ client library</a>, giving you insight into the performance of your message processing, for both incoming and outgoing messages.</p>
<p>The APM UI will show transactions initiated via RabbitMQ message receipt (subscribe/consume messages) as <strong>Message</strong> background tasks. Message creation via RabbitMQ also appears in transaction traces.</p>
<p>This feature requires New Relic <a href="https://docs.newrelic.com/docs/release-notes/agent-release-notes/nodejs-release-notes">Node.js agent version 2.0.0 or higher</a>.</p>
<h2>Performance improvements with background tasks [#background]</h2>
<p>One way to increase responsiveness of web applications is to delegate work to background processes. Message queues are commonly used for this inter-process communication.</p>
<p>In the context of message queuing systems, applications typically interact with message brokers to send and receive messages. The <code>amqplib</code> client library allows Node applications to interface with message brokers that implement the Advanced Message Queueing Protocol (AMQP) 0.9 or higher.</p>
<p>New Relic's Node.js agent shows messages sent and received using the RabbitMQ client library. With this visibility, you can see details including:</p>
<ul>
  <li>Number of messages produced by your app</li>
  <li>Time your app spends publishing messages</li>
  <li>Time your app spends processing "consumed" messages</li>
</ul>
<p><a href="#view-queue">APM</a> conveniently groups and reports operations that interact with queues. By analyzing this information, you can more easily identify bottlenecks and areas for performance improvement in your message passing architecture.</p>
<h2>Queue operations [#queue-ops]</h2>
<p>Supported entry points for queue operations appear as <code>Put</code> (publish a message) or <code>Take</code> (receive a message) in APM's user interface.</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p><strong>Queue operations</strong></p>
      </div>
      <div>
        <p><strong>Publish a message (<code>Put</code> in UI)</strong></p>
      </div>
      <div>
        <p><strong>Receive a message (<code>Take</code> in UI)</strong></p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p>RabbitMQ</p>
      </div>
      <div>
        <p><code>publish</code></p>
        <p><code>sendToQueue</code></p>
      </div>
      <div>
        <p><code>get</code></p>
        <p><code>consume</code></p>
      </div>
    </div>
  </div>
</div>
<h2>View in New Relic UI [#view-queue]</h2>
<p>Queue operations appear on APM's <a href="/docs/apm/applications-menu/monitoring/transactions-dashboard"><strong>Transactions</strong> page</a> for the selected app. The <code>Put</code> and <code>Take</code> metrics appear in the <strong>Breakdown table</strong> and are categorized as <code>MessageBroker</code> metrics. Here is an example:</p>
<p>
  <img src="./images/messaging-breakdown-table.png" alt="metric-breakdown-table" title="metric-breakdown-table">
</p>
<p><strong><a href="http://one.newrelic.com">one.newrelic.com</a> > APM > Applications > (select an app) > Transactions > (select a transaction):</strong> The transaction's <strong>Breakdown table</strong> categorizes queue operations as <code>MessageBroker</code> metrics and labels them as <code>Put</code> (publish a message) or <code>Take</code> (receive a message).</p>
<p>The <a href="/docs/apm/transactions/transaction-traces/transaction-trace-summary"><strong>Transaction trace summary</strong> page</a> may show <code>Put</code> and <code>Take</code> operations in the <strong>Slowest components</strong> section. For example:</p>
<p>
  <img src="./images/Screen-Shot-2017-07-12-at-1.29.28-PM.png" alt="slow-message-component" title="slow-message-component">
</p>
<p><strong><a href="http://one.newrelic.com">one.newrelic.com</a> > APM > Applications > (select an app) > Summary > (select a transaction trace):</strong> In this example, the selected transaction trace's <strong>Summary</strong> shows RabbitMQ operations in the colored bar chart. The <strong>Slowest components</strong> section also lists the RabbitMQ <code>Put</code> and <code>Take</code> results.</p>
<p>The <a href="/docs/apm/transactions/transaction-traces/transaction-traces"><strong>Transaction trace</strong> page</a> also includes a dedicated <strong>Messages</strong> tab that shows a summary of the message activity that occurred as part of the transaction.</p>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJ0aXAifV0=">
  <p>You can <a href="/docs/apm/transactions/transaction-traces/viewing-transaction-traces">select transaction traces</a> from the app's <strong>Summary</strong> or <strong>Transactions</strong> pages in <strong>APM</strong>.</p>
</div>
