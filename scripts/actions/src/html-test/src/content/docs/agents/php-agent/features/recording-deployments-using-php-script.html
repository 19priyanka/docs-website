
<p>You can send information about application deployments to New Relic <a href="/docs/apm/new-relic-apm/maintenance/recording-deployments">via the REST API</a> or via a PHP program or script. To record deployments via a script, you must have <a href="http://curl.haxx.se/libcurl/php/">libcurl</a> available for your PHP installation.</p>
<h2>Contents [#qiklinks]</h2>
<h2>Customizing the script [#php_deploy_script]</h2>
<p>Customize the <a href="#example-script">example script</a> to record deployments with your PHP application:</p>
<ol>
  <li>
    <p>Ensure that <a href="http://curl.haxx.se/libcurl/php/">libcurl</a> is installed in your PHP installation.</p>
  </li>
  <li>
    <p>Copy the <a href="#example-script">example script below</a> to a text editor.</p>
  </li>
  <li>
    <p>In the <code>$apikey</code> line, specify your <a href="/docs/apis/rest-api-v2/requirements/rest-api-key">New Relic API key</a>.</p>
  </li>
  <li>
    <p>Specify the app for which you want New Relic to record a deployment:</p>
    <ul>
      <li>
        <p>Specify an existing <a href="/docs/apm/apis/application-examples-v2/listing-your-app-id-metric-data-api-v2#view_single_app_id">New Relic app ID</a>.</p>
        <p><strong>OR</strong></p>
      </li>
      <li>
        <p>Specify an <code>$app_name</code> corresponding to <a href="/docs/agents/php-agent/configuration/php-agent-newrelicini-settings#inivar-appname">an existing New Relic for PHP app</a>. If you specify the app via its app name, ensure you uncomment the following line in the data string section of the script:</p>
        <pre><code>$dep_dat = "deployment[app_name]=".$app_name;
</code></pre>
      </li>
    </ul>
  </li>
  <li>
    <p>Optional: Customize the <code>$dep_description</code>, <code>$dep_change</code>, <code>$dep_user</code>, and <code>$dep_rev</code> values to record additional details about the deployment. If you customize these values, ensure you uncomment their lines in the data string section of the script. For example, to record user name in your script, uncomment this line of the data string section:</p>
    <pre><code>$dep_dat = $dep_dat."&#x26;deployment[user]=".$dep_user;
</code></pre>
  </li>
  <li>
    <p>Save the script.</p>
  </li>
  <li>
    <p>Call the script during your deployment process.</p>
  </li>
</ol>
<h2>Example script</h2>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJjYXV0aW9uIn1d">
  <p><strong>Caution:</strong> This is a generic example and should be <a href="#php_deploy_script">customized for your system configuration</a>.</p>
</div>
<pre><code class="language-php">#!/usr/bin/php
&#x3C;?php

#Deployment
# Assumes the availability of libcurl in the PHP environment.

#Make your changes here:

$apikey = "{INSERT YOUR API KEY HERE}";

#Specify an existing New Relic app name OR app ID
#$app_name = "{INSERT YOUR APPLICATION NAME HERE}";
$app_id = "{INSERT YOUR APPLICATION ID HERE}";

$dep_description = "This is your app id deployment";
#$dep_change = "This is a change log entry";
#$dep_user = "This is the user entry";
#$dep_rev = "This is a version number";

#compose the data string for curl

#$dep_dat = "deployment[app_name]=".$app_name;
$dep_dat = "deployment[app_id]=".$app_id;
$dep_dat = $dep_dat."&#x26;deployment[description]=".$dep_description;
#$dep_dat = $dep_dat."&#x26;deployment[changelog]=".$dep_change;
#$dep_dat = $dep_dat."&#x26;deployment[user]=".$dep_user;
#$dep_dat = $dep_dat."&#x26;deployment[revision]=".$dep_rev;

#There should be no changes necessary beyond this point

#deployment url at New Relic
$url = "https://api.newrelic.com/deployments.xml";

#Create header info
$header = array("x-api-key:".$apikey);

#initialize curl 
$ch = curl_init();

curl_setopt ($ch, CURLOPT_VERBOSE, 1);
curl_setopt ($ch, CURLOPT_URL, $url);
curl_setopt ($ch, CURLOPT_HEADER, 1);
curl_setopt ($ch, CURLOPT_HTTPHEADER, $header );
curl_setopt ($ch, CURLOPT_POSTFIELDS, $dep_dat );

# Make the curl call for deployment
$http_result = curl_exec ($ch);
$error = curl_error($ch);
$http_code = curl_getinfo($ch, CURLINFO_HTTP_CODE);

#close curl 
curl_close ($ch);

#output status 
vprintf ("Code  %s\n", $http_code);
vprintf ("Results %s\n", $http_result);
if ($error) {
   vprintf ("Error %s\n",$error);
}

?>
</code></pre>
<h2>For more help [#more_help]</h2>
<p>Additional documentation resources include:</p>
<ul>
  <li><a href="/docs/apm/applications-menu/events/deployments-page"><strong>Deployments</strong> page</a> (recent deployments and their impact on your end user and app server's Apdex scores, response times, throughput, and errors)</li>
  <li><a href="/docs/apm/new-relic-apm/maintenance/setting-deployment-notifications">Setting up deployment notifications</a> (agent-specific instructions)</li>
</ul>
