
<h2>Syntax</h2>
<pre><code>newrelic.agent.register_application(name=None, timeout=None)
</code></pre>
<p>Registers the Python agent immediately. Used for manual initialization of agent.</p>
<h2>Description</h2>
<p>When <a href="/docs/agents/python-agent/python-agent-api/initialize"><code>initialize</code></a> is called, it sets up the Python agent but does not register the agent with the <a href="/docs/accounts-partnerships/education/getting-started-new-relic/glossary#collector">collector</a>. This call registers the agent with the collector.</p>
<p>This is primarily used for non-web <a href="/docs/agents/python-agent/python-agent-api/background_task">background transactions</a> instrumented using the API. When used with non-web transactions, call <code>register_application</code> as soon as possible after the <code>initialize</code> call.</p>
<p>For web transactions, the agent normally registers automatically when the first web request or background task occurs the agent receives its <a href="/docs/agents/manage-apm-agents/configuration/configure-agent#ssc">server-side configuration</a> from the collector. Because registration can take a second or so, details are usually lost from the earliest transactions. You can collect all of this data by forcing registration with <code>register_application</code>, though doing so means your app may wait for registration to complete before serving any web requests or running background tasks.</p>
<p>If the script itself runs the WSGI server, call <code>register_application</code> from the main program thread in the main script file. If you use Apache/mod_wsgi or uWSGI, make the call from the WSGI script file and place the call immediately after <code>initialize</code><strong>.</strong></p>
<p>This call returns the application object, in the same way <a href="/docs/agents/python-agent/python-agent-api/application"><code>application</code></a> does. The application object is used to get a reference to the current agent-monitored application and is used by some Python agent API calls.</p>
<h3>Avoid calling during global import lock [#globl-lock]</h3>
<p>Do not call <code>register_application</code> with a non-zero timeout when the Python global import lock will be held. In other words, do not call it in a module file at global scope while the module is being imported. Doing so may result in a temporary deadlock with the background thread created by this call (the deadlock will not be broken until the timeout expires).</p>
<p>Note that many WSGI servers import the module containing the WSGI application via the standard Python module import mechanisms. In those cases, the global import lock will be held and the deadlock problem described above can occur.</p>
<p>For Gunicorn: The deadlock issue just described can also occur when using Gunicorn. The problem is that triggering <code>register_application</code> from the WSGI module is not safe, because it preloads the module into the parent process. To use <code>register_application</code> with Gunicorn (with or without a timeout) call it from a <code>post_fork()</code> callback. This is not a problem with Apache/mod_wsgi, since those tools have been designed not to do this, so it is safe to create background threads when the WSGI application is loaded.</p>
<h3>Call after worker process fork [#worker-processes]</h3>
<p>If you are recording transactions in child worker process, do not call <code>register_application</code> in the parent process before the child worker processes are forked. If you were to call <code>register_application</code> before forking, the background agent thread would be killed when the process is forked. Since the parent thread is reporting data to the collector, the agent will not be able to report data from child worker process.</p>
<h2>Parameters</h2>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>Parameter</p>
      </div>
      <div>
        <p>Description</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p><code>name</code></p>
        <p><em>string</em></p>
      </div>
      <div>
        <p>Optional. The application name. If set, this overrides the application name set in the Python agent's configuration.</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>timeout</code></p>
        <p><em>int</em> or <em>float</em></p>
      </div>
      <div>
        <p>Optional but highly recommended. The number of seconds that the app will try to register before giving up and sending a response. A value of <code>0</code> means that the application will not wait for registration before it serves requests. The default is <code>0</code>.</p>
        <p>This value gives the maximum number of seconds the caller should be blocked before control is returned and the caller allowed to proceed. With no value, the call uses the globally configured <a href="/docs/agents/python-agent/installation-configuration/python-agent-configuration#startup-timeout"><code>startup_timeout</code></a> setting in the agent configuration, which is <code>0.0</code> by default.</p>
      </div>
    </div>
  </div>
</div>
<h2>Return values</h2>
<p>Returns an application object that can be used by some other Python agent API calls.</p>
<h2>Examples</h2>
<h3>Registering a background task [#register-example]</h3>
<p>This example registers a non-web background task with a long timeout. Typically, for a web application, you would have a very short time-out (the default is 0), but you might set a longer timeout for a infrequent non-web task to ensure initialization and registration take place.</p>
<pre><code>import newrelic.agent

newrelic.agent.initialize('newrelic.ini')
newrelic.agent.register_application(timeout=10.0)

@newrelic.agent.background_task()
def main():
    pass

if __name__ == '__main__':
    main()
</code></pre>
