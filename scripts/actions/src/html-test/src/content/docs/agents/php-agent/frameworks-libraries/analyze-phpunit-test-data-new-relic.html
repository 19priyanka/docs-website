
<p>If you use <a href="https://phpunit.de/">PHPUnit</a> to manage and run your unit tests, the New Relic PHP agent can automatically capture the test summary results and send them to <a href="/docs/insights/new-relic-insights/understanding-insights/new-relic-insights">New Relic</a> as an <a href="/docs/insights/new-relic-insights/understanding-insights/new-relic-insights#database">event</a> where you can query and visualize test data at a glance. This feature was released in version <strong>6.7.0</strong> of the PHP Agent and supports PHPUnit versions <strong>3.7</strong> to <strong>8.x</strong></p>
<h2>Enable PHPUnit test events [#phpunit-enable]</h2>
<p>To enable PHPUnit test events:</p>
<ol>
  <li>Find or add the <code>newrelic.phpunit_events.enabled</code> setting in your <code>newrelic.ini</code> file and set it to <code>true</code>.</li>
  <li>Restart your web server (apache, PHP-FPM, Nginx, etc) for the setting change to take effect.</li>
</ol>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJ0aXAifV0=">
  <p>Exception messages are collected and sent with events. Also, if you use PHPUnit's <code>--disallow-test-output</code> option, which flags tests that print output as "risky," the test event will include the offending output.</p>
</div>
<h2>View available attributes [#phpunit-view-attributes]</h2>
<p>When <a href="#phpunit-enable">enabled</a>, the PHP Agent detects PHPUnit commands and populates New Relic with two event types that contain data for the test suite (named <a href="#testsuite-event-attributes"><code>TestSuite</code></a>) and individual tests (named <a href="#test-event-attributes"><code>Test</code></a>). You can query the data with <a href="/docs/insights/new-relic-insights/using-new-relic-query-language/using-nrql">NRQL queries</a> and <a href="/docs/insights/new-relic-insights/managing-dashboards-data/building-insights-dashboards">build a dashboard</a> of information important to you.</p>
<p>To query your test events, use <code>FROM TestSuite</code> and <code>FROM Test</code> when specifying your <code>SELECT</code> statements:</p>
<pre><code>SELECT uniqueCount(name) FROM TestSuite
</code></pre>
<p>
  <img src="./images/PHPUnit_dashboard_0.png" alt="PHPUnit_dashboard.png" title="PHPUnit_dashboard.png">
</p>
<p>Example of a PHPUnit test dashboard created by querying <code>TestSuite</code> and <code>Test</code> events.</p>
<h2>Example queries</h2>
<p>A dashboard of test summary data allows you to quickly see a snapshot of overall test success as well as dig into failing suites to determine their cause. These examples illustrate the kinds of widgets you can create with both <code>TestSuite</code> and <code>Test</code> event types.</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoicGVyY2VudC1zdWNjZXNzIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJQZXJjZW50IHN1Y2Nlc3MifV0=">
    <div data-prop-text="title">Percent success</div>
    <p>What percent of suites or tests are passing?</p>
    <pre><code>SELECT percentage(count(*), WHERE successful IS true) FROM TestSuite

</code></pre>![PHPUnit_passing_dials.png](./images/PHPUnit_passing_dials.png "PHPUnit_passing_dials.png")
    What percent of suites and tests are passing?
    <pre><code>
SELECT percentage(count(*), WHERE outcome = 'passed') FROM Test

</code></pre>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoidGVzdC1vdXRjb21lIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJUZXN0IG91dGNvbWUifV0=">
    <div data-prop-text="title">Test outcome</div>
    <p>What is the breakdown of test outcomes?</p>
    <pre><code>SELECT count(*) FROM Test FACET outcome

</code></pre>![PHPUnit_test_outcomes.png](./images/PHPUnit_test_outcomes.png "PHPUnit_test_outcomes.png")
    What is the breakdown of test outcomes?
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoidGVzdC1mYWlsdXJlcyJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiVGVzdCBmYWlsdXJlcyJ9XQ==">
    <div data-prop-text="title">Test failures</div>
    <p>What percent of the time does each test pass?</p>
    <pre><code>SELECT percentage(count(*), WHERE outcome = 'failed') FROM Test FACET name

</code></pre>![PHPUnit_test_failure.png](./images/PHPUnit_test_failure.png "PHPUnit_test_failure.png")
    What percent of the time does each test pass?
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoic3VpdGUtZmFpbHVyZXMifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IlRlc3Qgc3VpdGUgZmFpbHVyZXMifV0=">
    <div data-prop-text="title">Test suite failures</div>
    <p>What percent of the time does each suite pass, and is that consistent over time?</p>
    <pre><code>SELECT histogram((passedCount / testCount)*100, 100, 10) FROM TestSuite FACET name

</code></pre>![PHPUnit_passing_histogram.png](./images/PHPUnit_passing_histogram.png "PHPUnit_passing_histogram.png")
    What percent of the time does each suite pass, and is that consistent over time?
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZHVyYXRpb24ifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IkR1cmF0aW9uIn1d">
    <div data-prop-text="title">Duration</div>
    <p>How long does each test suite take to run, and is that consistent over time?</p>
    <pre><code>SELECT histogram(duration*1000, 10, 20) FROM TestSuite FACET name

</code></pre>![PHPUnit_duration_histogram.png](./images/PHPUnit_duration_histogram.png "PHPUnit_duration_histogram.png")
    How long does each test suite take to run, and is that consistent over time?
  </div>
</div>
<h2>Linked facets</h2>
<p>Because a PHPUnit test suite is linked to individual tests via its run ID, you can use <a href="/docs/insights/new-relic-insights/managing-dashboards-data/editing-insights-dashboards#facet-linking"><code>FACET</code> widgets to filter results</a> for a specific test run.</p>
<p>For example, if you created a widget with the most recent failing test suites and linked it to the current dashboard, you could click on a test and the surrounding widgets would update with information for only that test suite run.</p>
<p>
  <img src="./images/PHPUnit_facet_on_runId.png" alt="PHPUnit_facet_on_runId.png" title="PHPUnit_facet_on_runId.png">
</p>
<p>FACET widget (top-left) linked to the current dashboard allows you to drill into failing test suites.</p>
<p>In the above example, you can see that by clicking on run <code>5bb37ccee2a1dbc7</code>, we learn that one of two tests, <code>testFoo</code>, failed. Here are the NRQL queries that made up this example:</p>
<p><strong>Recent unsuccessful suites:</strong></p>
<pre><code>SELECT latest(timestamp), latest(name) FROM TestSuite WHERE successful IS false FACET runId
</code></pre>
<p><strong>Last unsuccessful suite:</strong></p>
<pre><code>SELECT host, name, duration * 1000 AS 'duration (ms)', assertionCount, testCount, passedCount, failedCount, incompleteCount, skippedCount, errorCount, riskyCount, warningCount FROM TestSuite WHERE successful IS false LIMIT 1
</code></pre>
<p><strong>Last unsuccessful test:</strong></p>
<pre><code>SELECT host, name, testSuiteName, duration * 1000 AS 'duration (ms)', outcome, assertionCount, message FROM Test WHERE outcome != 'passed' LIMIT 1
</code></pre>
<h2>PHPUnit event attributes</h2>
<p><code>TestSuite</code> and <code>Test</code> events contain the following attributes you can query against:</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoidGVzdHN1aXRlLWV2ZW50LWF0dHJpYnV0ZXMifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6eyJ0eXBlIjoibWR4VmFsdWVFeHByZXNzaW9uIiwidmFsdWUiOiI8PjxJbmxpbmVDb2RlPlRlc3RTdWl0ZTwvSW5saW5lQ29kZT4gZXZlbnQgYXR0cmlidXRlczwvPiIsInBvc2l0aW9uIjp7InN0YXJ0Ijp7ImxpbmUiOjE2MywiY29sdW1uIjoxMSwib2Zmc2V0Ijo2MzU1fSwiZW5kIjp7ImxpbmUiOjE2MywiY29sdW1uIjo2OSwib2Zmc2V0Ijo2NDEzfX19fV0=">
    <div data-prop-text="title">[object Object]</div>
    <p><strong>TestSuite</strong> events include the following attributes:</p>
    <div data-component="Table" data-prop="W10=">
      <div>
        <div>
          <div>
            <p>Attribute</p>
          </div>
          <div>
            <p>Description</p>
          </div>
        </div>
      </div>
      <div>
        <div>
          <div>
            <p><code>duration</code></p>
          </div>
          <div>
            <p>The number of seconds it took for the test suite to run.</p>
          </div>
        </div>
        <div>
          <div>
            <p><code>assertionCount</code></p>
          </div>
          <div>
            <p>The total number of assertions the test suite made.</p>
          </div>
        </div>
        <div>
          <div>
            <p><code>errorCount</code></p>
          </div>
          <div>
            <p>The number of errors reported.</p>
          </div>
        </div>
        <div>
          <div>
            <p><code>warningCount</code></p>
          </div>
          <div>
            <p>The number of tests with warnings. <em>Note that PHPUnit includes these in the <code>passedCount</code> as well.</em></p>
          </div>
        </div>
        <div>
          <div>
            <p><code>failedCount</code></p>
          </div>
          <div>
            <p>The number of failed tests.</p>
          </div>
        </div>
        <div>
          <div>
            <p><code>incompleteCount</code></p>
          </div>
          <div>
            <p>The number of incomplete tests.</p>
          </div>
        </div>
        <div>
          <div>
            <p><code>passedCount</code></p>
          </div>
          <div>
            <p>The number of passed tests.</p>
          </div>
        </div>
        <div>
          <div>
            <p><code>riskyCount</code></p>
          </div>
          <div>
            <p>The number of tests <a href="https://phpunit.de/manual/current/en/risky-tests.html">marked by PHPUnit as risky</a>.</p>
          </div>
        </div>
        <div>
          <div>
            <p><code>skippedCount</code></p>
          </div>
          <div>
            <p>The number of tests that were skipped.</p>
          </div>
        </div>
        <div>
          <div>
            <p><code>testCount</code></p>
          </div>
          <div>
            <p>The number of tests that ran.</p>
          </div>
        </div>
        <div>
          <div>
            <p><code>runId</code></p>
          </div>
          <div>
            <p>A unique identifier that ties the test suite to the individual tests. For example, <code>861d12cea0d5b923</code>.</p>
          </div>
        </div>
        <div>
          <div>
            <p><code>successful</code></p>
          </div>
          <div>
            <p>A boolean that is <code>true</code> if there were no failures or errors during the test suite run.</p>
          </div>
        </div>
        <div>
          <div>
            <p><code>name</code></p>
          </div>
          <div>
            <p>The name of the test suite.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoidGVzdC1ldmVudC1hdHRyaWJ1dGVzIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOnsidHlwZSI6Im1keFZhbHVlRXhwcmVzc2lvbiIsInZhbHVlIjoiPD48SW5saW5lQ29kZT5UZXN0PC9JbmxpbmVDb2RlPiBldmVudCBhdHRyaWJ1dGVzPC8+IiwicG9zaXRpb24iOnsic3RhcnQiOnsibGluZSI6MzE2LCJjb2x1bW4iOjExLCJvZmZzZXQiOjk0NTF9LCJlbmQiOnsibGluZSI6MzE2LCJjb2x1bW4iOjY0LCJvZmZzZXQiOjk1MDR9fX19XQ==">
    <div data-prop-text="title">[object Object]</div>
    <p><strong>Test</strong> events include the following attributes:</p>
    <div data-component="Table" data-prop="W10=">
      <div>
        <div>
          <div>
            <p>Attribute</p>
          </div>
          <div>
            <p>Description</p>
          </div>
        </div>
      </div>
      <div>
        <div>
          <div>
            <p><code>duration</code></p>
          </div>
          <div>
            <p>The number of seconds it took for the test to run.</p>
          </div>
        </div>
        <div>
          <div>
            <p><code>message</code></p>
          </div>
          <div>
            <p>Any message associated with the test outcome. For example: <strong>Failed asserting that false is true</strong> or <strong>This test depends on 'StackTest::testFailure' to pass.</strong>.</p>
          </div>
        </div>
        <div>
          <div>
            <p><code>assertionCount</code></p>
          </div>
          <div>
            <p>The number of assertions the test made.</p>
          </div>
        </div>
        <div>
          <div>
            <p><code>outcome</code></p>
          </div>
          <div>
            <p>The outcome of the test. Options include <strong>passed</strong>, <strong>failed</strong>, <strong>skipped</strong>, <strong>risky</strong>, <strong>warning</strong>, and <strong>incomplete</strong>.</p>
          </div>
        </div>
        <div>
          <div>
            <p><code>runId</code></p>
          </div>
          <div>
            <p>A unique identifier that ties the test to its test suite. For example: <code>861d12cea0d5b923</code>.</p>
          </div>
        </div>
        <div>
          <div>
            <p><code>name</code></p>
          </div>
          <div>
            <p>The name of the test.</p>
          </div>
        </div>
        <div>
          <div>
            <p><code>testSuiteName</code></p>
          </div>
          <div>
            <p>The name of the parent test suite.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<h2>For more help [#more_help]</h2>
<p>Additional documentation resources include:</p>
<ul>
  <li><a href="https://docs.newrelic.com/docs/insights/new-relic-insights/managing-dashboards-data/building-insights-dashboards">Building dashboards</a> (how to build and view customized dashboards)</li>
  <li><a href="/docs/insights/new-relic-insights/decorating-events/insights-attributes">Using NRQL</a> (how to use NRQL to explore your data)</li>
</ul>
