
<h2>Syntax</h2>
<pre><code>newrelic_get_trace_metadata()
</code></pre>
<p>Returns an associative array containing the identifiers of the current trace and the parent span.</p>
<h2>Requirements</h2>
<p>Requires PHP agent <a href="https://docs.newrelic.com/docs/release-notes/agent-release-notes/php-release-notes">version 9.3 or higher</a>.</p>
<p>Must be called inside a <a href="https://docs.newrelic.com/docs/accounts-partnerships/education/getting-started-new-relic/glossary#transaction">transaction</a>.</p>
<h2>Description</h2>
<p>Returns an associative array containing the identifiers of the current trace and the parent span. This information is useful for integrating with third party distributed tracing tools, such as Zipkin.</p>
<h2>Return values</h2>
<p>An associative array containing the keys:</p>
<ul>
  <li><code>trace.id</code>: the currently executing trace identifier. An empty value will be returned if the transaction does not support this functionality or distributed tracing is disabled.Returns:</li>
  <li><code>span.id</code>: the currently executing span identifier. An empty value will be returned if the transaction does not support this functionality or distributed tracing is disabled.</li>
</ul>
<h2>Examples</h2>
<h3>Populate B3 Headers for use with Zipkin</h3>
<p>Adds necessary distributed tracing metadata to the HTTP headers being sent to a Zipkin consumer:</p>
<pre><code>function make_http_request($url) {
  $metadata = newrelic_get_trace_metadata();
  $sampled = newrelic_is_sampled();

  $ch = curl_init($url);

  curl_setopt($ch, CURLOPT_HTTPHEADER, array(
    'X-B3-TraceId: ' . $metadata['trace_id'],
    'X-B3-SpanId: ' . substr(uniqid() . uniqid(), 0, 16),
    'X-B3-ParentSpanId: ' . $metadata['span_id'],
    'X-B3-Sampled: ' . $sampled));

  return curl_exec($ch);
}

$status = make_http_request("zipkin-consumer.example");
</code></pre>
