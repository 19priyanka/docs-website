
<p>How to update the APM .NET agent.</p>
<h2>Check your .NET agent version [#your_version]</h2>
<ol>
  <li>Refer to the <a href="https://docs.newrelic.com/docs/releases/dotnet/">release notes</a> to find the latest version of the agent.</li>
  <li>Check the version of the .NET agent you currently have installed by using <strong>Windows Programs and Features</strong> or by using your Linux package manager.</li>
  <li>Follow the update instructions for your agent:
    <ul>
      <li><a href="#updating_net">Windows</a></li>
      <li><a href="#updating_net_core">Linux</a></li>
    </ul>
  </li>
</ol>
<h2>Update the .NET agent (Windows) [#updating_net]</h2>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
  <p>Before updating:</p>
  <ul>
    <li>Updating the agent requires <strong>Administrator</strong> rights in your Windows admin group. For more information, see the <a href="/docs/agents/net-agent/getting-started/compatibility-requirements-net-framework-agent#user-rights">permissions documentation</a>.</li>
    <li>If your .NET Framework agent version is lower than 7.0 or you are using .NET Framework version 4.0 or lower, see <a href="#updating_older_net">Update legacy .NET agent</a>.</li>
  </ul>
</div>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoidXBkYXRlLWZyYW1ld29yay1zdGFuZGFyZCJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiU3RhbmRhcmQgaW5zdGFsbCJ9XQ==">
    <div data-prop-text="title">Standard install</div>
    <ol>
      <li>
        <p>Ensure that you have <a href="/docs/agents/net-agent/getting-started/compatibility-requirements-net-framework-agent#net-version">.NET 4.5 or higher installed on your system</a>.</p>
      </li>
      <li>
        <p>Stop IIS.</p>
      </li>
      <li>
        <p>Download and run the appropriate MSI install package for your <a href="/docs/agents/net-agent/getting-started/compatibility-requirements-net-framework-agent#architecture">architecture</a>:</p>
        <ul>
          <li><a href="http://download.newrelic.com/dot_net_agent/latest_release/NewRelicDotNetAgent_x86.msi">32-bit installer</a></li>
          <li><a href="http://download.newrelic.com/dot_net_agent/latest_release/NewRelicDotNetAgent_x64.msi">64-bit installer</a></li>
        </ul>
      </li>
      <li>
        <p>After the installer package finishes, start IIS.</p>
      </li>
    </ol>
  </div>
</div>
<h2>Update the .NET agent (Linux) [#updating_net_core]</h2>
<p>Use one of the following methods to update to the latest version of New Relic's .NET agent:</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoidXBkYXRpbmctY29yZS16aXAifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6InppcCwgdGFyLmd6LCBkZWIgZmlsZSJ9XQ==">
    <div data-prop-text="title">zip, tar.gz, deb file</div>
    <ol>
      <li>Shut down your application(s).</li>
      <li>Download and run the appropriate install file for your <a href="/docs/agents/net-agent/getting-started/compatibility-requirements-net-core-agent#architecture">architecture</a> from the <a href="https://download.newrelic.com/dot_net_agent/latest_release/">download site</a>.</li>
      <li>Extract the downloaded zip file on top of the existing files.</li>
      <li>Restart your application(s).</li>
    </ol>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoieXVtIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJ5dW0gKENlbnRPUywgT3JhY2xlIExpbnV4LCBvciBSSEVMKSJ9XQ==">
    <div data-prop-text="title">yum (CentOS, Oracle Linux, or RHEL)</div>
    <ol>
      <li>
        <p>Shut down your application(s).</p>
      </li>
      <li>
        <p>Use the following to update the agent:</p>
        <pre><code>sudo yum update newrelic-netcore20-agent
</code></pre>
      </li>
    </ol>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiYXB0In0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJhcHQgKERlYmlhbiwgTGludXggTWludCwgb3IgVWJ1bnR1KSJ9XQ==">
    <div data-prop-text="title">apt (Debian, Linux Mint, or Ubuntu)</div>
    <ol>
      <li>
        <p>Shut down your application(s).</p>
      </li>
      <li>
        <p>Use the following to get a list of available updates and install them:</p>
        <pre><code>sudo apt-get update &#x26;&#x26; sudo apt-get install --only-upgrade newrelic-netcore20-agent
</code></pre>
      </li>
    </ol>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoicnBtIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJycG0gKENlbnRPUywgT3JhY2xlIExpbnV4LCBvciBSSEVMKSJ9XQ==">
    <div data-prop-text="title">rpm (CentOS, Oracle Linux, or RHEL)</div>
    <ol>
      <li>
        <p>Shut down your application(s).</p>
      </li>
      <li>
        <p>Download and run the appropriate rpm file for your <a href="/docs/agents/net-agent/getting-started/compatibility-requirements-net-core-agent#architecture">architecture</a> from the <a href="https://download.newrelic.com/dot_net_agent/latest_release/">download site</a>.</p>
      </li>
      <li>
        <p>Use the following to update the agent:</p>
        <pre><code>sudo rpm -Uvh FILE_NAME.rpm
</code></pre>
      </li>
    </ol>
  </div>
</div>
<h2>.NET agent versions not supported [#eol-versions]</h2>
<p><strong>End of life notification:</strong> As of July 29, 2019, New Relic will no longer accept data from .NET agent versions earlier than <strong>5.1</strong>.</p>
<p>These agent versions use an out-of-date protocol when communicating with New Relic's data collection services. In addition, many of these versions contain a potential security issue where they may incorrectly send sensitive data to the New Relic collector.</p>
<h2>Update older .NET Framework agents (lower than 7.0) [#updating_older_net]</h2>
<p>If you are considering updating a .NET Framework agent version that is lower than 7.0, review the following notes. To see the agent version you have, see <a href="#your_version">Check agent version</a>. For a full list of agent changes, see the <a href="/docs/release-notes/agent-release-notes/net-release-notes">.NET release notes</a>.</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoib2xkLWZyYW1ld29yay12ZXJzaW9ucyJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiLk5FVCBGcmFtZXdvcmsgbGVnYWN5IGFnZW50IHZlcnNpb24gZGV0YWlscyJ9XQ==">
    <div data-prop-text="title">.NET Framework legacy agent version details</div>
    <div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
      <p>To instrument applications targeting .NET Framework 4.0 or earlier, you must use a version of the .NET Framework agent prior to 7.0. See <a href="http://docs.newrelic.com/docs/agents/net-agent/troubleshooting/technical-support-net-frameworks-40-or-earlier">support for .NET Frameworks 4.0 or earlier</a> for more information.</p>
    </div>
    <div data-component="Table" data-prop="W10=">
      <div>
        <div>
          <div>
            <p>If version is lower than...</p>
          </div>
          <div>
            <p>Do this...</p>
          </div>
        </div>
      </div>
      <div>
        <div>
          <div>
            <p>7.0</p>
          </div>
          <div>
            <p>Version 7.0 and higher of the .NET Framework agent support applications that target .NET Framework 4.5 or higher.</p>
          </div>
        </div>
        <div>
          <div>
            <p>6.12</p>
          </div>
          <div>
            <p>Versions 6.12 or higher do not support Windows Server 2003. If you require Windows Server 2003, use versions 6.11 or lower. For more information, get support at <a href="https://support.newrelic.com">support.newrelic.com</a> or download the agent at <a href="http://download.newrelic.com/">http://download.newrelic.com/</a></p>
          </div>
        </div>
        <div>
          <div>
            <p>6.11</p>
          </div>
          <div>
            <p>Previously, <a href="/docs/apm/applications-menu/monitoring/databases-slow-queries-page">database</a> and <a href="/docs/apm/applications-menu/monitoring/external-services-page">external</a> calls that occurred outside of a transaction would generate metrics that you could view in their respective pages in the APM UI. Now these metrics will not be displayed. In a non-web application these calls can be "wrapped" in a <a href="/docs/agents/net-agent/instrumentation/net-custom-transactions">custom transaction</a> to be able to view their metrics.</p>
          </div>
        </div>
        <div>
          <div>
            <p>6.0</p>
          </div>
          <div>
            <p>To get <a href="/docs/agents/net-agent/instrumentation/net-custom-transactions">async support</a> if your .NET agent version is earlier than 6.0, do the following as applicable:</p>
            <ol>
              <li>
                <p>Remove the following application setting in <code>newrelic.config</code> if it exists:</p>
                <pre><code>&#x3C;appSettings>
  &#x3C;add key="AsyncMode" value="false" />
&#x3C;/appSettings>
</code></pre>
              </li>
              <li>
                <p>Ensure your app's host has .NET 4.5 or higher installed.</p>
              </li>
              <li>
                <p>Tell .NET to use the new ASP request processing pipeline by adding the following lines to your <code>web.config</code>:</p>
                <pre><code>&#x3C;configuration>
  &#x3C;appSettings>
    &#x3C;add key="aspnet:UseTaskFriendlySynchronizationContext" value="true" />
  &#x3C;/appSettings>
&#x3C;configuration>
</code></pre>
                <p>OR</p>
                <p>Specify the .NET Framework version to be 4.5.2 or higher by adding the following lines to the <code>web.config</code>:</p>
                <pre><code>&#x3C;configuration>
  &#x3C;system.web>
    &#x3C;httpRuntime targetFramework="YOUR_TARGET_NET_VERSION" /> 
  &#x3C;/system.web>
&#x3C;configuration>
</code></pre>
              </li>
            </ol>
          </div>
        </div>
        <div>
          <div>
            <p>5.0 (for Web API)</p>
          </div>
          <div>
            <p>To see Web API transactions, you must opt in to a <a href="http://blogs.msdn.com/b/webdev/archive/2012/11/19/all-about-httpruntime-targetframework.aspx">.NET framework bug fix</a> if the following conditions apply:</p>
            <ul>
              <li>
                <p>You use ASP.NET Web API v1.</p>
              </li>
              <li>
                <p>Your app targets .NET Framework agent version 4.0. (This issue does not affect version 4.5 or higher.)</p>
              </li>
              <li>
                <p>You are upgrading from .NET Framework agent to version 5.0 or higher.</p>
                <p>To apply the fix:</p>
              </li>
            </ul>
            <ol>
              <li>
                <p>Ensure your app's host has .NET 4.5 installed.</p>
              </li>
              <li>
                <p>Add this <code>appSetting</code> to your <strong>web.config</strong>:</p>
                <pre><code>&#x3C;configuration>
  &#x3C;appSettings>
    &#x3C;add key="aspnet:UseTaskFriendlySynchronizationContext" value="true" />
  &#x3C;/appSettings>
&#x3C;configuration>
</code></pre>
                <p>For more information about this .NET framework bug, see <a href="http://stackoverflow.com/questions/18383923/why-is-httpcontext-current-null-after-await">Why is HttpContext.Current null after await?</a> and <a href="http://blogs.msdn.com/b/webdev/archive/2012/11/19/all-about-httpruntime-targetframework.aspx">All about &#x3C;httpRuntime targetFramework></a>.</p>
              </li>
            </ol>
          </div>
        </div>
        <div>
          <div>
            <p>5.0 (for metrics)</p>
          </div>
          <div>
            <p>Metrics that are not part of a transaction will not be displayed in the UI. <strong>Exception:</strong> You can view <a href="/docs/apm/applications-menu/monitoring/databases-slow-queries-page">database</a> and <a href="/docs/apm/applications-menu/monitoring/external-services-page">external</a> metrics in their respective pages in the APM UI. Other such metrics (such as instrumented methods) can be made viewable by "wrapping" them in a <a href="/docs/agents/net-agent/instrumentation/net-custom-transactions">custom transaction</a>.</p>
            <p>Your <a href="/docs/agents/net-agent/instrumentation/net-custom-instrumentation">custom instrumentation</a> may need to be updated to use <a href="/docs/agents/net-agent/instrumentation/net-custom-transactions">custom transactions</a>. For an example of what you will see in the UI, see this <a href="https://discuss.newrelic.com/t/change-in-non-web-transaction-reporting-with-version-5-x/28721">New Relic Online Technical Community post</a>.</p>
          </div>
        </div>
        <div>
          <div>
            <p>4.4</p>
          </div>
          <div>
            <p>New Relic improved transaction naming. However, these changes can affect the transaction names of existing metrics, including <a href="/docs/apm/transactions/key-transactions/key-transactions-tracking-important-transactions-or-events">key transactions</a>, "alert on anything" metrics, and <a href="/docs/query-your-data/explore-query-data/query-builder/use-advanced-nrql-mode-specify-data">queries</a> based on transaction names. You must recreate these settings using the new transaction name after the upgrade.</p>
          </div>
        </div>
        <div>
          <div>
            <p>4.2</p>
          </div>
          <div>
            <p>New Relic dropped the "outer" HTTP transaction ("<code>.svc</code>" transactions) for WCF applications hosted with <code>asp.net</code> compatibility mode disabled. Now only the WCF transaction is reported.</p>
            <p>This change results in more accurate throughput data. It also prevents HTTP status code errors from being reported for failed WCF transactions.</p>
          </div>
        </div>
        <div>
          <div>
            <p>4.1</p>
          </div>
          <div>
            <p>New Relic implemented datastore metrics for SQL traces. Metric names for database activity were updated to report under datastore.</p>
          </div>
        </div>
        <div>
          <div>
            <p>4.0</p>
          </div>
          <div>
            <p>MVC2 applications no longer generate MVC-specific segments or have MVC route-based transaction names.</p>
          </div>
        </div>
        <div>
          <div>
            <p>3.0</p>
          </div>
          <div>
            <p>New Relic's .NET agent became dependent on .NET 3.5. Your application can still target .NET 2.0, but you must have .NET 3.5 installed on the computer on which the agent executes.</p>
          </div>
        </div>
        <div>
          <div>
            <p>2.20</p>
          </div>
          <div>
            <p>Version 2.19.3.0 was the last .NET agent version that required both the <code>GetBrowserTimingFooter()</code> and the <code>GetBrowserTimingHeader()</code> API calls for browser monitoring. In agent version 2.20.24.0 or higher, you only need to call <code>GetBrowserTimingHeader()</code>. <code>GetBrowserTimingFooter()</code> has no effect. <strong>Recommendation:</strong> Remove these references from your code.</p>
          </div>
        </div>
        <div>
          <div>
            <p>2.9</p>
          </div>
          <div>
            <p>The configuration file changed from <code>newrelic.xml</code> to <code>newrelic.config</code>. Installers for newer agents attempt to convert <code>newrelic.xml</code> (if present) to <code>newrelic.config</code>.</p>
          </div>
        </div>
        <div>
          <div>
            <p>2.2 or earlier</p>
          </div>
          <div>
            <p>To upgrade from a .NET agent version earlier than 2.2, you must uninstall the old agent before installing the new version. Follow the standard procedures for your Windows version to uninstall the agent. Your operating system may require a restart.</p>
            <p>You may experience <code>cocreateinstance</code> errors with <strong>services.exe</strong> when you upgrade an old installer (2.1.3.494 or earlier) or make other changes to environment variables. To resolve this problem, refer to <a href="https://support.microsoft.com/en-us/kb/821761">Microsoft's documentation</a>.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
