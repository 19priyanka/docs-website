
<p>This is an example of a custom JMX YAML file for New Relic's Java agent, including value and definition, MBean, attributes, type, and names for metrics, objects, and attributes. For more information, including a video, see <a href="/docs/java/custom-jmx-monitoring-by-yml">Custom JMX monitoring by YAML</a>.</p>
<h2>Contents [#qiklinks]</h2>
<h2>YAML example</h2>
<p>Here is an example of a custom JMX YAML file. YAML files are space senstive.</p>
<pre><code>name: TomcatCustom
version: 1.0
enabled: true
jmx:
  - object_name: Catalina:type=Cache,host=localhost,path=/examples
    metrics:
      - attributes: accessCount, cacheSize, hitsCount
        type: simple
  - object_name: Catalina:type=Connector,port=8009
    metrics:
      - attributes: bufferSize, maxHeaderCount
  - object_name: java.nio:type=BufferPool,name=*
    metrics:
      - attributes: Count
        type: monotonically_increasing
</code></pre>
<h2>Example explanation [#initial_info]</h2>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoicHJvcGVydGllcyJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiUHJvcGVydGllcyJ9XQ==">
    <div data-prop-text="title">Properties</div>
    <div data-component="Table" data-prop="W10=">
      <div>
        <div>
          <div>
            <p><strong>Value</strong></p>
          </div>
          <div>
            <p><strong>Definition</strong></p>
          </div>
        </div>
      </div>
      <div>
        <div>
          <div>
            <p><code>name</code></p>
          </div>
          <div>
            <p>A descriptive name identifying your YAML custom instrumentation file, using one space before the property name. In the above example, the name is <code>TomcatCustom</code>.</p>
          </div>
        </div>
        <div>
          <div>
            <p><code>version</code></p>
          </div>
          <div>
            <p>The version of the extension file. Use a double. If two extensions have the same name, only the extension with the highest version will be used. Use one space before the property version. In the above example, the version is <code>1.0</code>.</p>
          </div>
        </div>
        <div>
          <div>
            <p><code>enabled</code></p>
          </div>
          <div>
            <p>If <code>true</code>, the Java agent will read the extension. If <code>false</code>, the Java agent will ignore the extension. Use one space before the property enabled. The above example is enabled.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZXhhbXBsZV9tYmVhbnMifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6Ik1CZWFucyJ9XQ==">
    <div data-prop-text="title">MBeans</div>
    <p>Each line in the YAML starting with <code>- object_name</code> represents an MBean. For example, the following lines describe the information to be pulled from the first MBean:</p>
    <pre><code>- object_name: Catalina:type=Cache,host=localhost,path=/examples
    metrics:
      - attributes: accessCount, cacheSize, hitsCount
        type: simple

</code></pre>
    <pre><code>
Catalina:type=Cache,host=localhost,path=/examples
Catalina:type=Connector,port=8009
java.nio:type=BufferPool,name=*

</code></pre>The asterisk (\*) wildcard can only be used with JDK 1.6 and higher.
    The three MBeans listed in the above example have the following object names:
    <pre><code>
- object_name: java.nio:type=BufferPool,name=*

</code></pre>The following line could match multiple MBeans:
    <pre><code>
- object_name: Catalina:type=Cache,host=localhost,path=/examples

</code></pre>The object_name property itself can match one or more MBeans. For example, the line below only matches one MBean:
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZXhhbXBsZV9hdHRyaWJ1dGVzIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJBdHRyaWJ1dGVzIn1d">
    <div data-prop-text="title">Attributes</div>
    <p>The JMX example retrieves six different attributes from the three MBeans. New Relic's Java agent pulls these attributes from the first MBean:</p>
    <ul>
      <li>
        <p><code>accessCount</code></p>
      </li>
      <li>
        <p><code>cacheSize</code></p>
      </li>
      <li>
        <p><code>hitsCount</code></p>
        <p>The agent pulls these attributes from the second MBean:</p>
      </li>
      <li>
        <p><code>bufferSize</code></p>
      </li>
      <li>
        <p><code>maxHeaderCount</code></p>
        <p>The agent pulls one attribute (<code>Count</code>) from third MBean.</p>
      </li>
    </ul>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZXhhbXBsZV90eXBlIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJUeXBlIn1d">
    <div data-prop-text="title">Type</div>
    <p>For <code>type</code>, use <code>simple</code> or <code>monotonically_increasing</code>. When <code>type</code> is not specified in the JMX YAML file, it defaults to <code>monotonically_increasing</code>.</p>
    <div data-component="Table" data-prop="W10=">
      <div>
        <div>
          <div>
            <p>Value</p>
          </div>
          <div>
            <p>Definition</p>
          </div>
        </div>
      </div>
      <div>
        <div>
          <div>
            <p><code>simple</code></p>
          </div>
          <div>
            <p>The exact value of the attribute will be reported to New Relic each minute.</p>
          </div>
        </div>
        <div>
          <div>
            <p><code>monotonically_increasing</code></p>
          </div>
          <div>
            <p>The positive difference will be reported to New Relic each minute.</p>
          </div>
        </div>
      </div>
    </div>
    <p>In the example above, the attributes <code>accessCount</code>, <code>cacheSize</code>, and <code>hitsCount</code> will be reported as <code>simple</code>. The attributes <code>bufferSize</code>, <code>maxHeaderCount</code>, and <code>Count</code> will be reported as <code>monotonically_increasing</code>.</p>
    <ul>
      <li>If the <code>hitsCount</code> attribute value is always <code>5</code>, then New Relic will report a <code>5</code> each minute.</li>
      <li>If the <code>Count</code> attribute value is always <code>5</code>, then New Relic will report a <code>0</code> for the value each minute.</li>
      <li>If the <code>Count</code> attribute value changes from <code>5</code> to <code>7</code>, then New Relic will report a <code>2</code> for that minute.</li>
    </ul>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoibWV0cmljX25hbWVzIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJNZXRyaWMgbmFtZXMifV0=">
    <div data-prop-text="title">Metric names</div>
    <p>When selecting custom dashboard metrics and not using the property <code>root_metric_name</code>, use the following format for all custom JMX metrics:</p>
    <pre><code>JMX/beginning_of_object_name/type/any_properties_in_object_name/attribute_name

</code></pre>If an attribute does not actually exist on the MBean, then the metric will never appear in New Relic.
    <pre><code>
JMX/Tomcat/localhost/accessCount
  JMX/Tomcat/localhost/cacheSize
  JMX/Tomcat/localhost/hitsCount
  JMX/SampleMBean/attOne
  JMX/SampleMBean/attTwo

</code></pre>Metric names:
    <pre><code>
- object_name: Catalina:type=Cache,host=localhost,path=/examples
    root_metric_name: Tomcat/{host}
    metrics:
      - attributes: accessCount, cacheSize, hitsCount
        type: simple
- object_name: mbean:type=Sample,host=localhost,path=*
    root_metric_name: SampleMBean
    metrics:
      - attributes: attOne, attTwo
        type: simple

</code></pre>If you are using the property `root_metric_name`, then the metric will be your root metric name prefixed with JMX and followed by the attribute's name. You can use object name values by specifying the object name key in the `root_metric_name` between brackets `{}`. For example:
    Part of a configuration file:
    <pre><code>
JMX/Catalina/Cache/localhost/examples/accessCount
JMX/Catalina/Cache/localhost/examples/cacheSize
JMX/Catalina/Cache/localhost/examples/hitsCount
JMX/Catalina/Connector/8009/bufferSize
JMX/Catalina/Connector/8009/maxHeaderCount
JMX/java.nio/BufferPool/direct/Count
JMX/java.nio/BufferPool/mapped/Count

</code></pre>&#x3C;Callout variant="tip">
    Some object names do not include a type. In that case, a null will be present in the metric name.
    &#x3C;/Callout>
    The configuration file does not use `root_metric_name`, so the following metrics will be created:
  </div>
</div>
<h2>Finding object and attribute names [#finding_names]</h2>
<p>The easiest way to find available MBeans and its associated attributes is to use the <a href="http://docs.oracle.com/javase/6/docs/technotes/guides/management/jconsole.html">JConsole instructions for JDK 1.6</a>.</p>
<h2>For more help [#more_help]</h2>
<p>Additional documentation resources include:</p>
<ul>
  <li><a href="/docs/java/custom-instrumentation-with-the-java-agent">Custom instrumentation with the Java agent</a> (method tracers, examples)</li>
  <li><a href="/docs/java/custom-jmx-monitoring-by-yml">Custom JMX monitoring by YAML</a> (YAML file structure, value and definition)</li>
</ul>
