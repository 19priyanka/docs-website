
<p>This document explains how Browser collects and stores your asynchronous single page app (SPA) data. This will give you a better understanding of the <a href="/docs/browser/single-page-app-monitoring/browser-ui/view-spa-data-new-relic-browser">SPA data you see in the Browser UI</a>. This will also help you more easily add custom monitoring with the <a href="/docs/browser/single-page-app-monitoring/use-spa-data/use-spa-api">SPA API</a>.</p>
<h2>Browser interactions [#browser-interaction]</h2>
<p>At the heart of SPA monitoring is the concept of the <strong>browser interaction</strong>. New Relic defines a browser interaction as anything that occurs in the app user's browser; for example:</p>
<ul>
  <li>A user interaction that leads to a page load or route change</li>
  <li>A scheduled, dynamic update to an app's widget</li>
</ul>
<p>A browser interaction includes not just the initial triggering event, but also the activity caused by that event, such as AJAX requests and both synchronous and asynchronous JavaScript. By tracking not just the cause but also the effects of a browser interaction, we help you understand how users experience your application's views and route changes.</p>
<p>All apps are different and have different monitoring needs. That's why we include default monitoring as well as the ability to set up custom monitoring for any browser interactions you choose.</p>
<h2>Types of SPA data reporting [#spa-data]</h2>
<p>Three major categories of single page app data can be reported to New Relic:</p>
<ul>
  <li>Initial page loads</li>
  <li>Route changes</li>
  <li>Custom browser interactions created via the <a href="/docs/browser/single-page-app-monitoring/spa-api/spa-api">SPA API</a></li>
</ul>
<p>Each of these creates a <code>BrowserInteraction</code> event. If one or more AJAX requests are part of an interaction, then associated <code>AjaxRequest</code> events are also created. These events and their attributes can be queried in the <a href="/docs/query-your-data/explore-query-data/query-builder/use-advanced-nrql-mode-specify-data">query builder</a>.</p>
<h2>Initial page loads</h2>
<p>An <strong>initial page load</strong> is a traditional URL change, stemming from a complete load or reload of a URL. This is indicated in the browser when a page load event fires (the <code>window.onload</code> event). Initial page loads appear along with route changes in <a href="/docs/browser/single-page-app-monitoring/browser-ui/view-spa-data-new-relic-browser">the Browser UI</a>.</p>
<h2>Route changes</h2>
<p>SPA users experience dynamic route changes in a similar way to page loads. Visitors to a site or app generally do not care <strong>how</strong> a new view was delivered; they simply know that when they perform an action, a new view appears. For this reason, we treat route changes in a similar way to page loads in the UI.</p>
<p>In order to optimally monitor single page applications, we start monitoring many browser interactions that could theoretically lead to route changes.</p>
<ul>
  <li>If these interactions do <strong>not</strong> lead to route changes, Browser initiates monitoring but then discards them.</li>
  <li>If these interactions <strong>do</strong> lead to a route change, Browser saves the interaction sequence as a <code>BrowserInteraction</code> event, including information about both synchronous and asynchronous activity.</li>
</ul>
<p>An interaction is considered a route change and saved as a <code>BrowserInteraction</code> event when one of the following occurs:</p>
<ul>
  <li>The URL hash changes (usually using <code>window.location.hash</code>).</li>
  <li>A <code>popstate</code> event fires during a callback associated with an interaction.</li>
  <li>A <code>pushState</code> or <code>replaceState</code> API is called.</li>
</ul>
<p>Route changes appear along with initial page loads in the <a href="/docs/browser/single-page-app-monitoring/browser-ui/view-spa-data-new-relic-browser">Browser UI</a>.</p>
<p>We receive and save hash fragments from route change URLs. If you use hashes to pass private or sensitive data, that data may be visible to your New Relic account users. For more information about data collection and reporting, see <a href="/docs/browser/new-relic-browser/performance-quality/security-new-relic-browser">Security for Browser</a>.</p>
<h2>Custom monitoring [#api-custom-events]</h2>
<p>You can use the <a href="/docs/browser/new-relic-browser/browser-agent-spa-api">SPA API</a> to set up custom monitoring of browser interactions that are not monitored by default. You can also use the API to disable default monitoring.</p>
<p>Custom events are saved as <code>BrowserInteraction</code> events and have the following attributes:</p>
<ul>
  <li>The <code>category</code> attribute will have the value <code>Custom</code>.</li>
  <li>The <code>trigger</code> attribute will have the value <code>api</code>. (This is the default value but can be changed with the API.)</li>
</ul>
<h2>Difference from traditional page load timing [#page-load-timing-diff]</h2>
<p>To provide optimized data for single page app monitoring, we measure page load timing in a new way: by wrapping low level browser functions, both synchronous and asynchronous. This gives a fuller depiction of how long it takes to complete the changes required for a new view.</p>
<p>This is different from the traditional method for page load timing. <a href="/docs/browser/new-relic-browser/page-load-timing-resources/page-load-timing-process">Traditional page load timing</a> uses the firing of the <code>window.onload</code> event to determine when a page is loaded. This is not an optimal way to measure view change timing because web apps often have asynchronous code that runs for a significant amount of time after the <code>window.onload</code> event occurs.</p>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJ0aXAifV0=">
  <p>Browser's standard, non-SPA <strong>Page views</strong> page displays different page load times than when SPA monitoring is enabled. Because SPA monitoring is measuring all asynchronous activity, the SPA load times will generally be longer than standard page load times.</p>
</div>
<p>The traditional <code>window.onload</code> page load timing still appears on the SPA <strong>Page views</strong> page. When you select a specific page load event, <strong>Window onload</strong> appears as a red line in the page load time chart. You can also select <strong>Switch to standard page views</strong> to return to traditional load timing displays.</p>
<h2>Timers [#spa-timers]</h2>
<p>The agent monitors all asynchronous calls, including timers. Timers with durations shorter than one second are wrapped. Timers longer than one second are not wrapped because usually they are meant for <a href="/docs/apm/transactions/intro-transactions/monitor-background-processes-other-non-web-transactions">non-web transactions</a>, such as background work or polling that is unrelated to a user interaction.</p>
<h2>Events and attributes [#event-data-structure]</h2>
<p>We save browser interactions that lead to route changes and page loads as <code>BrowserInteraction</code> events, and AJAX requests as <code>AjaxRequest</code> events. You can query these events in the <a href="/docs/query-your-data/explore-query-data/query-builder/use-advanced-nrql-mode-specify-data">query builder</a>.</p>
