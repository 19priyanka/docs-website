
<h2>Syntax</h2>
<pre><code>onEnd(function $callback)
</code></pre>
<p>Change the values associated with a SPA interaction before the interaction is saved .</p>
<h2>Requirements</h2>
<p>Agent version <a href="https://docs.newrelic.com/docs/release-notes/new-relic-browser-release-notes/browser-agent-release-notes">nr-963</a> or higher.</p>
<h2>Description</h2>
<p>This call provides the same object as <a href="https://docs.newrelic.com/docs/browser/new-relic-browser/browser-agent-apis/browser-spa-api-newrelicinteractiongetcontext"><code>getContext()</code></a>. When this is called, you can make final adjustments to the interaction before it's recorded. For example, you could add additional <a href="/docs/using-new-relic/welcome-new-relic/getting-started/glossary#attribute">attributes</a> based on the context values.</p>
<p>Other methods for modifying the interaction include:</p>
<ul>
  <li><a href="https://docs.newrelic.com/docs/browser/new-relic-browser/browser-agent-apis/browser-spa-api-newrelicinteractionsetname"><code>setName()</code></a></li>
  <li><a href="https://docs.newrelic.com/docs/browser/new-relic-browser/browser-agent-apis/browser-spa-api-newrelicinteractionsave"><code>save()</code></a></li>
  <li><a href="https://docs.newrelic.com/docs/browser/new-relic-browser/browser-agent-apis/browser-spa-api-newrelicinteractionignore"><code>ignore()</code></a></li>
  <li><a href="https://docs.newrelic.com/docs/browser/new-relic-browser/browser-agent-apis/browser-spa-api-newrelicinteractionsetattribute"><code>setAttribute()</code></a></li>
</ul>
<h2>Parameters</h2>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>Parameter</p>
      </div>
      <div>
        <p>Description</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p><code>$callback</code></p>
        <p><em>function</em></p>
      </div>
      <div>
        <p>Required. This function is called when the interaction ends. It is called with one parameter, which is the interaction context.</p>
      </div>
    </div>
  </div>
</div>
<h2>Return values</h2>
<p>This method returns the same API object created by <code>interaction()</code>.</p>
<h2>Examples</h2>
<pre><code>// router.js
router.addRoute('/dashboard', () => {
    const interaction = newrelic.interaction().onEnd(ctx => {
        interaction.setAttribute(
            'averageChartLoadTime',
            ctx.totalChartLoadTime / ctx.chartLoadCount
        )
    })
    getCharts().forEach(loadChart)
})

// chart-loader.js
function loadChart (chart) {
    const start = Date.now()
    chart.load().then(() => {
        const loadTime = Date.now() - start
        interaction.getContext(ctx => {
             ctx.totalChartLoadTime = (ctx.totalChartLoadTime || 0) + loadTime
             ctx.chartLoadCount += (ctx.chartLoadCount || 0) + 1
        })
    }
}
</code></pre>
