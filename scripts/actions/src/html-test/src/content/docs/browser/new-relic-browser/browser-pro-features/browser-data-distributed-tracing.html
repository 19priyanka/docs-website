
<p>If you use Browser to monitor end-user browser activity, you can now see end-user-originating browser-side traces in <a href="/docs/understand-dependencies/distributed-tracing/get-started/introduction-distributed-tracing">distributed tracing</a>. This document contains:</p>
<ul>
  <li><a href="#benefits">Benefits of this feature</a></li>
  <li><a href="#requirements">Requirements</a></li>
  <li><a href="#enable">Enable distributed tracing</a></li>
  <li><a href="#cors">Enable cross-origin resource sharing (CORS)</a></li>
  <li><a href="#find-data">Find and query data</a></li>
  <li><a href="#troubleshooting">Troubleshooting</a></li>
</ul>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJ0aXAifV0=">
  <p>Browser data is available in standard distributed tracing only.</p>
</div>
<h2>Benefits of browser data in distributed tracing [#benefits]</h2>
<p>By enabling New Relic to report browser data to <a href="/docs/understand-dependencies/distributed-tracing/get-started/introduction-distributed-tracing">distributed tracing</a>, you can see the connection between front-end activity and back-end activity. You can see across a full transaction, from time spent by an end user in the web browser, to network activity, to associated back-end services.</p>
<p>Benefits of this feature:</p>
<ul>
  <li>Quickly spot latencies, errors, and anomalies in the browser or network</li>
  <li>Resolve customer-facing problems more quickly</li>
  <li>All the <a href="/docs/understand-dependencies/distributed-tracing/get-started/introduction-distributed-tracing">benefits of distributed tracing</a> applied to your end-user monitoring</li>
</ul>
<h2>Requirements and compatibility [#requirements]</h2>
<p>This feature reports AJAX requests (Fetch and XHR) that occur during a <a href="/docs/browser/single-page-app-monitoring/use-spa-data/spa-data-collection#browser-interaction">browser interaction</a>. By default, only single-origin requests are monitored unless <a href="#cors">cross-origin resource sharing</a> is enabled.</p>
<p>Make sure you have the minimum versions for your Browser, APM, and APM agents:</p>
<ul>
  <li>
    <p>Browser Pro + SPA, with <a href="#enable">distributed tracing enabled</a></p>
    <ul>
      <li><a href="/docs/release-notes/new-relic-browser-release-notes/browser-agent-release-notes/browser-agent-v1153">Browser agent version 1153</a> or higher</li>
      <li><a href="/docs/release-notes/new-relic-browser-release-notes/browser-agent-release-notes/browser-agent-v1158">Browser agent version 1158 or higher</a> (required for <a href="#cors">cross-origin resource sharing</a>)</li>
    </ul>
  </li>
  <li>
    <p><a href="/docs/full-stack-observability/monitor-everything/get-started-new-relic-monitoring-tools/get-started-full-stack-observability">Full-Stack Observability</a> with <a href="/docs/understand-dependencies/distributed-tracing/enable-configure/enable-distributed-tracing">distributed tracing enabled</a></p>
  </li>
  <li>
    <p>APM agent version:</p>
    <ul>
      <li><a href="/docs/release-notes/agent-release-notes/c-sdk-release-notes">C SDK 1.3</a> or higher</li>
      <li><a href="/docs/release-notes/agent-release-notes/java-release-notes/java-agent-590">Java 5.9.0</a> or higher</li>
      <li><a href="https://docs.newrelic.com/docs/release-notes/agent-release-notes/php-release-notes/php-agent-940249">PHP</a> 9.4.0 or higher</li>
      <li><a href="https://docs.newrelic.com/docs/understand-dependencies/distributed-tracing/enable-configure/enable-distributed-tracing#compatibility-requirements">Other APM agent version requirements</a></li>
    </ul>
  </li>
</ul>
<h2>Enable distributed tracing [#enable]</h2>
<p>To enable distributed tracing for Browser monitoring:</p>
<ol>
  <li>Make sure you meet <a href="#requirements">requirements</a>, including having:
    <ul>
      <li><a href="https://newrelic.com/products/application-monitoring/pricing">Full-Stack Observability</a></li>
      <li><a href="/docs/browser/single-page-app-monitoring/get-started/install-single-page-app-monitoring-new-relic-browser#enable-spa">Browser Pro with SPA enabled</a></li>
    </ul>
  </li>
  <li>Go to <strong><a href="http://one.newrelic.com">one.newrelic.com</a>, and click Browser > (select an app) > Settings > Application settings</strong>.</li>
  <li>Turn on the <strong>Distributed tracing</strong> toggle.</li>
  <li>Optional: <a href="#cors">Enable cross-origin resource sharing</a>.</li>
  <li><a href="/docs/browser/new-relic-browser/installation/upgrade-browser-agent">Redeploy the Browser agent</a> (either restarting the associated APM agent or updating the copy/paste Browser installation).</li>
</ol>
<h2>Enable cross-origin resource sharing (CORS) [#cors]</h2>
<p>If you have AJAX requests that need resources from different origins, you can enable cross-origin resource sharing (CORS). By default, distributed tracing for cross-origin requests is not enabled because of browser CORS security restrictions: Distributed tracing is implemented by adding a custom HTTP header (<code>newrelic</code>) to outgoing AJAX requests, and browsers typically do not allow custom headers on cross-origin requests.</p>
<p>There are two separate configurations required to enable cross-origin distributed tracing:</p>
<ol>
  <li>Configure the service on the different origin to accept the <code>newrelic</code> custom header</li>
  <li>Configure Browser monitoring to include the target origin in distributed tracing</li>
</ol>
<p>Our <a href="#cors-configure">step-by-step instructions</a> provide key concepts and steps to enable this feature, but if you need more background about how cross-origin resource sharing works, we recommend this <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS">Mozilla developer document</a>.</p>
<h3>Risks and mitigations [#mitigation]</h3>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJjYXV0aW9uIn1d">
  <p>Cross-origin resource sharing can expose you to a high level of risk if the services on the different origins are not configured correctly. The AJAX requests will likely return an error, resulting in a variety of failures, including:</p>
  <ul>
    <li>
      <p>Resources failing to load (for example, images and key content)</p>
    </li>
    <li>
      <p>Login failures</p>
    </li>
    <li>
      <p>Entire site outages (depending on type of requests enabled)</p>
      <p>By enabling this cross-origin resource sharing feature, you are acknowledging the following:</p>
    </li>
    <li>
      <p>You understand that this feature is optional and not mandatory.</p>
    </li>
    <li>
      <p>You understand the steps you need to take in order to enable this feature for your services and your domains.</p>
    </li>
    <li>
      <p>You understand that if you do not properly configure your services prior to deployment (including but not limited to configuring your services on your domains to accept custom headers) portions or all of your website will likely malfunction.</p>
    </li>
    <li>
      <p>You understand that New Relic is neither responsible nor liable for errors or issues related to your misconfiguration of servers or services.</p>
    </li>
    <li>
      <p>You fully and solely accept the risks and wish to proceed.</p>
    </li>
  </ul>
</div>
<p>The best way to minimize your risk is to ensure you fully understand the process and to try it first in a test environment. Before reading the <a href="#cors-configure">step-by-step instructions</a>, it may help to first read this overview of the process:</p>
<p>To use distributed tracing with cross-origin resources, you populate a list of approved cross-origin resources in New Relic, and then we automatically send the following custom header to those resources: <code>newrelic</code>. For this process to work, you must first ensure that someone has configured the services on the other origins to accept this custom header.</p>
<p>Cross-origin resource sharing uses a variety of HTTP headers (both in the request and response). The header that specifically applies to New Relic is the <code>Access-Control-Allow-Headers</code> response header, which needs to include <code>newrelic</code> in its value. You must configure your server to return this CORS header in its response. Example:</p>
<p><code>Access-Control-Allow-Headers: newrelic</code></p>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
  <p>New Relic cannot perform any validation to ensure the services on the other origins were configured correctly. If you're unsure about how to allow these headers, do <strong>not</strong> add cross-origin resources to the approved list in the New Relic UI.</p>
</div>
<h3>Enable cross-origin resource sharing [#cors-configure]</h3>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJjYXV0aW9uIn1d">
  <p>You should always try enabling CORS in a test environment before setting it up in production.</p>
</div>
<p>To enable cross-origin resource sharing:</p>
<ol>
  <li>
    <p>Confirm that the services on the other origins are configured to accept the <code>newrelic</code> header using: <code>Access-Control-Allow-Headers: newrelic</code> (for details, see <a href="#mitigation">Risks and mitigations</a>).</p>
  </li>
  <li>
    <p>Confirm that you meet the <a href="#requirements">Browser monitoring requirements</a>.</p>
  </li>
  <li>
    <p>Make sure you are in <strong><a href="http://one.newrelic.com">one.newrelic.com</a>, and click Browser > (select an app) > Application settings</strong>.</p>
  </li>
  <li>
    <p>Turn on the <strong>Distributed tracing</strong> toggle if it's not already enabled.</p>
  </li>
  <li>
    <p>Turn on the <strong>Cross-origin resource sharing (CORS)</strong> toggle.</p>
  </li>
  <li>
    <p>Under <strong>Cross-origin resource sharing (CORS)</strong>, add cross-origin resources to the approved list.</p>
    <div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
      <p>Valid cross-origin resources must include:</p>
      <ul>
        <li>
          <p>The prefix <code>http://</code> or <code>https://</code></p>
        </li>
        <li>
          <p>The domain name</p>
          <p>The port number is not required unless it differs from the default for HTTP (port 80) or HTTPS (port 443).</p>
        </li>
      </ul>
    </div>
  </li>
  <li>
    <p>Select <strong>Save application settings</strong> to update the agent configuration.</p>
  </li>
  <li>
    <p><a href="/docs/browser/new-relic-browser/installation/upgrade-browser-agent">Redeploy the Browser agent</a> (either restarting the associated APM agent or updating the copy/paste Browser installation).</p>
  </li>
</ol>
<h2>Find data</h2>
<p>Tips for finding and querying data:</p>
<ul>
  <li>You can find end-user-originating traces in any <a href="/docs/understand-dependencies/distributed-tracing/ui-data/additional-distributed-tracing-features-new-relic-one">New Relic One distributed tracing UI</a>.</li>
  <li>In the distributed tracing UI, end-user spans are indicated with the 
    <img src="./images/distributed-tracing-browser-span-icon.png" alt="New Relic distributed tracing browser span icon" title="distributed-tracing-browser-span-icon.png"> icon.
  </li>
  <li>To see a span's attributes, select <a href="/docs/apm/distributed-tracing/ui-data/understand-use-distributed-tracing-data#span-details">a span in the UI</a>.</li>
  <li>Spans are reported as <a href="/attribute-dictionary?attribute_name=&#x26;events_tids%5B%5D=8337"><code>Span</code> data</a>, and can be <a href="/docs/using-new-relic/data/understand-data/query-new-relic-data">queried in New Relic</a>.</li>
  <li>Query tips:
    <ul>
      <li>Query by browser app name by setting <code>browserApp.name</code> to the browser app name.</li>
      <li>Query for traces containing at least one browser app span with <code>browserApp.name is not null</code>.</li>
      <li>Query for traces containing at least one back-end app with <code>appName is not null</code>.</li>
      <li>Query for traces containing both browser and back-end spans by combining the two previous conditions.</li>
    </ul>
  </li>
</ul>
<h2>Troubleshooting</h2>
<p>If you don't see end-user spans, or are having other distributed tracing issues, see <a href="/docs/apm/distributed-tracing/troubleshooting/troubleshooting-missing-trace-data#browser-data">Troubleshooting</a>.</p>
