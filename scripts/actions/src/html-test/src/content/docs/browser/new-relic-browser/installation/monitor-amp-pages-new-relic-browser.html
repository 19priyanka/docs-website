
<p>To collect performance data from HTML pages formatted for <a href="https://www.ampproject.org/learn/overview/">Google's Accelerated Mobile Pages (AMP) project</a>, you must add New Relic Browser's AMP agent to your AMP pages. This agent leverages the <a href="https://www.ampproject.org/docs/reference/components/amp-analytics"><code>amp-analytics</code> agent</a> to define the relevant New Relic events and send them to New Relic to be captured for reporting.</p>
<h2>Compatibility and requirements [#requirements]</h2>
<p>Browser's AMP agent is currently available as a private beta. In addition to New Relic Browser's <a href="/docs/browser/new-relic-browser/getting-started/compatibility-requirements-new-relic-browser">installation requirements</a>, Browser's AMP agent requires:</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p><strong>Browser AMP requirements</strong></p>
      </div>
      <div>
        <p><strong>Comments</strong></p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p>New Relic Browser</p>
      </div>
      <div>
        <p>New Relic Browser requirements include Browser Pro account, which includes access to New Relic Insights data depending on your <a href="https://newrelic.com/browser-monitoring/pricing">Browser subscription level</a>.</p>
      </div>
    </div>
    <div>
      <div>
        <p>Browser app ID</p>
      </div>
      <div>
        <p>To capture AMP throughput, New Relic Browser needs the <code>app ID</code> for each app:</p>
        <ol>
          <li>Go to <a href="https://rpm.newrelic.com/browser">rpm.newrelic.com/browser</a> and select an application from the index.</li>
          <li>Copy the numeric value that follows <code>/browser/1234567890</code> in the URL.</li>
        </ol>
      </div>
    </div>
    <div>
      <div>
        <p>Browser monitoring license key</p>
      </div>
      <div>
        <p>To obtain only the browser monitoring <a href="https://docs.newrelic.com/docs/browser/new-relic-browser/configuration/copy-browser-monitoring-license-key-app-id">license key</a>:</p>
        <ol>
          <li>Go to <strong><a href="https://rpm.newrelic.com/browser" title="Link opens in a new window.">rpm.newrelic.com/browser</a> > Settings</strong>.</li>
          <li>Select and copy the generated JavaScript, and paste it into a text file.</li>
          <li>Delete everything in the text file except the browser monitoring license key (just above the ending <code>&#x3C;/script></code> tag), and save.</li>
        </ol>
      </div>
    </div>
  </div>
</div>
<h2>Install Browser's AMP agent [#deploy-amp-agent]</h2>
<p>New Relic has partnered with The Amp Project to incorporate New Relic Browser's AMP agent in with the AMP Analytics repo.</p>
<p>To install the Browser AMP agent into your AMP app:</p>
<ol>
  <li>Add the attribute <code>newrelic</code> to your AMP analytics code. For more information, see the <a href="https://www.ampproject.org/docs/ads_analytics/analytics-vendors#new-relic">AMP site</a>.</li>
  <li>Add the browser <a href="#app-id"><code>app ID</code></a> and <a href="#key"><code>license key</code></a>. To send data from one AMP page to multiple Browser apps, include quote marks and a comma to separate each Browser <code>app ID</code>. For example: <code>"appId": ["123", "124", "125"]</code></li>
</ol>
<pre><code>&#x3C;amp-analytics type="newrelic" id="newrelic">
&#x3C;script type="application/json">
  {
    "vars": {
      "appId": "",
      "licenseKey": ""
    }
  }
&#x3C;/script>
&#x3C;/amp-analytics>
</code></pre>
<h2>View reported AMP events in Insights [#view-amp-events]</h2>
<p>Currently, your AMP data will not appear in the New Relic Browser UI. This is intentional; any AMP data sent to the New Relic collector will be removed automatically from your Browser metrics.</p>
<p>In the meantime, use New Relic Insights to compare your AMP page to non-AMP pages. The dashboard data provides standard performance key metrics.</p>
<p>New Relic stores AMP events in the <code>PageView</code> and <code>BrowserInteraction</code> schemas. To <a href="/docs/insights/use-insights-ui/explore-data/event-explorer-query-chart-your-event-data">view the AMP events</a>, run the following Insights queries:</p>
<ul>
  <li><code>SELECT * FROM BrowserInteraction WHERE mobileOptimized = 'amp'</code></li>
  <li><code>SELECT * FROM PageView WHERE mobileOptimized = 'amp'</code></li>
</ul>
<p>
  <img src="./images/browser-amp-beta-insights.png" alt="New Relic Browser: AMP data in Insights" title="New Relic Browser: AMP data in Insights">
</p>
<p><strong><a href="https://insights.newrelic.com">insights.newrelic.com</a> > Event explorer</strong>: Here is an example of an Insights dashboard showing AMP event data after you install New Relic Browser's AMP JavaScript snippet into the body of your AMP pages.</p>
<h2>AMP data dictionary [#amp-data]</h2>
<p>Here is a summary of the AMP data available in <code>BrowserInteraction</code> and <code>PageView</code>.</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>Insights variable</p>
      </div>
      <div>
        <p><a href="https://github.com/ampproject/amphtml/blob/master/spec/amp-var-substitutions.md">AMP parameter</a></p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p><code>appId</code></p>
        <p>The New Relic application ID.</p>
      </div>
      <div>
        <p>Populated by NR AMP agent</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>asn</code></p>
        <p>Autonomous System Number: A unique number identifying a group of IP networks that serves the content to the end user.</p>
      </div>
      <div>
        <p>Derived from IP</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>asnLatitude</code></p>
        <p>The latitude of the geographic center of the postal code where the Autonomous System Network is registered. This is not the end user's latitude.</p>
      </div>
      <div>
        <p>Derived from IP</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>asnLongitude</code></p>
        <p>The longitude of the geographic center of the postal code where the Autonomous System Network is registered. This is not the end user's longitude.</p>
      </div>
      <div>
        <p>Derived from IP</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>asnOrganization</code></p>
        <p>The organization that owns the Autonomous System Number. Often an ISP, sometimes a private company or institution.</p>
      </div>
      <div>
        <p>Derived from IP</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>category</code></p>
        <p>The type of interaction: Either initial page load, route change, or custom.</p>
      </div>
      <div>
        <p>Value: Always page load</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>city</code></p>
        <p>The city in which the event occurred; for example, Portland or Seattle.</p>
      </div>
      <div>
        <p>From request</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>countryCode</code></p>
        <p>The country from which the browser initiated the interaction. For a list of country codes, see <a href="http://en.wikipedia.org/wiki/ISO_3166-1_alpha-2#Current_codes">ISO 3166-1 alpha-2</a>.</p>
      </div>
      <div>
        <p>From request</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>deviceType</code></p>
        <p>The type of device that loaded the page: Either mobile, tablet, or desktop.</p>
      </div>
      <div>
        <p>Value: Always <code>mobile</code>. Looking to derive device</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>duration</code></p>
        <p>The total duration, in seconds, of the interaction event.</p>
      </div>
      <div>
        <p><code>pageLoadTime</code></p>
      </div>
    </div>
    <div>
      <div>
        <p><code>previousURL</code></p>
        <p>The ungrouped URL in the browser at the start of the interaction.</p>
      </div>
      <div>
        <p>Always blank (<code>previousUrl</code> is for route changes)</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>session</code></p>
        <p>The unique ID for the session in which the event occurred.</p>
      </div>
      <div>
        <p><code>clientId</code></p>
      </div>
    </div>
    <div>
      <div>
        <p><code>targetUrl</code></p>
        <p>The ungrouped URL in the browser at the end of the interaction.</p>
      </div>
      <div>
        <p><code>ampdocUrl</code></p>
      </div>
    </div>
    <div>
      <div>
        <p><code>timeToConnectStart</code></p>
        <p>The time, in seconds, from the start of the interaction to the connectStart, as defined by the Navigation Timing API. This attribute exists for initial page load events, not route changes.</p>
      </div>
      <div>
        <p><code>$navTiming(connectStart)</code></p>
      </div>
    </div>
    <div>
      <div>
        <p><code>timeToConnectEnd</code></p>
        <p>The time, in seconds, from the start of the interaction to the connectEnd, as defined by the Navigation Timing API. This attribute exists for initial page load events, not route changes.</p>
      </div>
      <div>
        <p><code>$navTiming(connectEnd)</code></p>
      </div>
    </div>
    <div>
      <div>
        <p><code>timeToDomComplete</code></p>
        <p>The time, in seconds, from the start of the interaction to the domComplete, as defined by the Navigation Timing API. This attribute exists for initial page load events, not route changes.</p>
      </div>
      <div>
        <p>$navTiming(domComplete)</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>timeToDomContentLoadedEventStart</code></p>
        <p>The time, in seconds, from the start of the interaction to the domContentLoadedEventStart, as defined by the Navigation Timing API. This attribute exists for initial page load events, not route changes.</p>
      </div>
      <div>
        <p><code>$navTiming(domContentLoadedEventStart)</code></p>
      </div>
    </div>
    <div>
      <div>
        <p><code>timeToDomContentLoadedEventEnd</code></p>
        <p>The time, in seconds, from the start of the interaction to the domContentLoadedEventEnd, as defined by the Navigation Timing API. This attribute exists for initial page load events, not route changes.</p>
      </div>
      <div>
        <p><code>$navTiming(domContentLoadedEventEnd)</code></p>
      </div>
    </div>
    <div>
      <div>
        <p><code>timeToDomInteractive</code></p>
        <p>The time, in seconds, from the start of the interaction to the domInteractive, as defined by the Navigation Timing API. This attribute exists for initial page load events, not route changes.</p>
      </div>
      <div>
        <p><code>$navTiming(domInteractive)</code></p>
      </div>
    </div>
    <div>
      <div>
        <p><code>timeToDomLoading</code></p>
        <p>The time, in seconds, from the start of the interaction to the domLoading, as defined by the Navigation Timing API. This attribute exists for initial page load events, not route changes.</p>
      </div>
      <div>
        <p>$navTiming(domLoading)</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>timeToDomainLookupStart</code></p>
        <p>The time, in seconds, from the start of the interaction to the domainLookupStart, as defined by the Navigation Timing API. This attribute exists for initial page load events, not route changes.</p>
      </div>
      <div>
        <p><code>$navTiming(domainLookupStart)</code></p>
      </div>
    </div>
    <div>
      <div>
        <p><code>timeToDomainLookupEnd</code></p>
        <p>The time, in seconds, from the start of the interaction to the domainLookupEnd, as defined by the Navigation Timing API. This attribute exists for initial page load events, not route changes.</p>
      </div>
      <div>
        <p><code>$navTiming(domainLookupEnd)</code></p>
      </div>
    </div>
    <div>
      <div>
        <p><code>timeToFetchStart</code></p>
        <p>The time, in seconds, from the start of the interaction to the fetchStart, as defined by the Navigation Timing API. This attribute exists for initial page load events, not route changes.</p>
      </div>
      <div>
        <p><code>$navTiming(fetchStart)</code></p>
      </div>
    </div>
    <div>
      <div>
        <p><code>timeToLoadEventStart</code></p>
        <p>The time, in seconds, from the start of the interaction to the loadEventStart, as defined by the Navigation Timing API. This attribute exists for initial page load events, not route changes.</p>
      </div>
      <div>
        <p><code>$navTiming(loadEventStart)</code></p>
      </div>
    </div>
    <div>
      <div>
        <p><code>timeToLoadEventEnd</code></p>
        <p>The time, in seconds, from the start of the interaction to the loadEventEnd, as defined by the Navigation Timing API. This attribute exists for initial page load events, not route changes.</p>
      </div>
      <div>
        <p><code>$navTiming(loadEventEnd)</code></p>
      </div>
    </div>
    <div>
      <div>
        <p><code>timeToRequestStart</code></p>
        <p>The time, in seconds, from the start of the interaction to the requestStart, as defined by the Navigation Timing API. This attribute exists for initial page load events, not route changes.</p>
      </div>
      <div>
        <p><code>$navTiming(requestStart)</code></p>
      </div>
    </div>
    <div>
      <div>
        <p><code>timeToResponseStart</code></p>
        <p>The time, in seconds, from the start of the interaction to the responseStart, as defined by the Navigation Timing API. This attribute exists for initial page load events, not route changes.</p>
      </div>
      <div>
        <p><code>$navTiming(responseStart)</code></p>
      </div>
    </div>
    <div>
      <div>
        <p><code>timeToResponseEnd</code></p>
        <p>The time, in seconds, from the start of the interaction to the responseEnd, as defined by the Navigation Timing API. This attribute exists for initial page load events, not route changes.</p>
      </div>
      <div>
        <p><code>$navTiming(responseEnd)</code></p>
      </div>
    </div>
    <div>
      <div>
        <p><code>timeToSecureConnection</code></p>
        <p>The time, in seconds, from the start of the interaction to the secureConnectionStart, as defined by the Navigation Timing API. This attribute exists for initial page load events, not route changes.</p>
      </div>
      <div>
        <p><code>${navTiming(secureConnectionStart)</code></p>
      </div>
    </div>
    <div>
      <div>
        <p><code>timeToUnloadEventStart</code></p>
        <p>The time, in seconds, from the start of the interaction to the unloadEventStart, as defined by the Navigation Timing API. This attribute exists for initial page load events, not route changes.</p>
      </div>
      <div>
        <p><code>$navTiming(unloadEventStart)</code></p>
      </div>
    </div>
    <div>
      <div>
        <p><code>timeToUnloadEventEnd</code></p>
        <p>The time, in seconds, from the start of the interaction to the unloadEventEnd, as defined by the Navigation Timing API. This attribute exists for initial page load events, not route changes.</p>
      </div>
      <div>
        <p><code>$navTiming(unloadEventEnd)</code></p>
      </div>
    </div>
    <div>
      <div>
        <p><code>timestamp</code></p>
        <p>The time (date, hour, minute, second) at which the interaction occurred.</p>
      </div>
      <div>
        <p><code>timestamp</code></p>
      </div>
    </div>
    <div>
      <div>
        <p><code>trigger</code></p>
        <p>The cause of the route change or page load. The default values are click, submit, popstate, or initial page load. For a custom event created with the API, the default value for trigger will be api. This value can also be set via the API.</p>
      </div>
      <div>
        <p>Possible values: Initial page load, click</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>userAgentName</code></p>
        <p>The end user's browser type.</p>
      </div>
      <div>
        <p>From request</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>userAgentVersion</code></p>
        <p>The end user's browser version.</p>
      </div>
      <div>
        <p>From request</p>
      </div>
    </div>
    <div>
      <div>
        <p><code>userAgentOS</code></p>
        <p>The end user's operating system.</p>
      </div>
      <div>
        <p>From request</p>
      </div>
    </div>
  </div>
</div>
<h2>Replace copy/pasted agent with library reference [#replace]</h2>
<p>If you previously copy/pasted New Relic Browser's AMP agent JS Snippet onto your AMP pages, you can now pull the snippet from AMP Analytics instead. Remove New Relic Browser's AMP agent JS snippet from your AMP pages, and then follow the <a href="#deploy-amp-agent">instructions to install Browser's AMP agent</a>.</p>
<h2>For more help [#more_help]</h2>
<p>During the beta period, <a href="mailto:ampbeta@newrelic.com">email your AMP feedback</a> to the New Relic Browser team.</p>
