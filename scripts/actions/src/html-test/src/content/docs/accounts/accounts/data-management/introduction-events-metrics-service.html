
<p>New Relic provides an events-to-metrics service that lets you generate <a href="/docs/telemetry-data-platform/ingest-manage-data/understand-data/new-relic-data-types#dimensional-metrics">metric-type data</a> from your <a href="/docs/telemetry-data-platform/ingest-manage-data/understand-data/new-relic-data-types#events-new-relic">event-type data</a>. Metrics are aggregates of your event data and are optimal for analyzing and monitoring trends over long time periods.</p>
<p>This document explains:</p>
<ul>
  <li><a href="#feature-description">Reasons to use this feature</a></li>
  <li><a href="#operations">Available operations</a></li>
  <li><a href="#use-graphql-api-tool">How to use our NerdGraph API tool</a> to perform operations</li>
</ul>
<h2>Why create metrics from event data? [#feature-description]</h2>
<p>Historically for New Relic, NRQL queries and the resulting charts were created only with <a href="/docs/using-new-relic/metrics/analyze-your-metrics/data-collection-metric-timeslice-event-data#event-data">event-type data</a>. With the new events-to-metrics feature, you can create metrics from your event data and create queries and charts from those metrics. Using metrics allows for more efficient data storage, which in turn allows for faster, more efficient data queries and chart-builds.</p>
<p>Here's an explanation of these two types of data:</p>
<ul>
  <li><strong>Events:</strong> Event data represents a record of a single event at a specific moment in time. For example, you may have an event for every request to the system. This data is ideal for in-depth troubleshooting and analysis.</li>
  <li><strong>Metrics:</strong> These provide an aggregated view of your event data. Metrics are better for showing trends over longer time ranges. For example, you could aggregate the total number of requests per service to one metric and then examine this month-over-month.</li>
</ul>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJ0aXAifV0=">
  <p>For more on how metrics and events are different, see <a href="/docs/using-new-relic/data/understand-data/new-relic-data-types">Understand data types</a>.</p>
</div>
<p>Note that creating metrics from events will <strong>not</strong> delete events; this feature creates metrics from the event data without altering the events.</p>
<p>More details on what makes metrics unique and better for longer-range querying/charting:</p>
<ul>
  <li>Metrics are <a href="/docs/telemetry-data-platform/ingest-manage-data/understand-data/new-relic-data-types#dimensional-metrics">dimensional</a>; you get to choose what metadata (like host name or app name) is attached to them.</li>
  <li>The data has already been pre-aggregated into longer-period time buckets.</li>
  <li>Common metric measurements, like average, sum, minimum, and maximum, are already calculated</li>
  <li>Data retention is 13 months.</li>
  <li>Metrics are <a href="/docs/telemetry-data-platform/get-data/apis/query-metric-data-type">queryable using the <code>Metric</code> event type</a>.</li>
</ul>
<p><a href="/docs/events-metrics-api-create-metrics">Start creating an events-to-metrics rule.</a></p>
<h2>Available operations [#operations]</h2>
<p>To perform events-to-metrics operations, you'll use NerdGraph, which is our GraphQL-format API. Before performing any operation, we recommend reading <a href="/docs/apis/graphql-api/getting-started/introduction-new-relic-graphql-api">Intro to NerdGraph</a> and exploring your data with the <a href="https://api.newrelic.com/graphiql">GraphiQL API tool</a>.</p>
<p>The events-to-metrics featureâ€™s operations fall under two basic <a href="/docs/apis/graphql-api/getting-started/introduction-new-relic-graphql-api#terminology">request types</a>:</p>
<ul>
  <li><strong>Mutations</strong>, which are operations that make changes to existing rules or settings (for example, creating a new events-to-metrics rule).</li>
  <li><strong>Queries</strong>, for fetching existing data (for example, fetching existing events-to-metrics rules).</li>
</ul>
<p>All metrics-to-events operations are role-based. When performed via NerdGraph, they'll be made under the currently logged-in New Relic user.</p>
<h3>Mutations</h3>
<p>Mutation operations include:</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiY3JlYXRlIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJDcmVhdGUgYW4gZXZlbnRzLXRvLW1ldHJpY3MgcnVsZSJ9XQ==">
    <div data-prop-text="title">Create an events-to-metrics rule</div>
    <p>See <a href="/docs/events-metrics-api-create-metrics">Create metrics</a>.</p>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZGVsZXRlIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJEZWxldGUgYSBydWxlIn1d">
    <div data-prop-text="title">Delete a rule</div>
    <div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
      <p>This operation modifies production settings, so we recommend thoroughly reviewing your changes before you run the operation.</p>
    </div>
    <p>To delete a rule, you need the rule ID and the <a href="/docs/accounts/install-new-relic/account-setup/account-id">New Relic account ID</a>. Here's an example request:</p>
    <pre><code>mutation {
  eventsToMetricsDeleteRule(deletes: {ruleId: "12", accountId: 123456}) {
    successes {
      id
      name
      nrql
    }
    failures {
      errors {
        description
        reason
      }
      submitted {
        ruleId
        accountId
      }
    }
  }
}

</code></pre>
    <pre><code>
{
  "data": {
    "eventsToMetricsDeleteRule": {
      "failures": [],
      "successes": [
        {
          "id": "12",
          "name": "Test Rule",
          "nrql": "select summary(duration) as 'server.responseTime' from Transaction where appName = 'Data Points Staging' facet name, appName, host"
        }
      ]
    }
  }
}

</code></pre>Let's look at some elements of this request:
    * `mutation`: one of the basic [API operation types](/docs/apis/graphql-api/getting-started/introduction-new-relic-graphql-api#tutorials).
    * `eventsToMetricsDeleteRule`: The method being called to delete a rule.
    * `deletes` takes two parameters:
    * `ruleId`: The ID of the events-to-metrics rule.
    * `accountId`: The [New Relic account ID](/docs/accounts/install-new-relic/account-setup/account-id).
    * In the `successes` and `submitted` blocks, you define the data returned by a success or failure. Available parameters for these blocks: `id` (`ruleId` for `submitted`), `name`, `description`, `nrql`, `enabled`, and `accountId`.
    Here's an example response for the above example request:
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZW5hYmxlLWRpc2FibGUifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IkVuYWJsZS9kaXNhYmxlIGEgcnVsZSJ9XQ==">
    <div data-prop-text="title">Enable/disable a rule</div>
    <div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
      <p>This operation modifies production settings, so we recommend thoroughly reviewing your changes before you run the operation.</p>
    </div>
    <p>To disable or enable an existing events-to-metrics rule, you use the same <code>eventsToMetricsUpdateRule</code> operation, with the only difference being whether <code>enabled</code> is set to <code>true</code> or <code>false</code> Here's an example request for enabling an existing events-to-metrics rule:</p>
    <pre><code>mutation {
  eventsToMetricsUpdateRule(updates: {ruleId: "12", accountId: 123456, enabled: true}) {
    successes {
      id
      name
      nrql
    }
    failures {
      errors {
        description
        reason
      }
      submitted {
        ruleId
        accountId
      }
    }
  }
}

</code></pre>Let's go through some elements of this request:
    * `mutation`: one of the basic [API operation types](/docs/apis/graphql-api/getting-started/introduction-new-relic-graphql-api#tutorials).
    * `eventsToMetricsUpdateRule`: The method being called to update an existing rule and either enable it or disable it.
    * `updates` takes three required parameters:
    * `ruleId`: The ID of the events-to-metrics rule.
    * `accountId`: The [New Relic account ID](/docs/accounts/install-new-relic/account-setup/account-id).
    * `enabled`: To enable a disabled rule, set this to `true`. To disable a rule, set this to `false`.
    * In the `successes` and `submitted` blocks, you define the data returned by a success or failure. Available parameters for these blocks:
    * `id` (`ruleId` for `submitted`)
    * `name`
    * `description`
    * `nrql`
    * `enabled`
    * `accountId`
  </div>
</div>
<h3>Queries</h3>
<p>Query operations include:</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoibGlzdC1hbGwtcnVsZXMifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6Ikxpc3QgYWxsIHJ1bGVzIGZvciBhIE5ldyBSZWxpYyBhY2NvdW50In1d">
    <div data-prop-text="title">List all rules for a New Relic account</div>
    <p>You can choose to list all rules in a New Relic account, or <a href="#list-rule-by-rule-id">return a specific rule</a>. Below is an example of listing of all rules for an account <code>123456</code>:</p>
    <pre><code>query {
  actor {
    account(id:123456) {
      eventsToMetrics{
        allRules{
          rules{
            id
            name
            enabled
            nrql
            description
          }
        }
      }
    }
  }
}

</code></pre>
    <pre><code>
{
  "data": {
    "actor": {
      "account": {
        "eventsToMetrics": {
          "allRules": {
            "rules": [
              {
                "description": "Metric for total time",
                "enabled": true,
                "id": "1",
                "name": "Total Time Tx",
                "nrql": "select summary(totalTime) as 'server.totalTime' from Transaction where appName = 'Data Points Staging' facet name, appName, host"
              },
              {
                "description": "Metric for duration",
                "enabled": true,
                "id": "2",
                "name": "Duration Rule",
                "nrql": "select summary(duration) as 'server.responseTime' from Transaction where appName = 'Data Points Staging' facet name, appName, host"
              }
            ]
          }
        }
      }
    }
  }
}

</code></pre>Let's go through some elements of this request:
    * `query`: one of the basic [API operation types](/docs/apis/graphql-api/getting-started/introduction-new-relic-graphql-api#tutorials), used for querying but not making changes.
    * `actor`: This specifies the current user.
    * `account(id: 123456)`: Specify the [ID for the New Relic account](/docs/accounts/install-new-relic/account-setup/account-id) to retrieve data from.
    * `eventsToMetrics`: Scope the data to only events-to-metrics rules.
    * `allRules`: Returns all rules for that account.
    * `rules`: In the `rules` block, you can define what data you want returned. Available fields include:
    * `id`
    * `name`
    * `description`
    * `nrql`
    * `accountId`
    * `enabled`
    Here's an example response:
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoibGlzdC1ydWxlLWJ5LXJ1bGUtaWQifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6Ikxpc3QgcnVsZSBieSBydWxlIElEIn1d">
    <div data-prop-text="title">List rule by rule ID</div>
    <p>If you know the exact ID for a rule, then you can query for a specific rule. For example, you may have just created a rule and now want to list its contents to review it. Below is an example listing rule number 36 for New Relic account 123456:</p>
    <pre><code>query {
  actor {
    account(id: 123456) {
      eventsToMetrics {
        rulesById(ruleIds:  "36") {
          rules {
            id
            name
            enabled
            nrql
            description
            accountId
          }
        }
      }
    }
  }
}

</code></pre>
    <pre><code>
{
  "data": {
    "actor": {
      "account": {
        "eventsToMetrics": {
          "rulesById": {
            "rules": [
              {
                "accountId": 123456,
                "description": "Metric for total time",
                "enabled": true,
                "id": "36",
                "name": "Total Time Tx",
                "nrql": "select summary(totalTime) as 'server.totalTime' from Transaction where appName = 'Data Points Staging' facet name, appName, host"
              }
            ]
          }
        }
      }
    }
  }
}

</code></pre>For more detail about the elements in this query, see [List all rules](#list-all-rules).
    Here's an example response:
  </div>
</div>
<h2>Use the NerdGraph GraphiQL API tool [#use-graphql-api-tool]</h2>
<p>You can use our <a href="https://api.newrelic.com/graphiql">GraphiQL tool</a> to explore the data structure, and to build and run the <a href="#operations">events-to-metrics operations</a>. To use this tool:</p>
<ol>
  <li>Once you have an operation's request created with the required parameters, go to the <a href="https://api.newrelic.com/graphiql">GraphiQL API tool</a> and paste your query into the box on the left.</li>
  <li>Execute the operation by pressing <strong>Play</strong>. (Optionally, you can get the cURL format by selecting <strong>Copy as cURL</strong>.)</li>
  <li>Validate the response in the response box on the right side. If you'd like to verify a rule-creation operation was performed successfully, you can <a href="#list-rule-by-rule-id">run a list query for that rule ID</a>.</li>
</ol>
<p>Related reading:</p>
<ul>
  <li><a href="/docs/events-metrics-api-create-metrics">How to create metrics</a></li>
  <li><a href="/docs/events-metrics-api-create-metrics#find-your-data">Tips for querying created metrics</a></li>
</ul>
