
<p>This supplemental guide provides OneLogin specific details on how to configure the New Relic OneLogin SCIM/SSO application to connect your organization's users to New Relic and allow single sign-on into New Relic. This supplemental guide is meant to be used along with the <a href="https://docs.newrelic.com/docs/assign-users-automated-provisioning-allow-single-sign">main automated provisioning guide</a>.</p>
<h2>Add SCIM/SSO application [#background]</h2>
<p>Add the New Relic SCIM/SSO application to your OneLogin applications.</p>
<ol>
  <li>Go to the OneLogin web site and sign in with an account that has administrator permissions.</li>
  <li>From the OneLogin home page, click on <strong>Administration</strong>.</li>
  <li>From the OneLogin Administration page, choose the <strong>Applications</strong> menu.</li>
  <li>From the OneLogin Applications page, click on <strong>Add App</strong>.</li>
  <li>In the search field on the OneLogin Find Applications page, enter "New Relic by Organization" and then click on the application when it shows in the search results.</li>
  <li>From the <strong>Add New Relic by Organization</strong> page, click on <strong>Save</strong>.</li>
</ol>
<h2>Configure SCIM/SSO application [#configure-application]</h2>
<p>Configuration for the New Relic SCIM/SSO application is split across several forms. This section describes the different forms that need to be configured.</p>
<p>From the <strong>New Relic by Organization</strong> application page, fill in the following forms:</p>
<h3>Step 1. Fill in the Configuration form</h3>
<p>In the left pane, select <strong>Configuration</strong> and complete the following:</p>
<ol>
  <li>Fill in the <strong>Authentication Domain ID</strong> and <strong>SCIM Bearer Token</strong> fields with the values provided by your account representative.</li>
  <li>Leave the <strong>API Connection</strong> disabled until all the configuration described in the following sections is completed. After completing all the configuration, enable the connection.</li>
</ol>
<h3>Step 2. Fill in the Rules form</h3>
<p>Configure the user groups to send to New Relic using rules. OneLogin provides this <a href="https://developers.onelogin.com/scim/create-app#scim_rules">documentation</a> which describes how to use rules to provision groups for users.</p>
<p>Decide what type of groups to send along with your users to New Relic. If your organization is using Active Directory or LDAP, you might choose to use security groups to define your users capabilities at New Relic. Another reasonable group choice is OneLogin role.</p>
<p>On the New Relic side, your user's groups define their capabilities. The groups that are sent with users will be mapped to New Relic capability groups.</p>
<p>Note that at the moment, there is no way to delete a group from the OneLogin side. This is a known limitation from OneLogin. Removing or changing rules does not delete groups already sent to New Relic. If you wish to no longer use a group, removing all the users from the group will prevent it from being used at New Relic.</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoicnVsZS1leGFtcGxlIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJBIHJ1bGUgdGhhdCBvbmx5IHVzZXMgYWN0aW9ucyJ9XQ==">
    <div data-prop-text="title">A rule that only uses actions</div>
    <p>Here's an example rule configuration does not use any conditions. The conditions are left empty to avoid applying any filtering logic to the users. All users will be sent in this example. If you want to send only a subset of users, you need to specify conditions to select the subset.</p>
    <p>
      <img src="./images/onelogin_rules_conditions_actions.png" alt="Screen capture showing the OneLogin Rules detail page about conditions and actions." title="onelogin_rules_conditions_actions.png">
    </p>
    <p>The actions describe where to retrieve the value for the group name and how to parse the value. In this example, we retrieve the group name from the OneLogin role field.</p>
    <p>The OneLogin role field only has a single value, but sometimes the source for the group name contains other fields besides group name. In other words, some sources give you a list of fields and values and only one of those fields has the value you want to use. In this case, you can insert a regular expression in <strong>with value that matches</strong> field to find and extract the value for the group name.</p>
    <p>This example uses the entire value of the <strong>For each</strong> field for the group name.</p>
  </div>
</div>
<h3>Step 3. Fill in the Parameters form</h3>
<p>In the left pane, select <strong>Parameters</strong> and complete the following:</p>
<ol>
  <li>
    <p>Click <strong>Groups</strong> field.</p>
    <p>
      <img src="./images/onelogin_parameter_form_general.png" alt="Screenshot of the OneLogin Parameter form showing which fields to configure." title="onelogin_parameter_form_general.png">
    </p>
  </li>
  <li>
    <p>Check <strong>Include in User Provisioning</strong>.</p>
    <p>
      <img src="./images/onelogin_parameter_form_specific.png" alt="Screenshot showing the OneLogin Parameter details page." title="onelogin_parameter_form_specific.png">
    </p>
  </li>
  <li>
    <p>Click <strong>Save</strong>.</p>
  </li>
</ol>
<h3>Step 4. Fill in the Provisioning form</h3>
<p>In the left pane, select <strong>Provisioning</strong> and complete the following:</p>
<p>
  <img src="./images/onelogin_provisioning_form.png" alt="Screen capture showing the OneLogin Provisioning page." title="onelogin_provisioning_form.png">
</p>
<ol>
  <li>
    <p>Check <strong>Enable</strong> provisioning.</p>
  </li>
  <li>
    <p>Under <strong>Require admin approval before this action is performed</strong>, uncheck these options:</p>
    <ul>
      <li><strong>Create user</strong></li>
      <li><strong>Delete user</strong></li>
      <li><strong>Update user</strong></li>
    </ul>
    <div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJ0aXAifV0=">
      <p>If you do not uncheck these options, SCIM provisioning requests will not be sent until an administrator approves them.</p>
    </div>
  </li>
  <li>
    <p>Set <strong>When users are deleted in OneLogin, or the user's app access is removed, perform the below action</strong> to <strong>Delete</strong>.</p>
  </li>
  <li>
    <p>Set <strong>When user accounts are suspended in OneLogin, perform the following action</strong> to <strong>Suspend</strong>.</p>
  </li>
</ol>
<h3>Step 5. Save your changes</h3>
<p>After you complete the above forms, click <strong>Save</strong>. Then, return to the <strong>Configuration</strong> form and enable the API connection.</p>
<h2>Assign users [#configure-sso]</h2>
<p>After New Relic SCIM/SSO application configuration is finished and New Relic side configuration is finished, you can begin to assign users to the application.</p>
<p>Assign the New Relic SCIM/SSO application to a user.</p>
<ol>
  <li>Go to the OneLogin web site and sign in with an account that has administrator permissions.</li>
  <li>From the OneLogin home page, click <strong>Administration</strong>.</li>
  <li>From the OneLogin Administration page, choose the <strong>Users</strong> menu Users item.</li>
  <li>From the OneLogin Users page, click the user you want to assign the application to.</li>
  <li>From the user's page, click <strong>Applications</strong>.</li>
  <li>From the user's application page, click the plus sign and select the "New Relic by Organization" application.</li>
  <li>From the <strong>Edit New Relic by Organization login for user</strong> page, enter the user's time zone in IANA Time Zone database format (also known as the Olson time zone database format) and click <strong>Save</strong>.</li>
  <li>If you're using <strong>Roles</strong> to define your New Relic capability groups, from the user's application page, click the proper role(s) for the user and then click <strong>Save User</strong>.</li>
</ol>
<p>OneLogin provisions users in near real time so almost the moment you save the user in OneLogin, the user should be ready to use at New Relic.</p>
