
<p>For <a href="#requirements">some types of data</a> in New Relic, you can drop (not report) that data. You might want to do this:</p>
<ul>
  <li>To filter out unimportant, low-value data</li>
  <li>To filter out potentially sensitive data</li>
</ul>
<p>If you choose to drop data, only new data will be affected. Existing data <a href="https://docs.newrelic.com/docs/telemetry-data-platform/ingest-manage-data/manage-data/manage-data-retention#data-deletion">cannot be edited or deleted</a>.</p>
<h2>Requirements</h2>
<p>You must have a user role with permissions for dropping data.</p>
<p>Currently the following types of data can be targeted by data dropping rules:</p>
<ul>
  <li>APM-reported events</li>
  <li>Browser-reported events</li>
  <li>Mobile-reported events</li>
  <li>Synthetics-reported events</li>
  <li>Custom events (like those generated by the <a href="/docs/insights/insights-data-sources/custom-data/insert-custom-events-new-relic-apm-agents">APM agent APIs</a> or the <a href="/docs/insights/insights-data-sources/custom-data/introduction-event-api">Event API</a>)</li>
  <li>Log data</li>
  <li>Trace spans</li>
  <li>Metrics from <a href="https://docs.newrelic.com/docs/data-ingest-apis/get-data-new-relic/metric-api/introduction-metric-api">the metric API</a>
    <ul>
      <li>Currently only <code>DROP_ATTRIBUTES</code>, not <code>DROP_DATA</code>, can be used on metrics</li>
      <li>Metrics generated from <a href="https://docs.newrelic.com/docs/data-ingest-apis/get-data-new-relic/metric-api/events-metrics-service-create-metrics">events-to-metrics</a> are not eligible</li>
    </ul>
  </li>
</ul>
<p>Support for additional types are planned for the future.</p>
<h2>Create drop data rule [#how-to]</h2>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJjYXV0aW9uIn1d">
  <p>Use caution when deciding to drop data. The data you drop is not recoverable. Before using this feature, please review <a href="#caution">caution information below.</a></p>
</div>
<p>To drop data, create a <a href="/docs/apis/nerdgraph/get-started/introduction-new-relic-nerdgraph">NerdGraph</a>-format drop rule that includes:</p>
<ul>
  <li>A <a href="/docs/query-data/nrql-new-relic-query-language/getting-started/introduction-nrql">NRQL</a> string that specifies what data types to drop</li>
  <li>An <strong>action</strong> type specifying how to apply the NRQL string</li>
</ul>
<p>You can form and make the call in the <a href="https://api.newrelic.com/graphiql">NerdGraph explorer</a>.</p>
<p>There are two ways to drop data:</p>
<ul>
  <li>
    <p><strong>Drop entire data types or a data subset</strong> (with optional filter). This uses the <code>DROP_DATA</code> <strong>action</strong> type and uses NRQL of the form:</p>
    <pre><code>SELECT * FROM DATA_TYPE_1, DATA_TYPE_2 (WHERE OPTIONAL_FILTER)
</code></pre>
    <p>For this type of drop rule, you cannot use anything other than <code>*</code> in the <code>SELECT</code> clause.</p>
  </li>
  <li>
    <p><strong>Drop attributes from data types</strong> (with optional filter). This uses the <code>DROP_ATTRIBUTES</code> <strong>action</strong> type and uses NRQL of the form:</p>
    <pre><code>SELECT dropAttr1, dropAttr2 FROM DATA_TYPE (WHERE OPTIONAL_FILTER)
</code></pre>
    <p>For this type of drop rule, you must pass in a non-empty list of raw attributes names.</p>
  </li>
</ul>
<h2>NRQL restrictions [#restrictions]</h2>
<p>Not all NRQL clauses make sense for generating drop rules. You can provide a <a href="/docs/query-data/nrql-new-relic-query-language/getting-started/nrql-syntax-clauses-functions#sel-where"><code>WHERE</code></a> clause to select data with specific attributes. Other features such as <code>TIMESERIES</code>, <code>COMPARE WITH</code>, <code>FACET</code>, and other clauses cannot be used.</p>
<p>The two action types have these restrictions:</p>
<ul>
  <li><code>DROP_DATA</code> can use only <code>SELECT *</code>.</li>
  <li><code>DROP_ATTRIBUTES</code> requires use of <code>SELECT</code> with "raw" attributes (attributes with no <a href="/docs/query-data/nrql-new-relic-query-language/getting-started/nrql-syntax-clauses-functions#functions">aggregator function</a> applied). This also means you cannot use <code>SELECT *</code>. Additionally, there are some attributes that are integral to their data type and <strong>cannot be dropped</strong> (such as <code>timestamp</code> on event data). If you include them, registration will fail.</li>
</ul>
<h2>Example drop rules [#example-rules]</h2>
<p>Here are some example drop rules:</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZHJvcC1ldmVudHMifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IkRyb3AgdHdvIGV2ZW50IHR5cGVzIn1d">
    <div data-prop-text="title">Drop two event types</div>
    <p>Let's say you notice you have some event types being sent to New Relic that are not important to you. Also, stopping the source from sending those event types quickly is unrealistic, requiring changes to agents and/or API instrumentation. Using a drop rule is an easier way to accomplish the same goal.</p>
    <p>Here is an example NerdGraph call that drops two event types: <code>Event1</code> and <code>Event2</code>.</p>
    <pre><code>mutation {
    nrqlDropRulesCreate(accountId: YOUR_ACCOUNT_ID, rules: [
        {
            action: DROP_DATA
            nrql: "SELECT * FROM Event1, Event2"
            description: "Drops all data for Event1 and Event2."
        }
    ])
    {
        successes { id }
        failures {
            submitted { nrql }
            error { reason description }
        }
    }
}

</code></pre>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZHJvcC1zcGVjaWZpYy1ldmVudHMifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IkRyb3AgZXZlbnRzIG1lZXRpbmcgY2VydGFpbiBjcml0ZXJpYSJ9XQ==">
    <div data-prop-text="title">Drop events meeting certain criteria</div>
    <p>Let’s say you have a high volume custom event type that arrives from multiple sources. If you don't find all of that data important, you can use a drop rule. Here is an example of a drop rule that filters out events based on specific criteria.</p>
    <pre><code>mutation {
    nrqlDropRulesCreate(accountId: YOUR_ACCOUNT_ID, rules: [
        {
            action: DROP_DATA
            nrql: "SELECT * FROM MyCustomEvent WHERE appName='LoadGeneratingApp' AND environment='development'"
            description: "Drops all data for MyCustomEvent that comes from the LoadGeneratingApp in the dev environment, because there is too much and we don’t look at it."
        }
    ])
    {
        successes { id }
        failures {
            submitted { nrql }
            error { reason description }
        }
    }
}

</code></pre>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZHJvcC1zZW5zaXRpdmUtZGF0YSJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiRHJvcCBzZW5zaXRpdmUgYXR0cmlidXRlcyB3aGlsZSBtYWludGFpbmluZyB0aGUgcmVzdCBvZiB0aGUgZGF0YSJ9XQ==">
    <div data-prop-text="title">Drop sensitive attributes while maintaining the rest of the data</div>
    <p>Let's say you noticed an event has attributes that contain Personally Identifiable Information (PII). You are working to update your services to stop sending the data, but until then, you need to cease storing further PII in New Relic. Although you could drop all of the data as it comes in the door with a <code>DROP_DATA</code> rule, the rest of the data still provides value. Therefore, you can register a drop rule to remove only the offending PII from your data:</p>
    <pre><code>mutation {
    nrqlDropRulesCreate(accountId: YOUR_ACCOUNT_ID, rules: [
        {
            action: DROP_ATTRIBUTES
            nrql: "SELECT userEmail, userName FROM MyCustomEvent
            description: "Removes the user name and email fields from MyCustomEvent"
        }
    ])
    {
        successes { id }
        failures {
            submitted { nrql }
            error { reason description }
        }
    }
}

</code></pre>
  </div>
</div>
<h2>Verify your drop rule works [#verify]</h2>
<p>After you create a drop rule, verify that it is working as expected. The rule should take effect quickly after a successful registration, so try running a <code>TIMESERIES</code> version of the query you registered to see that the data drops off.</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p>Drop rule type</p>
      </div>
      <div>
        <p>NRQL</p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p><code>DROP_DATA</code></p>
      </div>
      <div>
        <p><strong>Drop rule NRQL:</strong></p>
        <pre><code>SELECT * FROM MyEvent WHERE foo = bar

</code></pre>This should drop to 0. To verify that it did not affect any thing else, invert the `WHERE` clause.
        <pre><code>
SELECT count(*) FROM MyEvent WHERE foo = bar TIMESERIES

</code></pre>**Validation NRQL:**
      </div>
    </div>
    <div>
      <div>
        <p><code>DROP_ATTRIBUTES</code></p>
      </div>
      <div>
        <p><strong>Drop rule NRQL:</strong></p>
        <pre><code>SELECT dropAttr1, dropAttr2 FROM MyEvent WHERE foo = bar

</code></pre>Both lines should drop to 0. To verify that it did not affect events that contained these attributes and still should, invert the `WHERE` clause.
        <pre><code>
SELECT count(dropAttr1), count(dropAttr2) FROM MyEvent WHERE foo = bar TIMESERIES

</code></pre>**Validation NRQL:**
      </div>
    </div>
  </div>
</div>
<h2>View rules [#view]</h2>
<p>Here is an example NerdGraph call that returns the drop rules set on an account:</p>
<pre><code>{
    actor {
        account(id: YOUR_ACCOUNT_ID) {
            nrqlDropRules {
                list {
                    rules {
                        id
                        nrql
                        accountId
                        action
                        createdBy
                        createdAt
                        description
                    }
                    error { reason description } 
                }
            }
        }
    }
}
</code></pre>
<h2>Delete drop rules [#delete]</h2>
<p>Here is an example NerdGraph call deleting two specific drop rules:</p>
<pre><code>mutation {
    nrqlDropRulesDelete(accountId: YOUR_ACCOUNT_ID, ruleIds: ["48", "98"]) {
	successes {
	    id
	    nrql
	    accountId
	    action
	    description
	}
	failures {
	    error { reason description }
	    submitted { ruleId accountId }
        }
    }
}
</code></pre>
<h2>Audit drop rule history [#history]</h2>
<p>To see who created and deleted drop rules, query your <a href="https://docs.newrelic.com/docs/insights/use-insights-ui/manage-account-data/query-account-audit-logs-nrauditevent">account audit logs</a>. The <a href="#list">list endpoint</a> also includes the user ID of the person who created the rule.</p>
<h2>Cautions when dropping data [#caution]</h2>
<p>When creating drop rules, you are responsible for ensuring that the rules accurately identify and discard the data that meets the conditions that you have established. You are also responsible for monitoring the rule, as well as the data you disclose to New Relic.</p>
<p>New Relic cannot guarantee that this functionality will completely resolve data disclosure concerns you may have. New Relic does not review or monitor how effective the rules you develop are.</p>
<p>Creating rules about sensitive data can leak information about what kinds of data you maintain, including the format of your data or systems (for example, through referencing email addresses or specific credit card numbers). Rules you create, including all information in those rules, can be viewed and edited by any user with the relevant role-based access control permissions.</p>
<p>Only new data will be dropped. Existing data <a href="https://docs.newrelic.com/docs/telemetry-data-platform/ingest-manage-data/manage-data/manage-data-retention#data-deletion">cannot be edited or deleted</a>.</p>
<h2>Learn more</h2>
<p>Recommendations for learning more:</p>
<ul>
  <li><a href="/docs/apis/nerdgraph/get-started/introduction-new-relic-nerdgraph#terminology">NerdGraph basics and terminology</a></li>
  <li><a href="/docs/query-data/nrql-new-relic-query-language/getting-started/introduction-nrql">NRQL basics</a></li>
  <li>Browse the <a href="https://discuss.newrelic.com/c/telemetry-data-platform/dashboards">Explorers Hub</a> for community discussions about NRQL drop rules.</li>
</ul>
