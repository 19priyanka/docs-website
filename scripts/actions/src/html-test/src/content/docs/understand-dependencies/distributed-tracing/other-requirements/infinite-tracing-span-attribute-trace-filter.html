
<p>In addition to duration and random filters, trace observers use a span attribute trace filter to find useful traces. You can customize the filter rules to keep or discard traces that have spans with specific attributes.</p>
<h2>Overview</h2>
<p>Filter rules are key/value pairs specific to individual trace observers. You use the New Relic Edge app to define and view them.</p>
<p>The span attribute trace filter allows a total of three rules, and by default, two rules are provided to capture errors. While you can remove the two default error rules, we recommend you keep the two default error rules and add an additional rule, if you need one.</p>
<h2>Add a custom rule [#add-custom-rule]</h2>
<p>Here's an example of how to add a rule to keep all traces that have spans with attributes containing the user <code>sally@some_company.com</code>:</p>
<ol>
  <li>
    <p>Go to <a href="one.newrelic.com">one.newrelic.com</a> <strong>> Apps > Your apps > New Relic Edge</strong>.</p>
  </li>
  <li>
    <p>For the trace observer you want to modify, click the gear icon to open the filters.</p>
  </li>
  <li>
    <p>Under <strong>Create new rule</strong>, enter <code>user</code> below <strong>Span key</strong>, and then in the <strong>Key operator</strong> dropdown, select the value <strong>Equals</strong>:</p>
    <p>
      <img src="./images/span_key.png" alt="Screenshot showing how to enter a span key." title="span_key.png">
    </p>
  </li>
  <li>
    <p>Under <strong>Span value</strong>, enter <code>sally@some_company.com</code>, and then in the <strong>Value operator</strong> dropdown, select <strong>Equals</strong>.</p>
    <p>
      <img src="./images/span_value.png" alt="Screenshot showing how to enter a span value." title="span_value.png">
    </p>
  </li>
  <li>
    <p>In the <strong>Observer action</strong> dropdown, select <strong>Keep</strong>.</p>
    <div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJ0aXAifV0=">
      <p>If you have any traces that match this rule, you'll see them listed below the rule.</p>
    </div>
  </li>
  <li>
    <p>Click <strong>Add rule</strong> to save your custom rule.</p>
  </li>
</ol>
<p>When you add a custom rule, it takes effect immediately for that trace observer.</p>
<h2>Rule Priority</h2>
<p>When a trace has spans with attributes that match both <strong>Keep</strong> and <strong>Discard</strong> filter rules, the trace is discarded.</p>
<p>For example, suppose you don't want to save some expected errors that have a certain phrase in the error message. You could create a <strong>Discard</strong> filter rule that targets the error message while still retaining all other traces with an error.</p>
