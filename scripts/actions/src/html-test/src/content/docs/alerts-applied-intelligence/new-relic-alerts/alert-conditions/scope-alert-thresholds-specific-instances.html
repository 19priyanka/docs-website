
<p>You can set alert <a href="/docs/using-new-relic/welcome-new-relic/get-started/glossary#alert-threshold">thresholds</a> that trigger when they're violated by any of your Java app's instances. Scoping the condition to instances of your app is helpful for detecting anomalies that occur only in a subset of your app's instances.</p>
<p>These sorts of anomalies are easy to miss for apps that aggregate metrics across a large number of instances. By looking at each instance, you can more quickly identify where potential problems are originating.</p>
<h2>Example</h2>
<p>In this example, you set up a policy for a Java app with three instances. You want to open a violation when the condition's critical threshold for any instance's error rate is greater than .02% <strong>for at least</strong> five minutes.</p>
<p>During a five-minute time period the three instances have these error rates:</p>
<div data-component="Table" data-prop="W10=">
  <div>
    <div>
      <div>
        <p><strong>App instance</strong></p>
      </div>
      <div>
        <p><strong>4:45pm</strong></p>
      </div>
      <div>
        <p><strong>4:50pm</strong></p>
      </div>
      <div>
        <p><strong>Violation opened?</strong></p>
      </div>
    </div>
  </div>
  <div>
    <div>
      <div>
        <p>A</p>
      </div>
      <div>
        <p>0.00%</p>
      </div>
      <div>
        <p>0.00%</p>
      </div>
      <div>
        <p>No. This instance remained below the target threshold the entire time.</p>
      </div>
    </div>
    <div>
      <div>
        <p>B</p>
      </div>
      <div>
        <p>0.02%</p>
      </div>
      <div>
        <p>0.03%</p>
      </div>
      <div>
        <p>Yes. The alert threshold exceeded the 0.02% threshold for this instance for at least five minutes.</p>
      </div>
    </div>
    <div>
      <div>
        <p>C</p>
      </div>
      <div>
        <p>0.10%</p>
      </div>
      <div>
        <p>0.00%</p>
      </div>
      <div>
        <p>No. The threshold value must be breached for <a href="/docs/alerts/new-relic-alerts/configuring-alert-policies/define-thresholds-trigger-alert#threshold-triggers">at least five consecutive minutes</a> to open a violation.</p>
        <p>However, if you had set the threshold for <strong>at least once</strong> in five minutes, then the threshold value must be breached <a href="/docs/alerts/new-relic-alerts/configuring-alert-policies/minimum-maximum-values#violation">at least once</a> during the five-minute period.</p>
      </div>
    </div>
  </div>
</div>
<h2>Create instance-based alert condition [#procedure]</h2>
<p>To create a policy that triggers notifications for violations by your app's individual instances:</p>
<ol>
  <li>Follow the <a href="/docs/alerts/new-relic-alerts/configuring-alert-policies/alert-policy-workflow#alert-policy-process">basic workflow process</a> to set up a policy.</li>
  <li>When creating a <a href="/docs/alerts/new-relic-alerts/configuring-alert-policies/define-alert-conditions">condition</a> (step 2), select <a href="/docs/alerts/new-relic-alerts/configuring-alert-policies/select-product-targets-alert-condition"><strong>APM</strong></a>.</li>
  <li>Select <strong>Application metric</strong> as the type of condition.</li>
  <li>To calculate alert threshold violations <strong>individually</strong> for each of the app's selected instances, select <strong>Scope to Java application instances</strong>.</li>
  <li>Select <strong>Next, select entities</strong>, then identify one or more apps for this condition.</li>
  <li>Optional: Change the time when New Relic Alerts will force-close the violation (default is 24 hours).</li>
  <li>Use <strong>By condition</strong> or <strong>By condition and entity</strong> <a href="/docs/alerts/new-relic-alerts/reviewing-alert-incidents/specify-when-new-relic-creates-incidents">incident preference</a>.</li>
  <li>Continue the rest of the <a href="/docs/alerts/new-relic-alerts/configuring-alert-policies/alert-policy-workflow#alert-policy-process">policy workflow process (step 3)</a>.</li>
</ol>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJ0aXAifV0=">
  <p>To open violations based on the <strong>average</strong> of all instances for your apps, select <strong>Scope to the application</strong> instead of <strong>Scope to Java application instances</strong>.</p>
</div>
<h2>Use "By condition" incident preference [#targets]</h2>
<p>When setting the <a href="/docs/alerts/new-relic-alerts/reviewing-alert-incidents/specify-when-new-relic-creates-incidents">incident preference</a> for policies containing instance-based conditions, we recommend that you select <strong>By condition</strong> instead of <strong>By condition and entity</strong>. Although apps are the selected entities for this condition, we evaluate each JVM as a separate entity.</p>
<p>If you set your <strong>Incident preference</strong> to <strong>By condition and entity</strong>, a separate incident will be opened for each JVM that breaches the critical threshold. When an app fails across multiple JVMs, this can lead to alert "fatigue" and frustration.</p>
<h2>Use REST API for instance alerts</h2>
<p>To create instance-based <a href="/docs/alerts/new-relic-alerts/rest-api-alerts/manage-entities-alerts-conditions">alert conditions with the New Relic REST API</a>, include these items with your REST API call:</p>
<ul>
  <li>Your <a href="https://docs.newrelic.com/docs/apis/rest-api-v2/getting-started/introduction-new-relic-rest-api-v2#api_key">API key</a>.</li>
  <li>The numeric <a href="/docs/using-new-relic/welcome-new-relic/get-started/glossary#entity"><code>entity_id</code></a> for the <a href="/docs/using-new-relic/welcome-new-relic/get-started/glossary#entity">entity</a> being monitored</li>
  <li>The <a href="/docs/using-new-relic/welcome-new-relic/get-started/glossary#alert-condition"><code>condition_id</code></a> (available from the API Explorer: <a href="https://rpm.newrelic.com/api/explore/alerts_entity_conditions/list"><strong>Alerts Conditions > GET > List</strong></a>)</li>
  <li>The <code>entity_type</code> (set to <code>"application"</code>)</li>
  <li>The <code>condition_scope</code> (set to <code>"instance"</code> for a Java application instance or <code>"application"</code> for a Java app)</li>
</ul>
<p>Here is an example of the API request format and JSON response.</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiaW5zdGFuY2UtYXBpIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJJbnN0YW5jZSBhbGVydCBBUEkgY2FsbCJ9XQ==">
    <div data-prop-text="title">Instance alert API call</div>
    <p>Use this format for your API call:</p>
    <pre><code>curl -X PUT 'https://api.newrelic.com/v2/alerts_entity_conditions/12345.json' \
     -H 'Api-Key:$API_KEY' -i \
     -H 'Content-Type: application/json' \
     -G -d 'entity_type=application&#x26;condition_id=234567'

</code></pre>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiaW5zdGFuY2UtanNvbiJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiSW5zdGFuY2UgYWxlcnQgSlNPTiByZXNwb25zZSJ9XQ==">
    <div data-prop-text="title">Instance alert JSON response</div>
    <p>The API returns the response as JSON.</p>
    <pre><code>{
  "condition": [
    {
     "id": 234567,
     "type": "apm_app_metric",
     "name": "demo",
     "enabled": true,
     "entities": [
       12345
     ],
     "metric": "apdex",
     "condition_scope": "instance",   &#x3C;---&#x3C;&#x3C;&#x3C; scope indicator
     "violation_close_timer": 24,
     "terms": [
        {
         "duration": "5",
         "operator": "above",
         "priority": "critical",
         "threshold": "1",
         "time_function": "all"
        }
      ]
    }
  ] 
}

</code></pre>
  </div>
</div>
<h2>For more help [#more_help]</h2>
<p>If you need additional help, get support at <a href="https://support.newrelic.com">support.newrelic.com</a>.</p>
