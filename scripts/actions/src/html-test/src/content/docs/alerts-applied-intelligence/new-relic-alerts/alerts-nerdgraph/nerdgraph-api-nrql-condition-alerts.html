
<p>You can manage alerts conditions using our GraphQL NerdGraph API. Here are some conditions queries and mutations you can develop in our <a href="https://api.newrelic.com/graphiql">NerdGraph API explorer</a>.</p>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJ0aXAifV0=">
  <p>See the <a href="https://docs.newrelic.com/docs/apis/nerdgraph/get-started/introduction-new-relic-nerdgraph">NerdGraph introduction</a> for help getting started with NerdGraph API explorer.</p>
</div>
<p>This document covers the following:</p>
<ul>
  <li><a href="#steps">Steps to create a NRQL condition</a></li>
  <li><a href="#static-condition">NRQL static condition</a></li>
  <li><a href="#baseline-condition">NRQL baseline condition</a></li>
  <li><a href="#outlier-condition">NRQL outlier condition</a></li>
  <li><a href="#update-condition">Update a condition</a></li>
  <li><a href="#update-mutations">Update mutations</a></li>
  <li><a href="#filtering">List and filter NRQL conditions</a></li>
  <li><a href="#singular-condition">Singular NRQL condition queries</a></li>
  <li><a href="#description">Create a description</a></li>
  <li><a href="#delete-conditions">Delete conditions</a></li>
</ul>
<h2>Steps to create a NRQL condition [#steps]</h2>
<p>Follow these steps:</p>
<ol>
  <li>
    <p>Decide which condition type you want to create (see <a href="https://docs.newrelic.com/docs/alerts/new-relic-alerts/defining-conditions/create-alert-conditions-nrql-queries#threshold-types">NRQL Condition threshold types</a>).</p>
  </li>
  <li>
    <p>Find your relevant <code>policyID</code> by doing one of the following:</p>
    <ul>
      <li>Use the <a href="/docs/alerts/alerts-nerdgraph/nerdgraph-examples/nerdgraph-api-alerts-policies">NerdGraph policies API</a>.</li>
      <li>Go to <strong><a href="https://one.newrelic.com/" title="Link opens in a new window.">one.newrelic.com</a></strong>, in the top nav click <strong>Alerts &#x26; AI</strong>, then click <strong>Policies</strong>. Choose a policy. Find the ID under the policy name.</li>
    </ul>
  </li>
  <li>
    <p>Provide the appropriate mutation for your NRQL condition type and the relevant values.</p>
  </li>
</ol>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJ0aXAifV0=">
  <p>The NerdGraph GraphiQL explorer is the best place to find up-to-date documentation about the per-field specifics of the NerdGraph NRQL Conditions API. For example, questions like "What does the <code>valueFunction</code> field accept?" are best answered with the inline NerdGraph documentation.</p>
</div>
<h2>NRQL static condition [#static-condition]</h2>
<p>Here's an example of creating a static condition:</p>
<pre><code>mutation {
      alertsNrqlConditionStaticCreate(accountId: YOUR_ACCOUNT_ID, policyId: YOUR_POLICY_ID, condition: {
        name: "Low Host Count - Catastrophic"
        enabled: true
        nrql: {
          query: "SELECT uniqueCount(host) from Transaction where appName='my-app-name'"
        }
        signal {
          aggregationWindow: 60
          evaluationOffset: 3
        }
        terms: {
          threshold: 2
          thresholdOccurrences: AT_LEAST_ONCE
          thresholdDuration: 600
          operator: BELOW
          priority: CRITICAL
        }
        valueFunction: SINGLE_VALUE
        violationTimeLimitSeconds: 86400
      }) {
        id
        name
      }
    }
</code></pre>
<h2>NRQL baseline condition [#baseline-condition]</h2>
<p>Here's an example of creating a baseline condition:</p>
<pre><code>mutation {
      alertsNrqlConditionBaselineCreate(accountId: YOUR_ACCOUNT_ID, policyId: YOUR_POLICY_ID, condition: {
        name: "Baseline Condition"
        enabled: true
        baselineDirection: UPPER_ONLY
        nrql: {
          query: "SELECT average(duration) FROM Transaction"
        }
        signal {
          aggregationWindow: 60
          evaluationOffset: 3
        } 
        terms: {
          threshold: 13
          thresholdDuration: 180
          thresholdOccurrences: ALL
          operator: ABOVE
          priority: CRITICAL
        }
        violationTimeLimitSeconds: 86400
      }) {
        id
        name
        baselineDirection
      }
    }
</code></pre>
<h2>NRQL outlier condition [#outlier-condition]</h2>
<p>Here's an example of creating an outlier condition:</p>
<pre><code>mutation {
      alertsNrqlConditionOutlierCreate(accountId: YOUR_ACCOUNT_ID, policyId: YOUR_POLICY_ID, condition: {
        name: "Outlier Condition"
        enabled: true
        expectedGroups: 4
        openViolationOnGroupOverlap: false
        nrql: {
          query: "SELECT average(duration) FROM Transaction FACET httpResponseCode"
        }
        signal {
          aggregationWindow: 60
          evaluationOffset: 3
        }
        terms: {
          threshold: 1
          thresholdDuration: 300
          thresholdOccurrences: ALL
          operator: ABOVE
          priority: CRITICAL
        }
        violationTimeLimitSeconds: 86400
      }) {
        id
        name
        expectedGroups
        openViolationOnGroupOverlap
      }
    }
</code></pre>
<h2>Update a condition [#update-condition]</h2>
<p>Complete the following:</p>
<ol>
  <li>
    <p>Determine the type of your existing condition by requesting the type field in a <code>nrqlConditionsSearch</code> query like this:</p>
    <pre><code>{
      actor {
        account(id: YOUR_ACCOUNT_ID) {
          alerts {
            nrqlConditionsSearch {
              nrqlConditions {
                id
                type
              }
            }
          }
        }
      }
    }
</code></pre>
    <div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJ0aXAifV0=">
      <p>The <code>type</code> returned is what you use for your update mutation. For example, if the type returned is <code>STATIC</code>, use <code>alertsNrqlConditionStaticUpdate</code>. If the type returned is <code>BASELINE</code>, use <code>alertsNrqlConditionBaselineUpdate</code>. If the type returned is <code>OUTLIER</code>, use <code>alertsNrqlConditionOutlierUpdate</code>.</p>
    </div>
  </li>
  <li>
    <p>Provide the <code>id</code> of your condition to your relevant condition type mutation. Note that you can only update conditions of the relevant type.</p>
  </li>
</ol>
<p>Only provide update mutations for the fields you want to update. Fields you don't provide in the update are not touched.</p>
<h2>Update mutations</h2>
<p>Only fields that you provide in the update are changed. In the following example, <code>baselineDirection</code> returns unchanged, but <code>name</code> is updated.</p>
<pre><code>mutation {
      alertsNrqlConditionBaselineUpdate(id: YOUR_CONDITION_ID, accountId: YOUR_ACCOUNT_ID, condition: {
        name: "Your updated name"
      }) {
        id
        name
        baselineDirection
      }
    }
</code></pre>
<h2>List and filter NRQL conditions [#filtering]</h2>
<p>To list or filter your NRQL conditions, use the <code>nrqlConditionsSearch</code> query in NerdGraph.</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoicGFnaW5hdGlvbiJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiVXNlIGN1cnNvciBwYWdpbmF0aW9uIn1d">
    <div data-prop-text="title">Use cursor pagination</div>
    <p>The basic of list functionality for NRQL conditions allows you to paginate through your NRQL conditions as well as request the total count of conditions per account.</p>
    <p>The <code>nrqlConditionsSearch</code> query utilizes cursor pagination to paginate through resources. The idea behind cursor pagination is that the client will request a cursor in a programmatic loop until the cursor comes back empty.</p>
    <p>An initial list response will look something like this:</p>
    <pre><code>{
      actor {
        account(id: YOUR_ACCOUNT_ID) {
          alerts {
            nrqlConditionsSearch {
              nextCursor
              nrqlConditions {
                id
                name
                type
              }
              totalCount
            }
          }
        }
      }
    }

</code></pre>
    <pre><code>
{
      actor {
        account(id: YOUR_ACCOUNT_ID) {
          alerts {
            nrqlConditionsSearch(cursor: "WOwfJ4+TWm9QTFeKMGyg+w==:QqkI8S4+Wwnpno6z+uk8kQ==",
            ) {
              nextCursor
              nrqlConditions {
                id
                name
                type
              }
              totalCount
            }
          }
        }
      }
    }

</code></pre>In order to paginate through conditions in the response, have the client request the cursor to be returned until the `nextCursor` returns from the response as `null`:
    <pre><code>
{
      "data": {
        "actor": {
          "account": {
            "alerts": {
              "nrqlConditionsSearch": {
              "nextCursor": "WOwfJ4+TWm9QTFeKMGyg+w==:QqkI8S4+Wwnpno6z+uk8kQ==",
              "nrqlConditions": [
                {
                  "id": "4432",
                  "name": "Baseline Condition",
                  "type": "BASELINE"
                },
                {
                  "id": "443",
                  "name": "A static condition",
                  "type": "STATIC"
                },
                // more conditions here in reality
              ],
              "totalCount": 435
              }
            }
          }
        }
      },
    }

</code></pre>This example returns a JSON response like this:
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoic3BlY2lmaWMtZmllbGRzIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJSZXF1ZXN0IHR5cGUtc3BlY2lmaWMgZmllbGRzIn1d">
    <div data-prop-text="title">Request type-specific fields</div>
    <p>Certain fields are only available on specific NRQL condition types. The main reason that mutations are split between the different condition types is because they have minor differences between the fields they accept.</p>
    <p>For example, <code>valueFunction</code> is only relevant for static NRQL conditions and <code>baselineDirection</code> is only relevant on baseline NRQL conditions.</p>
    <p>But if these fields are only available on these certain condition types, how do we return them in a list of all of our condition types? The answer is a GraphQL convention known as inline fragments. Inline fragments allow you to access the data on a specific type of NRQL condition:</p>
    <pre><code>{
      actor {
        account(id: YOUR_ACCOUNT_ID) {
          alerts {
            nrqlConditionsSearch {
              nrqlConditions {
                id
                name
                type
                ...on AlertsNrqlStaticCondition {
                  valueFunction
                }
                ...on AlertsNrqlBaselineCondition {
                  baselineDirection
                }
                ...on AlertsNrqlOutlierCondition {
                  expectedGroups
                }
              }
            }
          }
        }
      }
    }

</code></pre>
    <pre><code>
{
      "data": {
        "actor": {
          "account": {
            "alerts": {
              "nrqlConditionsSearch": {
                "nrqlConditions": [
                  {
                    "baselineDirection": "UPPER_ONLY",
                    "id": "342",
                    "name": "My baseline condition",
                    "type": "BASELINE"
                  },
                  {
                    "id": "553",
                    "name": "My static condition",
                    "type": "STATIC",
                    "valueFunction": "SINGLE_VALUE"
                  },
                  {
                    "expectedGroups": 4,
                    "id": "802",
                    "name": "My outlier condition",
                    "type": "OUTLIER"
                  }
                ]
              }
            }
          }
        }
      }
    }

</code></pre>In the previous example query, we are asking GraphQL to do the hard work for us to determine which NRQL conditions are the correct type.
    So, when the returned type is a static condition, it will return the `valueFunction` in the object. When the returned type is a baseline condition, it will return `baselineDirection` instead, and when the type is an outlier condition, it will return `expectedGroups`. Here is an example response:
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoibnJxbC1jb25kaXRpb25zIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJGaWx0ZXIgTlJRTCBjb25kaXRpb25zIn1d">
    <div data-prop-text="title">Filter NRQL conditions</div>
    <p>You can filter NRQL conditions with the <code>searchCriteria</code> argument of the <code>nrqlConditionsSearch</code> query:</p>
    <p>Here's an example of filtering NRQL conditions with matching by name. This query returns NRQL conditions that match the provided name. Note that this match is case insensitive.</p>
    <pre><code>{
      actor {
        account(id: YOUR_ACCOUNT_ID) {
          alerts {
            nrqlConditionsSearch(searchCriteria: {
              name: "Baseline Condition"
            }) {
              nrqlConditions {
                id
                name
                type
              }
            }
          }
        }
      }
    }

</code></pre>
  </div>
</div>
<h2>Singular NRQL condition queries [#singular-condition]</h2>
<p>You can use the NRQL condition API to query for a singular condition. Run the <code>nrqlCondition</code> query in the alerts namespace.</p>
<p>Similar to type specific fields on the <code>nrqlConditionSearch</code> query, you can also use these inline fragments to request fields that are restricted to a NRQL condition type.</p>
<pre><code>{
      actor {
        account(id: YOUR_ACCOUNT_ID) {
          alerts {
            nrqlCondition(id: YOUR_CONDITION_ID) {
              id
              name
              ...on AlertsNrqlStaticCondition {
                valueFunction
              }
            }
          }
        }
      }
    }
</code></pre>
<h2>Update the description [#description]</h2>
<p>This will walk you through the procedure to create a <a href="/docs/alerts/new-relic-alerts/defining-conditions/alert-condition-descriptions">description</a> for a NRQL alert condition.</p>
<ol>
  <li>Get all the conditions for a policy:</li>
</ol>
<pre><code>{
     actor {
       account(id: YOUR_ACCOUNT_ID) {
         alerts {
           nrqlConditions(policyId: YOUR_POLICY_ID) {
             nextCursor
             results {
               id
               name
               description
               enabled
               nrql {
                 query
               }
               signal {
                 aggregationWindow
                 evaluationOffset
               }
               policyId
               runbookUrl
               terms {
                 duration
                 operator
                 priority
                 timeFunction
                 threshold
               }
               type
               violationTimeLimitSeconds
             }
           }
         }
       }
     }
    }
</code></pre>
<ol start="2">
  <li>Get the details for a single condition:</li>
</ol>
<pre><code>{
     actor {
       account(id: YOUR_ACCOUNT_ID) {
         alerts {
           nrqlCondition(id: "YOUR_CONDITION_ID") {
             description
             id
             enabled
             name
             nrql {
               query
             }
             signal {
               aggregationWindow
               evaluationOffset
             }
             policyId
             runbookUrl
             terms {
               operator
               priority
               threshold
               thresholdDuration
               thresholdOccurrences
             }
             type
             violationTimeLimitSeconds
           }
         }
       }
     }
    }
</code></pre>
<ol start="3">
  <li>Create a mutation with the description.</li>
</ol>
<p>Here's an empty mutation template:</p>
<pre><code>mutation {
     alertsNrqlConditionStaticUpdate(accountId: YOUR_ACCOUNT_ID, id: "YOUR_CONDITION_ID", condition: {description: ""}) {
       description
     }
    }
</code></pre>
<p>Here's an example mutation with an included example description:</p>
<pre><code>mutation {
     alertsNrqlConditionStaticUpdate(accountId: 123456, id: "123456", condition: {description: "timestamp : {{timestamp}} \n accountId : {{accountId}} \n type : {{type}} \n event : {{event}} \n description : {{description}} \n policyId : {{policyId}} \n policyName: {{policyName}} \n conditionName : {{conditionName}} \n conditionId : {{conditionId}} \n product : {{product}} \n conditionType : {{conditionType}} \n RunbookUrl : {{runbookUrl}} \n nrqlQuery : {{nrqlQuery}} \n nrqlEventType : {{nrqlEventType}} \n targetID : {{targetId}} \n targetName : {{targetName}} \n commandLine : {{tag.commandLine}} \n entityGuid : {{tag.entityGuid}} \n entityName : {{tag.entityName}} \n fullHostname : {{tag.fullHostname}} \n instanceType : {{tag.instanceType}} \n processDisplayName : {{tag.processDisplayName}}"}) {
       description
     }
    }
</code></pre>
<h2>Delete conditions</h2>
<p>You can use the <code>alertsConditionDelete</code> mutation to delete any type of condition. You can only request the <code>id</code> field on a delete mutation; for example:</p>
<pre><code>mutation {
        alertsConditionDelete(accountId: YOUR_ACCOUNT_ID, id: YOUR_CONDITION_ID) {
          id
        }
    }
</code></pre>
