
<p><a href="/docs/alerts/new-relic-alerts/getting-started/introduction-new-relic-alerts">Alerts</a> offers <a href="/docs/alerts/new-relic-alerts/defining-conditions/create-alert-conditions-nrql-queries">NRQL conditions</a> in three <a href="/docs/alerts/new-relic-alerts/defining-conditions/create-alert-conditions-nrql-queries#threshold-types">threshold types</a>: static, baseline, and outlier. This document explains how the outlier threshold type works, gives some <a href="#example-use-cases">example use cases and NRQL queries</a>, and explains how to <a href="#create">create an outlier condition</a>.</p>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
  <p>NRQL alerts do <strong>not</strong> affect Alerts policies for a Synthetic monitor. For example, <a href="https://docs.newrelic.com/docs/alerts-applied-intelligence/new-relic-alerts/alert-notifications/muting-rules-suppress-notifications">muting a NRQL alert</a> will <strong>not</strong> mute a <a href="http://docs.newrelic.com/docs/synthetics/synthetic-monitoring/using-monitors/alerts-synthetic-monitoring#alerts-existing-monitor">Synthetic monitor's alerts.</a></p>
</div>
<h2>What is outlier detection? [#feature]</h2>
<p>In software development and operations, it is common to have a group consisting of members you expect to behave approximately the same. For example: for servers using a load balancer, the traffic to the servers may go up or down, but the traffic for all the servers should remain in a fairly tight grouping.</p>
<p>The NRQL alert outlier detection feature parses the data returned by your <a href="/docs/insights/nrql-new-relic-query-language/nrql-resources/nrql-syntax-components-functions#sel-facet">faceted NRQL query</a> and:</p>
<ul>
  <li>Looks for the number of expected groups that you specify</li>
  <li>Looks for outliers (values deviating from a group) based on the sensitivity and time range you set</li>
</ul>
<p>Additionally, for queries that have more than one group, you can choose to be notified when groups start behaving the same.</p>
<p>
  <img src="./images/NRQL_outlier_violations.png" alt="New Relic Alerts - outlier NRQL alerts" title="NRQL_outlier_violations.png">
</p>
<p>This visual aid will help you understand the types of situations that will trigger a violation and those that won't.</p>
<p>For more on the rules and logic behind this calculation, see <a href="#rules-logic">Outlier detection rules</a>.</p>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJ0aXAifV0=">
  <p>Note: this feature does not take into account the past behavior of the monitored values; it looks for outliers only in the currently reported data. For an alert type that takes into account past behavior, see <a href="/docs/alerts/new-relic-alerts/defining-conditions/create-baseline-alert-conditions">Baseline alerting</a>.</p>
</div>
<h2>Example use cases</h2>
<p>These use cases will help you understand when to use the outlier threshold type. Note that the outlier feature requires a NRQL query with a <a href="/docs/insights/nrql-new-relic-query-language/nrql-resources/nrql-syntax-components-functions#sel-facet"><code>FACET</code> clause</a>.</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoibG9hZC1iYWxhbmNlZC1zZXJ2ZXJzLXVuZXZlbiJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiTm90aWZ5IGlmIGxvYWQtYmFsYW5jZWQgc2VydmVycyBoYXZlIHVuZXZlbiB3b3JrbG9hZCJ9XQ==">
    <div data-prop-text="title">Notify if load-balanced servers have uneven workload</div>
    <p>A load balancer divides web traffic approximately evenly across five different servers. You can set a notification to be sent if any server starts getting significantly more or less traffic than the other servers.</p>
    <p>Example query:</p>
    <pre><code>SELECT average(cpuPercent) FROM SystemSample WHERE apmApplicationNames = 'MY-APP-NAME' FACET hostname

</code></pre>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoibG9hZC1iYWxhbmNlZC1hcHAtbWlzYmVoYXZpbmcifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6Ik5vdGlmeSBpZiBsb2FkLWJhbGFuY2VkIGFwcGxpY2F0aW9uIGhhcyBtaXNiZWhhdmluZyBpbnN0YW5jZXMifV0=">
    <div data-prop-text="title">Notify if load-balanced application has misbehaving instances</div>
    <p>Application instances behind a load balancer should have similar throughput, error rates, and response times. If an instance is in a bad state, or a load balancer is misconfigured, this will not be the case. Detecting one or two bad app instances using aggregate metrics may be difficult if there is not a significant rise in the overall error rate of the application.</p>
    <p>You can set a notification for when an app instance’s throughput, error rate, or response time deviates too far from the rest of the group.</p>
    <p>Example query:</p>
    <pre><code>SELECT average(duration) FROM Transaction WHERE appName = 'MY-APP-NAME' FACET host

</code></pre>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiY2hhbmdlcy1lbnZpcm9ubWVudHMifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6Ik5vdGlmeSBvZiBjaGFuZ2VzIGluIGRpZmZlcmVudCBlbnZpcm9ubWVudHMifV0=">
    <div data-prop-text="title">Notify of changes in different environments</div>
    <p>An application is deployed in two different environments, with ten application instances in each. One environment is experimental and gets more errors than the other. But the instances that are in the same environment should get approximately the same number of errors.</p>
    <p>You can set a notification for when an instance starts getting more errors than the other instances in the same environment. Also, you can set a notification for when the two environments start to have the same number of errors as each other.</p>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoidGltZXpvbmUtcmVsYXRlZC1jaGFuZ2VzIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJOb3RpZnkgZm9yIHRpbWV6b25lLXJlbGF0ZWQgY2hhbmdlcyJ9XQ==">
    <div data-prop-text="title">Notify for timezone-related changes</div>
    <p>The number of logged in users for a company is about the same for each of four applications, but varies significantly by each of the three time zones the company operates in.</p>
    <p>You can set a notification for when any application starts getting more or less traffic from a certain timezone than the other applications. Sometimes the traffic from the different time zones are the same, so you would set up the alert condition to not be notified if the time zone groups overlap.</p>
  </div>
</div>
<p>For more details on how this feature works, see <a href="#rules-logic">Outlier rules and logic</a>.</p>
<h2>Create an outlier alert condition [#create]</h2>
<p>To create a NRQL alert that uses outlier detection:</p>
<ol>
  <li>When creating a condition, under <strong>Select a product</strong>, select <strong>NRQL</strong>.</li>
  <li>For <strong>Threshold type</strong>, select <strong>Outlier</strong>.</li>
  <li>Create a <a href="/docs/alerts/new-relic-alerts/defining-conditions/create-alert-conditions-nrql-queries#syntax">NRQL query</a> with a <a href="/docs/insights/nrql-new-relic-query-language/nrql-resources/nrql-syntax-components-functions#sel-facet"><code>FACET</code> clause</a> that returns the values you want to alert on.</li>
  <li>Depending on how the returned values group together, set the <strong>Number of expected groups</strong>.</li>
  <li>Adjust the deviation from the center of the group(s) and the duration that will trigger a violation.</li>
  <li>Optional: Add a <a href="/docs/alerts/new-relic-alerts/defining-conditions/define-thresholds-trigger-alert#threshold-levels">warning threshold</a> and set its deviation.</li>
  <li>Set any remaining available options and save.</li>
</ol>
<h2>Rules and logic [#rules-logic]</h2>
<p>Here are the rules and logic behind how outlier detection works:</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiYWxlcnQtbG9naWMifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IkRldGFpbHMgYWJvdXQgYWxlcnQgY29uZGl0aW9uIGxvZ2ljIn1d">
    <div data-prop-text="title">Details about alert condition logic</div>
    <p>After the condition is created, the query is run once every <a href="/docs/using-new-relic/welcome-new-relic/getting-started/glossary#harvest-cycle">harvest cycle</a> and the condition is applied. Unlike baseline alerts, outlier detection uses no historical data in its calculation; it's calculated using the currently collected data.</p>
    <p>Alerts will attempt to divide the data returned from the query into the number of groups selected during condition creation.</p>
    <p>For each group, the approximate average value is calculated. The allowable deviation you have chosen when creating the condition is centered around that average value. If a member of the group is outside the allowed deviation, it produces a violation.</p>
    <p>If <strong>Trigger when groups overlap</strong> has been selected, Alerts detects a convergence of groups. If the condition is looking for two or more groups, and the returned values cannot be separated into that number of distinct groups, then that will produce a violation. This type of “overlap” event is represented on a chart by group bands touching.</p>
    <p>Because this feature does not take past behavior into account, data is never considered to "belong" to a certain group. For example, a value that switches places with another value wouldn't trigger a violation. Additionally, an entire group that moves together also wouldn't trigger a violation.</p>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoibnJxbC1xdWVyeS1ydWxlcyJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiTlJRTCBxdWVyeSBydWxlcyBhbmQgbGltaXRzIn1d">
    <div data-prop-text="title">NRQL query rules and limits</div>
    <p>The NRQL query must be a <a href="/docs/insights/nrql-new-relic-query-language/nrql-resources/nrql-syntax-components-functions#sel-facet">faceted query</a>, and can only facet on one attribute. Queries that facet on more than one attribute won't work.</p>
    <p>The number of unique values returned must be 500 or less. If the query returns more than this number of values, the condition won't be created. If the query later returns more than this number after being created, the alert will fail.</p>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoidW5yZXR1cm5lZC1kYXRhIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJaZXJvIHZhbHVlcyBmb3IgdW5yZXR1cm5lZCBkYXRhIn1d">
    <div data-prop-text="title">Zero values for unreturned data</div>
    <p>When a query returns a set of values, only values that are actually returned are taken into account. If a value is not available for calculation (including if it goes from being collected one harvest cycle to not being collected), it is rendered as a zero and is not considered. In other words, the behavior of unreturned zero values will never trigger violations.</p>
  </div>
</div>
