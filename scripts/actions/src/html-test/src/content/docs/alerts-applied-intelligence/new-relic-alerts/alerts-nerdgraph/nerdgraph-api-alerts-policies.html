
<p>You can manage your alerts policies using our GraphQL NerdGraph API. Here are some queries and mutations you can develop in our <a href="https://api.newrelic.com/graphiql">NerdGraph API explorer</a>.</p>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJ0aXAifV0=">
  <p>See the <a href="https://docs.newrelic.com/docs/apis/nerdgraph/get-started/introduction-new-relic-nerdgraph">NerdGraph introduction</a> for help getting started with NerdGraph API explorer.</p>
</div>
<h2>List and filter policies [#list-and-filter]</h2>
<p>The <code>policiesSearch</code> query allows you to paginate through all of your policies per account. It also allows some filtering functionality on the account policies.</p>
<div data-component="CollapserGroup" data-prop="W10=">
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoibGlzdC1hbGwtcG9saWNpZXMifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6Ikxpc3RpbmcgYWxsIHBvbGljaWVzIGZvciBhbiBhY2NvdW50In1d">
    <div data-prop-text="title">Listing all policies for an account</div>
    <p>Here's an example:</p>
    <pre><code>{
  actor {
    account(id: YOUR_ACCOUNT_ID) {
      alerts {
        policiesSearch {
          policies {
            id
            name
            incidentPreference
          }
        }
      }
    }
  }
}

</code></pre>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoicGFnaW5hdGUifSx7InR5cGUiOiJtZHhBdHRyaWJ1dGUiLCJuYW1lIjoidGl0bGUiLCJ2YWx1ZSI6IlBhZ2luYXRpbmcgdGhyb3VnaCBwb2xpY2llcyB3aXRoIGN1cnNvciBwYWdpbmF0aW9uIn1d">
    <div data-prop-text="title">Paginating through policies with cursor pagination</div>
    <p>In order to paginate through your policies, you must request the <code>nextCursor</code> field on your initial query.</p>
    <p>With cursor pagination, you continue to make a request through the result set until the <code>nextCursor</code> that is returned from the response comes back empty. This signifies that you reached the end of your results.</p>
    <p>Here's an example:</p>
    <pre><code>{
  actor {
    account(id: YOUR_ACCOUNT_ID) {
      alerts {
        policiesSearch {
          nextCursor
          policies {
            id
            name
            incidentPreference
          }
          totalCount
        }
      }
    }
  }
}

</code></pre>
    <pre><code>
{
  actor {
    account(id: YOUR_ACCOUNT_ID) {
      alerts {
        policiesSearch(cursor: "/8o0y2qiR54m6thkdgHgwg==:jZTXDFKbTkhKwvMx+CtsPVM=") {
          nextCursor
          policies {
            id
            name
            incidentPreference
          }
          totalCount
        }
      }
    }
  }
}

</code></pre>So, in your subsequent request, provide the cursor like so, until the cursor is empty:
    <pre><code>
{
  "data": {
    "actor": {
      "account": {
        "alerts": {
          "policiesSearch": {
            "nextCursor": "/8o0y2qiR54m6thkdgHgwg==:jZTXDFKbTkhKwvMx+CtsPVM=",
            "policies": [
              {
                "id": "3455",
                "incidentPreference": "PER_POLICY",
                "name": "First Policy Name"
              },
              {
                "id": "2123",
                "incidentPreference": "PER_POLICY",
                "name": "Another Policy"
              },
              // ... more policies here in reality
            ],
            "totalCount": 745
          }
        }
      }
    }
  }
}

</code></pre>The code above returns a set of results like this:
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiIn0seyJ0eXBlIjoibWR4QXR0cmlidXRlIiwibmFtZSI6InRpdGxlIiwidmFsdWUiOiJGaW5kIGFsbCBwb2xpY2llcyBieSBzZWxlY3RlZCBpZHMifV0=">
    <div data-prop-text="title">Find all policies by selected ids</div>
    <p>The API allows policy queries by a sub-select of ids. This will only return the information for these policies that you provide.</p>
    <pre><code>{
  actor {
    account(id: YOUR_ACCOUNT_ID) {
      alerts {
        policiesSearch(searchCriteria: {
          ids: [A_POLICY_ID, ANOTHER_POLICY_ID]
        }) {
          policies {
            id
            name
            incidentPreference
          }
        }
      }
    }
  }
}

</code></pre>
  </div>
  <div data-component="Collapser" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJpZCIsInZhbHVlIjoiZmluZC1ieS1pZCJ9LHsidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ0aXRsZSIsInZhbHVlIjoiRmluZCBwb2xpY3kgYnkgaWQifV0=">
    <div data-prop-text="title">Find policy by id</div>
    <p>The API lets you query by policy id:</p>
    <pre><code>{
  actor {
    account(id: YOUR_ACCOUNT_ID) {
      alerts {
        policy(id: YOUR_POLICY_ID) {
          id
          name
          incidentPreference
        }
      }
    }
  }
}

</code></pre>
  </div>
</div>
<h2>Create a policy</h2>
<p>In order to create a policy, supply a name and an <code>incidentPreference</code>.</p>
<p>The incident preference will configure how incidents get created for each condition created in the policy. For more information, refer to the documentation about <a href="https://docs.newrelic.com/docs/alerts/new-relic-alerts/configuring-alert-policies/specify-when-new-relic-creates-incidents">choosing your incident preference</a>.</p>
<pre><code>mutation {
  alertsPolicyCreate(accountId: YOUR_ACCOUNT_ID, policy: {
    name: "Your Policy Name"
    incidentPreference: PER_CONDITION
  }) {
    id
    name
    incidentPreference
  }
}
</code></pre>
<h2>Update a policy</h2>
<p>When you update a policy, note that you don't need to supply all of the attributes on the policy. For example, you only need to supply the name if you only intend to update the name:</p>
<pre><code>mutation {
  alertsPolicyUpdate(accountId: YOUR_ACCOUNT_ID, id: YOUR_POLICY_ID, policy: {
    name: "Updated Policy Name"
  }) {
    id
    name
    incidentPreference
  }
}
</code></pre>
<h2>Delete a policy</h2>
<p>You can delete policies via the NerdGraph API. Note that only the id may be requested back from a deleted resource:</p>
<pre><code>mutation {
  alertsPolicyDelete(accountId: YOUR_ACCOUNT_ID, id: YOUR_POLICY_ID) {
    id
  }
}
</code></pre>
