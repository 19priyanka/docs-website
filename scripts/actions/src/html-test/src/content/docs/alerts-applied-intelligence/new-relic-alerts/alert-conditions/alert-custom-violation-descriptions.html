
<p>For some types of conditions, you can define a custom violation description that passes useful information downstream for better violation responses or for use by other systems. You can create a custom violation description in the UI or with NRQL.</p>
<h2>Requirements</h2>
<p>The custom violation description feature is available for:</p>
<ul>
  <li>NRQL alert conditions</li>
  <li>Infrastructure monitoring alert conditions</li>
</ul>
<p>The custom violation description field has a maximum character size of 4000.</p>
<h2>What is a custom violation description? [#description]</h2>
<p>For some <a href="#requirements">types of conditions</a>, you can create a custom violation description that passes information about a condition and its violations downstream. Using a description, you can:</p>
<ul>
  <li>Capture the reason for the condition</li>
  <li>Define the signal being monitored</li>
  <li>Define next steps</li>
  <li>Add metadata to downstream systems</li>
</ul>
<p>The <strong>Custom violation description</strong> field allows you to use a general template structure that, when a violation is generated, <a href="#substitution-format">substitutes the generic sections with specific values</a>. For example, let's say you used this in a description:</p>
<pre><code>This is my condition name : {{conditionName}}
The hostname is : {{tag.fullHostname}}
</code></pre>
<p>A violation resulting from this condition would fill in the details and you'd receive a notification like this:</p>
<pre><code>This is my condition name : My Great Alert Condition
The hostname is : ip-123-45-67-89.us-west-1.compute.internal
</code></pre>
<h2>Create a custom violation description [#create-description]</h2>
<p>
  <img src="./images/alerts_condition_description_field.png" alt="Screen capture of the alerts condition description field used to pass useful, custom information along." title="The alerts condition description field with some example content.">
</p>
<p>In the <strong><a href="https://one.newrelic.com">one.newrelic.com</a></strong> top nav, click <strong>Alerts &#x26; AI</strong>, click <strong>Alert policies</strong>, <strong>(select a policy)</strong>, then <strong>(select a condition)</strong>: Click <strong>+ Add custom violation description</strong> to open the field.</p>
<p>For a condition, you can create a custom violation description using this field.</p>
<h2>Custom violation description template example [#example]</h2>
<p>Here's a custom violation description template example:</p>
<pre><code>this is my condition name : {{conditionName}}
The hostname is : {{tag.fullHostname}}
Owning Team: {{tag.label.owning_team}}
Product: {{tag.label.product}}
ec2VpcId: {{tag.aws.ec2VpcId}}
Service name : {{tag.label.Name}}
AWS Region : {{tag.aws.awsRegion}}
AWS Availability Zone: {{tag.aws.awsAvailabilityZone}}
Department : {{tag.label.department}}
Environment: {{tag.label.environment}}
Cluster: {{tag.clusterName}}
Cluster Role: {{tag.clusterRole}}
EC2 Instance Type: {{tag.instanceType}}
EC2 InstanceID: {{tag.aws.ec2InstanceId}}
EC2 AmiId: {{tag.aws.ec2AmiId}}
EC2 Root Device Type: {{tag.aws.ec2RootDeviceType}}
</code></pre>
<p>Here's how that data might appear in a notification:</p>
<p>
  <img src="./images/new-relic-alert-violation-description-screenshot.png" alt="New Relic alert violation description " title="new-relic-alert-violation-description-screenshot.png">
</p>
<h2>How to use attributes [#attributes-tags]</h2>
<p>The attributes you can use in a custom violation description are a subset of attributes attached to the <a href="/docs/alerts/new-relic-alerts/defining-conditions/violation-event-attributes">violation event</a>. Here are some details about the available attributes and how to use them:</p>
<ul>
  <li>
    <p>Violation event attributes: For any of the <a href="/docs/alerts/new-relic-alerts/defining-conditions/violation-event-attributes">standard attributes available for use in a custom violation description</a>, use the format <code>{{AN_ATTRIBUTE}}</code>. For example:</p>
    <pre><code>The target name is : {{targetName}}
</code></pre>
  </li>
  <li>
    <p>Tag attributes: For tags, you would use the format <code>{{tag.TAG_NAME}}</code>. There are two types of tags:</p>
    <ul>
      <li>
        <p>Entity-related tags: <strong>For Infrastructure conditions only.</strong> You can find available <a href="/docs/new-relic-one/use-new-relic-one/core-concepts/tagging-use-tags-organize-group-what-you-monitor#">entity-related tags</a> by going to the <a href="/docs/new-relic-one/use-new-relic-one/ui-data/new-relic-one-entity-explorer-view-performance-across-apps-services-hosts">New Relic One entity explorer</a> and looking under a service's <strong>Metadata and tags</strong>, or by viewing violation details. Here's an example of using tags in a custom violation description:</p>
        <pre><code>The AWS region is : {{tag.aws.awsRegion}}
Responsible team : {{tag.label.owning_team}}
</code></pre>
      </li>
      <li>
        <p>Facet clause tags: <strong>For NRQL conditions only.</strong> If a NRQL condition uses a FACET clause, you can use <code>tag</code> formatting to use those values in your custom violation description. For example, if the NRQL query included <code>FACET hostName, cluster</code>, you could then use this:</p>
        <pre><code>The host is : {{tag.hostName}}
The cluster is : {{tag.cluster}}
</code></pre>
      </li>
    </ul>
  </li>
</ul>
<p>Please note that tag names cannot include a whitespace. The expanded values can include a whitespace, but not the names of the tags themselves.</p>
<h2>Create a custom violation description with NRQL [#create-description-nrql]</h2>
<p>You can create a custom violation description using a NRQL alert condition by creating a mutation with a description.</p>
<p>Here's an empty mutation template:</p>
<pre><code>mutation {
     alertsNrqlConditionStaticUpdate(accountId: YOUR_ACCOUNT_ID, id: "YOUR_CONDITION_ID", condition: {description: ""}) {
       YOUR_CUSTOM_VIOLATION_DESCRIPTION
     }
    }
</code></pre>
<p>Here's an example mutation with a custom violation description:</p>
<pre><code>mutation {
     alertsNrqlConditionStaticUpdate(accountId: 123456, id: "123456", condition: {description: "timestamp : {{timestamp}} \n accountId : {{accountId}} \n type : {{type}} \n event : {{event}} \n description : {{description}} \n policyId : {{policyId}} \n policyName: {{policyName}} \n conditionName : {{conditionName}} \n conditionId : {{conditionId}} \n product : {{product}} \n conditionType : {{conditionType}} \n RunbookUrl : {{runbookUrl}} \n nrqlQuery : {{nrqlQuery}} \n nrqlEventType : {{nrqlEventType}} \n targetID : {{targetId}} \n targetName : {{targetName}} \n commandLine : {{tag.commandLine}} \n entityGuid : {{tag.entityGuid}} \n entityName : {{tag.entityName}} \n fullHostname : {{tag.fullHostname}} \n instanceType : {{tag.instanceType}} \n processDisplayName : {{tag.processDisplayName}}"}) {
       description
     }
    }
</code></pre>
<ul>
  <li>For more information on NRQL conditions and using the NerdGraph API, go to <a href="/docs/alerts/alerts-nerdgraph/nerdgraph-examples/nerdgraph-api-alerts-nrql-conditions">NerdGraph API: NRQL condition alerts</a>.</li>
  <li>For Infrastructure monitoring conditions, you can create the custom violation description when <a href="/docs/infrastructure/new-relic-infrastructure/infrastructure-alert-conditions/infrastructure-alerts-add-edit-or-view-host-alert-information">creating an Infrastructure monitoring alert condition</a>.</li>
  <li>To learn about how to structure a custom violation description, see the <a href="#example">example template</a> and the <a href="#attributes-tags">attribute/tag instructions</a>.</li>
</ul>
<h2>Mentioning users or notifying channel in Slack [#create-description-nrql]</h2>
<p>When creating a description that you know will be sent to <a href="/docs/alerts-applied-intelligence/new-relic-alerts/alert-notifications/notification-channels-control-where-send-alerts#slack">Slack</a>, you may wish to <strong>@mention</strong> a user or generate a channel-wide notification (e.g. <strong>@here</strong> or <strong>@channel</strong>). To achieve this, simply include the User ID or a channel-wide notification in the description surrounded by <code>&#x3C;</code> and <code>></code> characters.</p>
<p>Here's an example for mentioning a user:</p>
<pre><code>Attention &#x3C;@LewCirne>
</code></pre>
<p>Here's an example for generating a channel-wide notification:</p>
<pre><code>Attention &#x3C;!channel>
</code></pre>
<div data-component="Callout" data-prop="W3sidHlwZSI6Im1keEF0dHJpYnV0ZSIsIm5hbWUiOiJ2YXJpYW50IiwidmFsdWUiOiJpbXBvcnRhbnQifV0=">
  <p>Note that the Slack convention for channel-wide notifications in Incoming Webhooks is to use a <strong>!</strong> prefix instead of <strong>@</strong></p>
  <p>e.g. <strong>!here</strong> or <strong>!channel</strong></p>
</div>
<h2>For more help [#more_help]</h2>
<p>Recommendations for learning more:</p>
<ul>
  <li>To learn more about NerdGraph, see <a href="https://docs.newrelic.com/docs/apis/nerdgraph/get-started/introduction-new-relic-nerdgraph">Introduction to NerdGraph</a>.</li>
  <li>See the Docs site's Alerts <a href="https://docs.newrelic.com/docs/alerts">landing page</a>.</li>
  <li>Browse <a href="https://discuss.newrelic.com/c/telemetry-data-platform/alerts" title="Link opens in a new window.">New Relic's Explorers Hub</a> for community discussions about Alerts.</li>
  <li><a href="https://docs.newrelic.com/docs/accounts-partnerships/getting-started-new-relic/find-help-or-file-support-ticket">Find additional help or file a support ticket</a>.</li>
  <li>Review the <a href="https://docs.newrelic.com/docs/licenses/product-or-service-licenses/new-relic-alerts">Alerts licenses attributions</a>, <a href="https://docs.newrelic.com/docs/licenses/license-information/general-usage-licenses/new-relic-data-usage-limits-policies">data usage limits</a>, and <a href="https://docs.newrelic.com/docs/licenses/license-information">other notices</a>.</li>
</ul>
