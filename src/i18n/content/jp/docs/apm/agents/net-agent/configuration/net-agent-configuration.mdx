---
title: .NETエージェントの設定
tags:
  - Agents
  - NET agent
  - Configuration
metaDescription: 'How to configure the New Relic .NET agent using newrelic.config, including startup and instrumentation options, and disabling unwanted features.'
translationType: machine
---

[New Relic アカウント](https://newrelic.com/signup) (永久に無料です)を作成し、 [.NET エージェント](/docs/apm/agents/net-agent/installation/introduction-net-agent-install/) をインストールすると、お客様の環境に合わせて .NET エージェントを設定することができます。

## 設定概要 [#config-overview]

APMエージェントの設定オプションでは、エージェントの動作の一部を制御することができます。これらの設定オプションの中には、基本的なインストールプロセスの一部であるもの（ライセンスキーやアプリ名の設定など）もありますが、ほとんどは、ログレベルの設定、プロキシホストアクセスの設定、特定の属性の除外、分散型トレースの有効化など、より高度な設定です。

.NETエージェントは、 `newrelic.config` ファイルから設定を取得します。このファイルは、 [インストールプロセスの一部として生成されます。](/docs/agents/net-agent/installation/install-enable-new-relic-net-agent) 。デフォルトでは、グローバルな `newrelic.config` ファイルのみが作成されますが、アプリローカルな `newrelic.config` ファイルを作成して、複数アプリのシステムをより細かく制御することもできます。その他の設定方法としては、環境変数を使ったり、UIからサーバーサイドの設定を行ったりすることができます。各種の設定オプションや、何が何よりも優先されるかについては、 [Config settings precedence](/docs/agents/net-agent/configuration/net-agent-configuration#config-options-precedence) を参照してください。

.NET Frameworkと.NET Coreの両方をサポートする場合、特に断りがない限り、同じ構成オプションを使用し、同じAPM機能を備えています。

設定ファイルに変更を加え、それが正しい形式であるかどうかを検証したい場合は、任意のXSDバリデータを使って、XSDファイル（例えば、 `C:˶˙︶˙˵ ) と照合することができます。`

`IISの場合: newrelic.config または app.config ファイルを変更した後、管理用コマンドプロンプトから IISRESET を実行してください。ログレベルの調整はリセットを必要としません。

設定方法と優先順位レベル

インストール時、.NETエージェントの設定ファイル(newrelic.config)は、すべての監視対象アプリケーションに適用されますが、他の方法でエージェントを設定することもできます。以下の図は、異なる構成オプションが互いに優先されることを示しています。

この図は、.NETエージェントを構成するさまざまな方法について、優先順位を説明しています。

ここでは、図に示された設定方法の詳細と、その優先順位について説明します。

.NET構成

	

詳細と優先順位

web.config or app.config or appsettings.json

	

これらのファイルで設定された設定が最も優先されます。

ただし、ローカルまたはグローバルの newrelic.config でエージェントが無効になっている場合は、これらのファイルの NewRelic.AgentEnabled の設定は無視されます。




環境変数

	

2番目に高い優先順位です。これらの詳細については、 .NET環境変数 を参照してください。




サーバーサイドコンフィグレーション

	

3番目に高い優先順位です。 限られた数のサーバー側の構成 の設定が利用できます。その他の設定は、他の構成ソースから得られます。




アプリローカル newrelic.config

	

4番目に優先されます。アプリローカルの newrelic.config ファイルを作成して、マルチアプリシステムの個々のアプリを設定することができます。これらのローカル設定ファイルは、グローバルな newrelic.config ファイルの設定を上書きします。

エージェントは、以下のディレクトリにあるアプリローカルの設定ファイルを、この順番で探します。

web.config または app.config ファイルに NewRelic.ConfigFile プロパティで指定されたディレクトリ。

ウェブアプリのルートディレクトリ（ app.config または web.config)

アプリの実行ファイルがあるディレクトリ

なお、アプリローカルのコンフィグファイルは、XSDファイルに対して完全に検証されている必要があります（例えば、 C:ʻProgramDataNew Relic.NET Agent\newrelic.xsd for Windowsなど）。




デフォルト（グローバル） newrelic.config

	

デフォルトのソースで、優先順位は最も低い。他に設定ファイルがない場合、ホスト上のすべてのアプリケーションを設定します。グローバル設定ファイルは、New Relic エージェントのホームディレクトリにあります。 %PROGRAMDATA%\New Relic\.NET Agent

必要な環境変数

New Relic の .NET エージェントは、環境変数を頼りに .NET 共通言語ランタイム (CLR) に New Relic をプロセスにアタッチするように指示します。 .NET エージェントのインストール手順 (MSI インストーラなど)では、これらの変数を自動的に設定してくれるものもあれば、手動で設定しなければならない手順もあります。

セキュリティ上の推奨事項です。どのユーザがシステム環境変数を設定できるかを考慮する必要があります。また、ユーザの環境変数がシステムの環境変数を上書きしないように、アプリケーションを実行するアカウントを保護する必要があります。

.NET Frameworkの環境変数

.NET Frameworkの場合、以下の変数が必要です。

.NETエージェントのインストーラは、これらをIISに追加するか、システム全体の環境変数として追加します。

.NET Coreの環境変数

.NET Coreの場合、以下の変数が必要です。

Linuxです。

Windows：

.NETエージェントのインストーラは、これらをIISに追加するか、システム全体の環境変数として追加します。

" お使いのシステムで以前に（New Relic 以外の）監視サービスを使用していた場合、New Relic エージェントをインストールして使用しようとすると、"プロファイラーの競合が発生する可能性があります。詳細はこちらをご覧ください。

プロファイラーのコンフリクトに関する説明

New Relic の .NET エージェントは、環境変数を頼りに .NET 共通言語ランタイム (CLR) に New Relic をプロセスにロードするよう指示します。インストール関連の環境変数は Microsoft の変数であり、New Relic の変数ではありません。これらの変数は他の .NET プロファイラーによって使用される可能性があり、一度に一つのプロセスに接続できるプロファイラーは一つだけです。このため、以前のアプリケーションモニタリング製品を使用していた場合、 プロファイラーの競合が発生する可能性があります。.

具体的なインストール方法については、 .NETエージェントのインストールドキュメント をご覧ください。

オプションの環境変数

New Relic の .NET エージェントの設定オプションの中には、設定ファイルで設定する代わりに、環境変数で設定できるものがあります。以下に、.NETエージェントで認識される環境変数のリストと値の例を示します。

New Relic APM と CodeStream を使用している場合は、 How to associate repositories と How to associate build SHA or release tags with errors inbox を参照してください。

セットアップオプション、newrelic.config

これらのオプションを使用して、newrelic.config ファイルを介してエージェントのセットアップと設定を行います。New Relic .NET エージェントは、以下のカテゴリの設定オプションをサポートしています。

構成要素サービス要素重要な要素の隠蔽プロキシ要素ログエレメントアプリケーション要素（構成）データ伝送素子ホスト名
構成要素

設定文書のルート要素は、 設定 要素です。

設定 要素は、以下の属性をサポートしています。

agentEnabled

タイプ

	

ブール値




デフォルト

	

true

New Relic エージェントを有効または無効にします。

maxStackTraceLines

タイプ

	

整数




デフォルト

	

80

任意のスタックダンプでトレースするスタックフレームの最大数です。

タイミング精度

タイプ

	

文字列




デフォルト

	

ロー

タイマーの精度をコントロールします。高精度であれば、より良いデータが得られますが、実行速度は低下します。可能な値は high と low です。

サービス要素

configuration 要素の最初の子は、 service 要素です。service 要素は、エージェントの New Relic サービスへの接続を設定します。

サービス 要素は、以下の属性をサポートしています。

licenseKey （必須）

タイプ

	

文字列




デフォルト

	

(なし)

あなたの New Relic ライセンスキー 。New Relic はライセンスキーを使用して、アプリのデータを UI で正しいアカウントに照合します。環境変数でライセンスキーを設定します。

または、アプリケーションの環境で NEW_RELIC_LICENSE_KEY 環境変数を設定してください。

sendEnvironmentInfo

タイプ

	

ブール値




デフォルト

	

true

実行環境情報を記録するようにエージェントに指示します。環境情報には、オペレーティングシステム、エージェントのバージョン、どのアセンブリが利用可能かなどが含まれます。

syncStartup

タイプ

	

ブール値




デフォルト

	

false

エージェントが New Relic に接続するまでアプリケーションの起動をブロックします。 true に設定すると、New Relic への接続が完了するまでブロックされるため、最初のトランザクションが完了するまでに大幅に時間がかかることがあります。

sendDataOnExit

タイプ

	

ブール値




デフォルト

	

false

エージェントが最後の収穫サイクルを開始し、すべてのデータをNew Relicに送信する間、アプリケーションのシャットダウンをブロックします。

sendDataOnExitThreshold

タイプ

	

整数




デフォルト

	

60000




ユニット

	

ミリ秒

エージェントがプロセスのシャットダウンをブロックする前に、プロセスを実行しなければならない最小時間。この設定は、 sendDataOnExit is true の場合にのみ適用されます。

completeTransactionsOnThread

タイプ

	

ブール値




デフォルト

	

false

falseの場合、エージェントはプールのスレッドを使用してトランザクション処理を完了します。

trueの場合、エージェントはリクエストスレッドでトランザクション処理を完了します。

リクエストタイムアウト

タイプ

	

整数




デフォルト

	

2000 ( sendDataOnExit enabled)

120000 ( sendDataOnExit disabled)




ユニット

	

ミリ秒

New Relic と通信する際のエージェントのリクエストタイムアウト。

オートスタート

タイプ

	

ブール値




デフォルト

	

トゥルー

インスツルメンテーションされた最初のメソッドがヒットしたときに、自動的に.NETエージェントを起動します。

重要な要素の隠蔽

obscuringKey 要素は、 service 要素のオプションの子です。.NETエージェントはこの値を使用して、サポートされている設定値を難読化します。たとえば、 難読化されたプロキシ パスワード が供給されると、このキーを使用して難読化が解除されます。

また、 NEW_RELIC_CONFIG_OBSCURING_KEY 環境変数を設定することで、不明瞭化キーを設定することもできます。

セキュリティ上の推奨事項です。難読化された値と同じ設定ファイルに難読化キーを配置することは、セキュリティ上のリスクがあります。隠蔽キーを環境変数に置き、環境変数へのアクセスを環境内で制限することを検討してください。

プロキシ要素

proxy 要素は、 service 要素のオプション子です。 proxy 要素は、エージェントがプロキシを介して New Relic のバックエンドサービスと通信する際に使用します。

プロキシ 要素は以下の属性をサポートしています。

ホスト

タイプ

	

文字列




デフォルト

	

(なし)

プロキシホストを定義します。

port

タイプ

	

整数




デフォルト

	

8080

プロキシポートを定義します。

uriPath

タイプ

	

文字列




デフォルト

	

(なし)

必要に応じて、プロキシURIのパスを定義します。

ドメイン

タイプ

	

文字列




デフォルト

	

(なし)

必要に応じて、プロキシサーバーでの認証に使用するドメインを定義します。

ユーザー

タイプ

	

文字列




デフォルト

	

(なし)

必要に応じて、認証用のユーザー名を定義します。

パスワード

タイプ

	

文字列




デフォルト

	

(なし)

必要に応じて、認証用のパスワードを定義します。

パスワード難読化

タイプ

	

文字列




デフォルト

	

(なし)

さらにセキュリティを高めるために、.NET エージェントは passwordObfuscated 属性を持つ難読化されたプロキシパスワードの使用をサポートしています。難読化されたプロキシパスワードは、以下の New Relic CLI コマンドを使用して生成されます。

難読化されたプロキシのパスワードを使用する場合は、 難読化キー も設定する必要があります。

ログエレメント

log 要素は、 configuration 要素の子要素です。 log 要素は、New Relic のロギングを設定します。エージェントは独自のログファイルを生成し、アプリケーションのログからログ情報を分離します。

ログ 要素は、以下の属性をサポートしています。

level

タイプ

	

文字列




デフォルト

	

情報

ログファイルに記録される詳細レベルを定義します。設定可能な値は、詳細度の高い順に以下のとおりです。

off

エラー

警告

情報

デバッグ

finest

すべて

または、アプリケーションの環境で NEWRELIC_LOG_LEVEL 環境変数を設定してください。

ログレベルを上げると、New Relic のパフォーマンスへの影響が大きくなります。

監査ログ

タイプ

	

ブール値




デフォルト

	

false

New Relicとの間で送受信されたすべてのデータを、auditlogログファイルと標準ログファイルの両方に記録します。

コンソール

タイプ

	

ブール値




デフォルト

	

false

ログファイルに加えて、コンソールにもログメッセージを送信します。

ディレクトリ

タイプ

	

文字列




デフォルト

	

C:ProgramData\New Relic\.NET Agent\Logs

エージェントが生成したログファイルを格納するディレクトリです。省略した場合は、New Relicエージェントのインストール領域にある logs という名前のディレクトリがデフォルトで使用されます。

ファイル名

タイプ

	

文字列




デフォルト

	

(なし)

ログファイルの名前を定義します。 fileName を定義しない場合は、監視するプロセスの名前から派生した名前になります。

または、アプリケーションの環境で NEW_RELIC_LOG 環境変数を設定してください。

応募要素（必須）

application 要素は、 configuration 要素の子要素です。この必須要素では、アプリケーション名を定義し、サンプリングを無効または有効にします。

name

タイプ

	

文字列




デフォルト

	

私の応募作品

あなたの .NET アプリケーションの 名前 は、 アプリケーション 要素の子です。New Relic は、この名前に基づいてデータを集約します。たとえば、 AppA と AppB という名前の2つの実行中のアプリケーションがある場合、New Relic のインターフェイスには AppA と AppB という2つのアプリケーションが表示されます。

また、アプリには3つまでの名前 を割り当てることができます。最初の名前はプライマリーネームです。例えば、以下のようになります。

または、アプリケーションの環境で NEW_RELIC_APP_NAME 環境変数を設定してください。

disableSamplers

タイプ

	

ブール値




デフォルト

	

false

サンプラーは、メモリとCPUの消費に関する情報を収集します。サンプリングを無効にするには、これを true に設定します。

または、アプリケーションの環境で NEW_RELIC_DISABLE_SAMPLERS 環境変数を設定してください。

データ伝送素子

dataTransmission 要素は、 configuration 要素の子要素です。この要素は、New Relic へのデータの送信方法に影響を与えるもので、特定のデータ送信要件がある場合に使用します。

dataTransmission 要素は、以下の属性をサポートしています。

putForDataSend

タイプ

	

ブール値




デフォルト

	

false

New Relic にデータを送信する際に使用する HTTP メソッドを定義します。これを true に設定すると、データ送信時に PUT メソッドを使用できるようになります。デフォルトでは POST メソッドが使用されます。

ホスト名

APM UI のデフォルトのホスト名ラベルが有用でない場合、New Relic UI でその名前を表示名で装飾することができます。アプリケーションのプロセスが再起動され、.NET エージェントが再びレポートすると、表示名が サーバー のドロップダウンリストに表示されます。このホスト名の設定は、 アプリケーションの Summary ページ のホストリストには影響しません。

表示名を設定するには、次のいずれかのオプションを選択します。環境変数は、コンフィグファイルの値よりも優先されます。その後、アプリケーションを再起動すると、New Relic UI に変更内容が表示されます。

コンフィグファイルによる設定

displayName 属性を、 newrelic.config の processHost 要素に設定します。 processHost 要素は、 configuration 要素の子です。

環境変数による設定

NEW_RELIC_PROCESS_HOST_DISPLAY_NAME 環境変数を設定します。

クラウドプラットフォームの利用

utilization 構成要素を設定し、エージェントが利用率情報を収集し、価格を決定するためにNew Relicサービスに送信する方法を制御します。エージェントは、Amazon Web Services (AWS) の EC2 インスタンス、Docker コンテナ、Azure、Google Cloud Platform、Pivotal Cloud Foundry、Kubernetes から情報を収集できます。

detectAws

タイプ

	

ブール値




デフォルト

	

true

エージェントがAWSメタデータAPIをポーリングするかどうかを決定します。

detectAzure

タイプ

	

ブール値




デフォルト

	

true

エージェントがAzure metadata APIをポーリングするかどうかを決定します。

検出GCP

タイプ

	

ブール値




デフォルト

	

true

エージェントが GCP メタデータ API をポーリングするかどうかを決定します。

detectPcf

タイプ

	

ブール値




デフォルト

	

true

エージェントが環境変数からPCF情報をポーリングするかどうかを決定します。

ドッカーの検出

タイプ

	

ブール値




デフォルト

	

true

エージェントがDocker情報をファイルシステムから読み取るかどうかを決定します。

Kubernetesの検出

タイプ

	

ブール値




デフォルト

	

true

エージェントが環境変数からKubernetesの情報をポーリングするかどうかを決定します。

インストゥルメンテーションのオプション

これらのオプションを使用して、アプリケーションや環境のどの要素をインスツルメンテーションするかを設定します。New Relic for .NET は、以下のカテゴリの計測オプションをサポートしています。

計装要素アプリケーションエレメント（計測器）属性要素
計装要素

instrumentation 要素は、 configuration 要素の子です。デフォルトでは、.NETエージェントは、IIS aspワーカープロセスとAzure Webおよびワーカーロールをインスツルメンテーションします。他のプロセスをインスツルメンテーションするには、 カスタムアプリケーションのインスツルメンテーション を参照してください。

アプリケーションエレメント（計測器）

applications 要素は、 instrumentation 要素の子です。applications 要素は、インストルメントを行う非ウェブ・アプリケーションを指定します。これには name 属性が含まれます。

これは、 application (configuration) 要素の 子であり、 configuration 要素とは異なります。

属性要素

属性とは、イベントやトランザクションのプロパティを決定するキーと値のペアのことです。各属性は、APM トランザクション トレース、APM エラー トレース、Transaction イベント、TransactionError イベント、または PageView イベントに送信されます。primary attributes 要素は、.NETエージェントの属性収集を有効または無効にし、収集または除外する特定の属性を定義します。また、属性の設定は、その宛先に基づいて構成することができます。 エラーコレクション 、 トランザクショントレース 、 ブラウザインスツルメンテーション 、 トランザクションイベント 。

この例では、エージェントは、キーが myApiKey (myApiKey.bar, myApiKey.value) で始まるすべての属性を除外しますが、カスタム属性 myApiKey.foo を収集します。

.NET APM の属性は、 .NET エージェントの属性 のページで確認できます。また、エージェントAPIコールでカスタム属性を定義することもできます。 AddCustomAttribute .

enabled

タイプ

	

ブール値




デフォルト

	

true

属性収集を有効または無効にする。primary attribute 要素で false に設定すると、この設定は個々の宛先のすべての属性設定を上書きします。

include

タイプ

	

文字列




デフォルト

	

(なし)

属性が有効な場合、エージェントはこのリストで指定されたすべての属性キーを収集します。複数の属性キーを指定するには、それぞれを個別に指定します。また、 * ワイルドカード文字をキーの最後に使用して、複数の属性にマッチさせることもできます（例： myApiKey.* ）。詳しくは、 属性のルール をご覧ください。

exclude

タイプ

	

文字列




デフォルト

	

(なし)

属性が有効な場合、エージェントはこのリストで指定された属性キーを収集しません。複数の属性キーを指定するには、それぞれを個別に指定します。また、 * ワイルドカード文字をキーの最後に使用して、複数の属性にマッチさせることもできます（例： myApiKey.* ）。詳しくは、 属性のルール をご覧ください。

機能オプション

これらのオプションを使用して、New Relic の機能を有効、無効、および設定します。New Relic for .NET では、以下の機能を設定することができます。

アプリ・プールクロスアプリケーショントレースエラー収集ハイセキュリティモード例外メッセージの除去Transactionイベントカスタムイベントカスタムパラメータタグ/ラベルブラウザのインストゥルメンテーションスロークエリトランザクショントレースデータストアトレーサーディストリビューティッド（分散）トレーシングスパンイベントHTTPリクエストヘッダの取得
アプリ・プール

これは、システムの グローバルコンフィグファイル にのみ適用されます。

applicationPools 要素は、 configuration 要素の子です。 applicationPools 要素は、プロファイラが計測するアプリケーションプールを正確に指定し、IIS アプリケーションプール名と同じ名前を使用します。この構成要素は、アプリプールの一部のみを測定する必要がある場合に便利です。たとえば、あるサーバーには数百のアプリケーションプールがありますが、.NET エージェントで計測する必要があるのは、そのうちのいくつかのプールだけです。

ここでは、特定のアプリケーションプールに対するインスツルメンテーションを無効にする例を示します。

ここでは、現在サーバー上で実行されているすべてのアプリケーションプールのインスツルメンテーションを無効にし、特定のアプリケーションプールのインスツルメンテーションを有効にする例を示します。

applicationPools 要素は、以下の要素をサポートしています。

defaultBehavior

タイプ

	

ブール値




デフォルト

	

false

IISを介して提供されるアプリケーションプールに対して、.NETエージェントが"グローバル" レベルでどのように動作するかを定義します。.NETエージェントは、デフォルトですべてのアプリケーションプールを計測します。 true の場合、 applicationPool の下にリストされ、 instrument 属性が false に設定されているアプリケーションプールは、インスツルメンテーションされません。

基本的に、 false に設定すると、アプリケーションプールリストは許可リストとして動作します。 true に設定すると、アプリケーションプールリストは拒否リストとして動作します。

アプリケーションプール

特定のアプリケーションプールに対するインスツルメンテーション動作を定義します。 name 属性には、アプリケーションプールの名前を指定します。 instrument 属性でプロファイリングを有効または無効にします。 name 属性でこのアプリケーションを定義します。

クロスアプリケーショントレース

crossApplicationTracer 要素は、 configuration 要素の子です。 crossApplicationTracer は、アプリケーション間でトランザクショントレースをリンクします。" サービス指向アーキテクチャーでリンクされると、HTTPで相互に通信するすべてのインスツルメンテッド・アプリケーションは、"トランザクション・トレースを、それらが呼び出すアプリケーションと、それらが呼び出されるアプリケーションとにリンクするようになります。 クロス・アプリケーション・トレーシング は、サービスとアプリケーションの間のパフォーマンスの関係を理解することを容易にします。

crossApplicationTracer 要素は以下の属性をサポートしています。

enabled

タイプ

	

ブール値




デフォルト

	

true

クロスアプリケーショントレースの有効化・無効化

エラー収集

errorCollector 要素は、 configuration 要素の子要素です。 errorCollector は、キャッチされなかった例外に関する情報を取得し、New Relic に送信するエラーコレクションを設定します。

APMでのエラー設定の概要については、APMでのエラーの管理を参照してください。

expectedClasses, expectedMessages, and expectedStatusCodes の構成設定には、 .NETエージェントバージョン8.31.0.0以上が必要です.

errorCollector 要素は、以下の要素と属性をサポートしています。

enabled

タイプ

	

ブール値




デフォルト

	

true

エラーコレクターを有効または無効にします。

captureEvents

タイプ

	

ブール値




デフォルト

	

true

エラーイベントの取り込みを有効または無効にします。

maxEventSamplesStored

タイプ

	

整数




デフォルト

	

100

エラー発生時のリザーバーリミット

ignoreClasses

無視される完全修飾クラス名のリストです。 SHOULD 報告されるべきエラークラスとメッセージの組み合わせの最大数は50です。50以上のリストがある場合は、最初の50 SHOULD だけが使用されます。

ignoreMessages

完全に修飾されたクラス名から、エラーのメッセージの部分文字列にマッチする文字列のリストへの、オプションのマップです。 SHOULD 報告されるエラークラスとメッセージの組み合わせの最大数は50です。50以上のリストがある場合は、最初の50 SHOULD のみが使用されます。

ignoreErrors (廃止されました)

タイプ

	

文字列




デフォルト

	

(なし)

New Relic に報告しない特定の例外をリストアップします。例外の完全な名前を使用する必要があります。例えば、 System.IO.FileNotFoundException のように。

ignoreStatusCodes

タイプ

	

文字列




デフォルト

	

(なし)

New Relic に報告しない特定の HTTP エラーコードを列挙します。401 だけのような標準的な積分 HTTP エラーコードを使用することもできますし、401.4 や 403.18 のような小数点を含む Microsoft の完全なステータスコードを使用することもできます。ステータスコードは400以上でなければなりません。

エージェントの NoticeError() API で報告されたカスタムエラーは、関連するトランザクションがここで設定された HTTP ステータスコードを持っていても、New Relic に報告されます。

予想されるクラス

期待通りとマークされる完全修飾クラス名のリストです。 SHOULD 報告されるべきエラークラスとメッセージの組み合わせの最大数は50です。50以上のリストがある場合は、最初の50 SHOULD のみが使用されます。

期待されるメッセージ

完全に修飾されたクラス名から、エラーのメッセージの部分文字列にマッチする文字列のリストへの、オプションのマップです。 SHOULD 報告されるエラークラスとメッセージの組み合わせの最大数は50です。50以上のリストがある場合は、最初の50 SHOULD のみが使用されます。

expectedStatusCodes

ステータスコードのコンマ区切りのリストです。リストには整数の範囲を含めることができ、ダッシュ（-）を使用して、範囲内の開始と終了の両方の整数を含みます。

属性

このサブエレメントは、エラートレースのエージェント属性設定をカスタマイズするために使用します。このサブエレメントは、プライマリの attributes エレメントと同じ設定を使用します。 enabled , include , and exclude .

ハイセキュリティモード

highSecurity 要素は、 configuration 要素の子です。 ハイセキュリティモードを有効にするには 、このプロパティを true に設定し、New Relic のユーザーインターフェイスでハイセキュリティプロパティを有効にします。ハイセキュリティを有効にすると、SSL がオンになり、リクエストパラメーター、カスタムパラメーター、HTTP リクエストヘッダーが収集されず、ストリップ例外メッセージが有効になり、クエリを生のまま New Relic に送信することができなくなります。

enabled

タイプ

	

ブール値




デフォルト

	

false

ハイセキュリティモードを有効または無効にします。例を示します。

例外メッセージの除去

stripExceptionMessages 要素は、 configuration 要素の子です。例外メッセージのストリップを有効にするには、このプロパティを true に設定します。デフォルトでは、これは false に設定されており、エージェントはすべての例外からのメッセージを New Relic のコレクターに送信します。ハイセキュリティモードを有効にすると、これは自動的に true に変更され、エージェントは例外からのメッセージをストリップします。

enabled

タイプ

	

ブール値




デフォルト

	

false

ストリップの例外メッセージを有効または無効にします。例

Transactionイベント

transactionEvents 要素は、 configuration 要素の子です。 transactionEvents を使用して、トランザクション・イベントを構成します。

transactionEvents 要素は以下の属性をサポートしています。

enabled

タイプ

	

ブール値




デフォルト

	

true

イベントレコーダーの有効化、無効化を行います。

maximumSamplesStored

タイプ

	

整数




デフォルト

	

10000

一度にメモリーに保存するサンプル数の最大値。

または、アプリケーションの環境で MAX_TRANSACTION_SAMPLES_STORED 環境変数を設定してください。

属性

このサブエレメントを使用して、トランザクション・イベントのエージェント属性設定をカスタマイズする。このサブエレメントは、プライマリの attributes エレメントと同じ設定を使用します： enabled , include , and exclude .

これらの属性設定は、 トランザクション イベントに固有のものです。属性設定は、すべてのイベントタイプにグローバルに適用することができます。この構成設定を使って に 。

分散トレーシングや無限トレーシングが有効な場合、トランザクションイベントからの情報は、そのトランザクションのルートのスパンイベントに適用されます。トランザクション・イベントの属性設定をスパン・イベントに適用したり、グローバル属性設定として適用することを検討してください。

カスタムイベント

customEvents 要素は、 configuration 要素の子です。 customEvents を使用して、 カスタムイベント を設定します。

CustomEvents 要素は以下の属性をサポートしています。

enabled

タイプ

	

ブール値




デフォルト

	

true

イベントレコーダーの有効化、無効化を行います。

maximumSamplesStored

タイプ

	

整数




デフォルト

	

10000

一度にメモリーに保存するサンプル数の最大値。

または、アプリケーションの環境で MAX_EVENT_SAMPLES_STORED 環境変数を設定してください。

カスタムパラメータ

customParameters 要素は、 configuration 要素の子です。 customParameters を使用して、 カスタムパラメーター を設定します。

CustomParameters 要素は、以下の属性をサポートしています。

enabled

タイプ

	

ブール値




デフォルト

	

true

カスタムパラメーターの取り込みを有効または無効にします。

ラベル（タグ）

labels 要素は、 configuration 要素の子です。

これは、 タグ の名前と値を設定するものです。リストは、コロンで区切られた名前と値のペアのセミコロン区切りのリストです。 NEW_RELIC_LABELS 環境変数と一緒に使うこともできます。例

ブラウザのインストゥルメンテーション

browserMonitoring 要素は、 configuration 要素の子です。 browserMonitoring は、.NET アプリケーションのブラウザ監視を設定します。ブラウザは、エンドユーザーのパフォーマンス体験を把握することができます。これは、各ページのヘッダーとフッターに少量のJavaScriptコードを注入することで、ユーザーのブラウザがウェブページをダウンロードしてレンダリングするまでの時間を測定することで実現しています。

browserMonitoring 要素は以下の属性をサポートしています。

オートインストゥルメント

タイプ

	

ブール値




デフォルト

	

true

デフォルトでは、エージェントはブラウザエージェントのJavaScriptを自動的に注入します。自動注入をオフにするには、この属性を false に設定してください。

属性

このサブエレメントを使用して、 ブラウザモニタリング のエージェント属性設定をカスタマイズします。このサブエレメントは、主要な attributes エレメントと同じ設定を使用します： enabled , include , and exclude 。

requestPathsExcluded

特定のページにブラウザエージェントが注入されないようにするには、このサブエレメントを使用します。この要素の使い方は以下の通りです。

このエージェントは、URL が指定された正規表現のいずれかに一致するページにブラウザエージェントを注入しません。正規表現は、 Microsoft Guidelines for the Regex class に従ってください。

これは、アプリケーション内のパスの仮想ディレクトリへの参照であり、除外したいパスの完全なURLではありません。たとえば、 https://www.mywebsite.com/mywebpages/ のページを除外するには、 /mywebpages/ をパス正規表現の値として挿入するだけです。

requestPathsExcluded 要素は、 DisableBrowserMonitoring() 呼び出しを使用することが不可能または望ましくない場合に使用する必要があります。パフォーマンスへの影響を最小限に抑えるために、正規表現はできるだけ少なくし、できるだけシンプルにしてください。

問い合わせの遅さ

slowSql 要素は、 configuration 要素の子要素です。 slowSql configuration は、遅いクエリの実行に関する情報をキャプチャーし、これらのクエリの説明プランをキャプチャーして難読化します。

slowSql 要素は以下の属性をサポートしています。

enabled

タイプ

	

ブール値




デフォルト

	

true

スロークエリートレースを有効または無効にします。

トランザクショントレース

transactionTracer 要素は configuration 要素の子です。 transactionTracer configures transaction traces.トレースに含まれるのは、発行されたクエリ ステートメントを含む、トランザクションの正確なコール シーケンスです。

transactionTracer 要素は以下の属性をサポートしています。

enabled

タイプ

	

ブール値




デフォルト

	

true

トランザクション トレースの有効化または無効化.

トランザクションスレッショルド

タイプ

	

文字列




デフォルト

	

apdex_f

トランザクションをトレースするための閾値を定義します。トランザクションにかかる時間がしきい値より長ければ、トレースの対象となります。トレースに関するルールについては、 transaction trace basics を参照してください。

デフォルト値は apdex_f で、アプリケーションの apdex_t の値の4倍を閾値としています。 apdex_t の詳細については、 Apdex を参照してください。

また、しきい値をミリ秒単位の特定の時間値に設定することもできます。

recordSql

タイプ

	

文字列




デフォルト

	

obfuscated

クエリのトレース・ポリシーを選択します。オプションは、 off （何も記録しない）、 obfuscated （難読化されたバージョンのクエリを記録する）、 raw （データベースに発行されたままのクエリを記録する）です。

生のクエリを記録することで、機密情報を取得できる可能性があります。

explainEnabled

タイプ

	

ブール値




デフォルト

	

false

true の場合、エージェントは遅いクエリに対して EXPLAIN 文をキャプチャします。

explainThreshold

タイプ

	

整数




デフォルト

	

500




ユニット

	

ミリ秒

エージェントは、この閾値を超えたクエリの低速クエリデータ を、利用可能な説明プランとともに、トランザクショントレースの一部として収集します。

maxSegments

タイプ

	

整数




デフォルト

	

3000

トランザクション・トレースで収集するセグメントの最大数です。

maxExplainPlans

タイプ

	

整数




デフォルト

	

20

1回の収穫サイクルで収集する説明プランの最大数です。

maxStackTrace

タイプ

	

整数




デフォルト

	

0

デフォルトでは maxStackTrace は0に設定されており、トランザクショントレースの一部としてスタックトレースを無効にします。この値が0より大きく設定されている場合は、トランザクショントレースのためにスタックトレースがキャプチャされます。

属性

このサブエレメントは、トランザクショントレースのエージェント属性設定をカスタマイズするために使用します。このサブエレメントは、プライマリの attributes エレメントと同じ設定を使用します： enabled , include , and exclude .

データストアトレーサー

datastoreTracer 要素は、 configuration 要素の子です。

datastoreTracer 要素は、以下のサブ要素をサポートしています。

instanceReporting

このサブエレメントを使用して、 いくつかのデータベースドライバー のデータストアインスタンスメトリクス（ホストやポートなど）の収集を有効にします。これらは、低速のクエリ・トレースやトランザクション・トレースで報告されます。属性 enabled のデフォルト値は true です。

databaseNameReporting

このサブエレメントを使用して、 一部のデータベースドライバのスロークエリストレースとトランザクショントレースでデータベース名の収集を有効にします 。属性 enabled のデフォルト値は true です。

queryParameters

このサブエレメントを使用して、低速のクエリ・トレースでSQLクエリ・パラメータの収集を有効にします。属性のデフォルト値は、 enabled false です。

クエリのパラメータを記録すると、機密情報が取得される可能性があります。transactionTracer.recordSql 設定オプションが raw に設定されていないと、このオプションは無視されます。
ディストリビューティッド（分散）トレーシング

distributedTracing 要素は、 configuration 要素の子です。

分散トレーシングでは、リクエストが分散システムを通過する際のパスを確認することができます。 分散型トレース を有効にすると、 クロスアプリケーショントレース が無効になり、APM 機能にも影響があります。有効にする前に、 プランニングガイド をお読みください。

Requires .NET agent version 8.6.45.0 or higher.

distributedTracing 要素は以下の属性をサポートしています。

有効または無効にするには、 Enable distributed tracing を参照してください。

enabled

タイプ

	

ブール値




デフォルト

	

false

または、アプリケーションの環境変数 NEW_RELIC_DISTRIBUTED_TRACING_ENABLED で分散型トレーシングを有効にします。

excludeNewrelicHeader

タイプ

	

ブール値




デフォルト

	

false

デフォルトでは、サポートされているバージョンのエージェントは、 newrelic ヘッダと W3C Trace Context ヘッダの両方を分散型トレーシングに利用します。 newrelic distributed tracing header は、W3C Trace Context headers をサポートしていない古いエージェントとの相互運用を可能にします。W3C Trace Context ヘッダをサポートしているエージェントのバージョンでは、 newrelic ヘッダよりも優先して分散型トレーシングを行います。

newrelicヘッダーを使用しない場合、これをtrueに設定すると、エージェントがnewrelicヘッダーを除外し、ディストリビューティッド（分散）トレーシング用のW3Cトレースコンテキストヘッダーのみを使用するようになります。

分散型トレーシングはスパンイベントを報告します。スパンイベントのレポートはデフォルトで有効ですが、 ディストリビュートトレース スパンをレポートするためには有効にする必要があります。スパンイベントを無効にするには、次のいずれかのオプションを選択します。

設定ファイルによるスパンイベントの無効化

< spanEvents> 要素を false に設定して、newrelic.config ファイルで無効にします。この要素は、 < 設定> 要素の子要素です。

環境変数によるスパンイベントの無効化

アプリケーションの環境に NEW_RELIC_SPAN_EVENTS_ENABLED 環境変数を設定します。

無限トレーシング

Infinite Tracing は、エージェントの外部にあるトレースオブザーバーを採用することで、分散型トレースサービスを拡張しています。様々なサービスにまたがるアプリケーションのトレースを100%観測し、実用的なデータを提供することで、問題をより早く解決することができます。

Infinite Tracing をオンにするには、 .NET agent version 8.30 以上 を使用し、 distributed tracing を有効にします。そして、以下の追加設定を行います。

無限のトレーススパンは、 transactionTracer.maxSegments の設定で制限することができます。

infiniteTracing 要素は以下の要素をサポートしています。

トレース_オブザーバー

trace_observer 要素は、エージェントから独立したオブザーバーホストを識別します。Infinite Tracing の有効なトレースオブザーバーホストエントリを取得する方法については、 Find or create a trace observer endpoint を参照してください。

トレースオブザーバーは、 NEW_RELIC_INFINITE_TRACING_TRACE_OBSERVER_HOST 環境変数を使って設定することもできます。

トレース・オブザーバーを設定するときには、ホストの一部としてプロトコルを指定してはいけません。たとえば、 https://myhost.infinitetracing.com の代わりに myhost.infinitetracing.com を使用してください。

スパンイベント

spanEvents 要素は、 configuration 要素の子です。 spanEvents を使用して、スパンイベントを設定します。

spanEvents 要素は以下の属性をサポートしています。

enabled

タイプ

	

ブール値




デフォルト

	

true

イベントレコーダーの有効化、無効化を行います。

maximumSamplesStored

タイプ

	

Int




デフォルト

	

2000

一度にメモリに保存するサンプル数の最大値です。これは、 NEW_RELIC_SPAN_EVENTS_MAX_SAMPLES_STORED 環境変数を使って設定することもできます。

この設定オプションは、.NET Agent v9.0以降でのみ利用可能です。

属性

このサブエレメントは、スパンイベントのエージェント属性設定をカスタマイズするために使用します。このサブエレメントは、プライマリの attributes エレメントと同じ設定を使用します： enabled , include , and exclude .

これらの属性設定は、スパンイベントに固有のものです。属性設定は、すべてのイベントタイプにグローバルに適用することができます。この構成設定で 。

HTTPリクエストヘッダの取得

allowAllHeaders 要素は、 configuration 要素の子です。これを true に設定すると、.NETエージェントがすべてのHTTPリクエストヘッダーを request.headers.{http-header-name}として取り込むことができます。 属性です。これを false に設定すると、.NETエージェントが以下のHTTPリクエストヘッダを収集することのみを許可します。

enabled

タイプ

	

ブール値




デフォルト

	

false

HTTPリクエストヘッダのキャプチャを有効または無効にします。例を示します。

allowAllHeaders 設定は、.NETエージェントのバージョン8.40.0+でのみ利用可能です。 allowAllHeaders を使用して属性をキャプチャする場合、キャプチャされたリクエストヘッダー属性は、ルートレベルと宛先レベルの 属性 の設定によって制御されたままです。 request.header.* を attributes 要素の下の include リストに設定しないと、.NET Agent はすべてのヘッダー属性をフィルタリングしてしまいます。デフォルトの newrelic.config は、 request.header.* を含めるように設定されています。

また、デフォルトの newrelic.config では、.NETエージェントが不要なデータを収集しないように、以下のHTTPリクエストヘッダを明示的に除外するように設定されています。

app.configまたはweb.configでの設定

ASP.NETおよび.NET Frameworkのコンソールアプリの場合、アプリの app.config または web.config の一番外側の要素内で、 < configuration> で以下の設定を行うこともできます。

エージェントの有効化・無効化

ローカルまたはグローバルの newrelic.config でエージェントが無効になっている場合、これらのファイルにある NewRelic.AgentEnabled の設定は無視されます。

アプリケーション名

詳細については、 Name your .NET application を参照してください。

ライセンスキー
newrelic.configの場所の変更

アプリのローカルルートやグローバルな設定場所以外の、設定ファイルの代替場所を指定します。入力する場所は、絶対パスでなければなりません。

appsettings.jsonでの設定

.NET Coreアプリの場合、 appsettings.json で以下の設定が可能です。

appsettings.json ファイルは、アプリケーションのカレントワーキングディレクトリに置かれている必要があります。このアプリケーションには、以下の依存関係が必要です。
Microsoft.Extensions.ConfigurationMicrosoft.Extensions.Configuration.JsonMicrosoft.Extensions.Configuration.EnvironmentVariables
エージェントの有効化・無効化

ローカルまたはグローバルの newrelic.config でエージェントが無効になっている場合、このファイルの NewRelic.AgentEnabled の設定は無視されます。

アプリケーション名

詳細については、 Name your .NET application を参照してください。

ライセンスキー
newrelic.configの場所の変更

アプリのローカルルートやグローバルな設定場所以外の、設定ファイルの代替場所を指定します。入力する場所は、絶対パスでなければなりません。`