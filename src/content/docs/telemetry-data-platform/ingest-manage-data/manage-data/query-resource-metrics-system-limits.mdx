---
title: Query resource metrics and system limits
tags:
  - Telemetry Data Platform
  - Ingest data manage data
  - Manage data
  - Resource metrics
  - system limits

---

As you use the New Relic system there are resource limits in place to protect your experience, our systems, and our other customers. 

These limits range from the maximum number of characters you can have in a query, to API request rates, to how many events your queries inspect. And everywhere in between.

This page describes the limit metrics and NrIntegration events that enable you to view  your limits, your current data usage and overall resource consumption as compared to those limits, and the impact of experiencing a limit event. We also provide a handful of queries that, when compiled into a dashboard, can give you consistent insight into your limits status.

<Callout variant="important">
While `NrIntegration` events cover nearly all limits, resource metrics currently only cover request rate ingestion limits.
</Callout>

## What happens when you reach a limit 

Our response to reaching a limit depends on a handful of factors: the [type of limit that’s reached](/docs/telemetry-data-platform/ingest-manage-data/manage-data/view-system-limits/#violations), as well as the duration, frequency, and amount at which you exceed the limit.  Exceeding a limit doesn’t always mean you experience a limit event -- dropped data, rejected traffic, or turned off data for the rest of the day. We sometimes allow a small buffer before enforcing a limit. That said, any resource consumed above 100% is at risk for limit impact at any time.

Many of our rate limits apply proportionally. That means if you’re barely exceeding the limit, we will take less action than if you are exceeding by 200%.

These are only visible if you are sending data in to corresponding dataType or limitName Api.
I.e if you are sending in data via the metric Api you’ll see the metric API resource metrics, if you are not sending any APM data in, you will not see APM resource metrics.

<Callout variant="tip">
Impact metrics will be generated regardless of impact, if no impact you’ll see a 0.
</Callout>


An `NrIntegration` error is generated when you experience impact and is a good way to quickly see if you’re experiencing any limit events. See [View System Limits](/docs/telemetry-data-platform/ingest-manage-data/manage-data/view-system-limits/) for more information.

## Three limit metrics for querying limit status

By putting these three limit metrics together on a dashboard you can quickly see detailed visuals of your Ingest Resource Request Per Minute limits (soon Data Points per Minute), and with NrIngration errors get a view into more limits.

![screenshot of limits dashboard](./images/.png "edit_retention_settings.png")

<figcaption>
  Dashboard displaying status in 
</figcaption>



Queries to create this dashboard: (thinking a drop down thingy)

From left to right top to bottom:

Resource Consumption Limits as a %

FROM Metric
 selectrate(sum(newrelic.resourceConsumption.currentValue), 1minute) /latest(newrelic.resourceConsumption.limitValue) * 100facet limitName where limitTimeWindow = '1 minute'timeseries

Max % Consumption in an hour

SELECT max(`usage`) FROM (FROM Metric select rate(sum(newrelic.resourceConsumption.currentValue), 1 minute) / latest(newrelic.resourceConsumption.limitValue) * 100 as 'usage' facet limitName timeseries ) facet limitName 


APM Agent API transaction events request per minute

FROM Metric
 selectrate(sum(newrelic.resourceConsumption.currentValue), 1minute) where limitName = 'APM Agent API transaction events requests per minute' TIMESERIES

Trace API With limit line

FROM Metric
 selectrate(sum(newrelic.resourceConsumption.currentValue), 1minute),latest(newrelic.resourceConsumption.limitValue) wherelimitName = 'Trace API requests per minute' TIMESERIES

Impact FACET

 selectrate(sum(newrelic.resourceConsumption.impact), 1minute) facet dataType, impact, resource, reason,limitName TIMESERIES 1 minute

NrIntegrationError by Limit

FROM NrIntegrationError
 select count(*) facet limitNameTIMESERIES MAX  since 1 day ago limit max

Multi-Account limits (only on time series charts)



Limit List and NrIntegration Error

FROM Metric
, NrIntegrationError
 selectrate(sum(newrelic.resourceConsumption.currentValue), 1minute) as 'Per Minute Count',latest(newrelic.resourceConsumption.limitValue) as ' limit Value',(rate(sum(newrelic.resourceConsumption.currentValue), 1minute)/latest(newrelic.resourceConsumption.limitValue)*100)as 'Percent Used', filter (count(*), whereNrIntegrationError.limitValue is not null) as 'limit reached count' facet limitName limit 1000


These metrics can hone in on a single limit or resource or you can leverage `FACET limitName or Resource` and get a view across all your limits.
Limit Value - newrelic.resourceConsumption.limitValue

`limitValue` allows you to see the setting for a limit by `limitName` and understand more about what resource is linked to this limit.

Example for Metric API request per minute
“FROM Metric select latest(newrelic.resourceConsumption.currentValue) where limitName = 'Metric API requests per minute' “  limit 200


To show all limits add FACET limitName (consider grouping by limitTimeWindow)
“FROM Metric select latest(newrelic.resourceConsumption.currentValue) WHERE limitTimeWindow = '1 minute' FACET limitName “  limit 200

Current Value - newrelic.resourceConsumption.currentValue
`currentValue` shows you how much of a given resource you’re currently consuming. To get a better glimpse into how our systems are viewing your consumption,  use a `rate()` function with the time period that aligns with the `limitWindow`.  limit 200


Example for Metric API request per minute
“FROM Metric select rate(sum(newrelic.resourceConsumption.currentValue),1 minute) where limitName = 'Metric API requests per minute' “  limit 200


To show all limits add FACET limitName (consider grouping by limitTimeWindow)

“FROM Metric select rate(sum(newrelic.resourceConsumption.currentValue),1 minute) where limitTimeWindow = '1 minute' FACET limitName “  limit 200

Impact - newrelic.resourceConsumption.impact
Most granular we have is dataType. It is possible for multiple limitNames to impact a single type, i.e Metric RPM and DPM. If know we will display limitName.

From Metric select rate(sum(newrelic.resourceConsumption.impact), 1 minute) facet dataType, resource, impact, limitName   TIMESERIES  limit 200


`impact` lets you know for any given resource what impact limit events are having. Zeros mean you are not currently impacted. 




Attributes on newrelic.resourceConsumption.limitValue  and newrelic.resourceConsumption.currentValue
limitName - The Name of the limit for the metric data i.e RPM Metric API
dataType - What kind of data the metric is tracking i.e Metric, Log, APM
Resource - What resource is being consumed - (I.E Requests, DPM)
limitTimeWindow - What is the time window that this resource is evaluated for limiting.
account -  


Attributes on newrelic.resourceConsumption.impact
dataType - What kind of data is being impacted i.e Metric, Log, APM
Resource - What resource is being impacted i.e Request Rate
Impact - A count of what  is happening when resource has exceeded set limit i.e dropped requests 
account - 

Querying Examples (build a dash):
View all your limits as a percentage of use
FROM Metric select (rate(sum(newrelic.resourceConsumption.currentValue), 1 minute)/latest(newrelic.resourceConsumption.limitValue))*100 facet limitName timeseries  limit 200

View one limit
FROM Metric select (rate(sum(newrelic.resourceConsumption.currentValue), 1 minute)/latest(newrelic.resourceConsumption.limitValue))*100 WHERE limitName = 'Metric API requests per minute’  limit 200

 
Alert on Resource Metrics

While building a dashboard to see all your limits is handy, being able to automate it is even better. These three metrics are alertable and when used together can provide updates as limits changes.

Since different limits are enforced by different timewindows, you may need several alerts to cover all your time windows (currently we only have metrics on 1 minute time windows, so you can set where TimeWindow = 1 minute and cover all of them for now)

Percent of Resource Used by Limit by limitTimeWindow
Example: Limits Faceting by LimitName and scoped by Timewindow 

From Metric select (rate(sum(newrelic.resourceConsumption.currentValue), 1 minute)/latest(newrelic.resourceConsumption.limitValue))*100 facet limitName  limit 200

Example: One limit 

From Metric select (rate(sum(newrelic.resourceConsumption.currentValue), 1 minute)/latest(newrelic.resourceConsumption.limitValue))*100 where limitName = ‘my limit’  limit 200


Impact
Example: Impact Facet by dataType, impact, resource, reason

From Metric select rate(sum(newrelic.resourceConsumption.impact), 1 minute) facet dataType, impact, resource, reason   limit 200


Example: Impact of a single dataType

From Metric select rate(sum(newrelic.resourceConsumption.impact), 1 minute) facet dataType, impact, resource, reason  WHERE dataType = ‘important things’  limit 200












JSON: YOLO
{
  "name": "Resource Limits Share",
  "description": null,
  "permissions": "PUBLIC_READ_WRITE",
  "pages": [
    {
      "name": "Resource Limits Share",
      "description": null,
      "widgets": [
        {
          "visualization": {
            "id": "viz.line"
          },
          "layout": {
            "column": 1,
            "row": 1,
            "height": 3,
            "width": 4
          },
          "title": "all limits ",
          "rawConfiguration": {
            "legend": {
              "enabled": true
            },
            "nrqlQueries": [
              {
                "accountId": 1,
                "query": "FROM Metric select rate(sum(newrelic.resourceConsumption.currentValue), 1 minute) / latest(newrelic.resourceConsumption.limitValue) * 100 facet limitName timeseries"
              }
            ],
            "yAxisLeft": {
              "zero": true
            }
          },
          "linkedEntityGuids": null
        },
        {
          "visualization": {
            "id": "viz.line"
          },
          "layout": {
            "column": 5,
            "row": 1,
            "height": 3,
            "width": 4
          },
          "title": "Impact FACET",
          "rawConfiguration": {
            "legend": {
              "enabled": true
            },
            "nrqlQueries": [
              {
                "accountId": 10952021,
                "query": "From Metric select rate(sum(newrelic.resourceConsumption.impact), 1 minute) facet dataType, impact, resource, reason, limitName   TIMESERIES 1 minute"
              }
            ],
            "yAxisLeft": {
              "zero": true
            }
          },
          "linkedEntityGuids": null
        },
        {
          "visualization": {
            "id": "viz.line"
          },
          "layout": {
            "column": 9,
            "row": 1,
            "height": 3,
            "width": 4
          },
          "title": "Trace API Requests per Minute",
          "rawConfiguration": {
            "dataFormatters": [],
            "legend": {
              "enabled": true
            },
            "nrqlQueries": [
              {
                "accountId": 1,
                "query": "FROM Metric select rate(sum(newrelic.resourceConsumption.currentValue), 1 minute) where limitName = 'Trace API requests per minute' TIMESERIES "
              }
            ],
            "yAxisLeft": {
              "zero": true
            }
          },
          "linkedEntityGuids": null
        },
        {
          "visualization": {
            "id": "viz.line"
          },
          "layout": {
            "column": 1,
            "row": 4,
            "height": 3,
            "width": 4
          },
          "title": "With limit line",
          "rawConfiguration": {
            "legend": {
              "enabled": true
            },
            "nrqlQueries": [
              {
                "accountId": 1,
                "query": "FROM Metric select rate(sum(newrelic.resourceConsumption.currentValue), 1 minute), latest(newrelic.resourceConsumption.limitValue) where limitName = 'Trace API requests per minute' TIMESERIES "
              }
            ],
            "yAxisLeft": {
              "zero": true
            }
          },
          "linkedEntityGuids": null
        }
      ]
    }
  ]
}
