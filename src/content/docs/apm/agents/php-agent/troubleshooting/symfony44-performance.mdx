---
title: Symfony 4.4 overhead with opcache.preload
type: troubleshooting
tags:
  - Agents
  - PHP agent
  - Troubleshooting
  - Symfony 4.4
---

## Problem

When using Symfony 4.4, you are experiencing large performance impacts when opcache.preload is active.

## Solution

1. Set ```newrelic.preload_framework_library_detection = false```
2. Ensure that your preload settings are compliant with symfony guidance requirements for preloading
  - [symfony.com/doc/current/performance](https://symfony.com/doc/current/performance.html#use-the-opcache-class-preloading)
  - If using PHP 7.4, follow symfony's additional installation information:
      [symfony.com/blog/new-in-symfony-4-4-preloading-symfony-applications-in-php-7-4](https://symfony.com/blog/new-in-symfony-4-4-preloading-symfony-applications-in-php-7-4)
      [symfonycasts.com/screencast/symfony5-upgrade/preload](https://symfonycasts.com/screencast/symfony5-upgrade/preload)
3. Restart your service

## Cause

When ```newrelic.preload_framework_library_detection``` and ```opcache.preload``` are both enabled, we query the opcache status with each function call. However, there are several issues related to using Symfony 4.4 that can result in this query returning ```null``. This consistently happening will cause significant overhead in the PHP Agent.

Currently, this issue has only been reported by environments using Kubernetes.
