---
title: Performance Issues Within AWS Fargate
type: troubleshooting
tags:
  - Agents
  - PHP agent
  - Troubleshooting
metaDescription: Using the PHP Agent in an AWS Fargate will result in poor to unacceptable performance due to the clock source.
---

## Problem

Using the New Relic PHP agent within a AWS Fargate results in poor performance.

## Explanation

The PHP agent relies heavily on the clock source of a system for timing activities.  Because of the constant clock checking, to be effective, the PHP agent needs a vDSO based clocksource so that the repetitive calls to check the time don't dominate the overall performance.  More details about how to check/change the clocksource can be found [here](https://discuss.newrelic.com/t/relic-solution-php-agent-cpu-overhead-tips/70182).


Unfortunately, AWS Fargate mandates the xen clock source which does NOT support vDSO.  Despite other clocksources being available, AWS Fargate prohibits changing the clocksource by making the sys directory read-only.
This is an [open issue](https://github.com/aws/containers-roadmap/issues/974) with Fargate regarding this limitation.


If Fargate is an absolute requirement, customers could turn autoinstrumenting off and manually instrument only a few, key transactions.  Other than this, because of all the importance of the clocksource with respect to time checking to gather PHP metrics, there are currently no workarounds for using the agent on Fargate due to this AWS issue, but customers have found success using the agent on AWS services like EC2 and Graviton that do allow you to change the clock source.