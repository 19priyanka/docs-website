---
title: 'Distributed tracing for the C SDK agent'
tags:
  - Understand dependencies
  - Distributed tracing
  - Enable and configure
metaDescription: How to enable distributed tracing or Infinite Tracing for APM agents.
redirects:
  - /docs/enable-distributed-tracing
  - /docs/apm/distributed-tracing/enable-configure/enable-distributed-tracing
  - /docs/understand-dependencies/distributed-tracing/enable-configure/apm-enable-distributed-tracing
  - /docs/understand-dependencies/distributed-tracing/enable-configure/enable-distributed-tracing
  - /docs/new-relic-solutions/best-practices-guides/full-stack-observability/best-practices-enable-distributed-tracing
  - /docs/understand-dependencies/distributed-tracing/enable-configure/language-agents-enable-distributed-tracing
---
import clogo from 'images/clogo.png'

Distributed tracing is available for services instrumented with the New Relic APM agent for C SDK. When you enable this feature for each of your services, you can see the entire journey of your requests throughout a [distributed system](/docs/distributed-tracing/concepts/introduction-distributed-tracing). Here are several ways to set up distributed tracing:

* [Guided installation for standard distributed tracing (recommended):](#quick-start-apm) A fast way to get started
* [Infinite Tracing:](#infinite-tracing) An advanced alternative to standard distributed tracing
* [Older APM agents:](#older-agents) Tracing options if you have older APM agents
* [Manual instrumentation:](#manual-instrumentation) Tips if automatic instrumentation doesn't work

<Callout variant="tip">
  If you want to get more background before getting started, check out these topics:
  * [How span sampling works](/docs/understand-dependencies/distributed-tracing/get-started/how-new-relic-distributed-tracing-works#sampling) explains distributed tracing options.
  * [Impacts to APM](/docs/apm/distributed-tracing/getting-started/transition-guide-distributed-tracing) tells you what to expect if you are a current APM user but haven't set up distributed tracing.
</Callout>

## Guided installation for standard distributed tracing (recommended): [#quick-start-apm]

This is the best approach to set up [standard distributed tracing](/docs/distributed-tracing/concepts/how-new-relic-distributed-tracing-works/#head-based) in either of these cases:

* You haven't installed any APM agents for your services yet.
* You want to instrument additional services with this agent.

If you already have some services instrumented with this APM agent, and you want to include them in distributed tracing, you'll need to manually enable distributed tracing for each service. See [Options for older APM agents](#older-agents).

You'll need a New Relic account to set up distributed tracing. If you don't already have one, you can quickly [create a free account](https://newrelic.com/signup).

### Step 1. Identify services

Figure out which services touch your request so you can instrument each of them to send trace data to New Relic.

### Step 2. Instrument each service with an APM agent [#update-agents]

For C SDK services that are not currently instrumented with the New Relic agent, you can run our guided installation that both instruments your service and enables distributed tracing.

You should run the guided installation for each service you want to instrument to ensure that each installation has a unique application name. If some of your services use other languages, simply run the [guided installation](/docs/distributed-tracing/enable-configure/quick-start) for those other languages.

To start the guided installation, click the link below. When you are finished, repeat this process for other services that handle your requests.

   <TechTileGrid>
      <TechTile
        name="APM: C"
        to="https://one.newrelic.com/launcher/nr1-core.settings?pane=eyJuZXJkbGV0SWQiOiJ0dWNzb24ucGxnLWluc3RydW1lbnQtZXZlcnl0aGluZyJ9&cards[0]=eyJuZXJkbGV0SWQiOiJzZXR1cC1uZXJkbGV0cy5zZXR1cC1jLWludGVncmF0aW9uIiwiYWNjb3VudElkIjoyNjQwNDA5fQ==&platform[accountId]=2498654&platform[timeRange][duration]=1800000&platform[$isFallbackTimeRange]=true"
        icon={<img src={clogo} alt="C"/>}
      />
    </TechTileGrid>

### Step 3. View traces [#view-traces]

After you instrument each of your services with APM agents, generate some traffic in your application so we can capture some traces. Here are some ways to view your traces in the UI:

<CollapserGroup>
  <Collapser
    id="entity-explorer"
    title="View traces that include a specific service"
  >
    Here's one way you can see traces for a particular service:

    1. Go to **[one.newrelic.com](https://one.newrelic.com/)**.
    2. Click **APM** in the top menu bar.
    3. Click your service.
    4. In the left navigation's **Monitor** section, click **Distributed tracing**.
    5. If you don't see the traces you want, you can filter by the `trace.id`.
  </Collapser>

  <Collapser
    id="dt-launcher"
    title="View traces across accounts"
  >
    This option allows you to search all traces across all New Relic accounts in your organization that you have access to.

    1. Go to **[one.newrelic.com](https://one.newrelic.com/)**.
    2. Click **Browse data** in the top menu bar, and then click **Traces**.
    3. Select your entity in the left pane.
    4. If you don't see the traces you want, you can filter by the `trace.id`.
  </Collapser>

  <Collapser
    id="logs-context"
    title="Examine logs for trace details"
  >
    You can bring your logs and application's data together to make troubleshooting easier and faster. With [logs in context](/docs/logs/logs-context/configure-logs-context-apm-agents/), you can see log messages related to your errors and traces directly in your app's UI.

    1. From the **Transactions** page, click on a trace to go to the [**Trace details** page](/docs/apm/transactions/transaction-traces/transaction-traces-trace-details-page).
    2. From the trace details page, click **See logs**.
    3. To view details related to an individual log message, click directly on the message.
  </Collapser>
</CollapserGroup>

For more help finding your traces in the UI:

* [Understand and use the distributed tracing UI](/docs/distributed-tracing/ui-data/understand-use-distributed-tracing-ui)
* [Query distributed trace data](/docs/understand-dependencies/distributed-tracing/ui-data/query-distributed-trace-data)

## Set up Infinite Tracing (advanced option) [#infinite-tracing] 

Infinite Tracing is not available for the C SDK agent.

## Options for older C SDK agents [#older-agents]

If you have older APM agents, use this section to figure out if the distributed tracing features you want are supported.

After reviewing the compatibility information, use the options in the configuration settings section.

### Compatibility guide

<CollapserGroup>
  <Collapser
    id="c-sdk"
    title="C SDK"
  >
    [Install (compile)](/docs/agents/c-sdk/install-configure/install-c-sdk-compile-link-your-code) or [update](/docs/agents/c-sdk/install-configure/update-your-c-sdk-library) to the required C SDK version. For best results, update to the [latest C SDK version](/docs/release-notes/agent-release-notes/c-sdk-release-notes).

    <table>
      <thead>
        <tr>
          <th style={{ width: "250px" }}>
            Option
          </th>

          <th>
            C SDK version
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            Standard distributed tracing
          </td>

          <td>
            1.1.0 or higher (W3C Trace Context not available)
          </td>
        </tr>

        <tr>
          <td>
            Infinite Tracing
          </td>

          <td>
            Not available
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>
</CollapserGroup>

### Configure distributed tracing for your older agents [#configure-agents]

Distributed tracing is enabled through configuration settings. Review the following C SDK-specific configurations. For general help with agent configurations, see [Configure the agent](/docs/agents/manage-apm-agents/configuration/configure-agent).

<CollapserGroup>
  <Collapser
    id="c-sdk-config-standard"
    title="C SDK"
  >
    Here's an overview of the settings. For more help with configuration, see [Enable distributed tracing for your C applications](/docs/agents/c-sdk/instrumentation/enable-distributed-tracing-your-c-applications).

    <table>
      <thead>
        <tr>
          <th style={{ width: "200px" }}>
            Type
          </th>

          <th>
            Required configuration
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            Standard distributed tracing
          </td>

          <td>
            Configuration options:

            * `newrelic_app_config_t` structure:

              ```
              newrelic_app_config_t* config;
              config = newrelic_create_app_config(app_name, license_key);
              config->distributed_tracing.enabled = true;
              ```
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>
</CollapserGroup>

<Callout variant="tip">
  If you need help with proxy configuration, see [Proxy support](/docs/understand-dependencies/distributed-tracing/other-requirements/infinite-tracing-proxy-support).
</Callout>

## Manual instrumentation (if automatic instrumentation doesn't work) [#manual-instrumentation]

**Recommendation:** Before performing any custom instrumentation, read:

* [How distributed tracing works](/docs/apm/distributed-tracing/getting-started/how-new-relic-distributed-tracing-works)
* [Troubleshoot missing data](/docs/apm/distributed-tracing/troubleshooting/troubleshooting-missing-trace-data)

If a service is not passing the trace header to other services, you can use the distributed tracing payload APIs to instrument the [calling service](#calling-service) and the [called service](#called-service). The calling service uses an API call to generate a payload, which is accepted by the called service.

<CollapserGroup>
  <Collapser
    id="calling-service"
    title="Instrument the calling service"
  >
    To instrument the calling service:

    1. Ensure the [version of the APM agent](#compatibility-requirements) that monitors the calling service supports distributed tracing.
    2. Invoke the agent API call for generating a distributed trace payload: [C SDK](/docs/agents/c-sdk/instrumentation/enable-distributed-tracing-your-c-applications).

       <Callout variant="important">
         To maintain proper ordering of spans in a trace, ensure you **generate the payload in the context of the span that sends it**.
       </Callout>
    3. Add that payload to the call made to the destination service (for example, in a header).
    4. (Optional) Identify the call as an external call: [C SDK](https://github.com/newrelic/c-sdk/blob/master/GUIDE.md#distributed-tracing).
   </Collapser>

  <Collapser
    id="called-service"
    title="Instrument the called service"
  >
    To instrument the called service:

    1. Ensure the [version of the APM agent](#compatibility-requirements) that monitors the called service supports distributed tracing.
    2. If the New Relic agent on the called service does not identify a New Relic transaction, use the agent API to declare a transaction:

         <Collapser
           id="c-sdk-create"
           title="C SDK"
         >
           One way to tell that a transaction is not in progress: when `newrelic_create_distributed_trace_payload()` is called, a `NULL` pointer is returned. To solve this problem, follow the procedures to [create a transaction](/docs/agents/c-sdk/instrumentation/instrument-your-app-c-sdk) with the C SDK.
         </Collapser>
    3. Extract the payload from the call that you received (for example, in a header).
    4. Invoke the call for accepting the payload: [C SDK](/docs/agents/c-sdk/instrumentation/enable-distributed-tracing-your-c-applications).
  </Collapser>
</CollapserGroup>
