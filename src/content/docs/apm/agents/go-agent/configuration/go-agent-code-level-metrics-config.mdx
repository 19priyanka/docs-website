---
title: Go agent code-level metrics configuration
tags:
  - Agents
  - Go agent
  - Configuration
metaDescription: Add source code context to your application traces, associating the trace data with the specific code being instrumented.
---

You can edit configuration settings for the Go agent to control the collection of code-level metrics. For general information about code-level metrics, see [Performance monitoring with CodeStream](/docs/codestream/how-use-codestream/performance-monitoring#code-level).

## Overview [#overview]

With code-level metrics enabled, the Go agent will attach attributes to trace data which give the location in your application source code
responsible for the actions being instrumented by those traces. This data includes:
 * Source file name
 * Source file line number
 * Function name
 * Namespace

<Callout variant="important">
    This feature is available for transactions as of Go agent version 3.18.0, and is turned off by default. To enable it, you must
    add `newrelic.ConfigCodeLevelMetricsEnabled(true)` to your application's configuration as explained below. Future releases may
    change this to be on by default and may expand the feature to be included with other trace types other than transactions.
</Callout>

## Configuration methods [#config]

When calling `newrelic.NewApplication` to configure the Go agent in your application, you can enable code-level metrics by
including the `newrelic.ConfigCodeLevelMetricsEnabled` option, like so:

```go
app, err := newrelic.NewApplication(
   newrelic.ConfigAppName("Your Application Name"),
   newrelic.ConfigLicense(os.Getenv("NEW_RELIC_LICENSE_KEY")),
   newrelic.ConfigCodeLevelMetricsEnabled(true),
)
```

With that simple step, the Go agent will add the source code context information in the following agent attributes on transactions:
<table>
  <thead>
    <tr>
    <th style={{ width: "200px" }}>
      Name
    </th>
    <th>
      Description
    </th>
    </tr>
  </thead>
  <tbody>
    <tr>
    <td>
      `code.function`
    </td>
    <td>
      The name of the function which started the transaction. Note that this may be automatically generated by the Go compiler in some cases.
    </td>
    </tr>
    <tr>
    <td>
      `code.namespace`
    </td>
    <td>
      The package/namespace where the function is located. The combination of `code.namespace` and `code.function`, joined with a delimiter such as
      a dot (`.`), is expected to uniquely identify the function.
    </td>
    </tr>
    <tr>
    <td>
      `code.filepath`
    </td>
    <td>
      The pathname of the source file containing the function being reported. Normally this is the full, absolute pathname; see below for
      a configuration option which allows you to change this to a relative path.
    </td>
    </tr>
    <tr>
    <td>
      `code.lineno`
    </td>
    <td>
      The line number within `code.filepath` where the transaction was started. See [the instrumentation guide](/docs/apm/agents/go-agent/instrumentation/go-agent-code-level-metrics-instrument) for ways to control this.
    </td>
    </tr>
  </tbody>
</table>

There are additional configuration options you may wish to use to further refine the collection of code-level metrics in your application.

<CollapserGroup>
  <Collapser
    id="go-clm-config-scope"
    title={<>Restrict CLM scope</>}
  >
  By default, with code-level metrics enabled, the agent will calculate and store source code context information for all types of traces
  supported (currently, this is only transactions, but this may be expanded in the future). If you are not interested in seeing code-level
  metrics for all types of traces, you can limit the scope to a subset of trace types in order to save some runtime overhead.

  To accomplish this, do one of the following:

  * If configuring via the `NewApplication` function, add a `ConfigCodeLevelMetricsScope` option:

    ```go
    app, err := newrelic.NewApplication(
       newrelic.ConfigAppName("Your Application Name"),
       newrelic.ConfigLicense("YOUR_NEW_RELIC_LICENSE_KEY"),
       newrelic.ConfigCodeLevelMetricsEnabled(true),
       newrelic.ConfigCodeLevelMetricsScope(newrelic.TransactionCLM),  // transactions only
    )
    ```
      * The value passed to `newrelic.ConfigCodeLevelMetricsScope` is a set of one or more `newrelic.CodeLevelMetricsScope` values separated by OR (`|`) operators.
      * To get the default behavior of collecting code-level metrics for every trace type the agent currently is able to report them for, set the scope to `newrelic.AllCLM`.
      * Setting the scope to the zero value of `newrelic.CodeLevelMetricsScope` also gives the default behavior of reporting all possible scope.
      * The supported set of scope values includes:
        <table>
          <thead>
            <tr>
            <th>
              Constant name
            </th>
            <th>
              Trace type
            </th>
            <th>
              As of agent version
            </th>
            </tr>
          </thead>
          <tbody>
            <tr>
            <td>
              `newrelic.TransactionCLM`
            </td>
            <td>
              Transactions
            </td>
            <td>
              3.18.0
            </td>
            </tr>
          </tbody>
        </table>
  * If configuring via environment variables, set `NEW_RELIC_CODE_LEVEL_METRICS_SCOPE` to a comma-separated list of scope names, such as:
    ```
    NEW_RELIC_CODE_LEVEL_METRICS_SCOPE="transaction"
    ```

    Don't forget to also include the `newrelic.ConfigFromEnvironmet` option when setting up the application:

    ```go
    app, err := newrelic.NewApplication(
       newrelic.ConfigAppName("Your Application Name"),
       newrelic.ConfigLicense("YOUR_NEW_RELIC_LICENSE_KEY"),
       newrelic.ConfigCodeLevelMetricsEnabled(true),
       newrelic.ConfigFromEnvironment(),
    )
    ```
      * The value in the environment variable `NEW_RELIC_CODE_LEVEL_METRICS_SCOPE` is a set of one or more scope keywords separated by commas.
      * To get the default behavior of collecting code-level metrics for every trace type the agent currently is able to report them for, set the value of the environment variable to `"AllCLM"`.
      * The supported set of scope names includes:
        <table>
          <thead>
            <tr>
            <th>
              Name
            </th>
            <th>
              Trace type
            </th>
            <th>
              As of agent version
            </th>
            </tr>
          </thead>
          <tbody>
            <tr>
            <td>
              `transaction` or `transactions` or `txn`
            </td>
            <td>
              Transactions
            </td>
            <td>
              3.18.0
            </td>
            </tr>
            <tr>
            <td>
              `all`
            </td>
            <td>
              All supported types
            </td>
            <td>
              3.18.0
            </td>
            </tr>
          </tbody>
        </table>
  </Collapser>
  <Collapser
    id="go-clm-config-ignore-prefix"
    title={<>Identify instrumented packages</>}
  >
  By default, with code-level metrics enabled, the agent will ignore functions in the call stack which it believes to be internal
  to the agent itself, to ensure that the function reported is the one intended, even though functions inside the agent will have
  been called to get into the code-level metrics instrumentation code. By default, it does this by ignoring any functions whose
  package name begins with `github.com/newrelic/go-agent/`. You can change this to any arbitrary name by setting your own
  `IgnorePrefix` value.

  To accomplish this, do one of the following:

  * If configuring via the `NewApplication` function, add a `ConfigCodeLevelMetricsIgnorePrefix` option:

    ```go
    app, err := newrelic.NewApplication(
       newrelic.ConfigAppName("Your Application Name"),
       newrelic.ConfigLicense("YOUR_NEW_RELIC_LICENSE_KEY"),
       newrelic.ConfigCodeLevelMetricsEnabled(true),
       newrelic.ConfigCodeLevelMetricsIgnorePrefix("github.com/some/other/name/"),
    )
    ```

  * If configuring via environment variables, set `NEW_RELIC_CODE_LEVEL_METRICS_IGNORE_PREFIX` to the desired prefix:
    ```
    NEW_RELIC_CODE_LEVEL_METRICS_IGNORE_PREFIX="github.com/some/other/name/"
    ```

    Don't forget to also include the `newrelic.ConfigFromEnvironmet` option when setting up the application:

    ```go
    app, err := newrelic.NewApplication(
       newrelic.ConfigAppName("Your Application Name"),
       newrelic.ConfigLicense("YOUR_NEW_RELIC_LICENSE_KEY"),
       newrelic.ConfigCodeLevelMetricsEnabled(true),
       newrelic.ConfigFromEnvironment(),
    )
    ```
  </Collapser>
  <Collapser
    id="go-clm-config-path-prefix"
    title={<>Truncate source path prefix</>}
  >
  By default, with code-level metrics enabled, the agent will report the full pathname of each source file. However, this may
  not be desired. For example, you may wish to only report application paths relative to the root of the project source
  tree, allowing data to be correlated between instances regardless of where they are installed in the filesystem.

  To accomplish this, specify a `PathPrefix` string that indicates the start of your local project source path. If that string is found
  in a source file pathname, everything that appears before it will be removed. For example, if the `PathPrefix` parameter
  is set to `myproject/src` then `/usr/local/projects/myproject/src/widget/main.go` would be reported in the code-level metrics
  as `myproject/src/widget/main.go`.

  If `PathPrefix` is empty, or a source file doesn't contain the prefix string at all, the full pathname will be reported.

  Do one of the following:

  * If configuring via the `NewApplication` function, add a `ConfigCodeLevelMetricsPathPrefix` option:

    ```go
    app, err := newrelic.NewApplication(
       newrelic.ConfigAppName("Your Application Name"),
       newrelic.ConfigLicense("YOUR_NEW_RELIC_LICENSE_KEY"),
       newrelic.ConfigCodeLevelMetricsEnabled(true),
       newrelic.ConfigCodeLevelMetricsPathPrefix("myprojects/src/"),
    )
    ```

  * If configuring via environment variables, set `NEW_RELIC_CODE_LEVEL_METRICS_PATH_PREFIX` to the desired prefix:
    ```
    NEW_RELIC_CODE_LEVEL_METRICS_PATH_PREFIX="myprojects/src/"
    ```

    Don't forget to also include the `newrelic.ConfigFromEnvironmet` option when setting up the application:

    ```go
    app, err := newrelic.NewApplication(
       newrelic.ConfigAppName("Your Application Name"),
       newrelic.ConfigLicense("YOUR_NEW_RELIC_LICENSE_KEY"),
       newrelic.ConfigCodeLevelMetricsEnabled(true),
       newrelic.ConfigFromEnvironment(),
    )
    ```
  </Collapser>
</CollapserGroup>
