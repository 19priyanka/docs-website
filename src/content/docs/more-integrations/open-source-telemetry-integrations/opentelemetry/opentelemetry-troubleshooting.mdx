---
title: Troubleshooting OpenTelemetry with New Relic
tags:
  - Integrations
  - Open source telemetry integrations
  - OpenTelemetry
metaDescription: Troubleshoot issues using OpenTelemetry with New Relic
---

## OpenTelemetry data sent via OTLP is not queryable

### Problem

You sent OpenTelemetry metrics, logs, or traces using OTLP and are unable to view the data. Before digging deeper, make sure you've checked the following:

* The OTLP endpoint configured matches one of our [documented endpoints](/docs/more-integrations/open-source-telemetry-integrations/opentelemetry/opentelemetry-quick-start/#review-settings), is properly formatted, and includes the official [default port](https://github.com/open-telemetry/opentelemetry-specification/blob/90d9aab8a871db4954831e8447eb325ef020a80c/specification/protocol/otlp.md#otlpgrpc-default-port), 4317. Sending OTLP data via port 443 is not supported at this time.
* The outbound traffic is not restricted by a firewall. [Networks](/docs/using-new-relic/cross-product-functions/install-configure/networks/#opentelemetry) documents domains and network blocks that may need to be explicitly allowed.
* The client is configured to use TLS 1.2 or higher and the request includes the `api-key` header with a valid New Relic account (ingest) [license key](https://one.newrelic.com/launcher/api-keys-ui.launcher).
* Requests include valid protobuf payloads and use gRPC and HTTP/2 transport, preferably with [gzip compression](/docs/more-integrations/open-source-telemetry-integrations/opentelemetry/opentelemetry-concepts/#compression) enabled. Sending protobuf or JSON-encoded payloads over HTTP/1.1 is not supported at this time.
* Client output and logs do not indicate `4xx` or `5xx` response codes are being returned.

### Solution

There are number of tools that can be used to validate the successful delivery of telemetry data to our platform. A good first step is to check the [data management hub](/docs/data-apis/manage-data/manage-your-data/) to [facet data ingest](/docs/data-apis/manage-data/manage-data-coming-new-relic/#facet-data-ingest) and determine how much data is arriving from various sources. You can also use the [Data Explorer](/docs/query-your-data/explore-query-data/browse-data/introduction-data-explorer/#use-case-troubleshooting) or [Query Builder](/docs/query-your-data/explore-query-data/query-builder/use-advanced-nrql-mode-query-data/) to look for data faceted by `instrumentation.provider` or `newrelic.source` attributes:

```sql
FROM Log, Metric, Span SELECT datapointcount() WHERE instrumentation.provider = 'opentelemetry' FACET instrumentation.provider, newrelic.source
```

![Screenshot showing the data point count for logs, metrics, and traces faceted by instrumentation.provider and newrelic.source](./images/otlp-troubleshooting-facet-query.png "Screenshot showing the data point count for logs, metrics, and traces faceted by instrumentation.provider and newrelic.source")

This query should tell you whether data is arriving via OTLP. If the data you expect is not present, try removing the `WHERE` clause or checking for integration errors. Querying [NrIntegrationError events](/docs/data-apis/manage-data/nrintegrationerror/) can be helpful to determine whether you have configuration or format issues or if you've run into our platform limits.

<Callout variant="important">
The same [data ingest API limits](/docs/data-apis/manage-data/view-system-limits/#data-ingest-api-limits) apply to metrics, logs, and traces ingested via OTLP as our other ingest APIs.
</Callout>

Various parts of the NR1 UI rely on the presense of specific attributes to function properly. You can use the [NRQL console](/docs/query-your-data/explore-query-data/query-builder/nrql-console/) feature in many places to check the `WHERE` clause or `FACET` clause of the query for required attributes. You can also edit those clauses and re-run the query to determine whether there is data present with those attributes missing. Examples of required attributes include `service.name` and `service.instance.id`, for a more complete list, please reference this section on [resources](/docs/more-integrations/open-source-telemetry-integrations/opentelemetry/opentelemetry-concepts/#resources).

## OpenTelemetry entities or relationships are missing

### Problem
You sent OpenTelemetry data from a service or infrastructure component and either the [entity](/docs/new-relic-one/use-new-relic-one/core-concepts/what-entity-new-relic/) or its [relationships](/docs/new-relic-one/use-new-relic-one/core-concepts/what-entity-new-relic/#related-entities) are missing or incorrect.

### Solution

OpenTelemetry entities will be synthesized based on the [public rules](https://github.com/newrelic/entity-definitions/blob/b8e75d839eed7859044a9bb601a62e5323107350/definitions/ext-service/definition.yml) described for the `EXT-SERVICE` entity type. The standard rule to match relies on the presence of the `service.name` dimension which follows the OpenTelemetry [semantic conventions](https://github.com/open-telemetry/opentelemetry-specification/blob/527206ea49e384de957eda105d9425aa8fefca25/specification/overview.md#semantic-conventions).

To set the `service.name` with the OpenTelemetry Java SDK, include it in your [resource](/docs/more-integrations/open-source-telemetry-integrations/opentelemetry/opentelemetry-concepts/#resources):
```java
var resource = Resource.getDefault()
    .merge(Resource.builder().put(SERVICE_NAME, serviceName).build());
```

Depending on the SDK, you may also set the `service.name` by declaring it in the `OTEL_RESOURCE_ATTRIBUTES` or `OTEL_SERVICE_NAME` [environment variables](https://github.com/open-telemetry/opentelemetry-specification/blob/20c82de552d08428e8cadaaef3e6cb46812f7c00/specification/sdk-environment-variables.md#general-sdk-configuration).

For Logs you can use a structured log template to inject the `service.name`.

For more examples, visit the [newrelic-opentelemetry-examples](https://github.com/newrelic/newrelic-opentelemetry-examples) repository on GitHub.
