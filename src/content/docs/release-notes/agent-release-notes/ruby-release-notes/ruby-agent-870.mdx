---
subject: Ruby agent
releaseDate: '2022-05-03'
version: 8.7.0
downloadLink: 'https://rubygems.org/downloads/newrelic_rpm-8.7.0.gem'
---

  ## v8.7.0

  * **APM logs-in-context log forwarding on by default**

    Automatic application log forwarding is now enabled by default. This version of the agent will automatically send enriched application logs to New Relic. To learn more about about this feature see [here](https://docs.newrelic.com/docs/apm/new-relic-apm/getting-started/get-started-logs-context/), and additional configuration options are available [here](https://docs.newrelic.com/docs/logs/logs-context/configure-logs-context-ruby). To learn about how to toggle log ingestion on or off by account see [here](https://docs.newrelic.com/docs/logs/logs-context/disable-automatic-logging).

  * **Improved async support and Thread instrumentation**

    Previously, the agent was not able to record events and metrics inside Threads created inside of an already running transaction. This release includes 2 new configuration options to support multithreaded applications to automatically instrument threads. A new configuration option,`instrumentation.thread.tracing` (disabled by default), has been introduced that, when enabled, will allow the agent to insert New Relic tracing inside of all Threads created by an application. To support applications that only want some threads instrumented by New Relic, a new class is available, `NewRelic::TracedThread`, that will create a thread that includes New Relic instrumentation, see our [API documentation](https://www.rubydoc.info/gems/newrelic_rpm/NewRelic) for more details.

    New configuration options included in this release:
    | Configuration name | Default | Behavior |
    | ----------- | ----------- |----------- |
    | `instrumentation.thread`  | `auto` (enabled) | Allows the agent to correctly nest spans inside of an asyncronous transaction   |
    | `instrumentation.thread.tracing` | `false` (disabled)   |  Automatically add tracing to all Threads created in the application. This may be enabled by default in a future release. |

    We'd like to thank @mikeantonelli for sharing a gist with us that provided our team with an entry point for this feature.

  *  **Added updated configuration options for transaction events and deprecated previous configs**

    This release deprecates the following instrumentation:
    <table>
      <thead>
        <tr>
          <th>Deprecated</th>
          <th>Replacement</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>ActiveMerchant < 1.65.0</td>
          <td>ActiveMerchant >= 1.65.0</td>
        </tr>
        <tr>
          <td>Acts As Solr (all versions)</td>
          <td>none</td>
        </tr>
        <tr>
          <td>Authlogic (all versions)</td>
          <td>none</td>
        </tr>
        <tr>
          <td>Bunny < 2.7.0</td>
          <td>bunny >= 2.7.0</td>
        </tr>
        <tr>
          <td>Dalli < 3.2.1</td>
          <td>Dalli >= 3.2.1</td>
        </tr>
        <tr>
          <td>DataMapper (all versions)</td>
          <td>none</td>
        </tr>
        <tr>
          <td>Delayed Job < 4.1.0</td>
          <td>Delayed Job >= 4.1.0</td>
        </tr>
        <tr>
          <td>Excon < 0.56.0</td>
          <td>Excon >= 0.56.0</td>
        </tr>
        <tr>
          <td>Grape < 0.19.2</td>
          <td>Grape >= 0.19.2</td>
        </tr>
        <tr>
          <td>HTTPClient < 2.8.3</td>
          <td>HTTPClient 2.8.3</td>
        </tr>
        <tr>
          <td>HTTP.rb < 2.2.2</td>
          <td>HTTP.rb >= 2.2.2</td>
        </tr>
        <tr>
          <td>Mongo < 2.4.1</td>
          <td>Mongo >= 2.4.1</td>
        </tr>
        <tr>
          <td>Padrino < 0.15.0</td>
          <td>Padrino >= 0.15.0</td>
        </tr>
        <tr>
          <td>Passenger < 5.1.3</td>
          <td>Passenger >= 5.1.3</td>
        </tr>
        <tr>
          <td>Puma < 3.9.0</td>
          <td>Puma >= 3.9.0</td>
        </tr>
        <tr>
          <td>Rack < 1.6.8</td>
          <td>Rack >= 1.6.8</td>
        </tr>
        <tr>
          <td>Rainbows (all versions)</td>
          <td>none</td>
        </tr>
        <tr>
          <td>Sequel < 4.45.0</td>
          <td>Sequel >= 4.45.0</td>
        </tr>
        <tr>
          <td>Sidekiq < 5.0.0</td>
          <td>Sidekiq >= 5.0.0</td>
        </tr>
        <tr>
          <td>Sinatra < 2.0.0</td>
          <td>Sinatra >= 2.0.0</td>
        </tr>
        <tr>
          <td>Sunspot (all versions)</td>
          <td>none</td>
        </tr>
        <tr>
          <td>Typhoeus < 1.3.0</td>
          <td>Typhoeus >= 1.3.0</td>
        </tr>
        <tr>
          <td>Unicorn < 5.3.0</td>
          <td>Unicorn >= 5.3.0</td>
        </tr>
      </tbody>
    </table>

    For the gems with deprecated versions, we will no longer test those versions in our multiverse suite. They may, however, still be compatible with the agent. We will no longer fix bug reports for issues with these versions of the gem.

  * **Clarify documentation for `rake.tasks` configuration**

    The `rake.tasks` description in the default `newrelic.yml` file and the [New Relic Ruby Agent Configuration docs](https://docs.newrelic.com/docs/apm/agents/ruby-agent/configuration/ruby-agent-configuration#rake-tasks) have been updated to clarify its behavior and usage. The documentation now reads:

    > Specify an array of Rake tasks to automatically instrument. This configuration option converts the Array to a RegEx list. If you'd like to allow all tasks by default, use `rake.tasks: [.+]`. Rake tasks will not be instrumented unless they're added to this list. For more information, visit the (New Relic Rake Instrumentation docs)[/docs/apm/agents/ruby-agent/background-jobs/rake-instrumentation].

    We thank @robotfelix for suggesting these changes.

  * **Enable Environment Variables setting Array configurations to be converted to Arrays**

    Prior to this change, when comma-separated lists were passed as environment variables, an error would be emitted to the `newrelic_agent.log` and a String would be set as the value. Now, Arrays will be accurately coerced.

  * **Bugfix: Allow TransactionEvents to be sampled at the expected rate**

    The `transaction_events.max_samples_stored` capacity value within the TransactionEventAggregator did not match up with its expected harvest cycle interval, causing TransactionEvents to be over-sampled. This bugfix builds upon the updates made in [#952](https://github.com/newrelic/newrelic-ruby-agent/pull/952) so that the interval and capacity behave as expected for the renamed `transaction_events*` configuration options.



## Support statement

New Relic recommends that you upgrade the agent regularly and at a minimum every 3 months. As of this release, the oldest supported version is [5.7.0.350](https://docs.newrelic.com/docs/release-notes/agent-release-notes/ruby-release-notes/ruby-agent-570350).
