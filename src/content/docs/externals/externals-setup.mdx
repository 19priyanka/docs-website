---
title: The new externals setup
---
The new externals feature is available for New Relic APM agents and OpenTelemetry. Review the following to understand the steps to set up new externals for APM agents and OpenTelemetry. After you get externals set up, you may need to adjust the [sampling rate](#adjust-sampling) if you don't see enough data.

## APM agents [#externals-and-apm]

The new externals feature works closely with New Relic APM agents. For some agents you only need to install the agent, while others require some additional steps. Here’s what you need to know about setting up the new externals:

[QUESTION: DO USERS NEED TO TURN OFF CROSS-APPLICATION TRACING IF THEY HAVE BEEN USING IT?]

[QUESTION: ARE THE LINKS IN THE TABLE APPROPRIATE?]

<table>
  <thead>
    <tr>
      <th style={{ width: "200px" }}>
        Agent
      </th>
      <th>
        Setup
      </th>
    </tr>
  </thead>
    <tbody>
    <tr>
      <td>
        C SDK
      </td>
      <td>
        See the documentation about [instrumenting segments](https://docs.newrelic.com/docs/apm/agents/c-sdk/instrumentation/instrument-your-app-c-sdk/#external-segments).
      </td>
    </tr>
    <tr>
      <td>
        Go
      </td>
      <td>
        See the documentation about using [NewRoundTripper()](https://docs.newrelic.com/docs/apm/agents/go-agent/instrumentation/instrument-go-segments/).
      </td>
    </tr>
    <tr>
      <td>
        Java
      </td>
      <td>
        See the documentation about using the [Java agent API](https://docs.newrelic.com/docs/apm/agents/java-agent/api-guides/java-agent-api-instrument-external-calls-messaging-datastore-web-frameworks/) to instrument external calls. 
      </td>
    </tr>
    <tr>
      <td>
        .NET
      </td>
      <td>
        The .NET agent and the.NET agent in Azure automatically instrument external calls, but they don’t instrument methods for transactions. To see transactions, you need to use a combination of the following:

          * [Custom transactions](https://docs.newrelic.com/docs/agents/net-agent/instrumentation/net-custom-transactions/)
          * [Instrumented worker roles](https://docs.newrelic.com/docs/apm/agents/net-agent/azure-installation/install-net-agent-azure-cloud-services/#requirements)
      </td>
    </tr>
    <tr>
      <td>
        Node.js
      </td>
      <td>
        See the documentation about using the [Node.js agent API](https://docs.newrelic.com/docs/apm/agents/nodejs-agent/api-guides/guide-using-nodejs-agent-api/#external-services).
      </td>
    </tr>
    <tr>
      <td>
        PHP
      </td>
      <td>
        See the documentation about using the [PHP agent API](https://docs.newrelic.com/docs/apm/agents/php-agent/php-agent-api/guide-using-php-agent-api/#datastore) to instrument external calls.
      </td>
    </tr>
    <tr>
      <td>
        Python
      </td>
      <td>
        No extra steps are necessary: External calls are instrumented automatically.
      </td>
    </tr>
    <tr>
      <td>
        Ruby
      </td>
      <td>
        See the documentation about using the [Ruby agent API](https://docs.newrelic.com/docs/apm/agents/ruby-agent/api-guides/guide-using-ruby-agent-api/#externals) to instrument external calls.
      </td>
    </tr>
    </tbody>
</table>

## OpenTelemetry [#otel-setup]

The New Relic UI shows the new externals details once you complete the steps for setting up the OpenTelemetry instrumentation for your service. The transactions between services you see for OpenTelemetry are a little different from the transactions you see between New Relic APM agents. OpenTelemetry transactions are simply the request spans between services, without the detail for multiple API calls between services.

<Callout variant="important">
If your OpenTelemetry service is connected to an APM service, [QUESTION: WHAT MORE DO WE NEED HERE?].
</Callout>

The quality of the information you see depends on the sampling strategy you are using in the collector. See the following section about using sampling to control what you see in the UI.

[QUESTION: WHAT HAPPENS IF USERS DO NOT USE A COLLECTOR AND DO NO SAMPLING?]

[QUESTION: WHAT MAKES NEW EXTERNALS SO GREAT FOR OPENTELEMETRY IF TRANSACTION-LEVEL DETAILS IS NOT LIKE AGENTS? CAN'T THEY JUST USE AUTOMAP?]


## Adjust sampling to see more UI data [#adjust-sampling]

If you see little or no data when you start drilling beyond the initial page of the map, you may need to adjust the span reservoir to sample more data. The reason for this is that map information beyond the initial page is populated by sampled trace data. Here is some information about the different routines for adjusting the reservoir for APM agents, as well as tips for adjusting sampling for OpenTelemetry.


### APM agent sampling [#sampling-agents]

All APM agents have a reservoir that stores spans, and most of these agent reservoirs are configurable. The size of this reservoir affects how much data flows into the new externals map. 

The default agent configuration value of 2000 defines the maximum number of events the agent collects per minute. If there are more than this number, the agent collects a statistical sampling, essentially degrading the amount of data that is used in the externals map.

If you’re not seeing the type of detail you want in the UI, you can increase the size of the reservoir up to 10,000. 

Review the following to adjust the agent reservoirs:

* [C SDK](https://docs.newrelic.com/docs/apm/agents/c-sdk/instrumentation/instrument-your-app-c-sdk/#external-segments)
* [Go](https://docs.newrelic.com/docs/apm/agents/go-agent/instrumentation/instrument-go-segments/)
* [Java](https://docs.newrelic.com/docs/apm/agents/java-agent/configuration/java-agent-configuration-config-file/#cfg-span-events-max-samples-stored)
* [.NET](https://docs.newrelic.com/docs/apm/agents/net-agent/configuration/net-agent-configuration/#paragrp-max-samples-stored)
* [Node.js](https://docs.newrelic.com/docs/apm/agents/nodejs-agent/installation-configuration/nodejs-agent-configuration/#span-events-max-samples-stored)
* PHP (The reservoir is not currently configurable)
* [Python](https://docs.newrelic.com/docs/apm/agents/python-agent/configuration/python-agent-configuration/#environment-variables): See `NEW_RELIC_SPAN_EVENTS_MAX_SAMPLES_STORED`
* [Ruby](https://docs.newrelic.com/docs/apm/agents/ruby-agent/configuration/ruby-agent-configuration/#span_events-max_samples_stored)

### OpenTelemetry sampling [#otel-sampling]

For OpenTelemetry, the initial and subsequent maps as you drill down are populated by sampled traces, which means that you may not see enough useful data. To resolve this, you can change the sampling in the collector to allow more data into New Relic. 

See [Sampling](https://docs.newrelic.com/docs/more-integrations/open-source-telemetry-integrations/opentelemetry/opentelemetry-concepts/#sampling) for tips about configuration.

[QUESTION: WHAT ELSE CAN WE ADD HERE TO CLARIFY OPENTELEMETRY?]
