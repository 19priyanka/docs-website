---
title: "NerdGraph tutorial: Manage user groups and access grants"
tags:
  - APIs
  - NerdGraph
metaDescription: "Examples of using New Relic's NerdGraph API to manage users, groups, and access grants."
---

You can use New Relic’s [NerdGraph API](/docs/apis/nerdgraph/get-started/introduction-new-relic-nerdgraph) to view and manage user groups and access grants. For how to do this in the UI, see the [user management UI docs](/docs/accounts/accounts-billing/new-relic-one-user-management/user-management-ui-and-tasks). 


## Requirements [#requirements]

Requirements to manage users via NerdGraph include: 
* Requires [Pro or Enterprise edition](https://newrelic.com/pricing) (Standard edition organizations can't configure groups or access grants). 
* You must be a user on the [New Relic One user model](/docs/accounts/original-accounts-billing/original-users-roles/overview-user-models#determine-user-model). Other permissions-related requirements: 
  * Required [user type](/docs/accounts/accounts-billing/new-relic-one-user-management/user-type): core user or full platform user 
  * Required [role](/docs/accounts/accounts-billing/new-relic-one-user-management/user-management-concepts#roles): **Organization manager** or **Authentication domain manager**

## Before you start [#concepts]

Before using NerdGraph to manage your users, it will help you to understand:

* [How user groups and access grants work](/docs/accounts/accounts-billing/new-relic-one-user-management/user-management-concepts/#understand-concepts)
* [The basics of using NerdGraph](/docs/apis/nerdgraph/get-started/introduction-new-relic-nerdgraph)

This tutorial will show you how to: 
* Return information about existing groups 
* Create, update, and delete user groups
* Add and remove users from groups 
* Add and remove access grants from groups

Note that the [NerdGraph explorer](/docs/apis/nerdgraph/get-started/introduction-new-relic-nerdgraph/#explorer) has built-in docs that define the fields used in these requests.

## Query existing roles [#query-roles]

Here's an example of returning information about roles: 

```graphql
{
  actor {
    organization {
      authorizationManagement {
        authenticationDomains {
          authenticationDomains {
            groups {
              groups {
                roles {
                  roles {
                    accountId
                    displayName
                    id
                    name
                    organizationId
                    type
                  }
                }
              }
            }
          }
        }
      }
    }
  }
}
```

Here's an example result: 

```graphql
{
  "data": {
    "actor": {
      "organization": {
        "authorizationManagement": {
          "authenticationDomains": {
            "authenticationDomains": [
              {
                "groups": {
                  "groups": [
                    {
                      "roles": {
                        "roles": [
                          {
                            "accountId": "account-id",
                            "displayName": "name",
                            "id": "id",
                            "name": "role-name",
                            "organizationId": null,
                            "type": "role-type"
                          },
                          {
                            "accountId":null,
                            "displayName": "name",
                            "id": "id",
                            "name": "role-name",
                            "organizationId": "organization-id",
                            "type": "role-type"
                          }
                        ]
                      }
                    }
                  ]
                }
              }
            ]
          }
        }
      }
    }
  }
}
```

## Query users [#query-users]

Here's an example of querying information about your users: 

```
{
  actor {
    organization {
      userManagement {
        authenticationDomains {
          authenticationDomains {
            groups {
              groups {
                users {
                  users {
                    id
                    email
                    name
                    timeZone
                  }
                }
              }
            }
          }
        }
      }
    }
  }
}
```

Here's an example result:

```
{
  "data": {
    "actor": {
      "organization": {
        "userManagement": {
          "authenticationDomains": {
            "authenticationDomains": [
              {
                "groups": {
                  "groups": [
                    {
                      "users": {
                        "users": [
                          {
                            "email": "example@newrelic.com",
                            "id": "123456789",
                            "name": "Example Relic",
                            "timeZone": "Etc/UTC"
                          }
                        ]
                      }
                    }
                  ]
                }
              }
            ]
          }
        }
      }
    }
  }
}
```

## Create a group [#create-group]

Here's an example of creating a [group](/docs/accounts/accounts-billing/new-relic-one-user-management/user-management-concepts/#groups): 

```
mutation {
  userManagementCreateGroup(createGroupOptions: {authenticationDomainId: "<var>YOUR_AUTH_DOMAIN</var>", displayName: "<var>GROUP_DISPLAY_NAME</var>"}) {
    group {
      displayName
      id
    }
  }
}
```

Successful response:
```
{
  "data": {
    "userManagementCreateGroup": {
      "group": {
        "displayName": "GROUP_DISPLAY_NAME"
	  "id": "GROUP_ID"
      }
    }
  }
}
```

## Update user group [#update-group]

Here's an example of updating a [group](/docs/accounts/accounts-billing/new-relic-one-user-management/user-management-concepts/#groups).

```
mutation {
  userManagementUpdateGroup(updateGroupOptions: {displayName: "<var>YOUR_UPDATED_GROUP_NAME</var>", id: "<var>GROUP_ID</var>"}) {
    group {
      id
      displayName
    }
  }
}
```

Response for success: 
```
{
  "data": {
    "userManagementUpdateGroup": {
      "group": {
        "displayName": "YOUR_UPDATED_GROUP_NAME",
        "id": "GROUP_ID"
      }
    }
  }
}
```

Response for failure: 
```
{
  "data": {
    "userManagementUpdateGroup": null
  },
  "errors": [
    {
      "extensions": {
        "errorClass": "SERVER_ERROR"
      },
      "locations": [
        {
          "column": 3,
          "line": 2
        }
      ],
      "message": "Group could not be found",
      "path": [
        "userManagementUpdateGroup"
      ]
    }
  ]
}
```

## Delete a group [#delete-group]

Here's an example of deleting a [group](/docs/accounts/accounts-billing/new-relic-one-user-management/user-management-concepts/#groups):

```
mutation {
  userManagementDeleteGroup(groupOptions: {id: "<var>GROUP_ID</var>"}) {
    group {
      id
    }
  }
}
```

Response for success:
```
{
  "data": {
    "userManagementDeleteGroup": {
      "group": {
        "id": "GROUP_ID"
      }
    }
  }
}
```

Response for failure:
```
{
  "data": {
    "userManagementDeleteGroup": null
  },
  "errors": [
    {
      "extensions": {
        "errorClass": "SERVER_ERROR"
      },
      "locations": [
        {
          "column": 3,
          "line": 2
        }
      ],
      "message": "Couldn't find Group with 'id'='ENTERED_GROUP_ID",
      "path": [
        "userManagementDeleteGroup"
      ]
    }
  ]
}
```

## Add users to groups [#add-users]

Here's an example of adding users to groups: 

```
mutation {
  userManagementAddUsersToGroups(addUsersToGroupsOptions: {groupIds: [<var>GROUP_ID_1</var>, <var>GROUP_ID_2</var>], userIds: [<var>YOUR_USERS_IDS</var>]}) {
    groups {
      displayName
      id
    }
  }
}
```

Response for success:

```
{
  "data": {
    "userManagementAddUsersToGroups": {
      "groups": [
        {
          "displayName": "GROUP_1_NAME",
          "id": "GROUP_ID_1"
        },
        {
          "displayName": "GROUP_NAME_2",
          "id": "GROUP_ID_2"
        }
      ]
    }
  }
}
```

Response for failure:
```
{
  "data": {
    "userManagementAddUsersToGroups": null
  },
  "errors": [
    {
      "extensions": {
        "errorClass": "SERVER_ERROR"
      },
      "locations": [
        {
          "column": 3,
          "line": 2
        }
      ],
      "message": "The following ids were not found: group_ids: 'NON_EXISTENT_GROUP_ID'",
      "path": [
        "userManagementAddUsersToGroups"
      ]
    }
  ]
}
```

## Remove users from groups [#remove-users]

Here's an example of removing users from groups:

```
mutation {
  userManagementRemoveUsersFromGroups(removeUsersFromGroupsOptions: {groupIds: [<var>YOUR_GROUP_IDS</var>], userIds: [<var>YOUR_USER_IDS</var>]}) {
    groups {
      displayName
      id
    }
  }
}
```

Response for success:

```
{
  "data": {
    "userManagementRemoveUsersFromGroups": {
      "groups": [
        {
          "displayName": "YOUR_GROUP_NAME",
          "id": "YOUR_GROUP_ID"
        }
      ]
    }
  }
}
```

Response for failure:
```
​​{
  "data": {
    "userManagementRemoveUsersFromGroups": null
  },
  "errors": [
    {
      "extensions": {
        "errorClass": "SERVER_ERROR"
      },
      "locations": [
        {
          "column": 3,
          "line": 2
        }
      ],
      "message": "The following ids were not found: user_ids: 'NON-EXISTENT_USER_ID'",
      "path": [
        "userManagementRemoveUsersFromGroups"
      ]
    }
  ]
}
```

## Grant access to group [#grant-access]

Here's an example of creating an access grant (access to a role and an account) for a group:

```
mutation {
  authorizationManagementGrantAccess(grantAccessOptions: {groupId: "<var>YOUR_GROUP_ID</var>", accountAccessGrants: {accountId: "<var>ACCOUNT_ID</var>", roleId: "<var>ROLE_ID</var>"}}) {
    roles {
      displayName
      accountId
    }
  }
}
```

Response for success:

```
{
  "data": {
    "authorizationManagementGrantAccess": {
      "roles": [
        {
          "displayName": "ROLE_NAME_1",
          "id": "ROLE_ID_1"
        },
        {
          "displayName": "ROLE_NAME_2",
          "id": "ROLE_ID_2"
        },
        {
          "displayName": "ROLE_NAME_3",
          "id": "ROLE_ID_3"
        },
        {
          "displayName": "ROLE_NAME_4",
          "id": "ROLE_ID_4"
        }
      ]
    }
  }
}
```

Response for failure:
```
{
  "data": {
    "authorizationManagementGrantAccess": null
  },
  "errors": [
    {
      "extensions": {
        "errorClass": "SERVER_ERROR"
      },
      "locations": [
        {
          "column": 3,
          "line": 2
        }
      ],
      "message": "Validation failed: Role must exist, Role can't be blank, Role scope does not match granted_on type",
      "path": [
        "authorizationManagementGrantAccess"
      ]
    }
  ]
}
```

## Revoke grants from group [#revoke-grants]

Here's an example of revoking access grants from groups: 

```
mutation {
  authorizationManagementRevokeAccess(revokeAccessOptions: {accountAccessGrants: {accountId: "<var>ACCOUNT_ID</var>", roleId: "<var>ROLE_ID</var>"}, groupId: "<var>GROUP_ID</var>"}) {
    roles {
      accountId
      displayName
    }
  }
}
```

Response for success:
```
{
  "data": {
    "authorizationManagementRevokeAccess": {
      "roles": [
         {
          "displayName": "ROLE_NAME_1",
          "id": "ROLE_ID_1"
        },
        {
          "displayName": "ROLE_NAME_2",
          "id": "ROLE_ID_2"
        },
        {
          "displayName": "ROLE_NAME_3",
          "id": "ROLE_ID_3"
        }
      ]
    }
  }
}
```

